import{Q as $,r as g,k as I,a as u,h as L,w,b as t,i as C,d as i,u as V,p as B,t as a,n as _,c,e as m,f as O,F as U,j as q,l as M,x as j,A as E,g as Q}from"./app-CSuMz0Jo.js";import{A as z}from"./AuthenticatedLayout-CfED7tvs.js";import{S as v}from"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"section dashboard"},J={class:"card mb-4"},K={class:"card-header d-flex justify-content-between align-items-center"},R={class:"card-body"},W={class:"row"},X={class:"col-md-3"},Y={class:"col-md-3"},Z={class:"col-md-3"},tt={class:"col-md-3"},st={key:0,class:"row mt-3"},et={class:"col-md-6"},at={class:"badge bg-info"},lt={class:"col-md-6"},ot={class:"badge bg-info"},nt={class:"row mb-4"},dt={class:"col-md-3"},rt={class:"card text-center"},it={class:"card-body"},ut={class:"text-primary"},ct={class:"col-md-3"},mt={class:"card text-center"},bt={class:"card-body"},vt={class:"text-info"},ft={class:"col-md-3"},gt={class:"card text-center"},_t={class:"card-body"},ht={class:"text-success"},pt={class:"col-md-3"},yt={class:"card text-center"},xt={class:"card-body"},kt={class:"text-danger"},wt={class:"card"},Mt={class:"card-body"},Ft={class:"table-responsive"},St={class:"table table-hover"},Ct={class:"text-success"},Vt=["onClick"],Bt={key:0},jt={class:"modal-dialog"},Dt={class:"modal-content"},At={class:"modal-header"},Nt={class:"modal-title"},Pt={class:"modal-body"},Tt={class:"mb-3"},$t=["value"],It={class:"mb-3"},Lt=["max"],Ot={class:"mb-3"},Ut=["disabled"],qt={key:0,class:"text-danger"},Et={class:"mb-3"},Qt={key:0,class:"alert alert-info"},zt={class:"modal-footer"},Gt=["disabled"],Ht={key:0,class:"spinner-border spinner-border-sm me-2"},Jt={key:0,class:"modal-backdrop fade show"},Kt={__name:"Show",props:{customer:Object,invoices:Array,statistics:Object,translations:Object},setup(o){const h=o;$();const b=g(!1),r=g(null),f=g(!1),n=g({amount:"",payment_method:"cash",notes:""}),p=I(()=>h.customer.balance?n.value.payment_method!=="balance"?!0:(h.customer.balance.balance_dinar||0)>=parseFloat(n.value.amount||0):!1),d=(e,s="dinar")=>e?`${parseFloat(e).toFixed(2)} ${s==="dollar"?"$":"د.ع"}`:"0.00",D=e=>e?new Date(e).toLocaleDateString("ar-IQ"):"-",A=e=>({paid:"مدفوعة",due:"غير مدفوعة",pending:"قيد الانتظار",completed:"مكتملة",cancelled:"ملغاة"})[e]||e,N=e=>({paid:"badge bg-success",due:"badge bg-danger",pending:"badge bg-warning",completed:"badge bg-success",cancelled:"badge bg-secondary"})[e]||"badge bg-secondary",P=e=>({cash:"نقدي",balance:"من الرصيد",transfer:"تحويل"})[e]||e,T=e=>{r.value=e,n.value={amount:e.remaining.toFixed(2),payment_method:"cash",notes:""},b.value=!0},y=()=>{b.value=!1,r.value=null,n.value={amount:"",payment_method:"cash",notes:""}},F=()=>{if(r.value){if(parseFloat(n.value.amount)<=0){v.fire("خطأ","المبلغ يجب أن يكون أكبر من صفر","error");return}if(parseFloat(n.value.amount)>r.value.remaining){v.fire("خطأ","المبلغ المدفوع أكبر من المبلغ المتبقي","error");return}if(n.value.payment_method==="balance"&&!p.value){v.fire("خطأ","الرصيد غير كافي","error");return}f.value=!0,Q.post(route("customers.orders.pay",{customer:h.customer.id,order:r.value.id}),n.value,{onSuccess:()=>{v.fire("نجح","تم دفع الفاتورة بنجاح","success"),y()},onError:e=>{const s=e.message||e.amount||"حدث خطأ أثناء الدفع";v.fire("خطأ",s,"error")},onFinish:()=>{f.value=!1}})}};return(e,s)=>(u(),L(z,{translations:o.translations},{default:w(()=>{var x,k,S;return[t("section",H,[t("div",J,[t("div",K,[s[4]||(s[4]=t("h5",{class:"mb-0"},"معلومات العميل",-1)),C(V(B),{href:e.route("customers.index"),class:"btn btn-secondary btn-sm"},{default:w(()=>s[3]||(s[3]=[t("i",{class:"bi bi-arrow-right"},null,-1),i(" رجوع ")])),_:1},8,["href"])]),t("div",R,[t("div",W,[t("div",X,[s[5]||(s[5]=t("strong",null,"الاسم:",-1)),i(" "+a(o.customer.name),1)]),t("div",Y,[s[6]||(s[6]=t("strong",null,"الهاتف:",-1)),i(" "+a(o.customer.phone||"-"),1)]),t("div",Z,[s[7]||(s[7]=t("strong",null,"البريد الإلكتروني:",-1)),i(" "+a(o.customer.email||"-"),1)]),t("div",tt,[s[8]||(s[8]=t("strong",null,"الحالة:",-1)),t("span",{class:_(o.customer.is_active?"badge bg-success":"badge bg-danger")},a(o.customer.is_active?"نشط":"غير نشط"),3)])]),o.customer.balance?(u(),c("div",st,[t("div",et,[s[9]||(s[9]=t("strong",null,"الرصيد بالدولار:",-1)),t("span",at,a(d(o.customer.balance.balance_dollar||0,"dollar")),1)]),t("div",lt,[s[10]||(s[10]=t("strong",null,"الرصيد بالدينار:",-1)),t("span",ot,a(d(o.customer.balance.balance_dinar||0,"dinar")),1)])])):m("",!0)])]),t("div",nt,[t("div",dt,[t("div",rt,[t("div",it,[s[11]||(s[11]=t("h6",{class:"text-muted"},"إجمالي الفواتير",-1)),t("h4",ut,a(o.statistics.total_invoices),1)])])]),t("div",ct,[t("div",mt,[t("div",bt,[s[12]||(s[12]=t("h6",{class:"text-muted"},"إجمالي المبلغ",-1)),t("h4",vt,a(d(o.statistics.total_amount)),1)])])]),t("div",ft,[t("div",gt,[t("div",_t,[s[13]||(s[13]=t("h6",{class:"text-muted"},"إجمالي المدفوع",-1)),t("h4",ht,a(d(o.statistics.total_paid)),1)])])]),t("div",pt,[t("div",yt,[t("div",xt,[s[14]||(s[14]=t("h6",{class:"text-muted"},"إجمالي الدين",-1)),t("h4",kt,a(d(o.statistics.total_debt)),1)])])])]),t("div",wt,[s[19]||(s[19]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},"الفواتير المرتبطة")],-1)),t("div",Mt,[t("div",Ft,[t("table",St,[s[18]||(s[18]=t("thead",null,[t("tr",null,[t("th",null,"رقم الفاتورة"),t("th",null,"التاريخ"),t("th",null,"المبلغ الإجمالي"),t("th",null,"الخصم"),t("th",null,"المبلغ النهائي"),t("th",null,"المدفوع"),t("th",null,"المتبقي"),t("th",null,"الحالة"),t("th",null,"طريقة الدفع"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(u(!0),c(U,null,O(o.invoices,l=>(u(),c("tr",{key:l.id},[t("td",null,a(l.order_number),1),t("td",null,a(D(l.date)),1),t("td",null,a(d(l.total_amount)),1),t("td",null,a(d(l.discount_amount)),1),t("td",null,[t("strong",null,a(d(l.final_amount)),1)]),t("td",Ct,a(d(l.total_paid)),1),t("td",{class:_(["text-danger",{"fw-bold":l.remaining>0}])},a(d(l.remaining)),3),t("td",null,[t("span",{class:_(N(l.status))},a(A(l.status)),3)]),t("td",null,a(P(l.payment_method)),1),t("td",null,[l.remaining>0?(u(),c("button",{key:0,class:"btn btn-sm btn-primary",onClick:Rt=>T(l)},s[15]||(s[15]=[t("i",{class:"bi bi-cash-coin"},null,-1),i(" دفع ")]),8,Vt)):m("",!0),C(V(B),{href:e.route("order.print",l.id),class:"btn btn-sm btn-info",target:"_blank"},{default:w(()=>s[16]||(s[16]=[t("i",{class:"bi bi-printer"},null,-1),i(" طباعة ")])),_:2},1032,["href"])])]))),128)),o.invoices.length===0?(u(),c("tr",Bt,s[17]||(s[17]=[t("td",{colspan:"10",class:"text-center text-muted"},"لا توجد فواتير",-1)]))):m("",!0)])])])])])]),b.value?(u(),c("div",{key:0,class:_(["modal fade",{show:b.value,"d-block":b.value}]),tabindex:"-1"},[t("div",jt,[t("div",Dt,[t("div",At,[t("h5",Nt,"دفع الفاتورة "+a((x=r.value)==null?void 0:x.order_number),1),t("button",{type:"button",class:"btn-close",onClick:y})]),t("div",Pt,[t("form",{onSubmit:q(F,["prevent"])},[t("div",Tt,[s[20]||(s[20]=t("label",{class:"form-label"},"المبلغ المتبقي",-1)),t("input",{type:"text",class:"form-control",value:d(((k=r.value)==null?void 0:k.remaining)||0),disabled:""},null,8,$t)]),t("div",It,[s[21]||(s[21]=t("label",{class:"form-label"},[i("المبلغ المدفوع "),t("span",{class:"text-danger"},"*")],-1)),M(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=l=>n.value.amount=l),step:"0.01",min:"0.01",max:(S=r.value)==null?void 0:S.remaining,required:""},null,8,Lt),[[j,n.value.amount]])]),t("div",Ot,[s[24]||(s[24]=t("label",{class:"form-label"},[i("طريقة الدفع "),t("span",{class:"text-danger"},"*")],-1)),M(t("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=l=>n.value.payment_method=l),required:""},[s[22]||(s[22]=t("option",{value:"cash"},"نقدي",-1)),t("option",{value:"balance",disabled:!p.value},"من الرصيد",8,Ut),s[23]||(s[23]=t("option",{value:"transfer"},"تحويل",-1))],512),[[E,n.value.payment_method]]),n.value.payment_method==="balance"&&!p.value?(u(),c("small",qt," الرصيد غير كافي ")):m("",!0)]),t("div",Et,[s[25]||(s[25]=t("label",{class:"form-label"},"ملاحظات",-1)),M(t("textarea",{class:"form-control","onUpdate:modelValue":s[2]||(s[2]=l=>n.value.notes=l),rows:"3"},null,512),[[j,n.value.notes]])]),r.value?(u(),c("div",Qt,[s[26]||(s[26]=t("strong",null,"المبلغ النهائي:",-1)),i(" "+a(d(r.value.final_amount)),1),s[27]||(s[27]=t("br",null,null,-1)),s[28]||(s[28]=t("strong",null,"المدفوع سابقاً:",-1)),i(" "+a(d(r.value.total_paid)),1),s[29]||(s[29]=t("br",null,null,-1)),s[30]||(s[30]=t("strong",null,"المتبقي:",-1)),i(" "+a(d(r.value.remaining)),1)])):m("",!0)],32)]),t("div",zt,[t("button",{type:"button",class:"btn btn-secondary",onClick:y},"إلغاء"),t("button",{type:"button",class:"btn btn-primary",onClick:F,disabled:f.value},[f.value?(u(),c("span",Ht)):m("",!0),s[31]||(s[31]=i(" دفع "))],8,Gt)])])]),b.value?(u(),c("div",Jt)):m("",!0)],2)):m("",!0)]}),_:1},8,["translations"]))}},ts=G(Kt,[["__scopeId","data-v-8c9cad2d"]]);export{ts as default};
