import{r as h,o as A,a as l,c as F,w,b as s,t as a,d,e as o,f as c,F as p,g as x,n as _,h as f}from"./app-AYyl8aPx.js";import{_ as M}from"./AuthenticatedLayout-CYr2UffW.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"d-flex justify-content-between align-items-center"},P={class:"font-semibold text-xl text-gray-800 leading-tight"},q={class:"py-12"},B={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},D={class:"card mb-4"},K={class:"card-body"},X={class:"row g-3"},z={class:"col-md-2"},I=["disabled"],V={key:0,class:"bi bi-play-circle"},$={key:1,class:"spinner-border spinner-border-sm me-2"},L={key:2,class:"badge bg-light text-dark ms-2"},G={class:"col-md-2"},H=["disabled"],J={key:0,class:"bi bi-arrow-counterclockwise"},Q={key:1,class:"spinner-border spinner-border-sm me-2"},U={class:"col-md-2"},W=["disabled"],Y={key:0,class:"bi bi-arrow-repeat"},Z={key:1,class:"spinner-border spinner-border-sm me-2"},ss={class:"col-md-3"},ts=["disabled"],es={key:0,class:"bi bi-database-add"},as={key:1,class:"spinner-border spinner-border-sm me-2"},ls={class:"col-md-3"},ns=["disabled"],os={class:"card mb-4"},is={class:"card-header"},rs={class:"card-title mb-0"},ds={class:"card-body"},cs={key:0},us={class:"text-primary"},bs={class:"table-responsive"},ms={class:"table table-sm table-hover"},vs={key:0,class:"badge bg-success"},gs={key:1,class:"badge bg-warning"},hs={key:0,class:"badge bg-info"},fs={key:1,class:"text-muted"},ys={class:"row mt-3"},_s={class:"col-md-6"},ks={class:"alert alert-warning"},ws={class:"col-md-6"},ps={class:"alert alert-success"},xs={key:1,class:"text-center text-muted py-4"},Ss={class:"card"},Cs={class:"card-header"},js={class:"card-title mb-0"},Ts={class:"card-body"},Os={class:"table-responsive"},Ns={class:"table table-striped table-hover"},As={class:"badge bg-info"},Fs={class:"badge bg-secondary"},Ms={class:"text-muted"},Rs={class:"text-muted"},Es={key:0,class:"modal-mask"},Ps={class:"modal-wrapper"},qs={class:"modal-container modal-lg"},Bs={class:"modal-header"},Ds={class:"modal-body"},Ks={key:0,class:"alert alert-info"},Xs={key:1,class:"bg-dark text-light p-3 rounded",style:{"font-family":"monospace","white-space":"pre-wrap","max-height":"400px","overflow-y":"auto"}},zs={class:"modal-footer"},Is={__name:"Migrations",props:{migrations:Object,tables:Array,translations:Object},setup(e){const y=e,n=h(!1),u=h(!1),g=h(""),b=h(""),m=h(!1),v=h(""),S=async()=>{if(confirm("هل أنت متأكد من تشغيل المايكريشنات المعلقة؟")){n.value=!0;try{const t=await(await fetch("/admin/migrations/run",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{n.value=!1}}},C=async()=>{if(confirm(y.translations.confirm_rollback)){n.value=!0;try{const t=await(await fetch("/admin/migrations/rollback",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{n.value=!1}}},j=async()=>{if(confirm(y.translations.confirm_refresh)){n.value=!0;try{const t=await(await fetch("/admin/migrations/refresh",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{n.value=!1}}},T=async()=>{if(confirm(y.translations.confirm_seeders)){n.value=!0;try{const t=await(await fetch("/admin/migrations/seeders",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{n.value=!1}}},k=()=>{f.reload()},O=i=>i?new Date(i).toLocaleString("ar-SA"):"غير محدد",N=i=>new Intl.NumberFormat("ar-SA").format(i);return A(()=>{setInterval(()=>{n.value||k()},3e4)}),(i,t)=>(l(),F(M,{translations:e.translations},{header:w(()=>[s("div",E,[s("h2",P,a(e.translations.migration_management),1)])]),default:w(()=>[s("div",q,[s("div",B,[s("div",D,[t[3]||(t[3]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-gear"}),d(" إجراءات المايكريشنات ")])],-1)),s("div",K,[s("div",X,[s("div",z,[s("button",{onClick:S,disabled:n.value||e.migrations.pending.length===0,class:"btn btn-success w-100"},[n.value?c("",!0):(l(),o("i",V)),n.value?(l(),o("span",$)):c("",!0),d(" "+a(e.translations.run_pending)+" ",1),e.migrations.pending.length>0?(l(),o("span",L,a(e.migrations.pending.length),1)):c("",!0)],8,I)]),s("div",G,[s("button",{onClick:C,disabled:n.value||e.migrations.executed.length===0,class:"btn btn-warning w-100"},[n.value?c("",!0):(l(),o("i",J)),n.value?(l(),o("span",Q)):c("",!0),d(" "+a(e.translations.rollback_last),1)],8,H)]),s("div",U,[s("button",{onClick:j,disabled:n.value,class:"btn btn-danger w-100"},[n.value?c("",!0):(l(),o("i",Y)),n.value?(l(),o("span",Z)):c("",!0),d(" "+a(e.translations.refresh_all),1)],8,W)]),s("div",ss,[s("button",{onClick:T,disabled:n.value,class:"btn btn-info w-100"},[n.value?c("",!0):(l(),o("i",es)),n.value?(l(),o("span",as)):c("",!0),d(" "+a(e.translations.run_seeders),1)],8,ts)]),s("div",ls,[s("button",{onClick:k,disabled:n.value,class:"btn btn-outline-primary w-100"},t[2]||(t[2]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1),d(" تحديث البيانات ")]),8,ns)])])])]),s("div",os,[s("div",is,[s("h5",rs,[t[4]||(t[4]=s("i",{class:"bi bi-list-check"},null,-1)),d(" "+a(e.translations.migration_status),1)])]),s("div",ds,[e.migrations.all&&e.migrations.all.length>0?(l(),o("div",cs,[s("h6",us,[t[5]||(t[5]=s("i",{class:"bi bi-list-ul"},null,-1)),d(" جميع المايكريشنات ("+a(e.migrations.all.length)+") ",1)]),s("div",bs,[s("table",ms,[s("thead",null,[s("tr",null,[s("th",null,a(e.translations.migration_name),1),t[6]||(t[6]=s("th",null,"الحالة",-1)),s("th",null,a(e.translations.batch),1)])]),s("tbody",null,[(l(!0),o(p,null,x(e.migrations.all,r=>(l(),o("tr",{key:r.migration,class:_({"table-warning":r.status==="Pending","table-success":r.status==="Ran"})},[s("td",null,[s("code",null,a(r.migration),1)]),s("td",null,[r.status==="Ran"?(l(),o("span",vs,t[7]||(t[7]=[s("i",{class:"bi bi-check-circle"},null,-1),d(" منفذ ")]))):(l(),o("span",gs,t[8]||(t[8]=[s("i",{class:"bi bi-clock"},null,-1),d(" معلق ")])))]),s("td",null,[r.batch!=="N/A"?(l(),o("span",hs,a(r.batch),1)):(l(),o("span",fs,"-"))])],2))),128))])])])])):c("",!0),s("div",ys,[s("div",_s,[s("div",ks,[t[9]||(t[9]=s("i",{class:"bi bi-clock"},null,-1)),t[10]||(t[10]=s("strong",null,"المايكريشنات المعلقة:",-1)),d(" "+a(e.migrations.pending?e.migrations.pending.length:0),1)])]),s("div",ws,[s("div",ps,[t[11]||(t[11]=s("i",{class:"bi bi-check-circle"},null,-1)),t[12]||(t[12]=s("strong",null,"المايكريشنات المنفذة:",-1)),d(" "+a(e.migrations.executed?e.migrations.executed.length:0),1)])])]),!e.migrations.all||e.migrations.all.length===0?(l(),o("div",xs,t[13]||(t[13]=[s("i",{class:"bi bi-inbox display-4"},null,-1),s("p",{class:"mt-2"},"لا توجد مايكريشنات",-1)]))):c("",!0)])]),s("div",Ss,[s("div",Cs,[s("h5",js,[t[14]||(t[14]=s("i",{class:"bi bi-table"},null,-1)),d(" "+a(e.translations.table_info),1)])]),s("div",Ts,[s("div",Os,[s("table",Ns,[s("thead",null,[s("tr",null,[s("th",null,a(e.translations.table_name),1),s("th",null,a(e.translations.table_rows),1),s("th",null,a(e.translations.table_size),1),t[15]||(t[15]=s("th",null,"المحرك",-1)),t[16]||(t[16]=s("th",null,"الترميز",-1)),s("th",null,a(e.translations.last_modified),1)])]),s("tbody",null,[(l(!0),o(p,null,x(e.tables,r=>(l(),o("tr",{key:r.name},[s("td",null,[s("strong",null,a(r.name),1)]),s("td",null,[s("span",As,a(N(r.rows)),1)]),s("td",null,a(r.size),1),s("td",null,[s("span",Fs,a(r.engine),1)]),s("td",null,[s("small",Ms,a(r.collation),1)]),s("td",null,[s("small",Rs,a(O(r.updated)),1)])]))),128))])])])])]),u.value?(l(),o("div",Es,[s("div",Ps,[s("div",qs,[s("div",Bs,[t[17]||(t[17]=s("h5",{class:"modal-title"},"نتيجة تنفيذ المايكريشن",-1)),s("button",{onClick:t[0]||(t[0]=r=>u.value=!1),class:"btn-close"})]),s("div",Ds,[s("div",{class:_(["alert",m.value?"alert-success":"alert-danger"])},[s("i",{class:_(["bi",m.value?"bi-check-circle":"bi-exclamation-triangle"])},null,2),d(" "+a(g.value),1)],2),v.value?(l(),o("div",Ks,[t[18]||(t[18]=s("i",{class:"bi bi-lightbulb"},null,-1)),t[19]||(t[19]=s("strong",null,"اقتراح:",-1)),d(" "+a(v.value),1)])):c("",!0),b.value?(l(),o("div",Xs,a(b.value),1)):c("",!0)]),s("div",zs,[s("button",{onClick:t[1]||(t[1]=r=>u.value=!1),class:"btn btn-secondary"},"إغلاق")])])])])):c("",!0)])])]),_:1},8,["translations"]))}},Gs=R(Is,[["__scopeId","data-v-fa343bd8"]]);export{Gs as default};
