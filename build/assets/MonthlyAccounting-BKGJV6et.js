import{r as h,k as L,o as q,C as D,a as i,h as B,w as N,b as t,i as P,d as u,n as f,c as d,t as e,e as v,F as w,f as M,l as x,A as O,x as Y,g as C}from"./app-D346Pjzq.js";import{_ as K}from"./AuthenticatedLayout-BheGbMS3.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"pagetitle dark:text-white"},H={class:"breadcrumb"},J={class:"breadcrumb-item"},z={class:"section"},I={class:"row"},G={class:"col-lg-12"},Q={class:"card"},W={class:"card-body"},Z={class:"nav nav-tabs",id:"monthlyTabs",role:"tablist"},tt={class:"nav-item",role:"presentation"},st={class:"nav-item",role:"presentation"},ot={class:"nav-item",role:"presentation"},et={class:"tab-content mt-4"},lt={key:0,class:"tab-pane fade show active"},nt={class:"row"},at={class:"col-md-8"},it={class:"card"},dt={class:"card-header"},rt={class:"card-title mb-0"},ct={class:"card-body"},ut={class:"row"},vt={class:"col-md-6"},mt={class:"info-item"},bt={class:"value"},_t={class:"info-item"},ht={class:"value"},yt={class:"info-item"},ft={class:"value"},pt={class:"info-item"},gt={class:"value text-danger"},kt={class:"info-item"},wt={class:"value text-danger"},Mt={class:"col-md-6"},Ct={class:"info-item"},xt={class:"value"},Tt={class:"info-item"},$t={class:"value"},St={class:"info-item"},jt={class:"value text-success"},Nt={class:"mt-4"},Ot={class:"row"},At={class:"col-md-6"},Ft={class:"info-item"},Et={class:"value"},Rt={class:"col-md-6"},Vt={class:"info-item"},Lt={class:"value"},qt={class:"mt-4"},Dt={class:"row"},Bt={class:"col-md-6"},Pt={class:"info-item"},Yt={class:"value text-danger"},Kt={class:"col-md-6"},Ut={class:"info-item"},Xt={class:"value text-danger"},Ht={key:0,class:"mt-3"},Jt={class:"text-muted"},zt={class:"col-md-4"},It={class:"card"},Gt={class:"card-body"},Qt={key:0,class:"d-grid gap-2"},Wt={key:1,class:"alert alert-info"},Zt={class:"mt-3"},ts=["disabled"],ss={key:1,class:"tab-pane fade show active"},os={class:"card"},es={class:"card-body"},ls={class:"table-responsive"},ns={class:"table table-striped"},as={class:"btn-group",role:"group"},is=["onClick"],ds=["onClick"],rs={class:"d-flex justify-content-center mt-3"},cs={class:"pagination"},us=["onClick","innerHTML","disabled"],vs={key:2,class:"tab-pane fade show active"},ms={class:"card"},bs={class:"card-body"},_s={class:"row mb-3"},hs={class:"col-md-4"},ys=["value"],fs={class:"col-md-4"},ps=["value"],gs={class:"col-md-4"},ks=["disabled"],ws={key:0,class:"mt-4"},Ms={class:"card"},Cs={class:"card-header"},xs={class:"card-title mb-0"},Ts={class:"card-body"},$s={class:"row"},Ss={class:"col-md-6"},js={class:"info-item"},Ns={class:"value"},Os={class:"info-item"},As={class:"value"},Fs={class:"info-item"},Es={class:"value"},Rs={class:"col-md-6"},Vs={class:"info-item"},Ls={class:"value"},qs={class:"info-item"},Ds={class:"value"},Bs={class:"info-item"},Ps={class:"value text-success"},Ys={key:0,class:"modal fade show d-block",tabindex:"-1"},Ks={class:"modal-dialog"},Us={class:"modal-content"},Xs={class:"modal-header"},Hs={class:"modal-body"},Js={class:"mb-3"},zs={class:"modal-footer"},Is=["disabled"],Gs={key:0,class:"spinner-border spinner-border-sm me-2"},Qs={key:1,class:"modal-backdrop fade show"},Ws={__name:"MonthlyAccounting",props:{translations:Object,activeTab:String,currentMonth:Object,monthlyAccounts:Object,monthlyReport:Object},setup(l){const T=l,c=h(T.activeTab||"current"),y=h(!1),g=h(""),k=h(!1),m=h(""),b=h(""),_=h(T.monthlyReport),A=L(()=>{const n=new Date().getFullYear();return Array.from({length:5},(s,r)=>n-r)}),$=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],a=(n,s="dollar")=>{if(n==null)return"0.00";const r=s==="dollar"?"$":"د.ع";return`${parseFloat(n).toFixed(2)} ${r}`},F=async()=>{k.value=!0;try{const s=await(await fetch(route("decoration.monthly.close"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({notes:g.value})})).json();s.success?(y.value=!1,g.value="",C.reload()):alert(s.message||"حدث خطأ أثناء إغلاق الشهر")}catch(n){console.error("Error closing month:",n),alert("حدث خطأ أثناء إغلاق الشهر")}finally{k.value=!1}},S=async n=>{try{const r=await(await fetch(route("decoration.monthly.recalculate",n),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();r.success?(alert("تم إعادة حساب البيانات بنجاح"),C.reload()):alert(r.message||"حدث خطأ أثناء إعادة حساب البيانات")}catch(s){console.error("Error recalculating data:",s),alert("حدث خطأ أثناء إعادة حساب البيانات")}},E=async(n,s)=>{try{const o=await(await fetch(route("decoration.monthly.payoutCommissions"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({year:n,month:s})})).json();o.success?(alert("تم دفع العمولات بنجاح"),C.reload()):alert(o.message||"حدث خطأ أثناء دفع العمولات")}catch(r){console.error("Error paying out commissions:",r),alert("حدث خطأ أثناء دفع العمولات")}},R=(n,s)=>{m.value=n,b.value=s,c.value="reports",j()},j=async()=>{if(!(!m.value||!b.value))try{const s=await(await fetch(route("decoration.monthly.report",{year:m.value,month:b.value}))).json();s.success?_.value=s.data:alert(s.message||"لا توجد بيانات لهذا الشهر")}catch(n){console.error("Error loading monthly report:",n),alert("حدث خطأ أثناء تحميل التقرير")}},V=n=>{n&&C.visit(n)};return q(()=>{const n=new Date;m.value=n.getFullYear(),b.value=n.getMonth()+1}),(n,s)=>{const r=D("Link");return i(),B(K,{translations:l.translations},{default:N(()=>[t("div",X,[s[13]||(s[13]=t("h1",{class:"dark:text-white"},"المحاسبة الشهرية للديكورات",-1)),t("nav",null,[t("ol",H,[t("li",J,[P(r,{class:"nav-link dark:text-white",href:n.route("decorations.dashboard")},{default:N(()=>s[11]||(s[11]=[u(" الديكورات ")])),_:1},8,["href"])]),s[12]||(s[12]=t("li",{class:"breadcrumb-item active"},"المحاسبة الشهرية",-1))])])]),t("section",z,[t("div",I,[t("div",G,[t("div",Q,[t("div",W,[t("ul",Z,[t("li",tt,[t("button",{class:f(["nav-link",{active:c.value==="current"}]),onClick:s[0]||(s[0]=o=>c.value="current"),type:"button"}," الشهر الحالي ",2)]),t("li",st,[t("button",{class:f(["nav-link",{active:c.value==="history"}]),onClick:s[1]||(s[1]=o=>c.value="history"),type:"button"}," السجل الشهري ",2)]),t("li",ot,[t("button",{class:f(["nav-link",{active:c.value==="reports"}]),onClick:s[2]||(s[2]=o=>c.value="reports"),type:"button"}," التقارير ",2)])]),t("div",et,[c.value==="current"?(i(),d("div",lt,[t("div",nt,[t("div",at,[t("div",it,[t("div",dt,[t("h5",rt,[u(" الشهر الحالي: "+e(l.currentMonth.month_name)+" "+e(l.currentMonth.year)+" ",1),t("span",{class:f(["badge","bg-"+(l.currentMonth.status==="open"?"success":"secondary")])},e(l.currentMonth.status_name),3)])]),t("div",ct,[t("div",ut,[t("div",vt,[t("div",mt,[s[14]||(s[14]=t("label",null,"عدد الطلبات:",-1)),t("span",bt,e(l.currentMonth.total_orders),1)]),t("div",_t,[s[15]||(s[15]=t("label",null,"إجمالي مبلغ الطلبات:",-1)),t("span",ht,e(a(l.currentMonth.total_orders_amount)),1)]),t("div",yt,[s[16]||(s[16]=t("label",null,"إجمالي المدفوعات المستلمة:",-1)),t("span",ft,e(a(l.currentMonth.total_payments_received)),1)]),t("div",pt,[s[17]||(s[17]=t("label",null,"عمولات الموظفين (دولار):",-1)),t("span",gt,e(a(l.currentMonth.total_commissions_usd,"dollar")),1)]),t("div",kt,[s[18]||(s[18]=t("label",null,"عمولات الموظفين (دينار):",-1)),t("span",wt,e(a(l.currentMonth.total_commissions_iqd,"dinar")),1)])]),t("div",Mt,[t("div",Ct,[s[19]||(s[19]=t("label",null,"الرصيد بالدولار:",-1)),t("span",xt,e(a(l.currentMonth.total_balance_dollar,"dollar")),1)]),t("div",Tt,[s[20]||(s[20]=t("label",null,"الرصيد بالدينار:",-1)),t("span",$t,e(a(l.currentMonth.total_balance_dinar,"dinar")),1)]),t("div",St,[s[21]||(s[21]=t("label",null,"صافي الربح:",-1)),t("span",jt,e(a(l.currentMonth.net_profit_dollar)),1)])])]),t("div",Nt,[s[24]||(s[24]=t("h6",null,"الرصيد الافتتاحي:",-1)),t("div",Ot,[t("div",At,[t("div",Ft,[s[22]||(s[22]=t("label",null,"الدولار:",-1)),t("span",Et,e(a(l.currentMonth.opening_balance_dollar,"dollar")),1)])]),t("div",Rt,[t("div",Vt,[s[23]||(s[23]=t("label",null,"الدينار:",-1)),t("span",Lt,e(a(l.currentMonth.opening_balance_dinar,"dinar")),1)])])])]),t("div",qt,[s[27]||(s[27]=t("h6",null,"عمولات الموظفين للشهر:",-1)),t("div",Dt,[t("div",Bt,[t("div",Pt,[s[25]||(s[25]=t("label",null,"بالدولار:",-1)),t("span",Yt,e(a(l.currentMonth.total_commissions_usd,"dollar")),1)])]),t("div",Kt,[t("div",Ut,[s[26]||(s[26]=t("label",null,"بالدينار:",-1)),t("span",Xt,e(a(l.currentMonth.total_commissions_iqd,"dinar")),1)])])])]),l.currentMonth.notes?(i(),d("div",Ht,[s[28]||(s[28]=t("h6",null,"ملاحظات:",-1)),t("p",Jt,e(l.currentMonth.notes),1)])):v("",!0)])])]),t("div",zt,[t("div",It,[s[35]||(s[35]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"إجراءات الشهر")],-1)),t("div",Gt,[l.currentMonth.status==="open"?(i(),d("div",Qt,[t("button",{class:"btn btn-warning",onClick:s[3]||(s[3]=o=>y.value=!0)},s[29]||(s[29]=[t("i",{class:"bi bi-lock"},null,-1),u(" إغلاق الشهر ")])),t("button",{class:"btn btn-info",onClick:s[4]||(s[4]=o=>S(l.currentMonth.id))},s[30]||(s[30]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),u(" إعادة حساب البيانات ")]))])):(i(),d("div",Wt,s[31]||(s[31]=[t("i",{class:"bi bi-info-circle"},null,-1),u(" الشهر مغلق - لا يمكن إجراء تعديلات ")]))),t("div",Zt,[s[33]||(s[33]=t("h6",null,"دفع عمولات الموظفين",-1)),s[34]||(s[34]=t("p",{class:"text-muted"},"يمكن دفع العمولات المستحقة وتصفيتها للشهر القادم.",-1)),t("button",{class:"btn btn-outline-success w-100",onClick:s[5]||(s[5]=o=>E(l.currentMonth.year,l.currentMonth.month)),disabled:l.currentMonth.status!=="open"},s[32]||(s[32]=[t("i",{class:"bi bi-cash-coin"},null,-1),u(" دفع العمولات للشهر ")]),8,ts)])])])])])])):v("",!0),c.value==="history"?(i(),d("div",ss,[t("div",os,[s[39]||(s[39]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"السجل الشهري")],-1)),t("div",es,[t("div",ls,[t("table",ns,[s[38]||(s[38]=t("thead",null,[t("tr",null,[t("th",null,"الشهر"),t("th",null,"السنة"),t("th",null,"الحالة"),t("th",null,"عدد الطلبات"),t("th",null,"إجمالي المبلغ"),t("th",null,"المدفوعات"),t("th",null,"صافي الربح"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(i(!0),d(w,null,M(l.monthlyAccounts.data,o=>(i(),d("tr",{key:o.id},[t("td",null,e(o.month_name),1),t("td",null,e(o.year),1),t("td",null,[t("span",{class:f(["badge","bg-"+(o.status==="open"?"success":"secondary")])},e(o.status_name),3)]),t("td",null,e(o.total_orders),1),t("td",null,e(a(o.total_orders_amount)),1),t("td",null,e(a(o.total_payments_received)),1),t("td",null,e(a(o.net_profit_dollar)),1),t("td",null,[t("div",as,[t("button",{class:"btn btn-sm btn-outline-info",onClick:p=>R(o.year,o.month)},s[36]||(s[36]=[t("i",{class:"bi bi-eye"},null,-1)]),8,is),o.status==="open"?(i(),d("button",{key:0,class:"btn btn-sm btn-outline-warning",onClick:p=>S(o.id)},s[37]||(s[37]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,ds)):v("",!0)])])]))),128))])])]),t("div",rs,[t("nav",null,[t("ul",cs,[(i(!0),d(w,null,M(l.monthlyAccounts.links,o=>(i(),d("li",{key:o.label,class:f(["page-item",{active:o.active,disabled:!o.url}])},[t("button",{class:"page-link",onClick:p=>V(o.url),innerHTML:o.label,disabled:!o.url},null,8,us)],2))),128))])])])])])])):v("",!0),c.value==="reports"?(i(),d("div",vs,[t("div",ms,[s[51]||(s[51]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"تقارير شهرية")],-1)),t("div",bs,[t("div",_s,[t("div",hs,[x(t("select",{"onUpdate:modelValue":s[6]||(s[6]=o=>m.value=o),class:"form-select"},[s[40]||(s[40]=t("option",{value:""},"اختر السنة",-1)),(i(!0),d(w,null,M(A.value,o=>(i(),d("option",{key:o,value:o},e(o),9,ys))),128))],512),[[O,m.value]])]),t("div",fs,[x(t("select",{"onUpdate:modelValue":s[7]||(s[7]=o=>b.value=o),class:"form-select"},[s[41]||(s[41]=t("option",{value:""},"اختر الشهر",-1)),(i(),d(w,null,M($,(o,p)=>t("option",{key:p,value:p+1},e(o),9,ps)),64))],512),[[O,b.value]])]),t("div",gs,[t("button",{class:"btn btn-primary",onClick:j,disabled:!m.value||!b.value},s[42]||(s[42]=[t("i",{class:"bi bi-search"},null,-1),u(" عرض التقرير ")]),8,ks)])]),_.value?(i(),d("div",ws,[t("div",Ms,[t("div",Cs,[t("h5",xs," تقرير "+e($[b.value-1])+" "+e(m.value),1)]),t("div",Ts,[t("div",$s,[t("div",Ss,[s[46]||(s[46]=t("h6",null,"ملخص الشهر:",-1)),t("div",js,[s[43]||(s[43]=t("label",null,"عدد الطلبات:",-1)),t("span",Ns,e(_.value.monthly_account.total_orders),1)]),t("div",Os,[s[44]||(s[44]=t("label",null,"إجمالي المبلغ:",-1)),t("span",As,e(a(_.value.monthly_account.total_orders_amount)),1)]),t("div",Fs,[s[45]||(s[45]=t("label",null,"المدفوعات المستلمة:",-1)),t("span",Es,e(a(_.value.monthly_account.total_payments_received)),1)])]),t("div",Rs,[s[50]||(s[50]=t("h6",null,"الرصيد:",-1)),t("div",Vs,[s[47]||(s[47]=t("label",null,"الدولار:",-1)),t("span",Ls,e(a(_.value.monthly_account.total_balance_dollar,"dollar")),1)]),t("div",qs,[s[48]||(s[48]=t("label",null,"الدينار:",-1)),t("span",Ds,e(a(_.value.monthly_account.total_balance_dinar,"dinar")),1)]),t("div",Bs,[s[49]||(s[49]=t("label",null,"صافي الربح:",-1)),t("span",Ps,e(a(_.value.monthly_account.net_profit_dollar)),1)])])])])])])):v("",!0)])])])):v("",!0)])])])])])]),y.value?(i(),d("div",Ys,[t("div",Ks,[t("div",Us,[t("div",Xs,[s[52]||(s[52]=t("h5",{class:"modal-title"},"إغلاق الشهر",-1)),t("button",{type:"button",class:"btn-close",onClick:s[8]||(s[8]=o=>y.value=!1)})]),t("div",Hs,[s[54]||(s[54]=t("div",{class:"alert alert-warning"},[t("i",{class:"bi bi-exclamation-triangle"}),u(" هل أنت متأكد من إغلاق الشهر؟ لا يمكن التراجع عن هذا الإجراء. ")],-1)),t("div",Js,[s[53]||(s[53]=t("label",{for:"closeNotes",class:"form-label"},"ملاحظات (اختياري)",-1)),x(t("textarea",{id:"closeNotes","onUpdate:modelValue":s[9]||(s[9]=o=>g.value=o),class:"form-control",rows:"3",placeholder:"أضف ملاحظات حول إغلاق الشهر..."},null,512),[[Y,g.value]])])]),t("div",zs,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=o=>y.value=!1)},"إلغاء"),t("button",{type:"button",class:"btn btn-warning",onClick:F,disabled:k.value},[k.value?(i(),d("span",Gs)):v("",!0),s[55]||(s[55]=u(" إغلاق الشهر "))],8,Is)])])])])):v("",!0),y.value?(i(),d("div",Qs)):v("",!0)]),_:1},8,["translations"])}}},oo=U(Ws,[["__scopeId","data-v-c83c9b81"]]);export{oo as default};
