import{S as L,U as ot,l as O,T as at,m as M,h as D,p as rt,L as G,q as st,c as it,w as R,o as $,b as e,t as c,a as w,d as F,u as h,i as E,x as N,N as P,f as S,F as lt,s as ct,g as U}from"./app-D1Lw9uYg.js";import{_ as dt}from"./AuthenticatedLayout-ByjC1uD8.js";import{_ as W}from"./InputError-CENpJPMT.js";import{C as H}from"./vue-select-DnrZGt0h.js";import"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as ut}from"./ModalConfirmOrderAndPay-D3DG_W26.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function mt(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var Z=mt,ft=typeof L=="object"&&L&&L.Object===Object&&L,bt=ft,vt=bt,pt=typeof self=="object"&&self&&self.Object===Object&&self,yt=vt||pt||Function("return this")(),tt=yt,ht=tt,_t=function(){return ht.Date.now()},gt=_t,Tt=/\s/;function xt(t){for(var s=t.length;s--&&Tt.test(t.charAt(s)););return s}var $t=xt,jt=$t,wt=/^\s+/;function St(t){return t&&t.slice(0,jt(t)+1).replace(wt,"")}var kt=St,Ot=tt,Ct=Ot.Symbol,et=Ct,Q=et,nt=Object.prototype,It=nt.hasOwnProperty,qt=nt.toString,C=Q?Q.toStringTag:void 0;function Vt(t){var s=It.call(t,C),d=t[C];try{t[C]=void 0;var u=!0}catch{}var m=qt.call(t);return u&&(s?t[C]=d:delete t[C]),m}var Lt=Vt,Et=Object.prototype,Nt=Et.toString;function Ut(t){return Nt.call(t)}var Bt=Ut,K=et,Pt=Lt,At=Bt,Mt="[object Null]",Dt="[object Undefined]",X=K?K.toStringTag:void 0;function Gt(t){return t==null?t===void 0?Dt:Mt:X&&X in Object(t)?Pt(t):At(t)}var Rt=Gt;function Ft(t){return t!=null&&typeof t=="object"}var Wt=Ft,Ht=Rt,Qt=Wt,Kt="[object Symbol]";function Xt(t){return typeof t=="symbol"||Qt(t)&&Ht(t)==Kt}var zt=Xt,Jt=kt,z=Z,Yt=zt,J=NaN,Zt=/^[-+]0x[0-9a-f]+$/i,te=/^0b[01]+$/i,ee=/^0o[0-7]+$/i,ne=parseInt;function oe(t){if(typeof t=="number")return t;if(Yt(t))return J;if(z(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=z(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=Jt(t);var d=te.test(t);return d||ee.test(t)?ne(t.slice(2),d?2:8):Zt.test(t)?J:+t}var ae=oe,re=Z,A=gt,Y=ae,se="Expected a function",ie=Math.max,le=Math.min;function ce(t,s,d){var u,m,b,p,l,f,g=0,I=!1,T=!1,k=!0;if(typeof t!="function")throw new TypeError(se);s=Y(s)||0,re(d)&&(I=!!d.leading,T="maxWait"in d,b=T?ie(Y(d.maxWait)||0,s):b,k="trailing"in d?!!d.trailing:k);function _(r){var o=u,y=m;return u=m=void 0,g=r,p=t.apply(y,o),p}function x(r){return g=r,l=setTimeout(j,s),I?_(r):p}function B(r){var o=r-f,y=r-g,v=s-o;return T?le(v,b-y):v}function q(r){var o=r-f,y=r-g;return f===void 0||o>=s||o<0||T&&y>=b}function j(){var r=A();if(q(r))return V(r);l=setTimeout(j,B(r))}function V(r){return l=void 0,k&&u?_(r):(u=m=void 0,p)}function a(){l!==void 0&&clearTimeout(l),g=0,u=f=m=l=void 0}function n(){return l===void 0?p:V(A())}function i(){var r=A(),o=q(r);if(u=arguments,m=this,f=r,o){if(l===void 0)return x(f);if(T)return clearTimeout(l),l=setTimeout(j,s),_(f)}return l===void 0&&(l=setTimeout(j,s)),p}return i.cancel=a,i.flush=n,i}var de=ce;const ue=ot(de),me={class:"pagetitle dark:text-white"},fe={class:"dark:text-white"},be={class:"breadcrumb"},ve={class:"breadcrumb-item"},pe={class:"breadcrumb-item active dark:text-white"},ye={class:"section dashboard"},he={class:"row"},_e={class:"col-lg-12"},ge={class:"card"},Te={class:"card-body"},xe={class:"card-title"},$e={class:"row g-3"},je={class:"row mb-3"},we={for:"customerSelect",class:"col-sm-2 col-form-label"},Se={class:"col-sm-10"},ke={class:"row mb-3"},Oe={for:"inputBarcode",class:"col-sm-2 col-form-label"},Ce={class:"col-sm-10"},Ie=["placeholder"],qe={key:0,class:"row mb-3"},Ve={for:"productTable",class:"col-sm-2 col-form-label"},Le={class:"col-sm-10"},Ee={class:"table"},Ne=["onInput","onUpdate:modelValue","max"],Ue=["onUpdate:modelValue"],Be=["value"],Pe=["onClick"],Ae={class:"row"},Me={class:"col-md-6"},De={class:"col-md-6"},Ge={class:"text-center"},Re=["disabled"],Fe={key:0,class:"bi bi-save"},We={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ze={__name:"Create",props:{products:Array,customers:Array,defaultCustomer:Object,translations:Object},setup(t){let s=O(""),d=O(!1),u=O(""),m=O(!1);const b=t,p=O(b.defaultCustomer.name),l=at({customer_id:b.defaultCustomer.id,items:[],log:[],total_amount:0}),f=M([]),g=M([]),I=D(()=>s.value?b.customers.filter(a=>{const n=s.value.toLowerCase();return a.name.toLowerCase().includes(n)||a.phone.includes(n)}):b.customers),T=a=>{const n=b.products.find(i=>i.id===a.product_id);n&&(a.price=n.price,a.max_quantity=n.max_quantity)},k=a=>{const n=b.products.find(i=>i.id===a.product_id);n&&a.quantity>n.max_quantity&&(a.quantity=n.max_quantity)},_=D(()=>f.reduce((a,n)=>a+n.quantity*n.price,0));rt(_,a=>{l.total_amount=a});const x=a=>{const n=new Date().toLocaleString();g.push({message:a,timestamp:n})},B=()=>{f.push({product_id:"",quantity:1,price:0}),x("product_added")},q=a=>{f.splice(a,1),x("product_removed")},j=async a=>{d.value=!0;const n={total_amount:l.total_amount,total_paid:a.amountDollar,customer_id:l.customer_id,date:a.date,notes:a.notes,items:f.reduce((i,r)=>{let o=i.find(y=>y.product_id===r.product_id);return o?o.quantity+=r.quantity:i.push(r),i},[])};try{const i=await G.post("/api/createOrder",n);if(i.status===200||i.status===201){let r=i.data.id,o=i.data.order_id;window.open(`/api/getIndexAccountsSelas?print=2&transactions_id=${r}&order_id=${o}`,"_blank"),x("invoice_saved")}else x("invoice_save_failed")}catch(i){console.error("خطأ أثناء حفظ الفاتورة:",i),x("invoice_save_failed")}finally{d.value=!1}},V=ue(async()=>{if(u.value)try{const a=await G.get(`/api/products/${u.value}`);if(a.data.id){const n=f.find(i=>i.product_id===a.data.id);n?n.quantity+=1:f.push({product_id:a.data.id,quantity:1,price:a.data.price}),u.value="",console.log("تمت إضافة أو تحديث المنتج:",a.data)}}catch(a){console.error("خطأ أثناء البحث عن الباركود:",a)}},500);return(a,n)=>{const i=st("Link");return $(),it(dt,{translations:t.translations},{default:R(()=>{var r;return[e("div",me,[e("h1",fe,c(t.translations.invoice),1),e("nav",null,[e("ol",be,[e("li",ve,[w(i,{class:"nav-link dark:text-white",href:a.route("dashboard")},{default:R(()=>[F(c(t.translations.Home),1)]),_:1},8,["href"])]),e("li",pe,c(t.translations.invoice),1)])])]),e("section",ye,[e("div",he,[e("div",_e,[e("div",ge,[e("div",Te,[e("h5",xe,c(t.translations.create_invoice),1),e("form",$e,[e("div",je,[e("label",we,c(t.translations.client),1),e("div",Se,[w(h(H),{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=o=>p.value=o),options:I.value,label:"name","track-by":"id",reduce:o=>({id:o.id,name:o.name}),onBlur:n[1]||(n[1]=o=>a.mouseleave(p.value)),clearable:!0,placeholder:t.translations.select_customer},null,8,["modelValue","options","reduce","placeholder"]),w(W,{message:h(l).errors.customer},null,8,["message"])])]),e("div",ke,[e("label",Oe,c(t.translations.barcode),1),e("div",Ce,[E(e("input",{autofocus:"",id:"inputBarcode",type:"text",class:"form-control",placeholder:t.translations.barcode,onKeyup:n[2]||(n[2]=o=>h(V)()),"onUpdate:modelValue":n[3]||(n[3]=o=>P(u)?u.value=o:u=o)},null,40,Ie),[[N,h(u)]]),w(W,{message:h(l).errors.name},null,8,["message"])])]),p.value?($(),S("div",qe,[e("label",Ve,c(t.translations.products),1),e("div",Le,[e("table",Ee,[e("thead",null,[e("tr",null,[e("th",null,c(t.translations.product),1),e("th",null,c(t.translations.quantity),1),e("th",null,c(t.translations.price)+" "+c(t.translations.dollar),1),e("th",null,c(t.translations.total)+" "+c(t.translations.dollar),1),e("th",null,c(t.translations.actions),1)])]),e("tbody",null,[($(!0),S(lt,null,ct(f,(o,y)=>($(),S("tr",{key:y},[w(h(H),{modelValue:o.product_id,"onUpdate:modelValue":v=>o.product_id=v,options:t.products,label:"name",reduce:v=>v.id,placeholder:t.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:v=>T(o)},null,8,["modelValue","onUpdate:modelValue","options","reduce","placeholder","onMouseleave"]),e("td",null,[E(e("input",{type:"number",onInput:v=>k(o),"onUpdate:modelValue":v=>o.quantity=v,min:"1",max:o.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,Ne),[[N,o.quantity]])]),e("td",null,[E(e("input",{type:"number","onUpdate:modelValue":v=>o.price=v,min:"0",class:"form-control",placeholder:"Price"},null,8,Ue),[[N,o.price]])]),e("td",null,[e("input",{type:"number",value:o.quantity*o.price,class:"form-control",disabled:""},null,8,Be)]),e("td",null,[e("button",{type:"button",class:"btn btn-danger",onClick:v=>q(y)},n[8]||(n[8]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Pe)])]))),128))])]),(r=t.products)!=null&&r.length?($(),S("button",{key:0,type:"button",class:"btn btn-primary",onClick:B},c(t.translations.add_product),1)):U("",!0)])])):U("",!0),e("div",Ae,[e("div",Me,[e("strong",null,c(b.translations.total)+" "+c(t.translations.dollar)+":",1)]),e("div",De,[E(e("input",{type:"number","onUpdate:modelValue":n[4]||(n[4]=o=>_.value=o),class:"form-control",readonly:""},null,512),[[N,_.value]])])]),e("div",Ge,[e("button",{type:"submit",class:"btn btn-primary",disabled:h(d),onClick:n[5]||(n[5]=o=>P(m)?m.value=!0:m=!0)},[F(c(t.translations.save)+"   ",1),h(d)?U("",!0):($(),S("i",Fe)),h(d)?($(),S("span",We)):U("",!0)],8,Re)])])])])])]),w(ut,{translations:t.translations,show:h(m),total:_.value,onClose:n[6]||(n[6]=o=>P(m)?m.value=!1:m=!1),onConfirm:n[7]||(n[7]=o=>j(o))},null,8,["translations","show","total"])])]}),_:1},8,["translations"])}}};export{Ze as default};
