import{r as A,k as C,B as h,o as z,a as I,h as J,w as Q,c as E,b as e,d as T,t as d,e as M,l as x,x as k,C as Z,K as tt,V as w,M as et}from"./app-C0t-d26H.js";import{_ as nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const at={key:0,class:"modal-mask"},ot={class:"modal-wrapper"},st={class:"pos-payment-modal"},rt={class:"payment-header"},it={class:"payment-summary"},lt={class:"summary-card"},ut={class:"summary-grid"},dt={class:"summary-item"},mt={class:"summary-value amount"},ct={key:0,class:"summary-item"},ft={class:"summary-value discount"},vt={class:"summary-item total-item"},bt={class:"summary-value final-total"},yt={class:"payment-form"},pt={class:"form-layout"},gt={class:"form-column"},Tt={class:"form-group"},$t=["max"],ht={class:"form-group"},xt={class:"form-group"},kt={class:"form-label"},St={class:"form-group"},_t={class:"form-label"},jt={class:"form-column"},Ot={class:"form-group"},It={class:"amount-input-group"},wt={key:0,class:"form-group"},Dt={class:"change-display"},Ct={class:"change-amount"},Et={class:"payment-actions"},Mt={__name:"ModalConfirmOrderAndPay",props:{show:Boolean,total:Number,translations:Object,defaultCurrency:String},emits:["close","confirm"],setup(t,{emit:s}){const u=t;function m(){const o=new Date,n=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),j=String(o.getDate()).padStart(2,"0");return`${n}-${i}-${j}`}const a=A({date:m(),printInvoice:!1,amountDollar:u.total,discount_amount:0,discount_rate:0,notes:"",paymentMethod:"cash"}),b=A(null),c=C(()=>a.value.discount_rate>0?u.total*a.value.discount_rate/100:a.value.discount_amount||0),r=C(()=>Math.max(0,u.total-c.value)),f=C(()=>Math.max(0,a.value.amountDollar-r.value));h(()=>u.total,o=>{a.value.amountDollar=r.value}),h(()=>a.value.amountDollar,o=>{o<0&&(a.value.amountDollar=0)}),h(()=>a.value.discount_rate,o=>{o>0&&(a.value.discount_amount=0),a.value.amountDollar=r.value}),h(()=>a.value.discount_amount,o=>{o>0&&(a.value.discount_rate=0),a.value.amountDollar=r.value}),h(()=>u.show,o=>{o&&tt(()=>{var n,i;(n=b.value)==null||n.focus(),(i=b.value)==null||i.select()})});const v=()=>{a.value={date:m(),printInvoice:!1,amountDollar:r.value,discount_amount:0,discount_rate:0,notes:"",paymentMethod:"cash"}},_=()=>{a.value.amountDollar=r.value},p=o=>{u.show&&(o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),a.value.printInvoice=!0,g("confirm",a.value),v()),o.key==="Enter"&&o.shiftKey&&(o.preventDefault(),a.value.printInvoice=!1,g("confirm",a.value),v()),o.key==="Escape"&&(o.preventDefault(),g("close")))},g=s;return z(()=>{document.addEventListener("keydown",p)}),(o,n)=>(I(),J(Z,{name:"modal"},{default:Q(()=>[t.show?(I(),E("div",at,[e("div",ot,[e("div",st,[e("div",rt,[n[10]||(n[10]=e("h4",{class:"payment-title"},[e("i",{class:"bi bi-credit-card"}),T(" إتمام عملية الدفع ")],-1)),e("button",{onClick:n[0]||(n[0]=i=>o.$emit("close")),class:"btn-close-modal"},n[9]||(n[9]=[e("i",{class:"bi bi-x"},null,-1)]))]),e("div",it,[e("div",lt,[e("div",ut,[e("div",dt,[n[11]||(n[11]=e("div",{class:"summary-label"},"المبلغ الأصلي",-1)),e("div",mt,d(t.total.toFixed(2))+" "+d(t.defaultCurrency),1)]),c.value>0?(I(),E("div",ct,[n[12]||(n[12]=e("div",{class:"summary-label"},"الخصم",-1)),e("div",ft,"-"+d(c.value.toFixed(2))+" "+d(t.defaultCurrency),1)])):M("",!0),e("div",vt,[n[13]||(n[13]=e("div",{class:"summary-label"},"المبلغ النهائي",-1)),e("div",bt,d(r.value.toFixed(2))+" "+d(t.defaultCurrency),1)])])])]),e("div",yt,[e("div",pt,[e("div",gt,[n[16]||(n[16]=e("div",{class:"form-group"},[e("label",{class:"form-label"},"طريقة الدفع"),e("div",{class:"payment-method-cash"},[e("div",{class:"cash-indicator"},[e("i",{class:"bi bi-cash"}),e("span",null,"نقدي")])])],-1)),e("div",Tt,[n[14]||(n[14]=e("label",{class:"form-label"},"خصم مبلغ",-1)),x(e("input",{type:"number",class:"form-control","onUpdate:modelValue":n[1]||(n[1]=i=>a.value.discount_amount=i),min:"0",max:t.total,step:"0.01",placeholder:"0.00"},null,8,$t),[[k,a.value.discount_amount,void 0,{number:!0}]])]),e("div",ht,[n[15]||(n[15]=e("label",{class:"form-label"},"خصم نسبة %",-1)),x(e("input",{type:"number",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=i=>a.value.discount_rate=i),min:"0",max:"100",step:"0.1",placeholder:"0"},null,512),[[k,a.value.discount_rate,void 0,{number:!0}]])]),e("div",xt,[e("label",kt,d(t.translations.note),1),x(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[3]||(n[3]=i=>a.value.notes=i),placeholder:"ملاحظات إضافية..."},null,512),[[k,a.value.notes]])]),e("div",St,[e("label",_t,d(t.translations.date),1),x(e("input",{type:"date",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=i=>a.value.date=i)},null,512),[[k,a.value.date]])])]),e("div",jt,[e("div",Ot,[n[17]||(n[17]=e("label",{class:"form-label"},"المبلغ المدفوع",-1)),e("div",It,[x(e("input",{ref_key:"amountInput",ref:b,type:"number",class:"form-control amount-input","onUpdate:modelValue":n[5]||(n[5]=i=>a.value.amountDollar=i),min:"0",step:"0.01",placeholder:"0.00"},null,512),[[k,a.value.amountDollar,void 0,{number:!0}]]),e("button",{onClick:_,class:"btn btn-outline-primary exact-btn"}," المبلغ الصحيح ")])]),f.value>0?(I(),E("div",wt,[e("div",Dt,[n[18]||(n[18]=e("i",{class:"bi bi-arrow-return-left"},null,-1)),n[19]||(n[19]=e("span",null,"المبلغ المرتجع: ",-1)),e("span",Ct,d(f.value.toFixed(2))+" "+d(t.defaultCurrency),1)])])):M("",!0)])])]),e("div",Et,[e("button",{onClick:n[6]||(n[6]=i=>o.$emit("close")),class:"btn btn-secondary cancel-btn"},[n[20]||(n[20]=e("i",{class:"bi bi-x-circle"},null,-1)),T(" "+d(t.translations.cancel),1)]),e("button",{onClick:n[7]||(n[7]=i=>{a.value.printInvoice=!1,o.$emit("confirm",a.value),v()}),class:"btn btn-success save-btn"},[n[21]||(n[21]=e("i",{class:"bi bi-check-circle"},null,-1)),T(" "+d(t.translations.save_without_invoice),1)]),e("button",{onClick:n[8]||(n[8]=i=>{a.value.printInvoice=!0,o.$emit("confirm",a.value),v()}),class:"btn btn-primary print-btn"},[n[22]||(n[22]=e("i",{class:"bi bi-printer"},null,-1)),T(" "+d(t.translations.save_with_invoice),1)])]),n[23]||(n[23]=e("div",{class:"keyboard-info"},[e("small",{class:"text-muted"},[e("kbd",null,"Enter"),T(" حفظ وطباعة • "),e("kbd",null,"Shift+Enter"),T(" حفظ بدون طباعة • "),e("kbd",null,"Esc"),T(" إلغاء ")])],-1))])])])):M("",!0)]),_:1}))}},Fe=nt(Mt,[["__scopeId","data-v-507c4958"]]);function Nt(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var W=Nt,Ft=typeof w=="object"&&w&&w.Object===Object&&w,Vt=Ft,At=Vt,Bt=typeof self=="object"&&self&&self.Object===Object&&self,Lt=At||Bt||Function("return this")(),K=Lt,Gt=K,Pt=function(){return Gt.Date.now()},Ut=Pt,Rt=/\s/;function Wt(t){for(var s=t.length;s--&&Rt.test(t.charAt(s)););return s}var Kt=Wt,Ht=Kt,Xt=/^\s+/;function Yt(t){return t&&t.slice(0,Ht(t)+1).replace(Xt,"")}var qt=Yt,zt=K,Jt=zt.Symbol,H=Jt,B=H,X=Object.prototype,Qt=X.hasOwnProperty,Zt=X.toString,S=B?B.toStringTag:void 0;function te(t){var s=Qt.call(t,S),u=t[S];try{t[S]=void 0;var m=!0}catch{}var a=Zt.call(t);return m&&(s?t[S]=u:delete t[S]),a}var ee=te,ne=Object.prototype,ae=ne.toString;function oe(t){return ae.call(t)}var se=oe,L=H,re=ee,ie=se,le="[object Null]",ue="[object Undefined]",G=L?L.toStringTag:void 0;function de(t){return t==null?t===void 0?ue:le:G&&G in Object(t)?re(t):ie(t)}var me=de;function ce(t){return t!=null&&typeof t=="object"}var fe=ce,ve=me,be=fe,ye="[object Symbol]";function pe(t){return typeof t=="symbol"||be(t)&&ve(t)==ye}var ge=pe,Te=qt,P=W,$e=ge,U=NaN,he=/^[-+]0x[0-9a-f]+$/i,xe=/^0b[01]+$/i,ke=/^0o[0-7]+$/i,Se=parseInt;function _e(t){if(typeof t=="number")return t;if($e(t))return U;if(P(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=P(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=Te(t);var u=xe.test(t);return u||ke.test(t)?Se(t.slice(2),u?2:8):he.test(t)?U:+t}var je=_e,Oe=W,N=Ut,R=je,Ie="Expected a function",we=Math.max,De=Math.min;function Ce(t,s,u){var m,a,b,c,r,f,v=0,_=!1,p=!1,g=!0;if(typeof t!="function")throw new TypeError(Ie);s=R(s)||0,Oe(u)&&(_=!!u.leading,p="maxWait"in u,b=p?we(R(u.maxWait)||0,s):b,g="trailing"in u?!!u.trailing:g);function o(l){var y=m,$=a;return m=a=void 0,v=l,c=t.apply($,y),c}function n(l){return v=l,r=setTimeout(O,s),_?o(l):c}function i(l){var y=l-f,$=l-v,V=s-y;return p?De(V,b-$):V}function j(l){var y=l-f,$=l-v;return f===void 0||y>=s||y<0||p&&$>=b}function O(){var l=N();if(j(l))return F(l);r=setTimeout(O,i(l))}function F(l){return r=void 0,g&&m?o(l):(m=a=void 0,c)}function Y(){r!==void 0&&clearTimeout(r),v=0,m=f=a=r=void 0}function q(){return r===void 0?c:F(N())}function D(){var l=N(),y=j(l);if(m=arguments,a=this,f=l,y){if(r===void 0)return n(f);if(p)return clearTimeout(r),r=setTimeout(O,s),o(f)}return r===void 0&&(r=setTimeout(O,s)),c}return D.cancel=Y,D.flush=q,D}var Ee=Ce;const Ve=et(Ee);export{Fe as M,Ve as d};
