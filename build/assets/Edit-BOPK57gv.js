import{r as h,s as z,k as j,T as G,B as L,a as p,h as H,w as J,b as s,d as b,t as l,n as d,j as E,l as u,G as I,u as i,x as g,i as _,c as v,e as x}from"./app-uajXcrcW.js";import{_ as K}from"./AuthenticatedLayout-C12govuI.js";import{_ as f}from"./InputError-roqXDSfs.js";import{l as W}from"./lodash-Cub8QcOd.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"section dashboard"},Z={class:"row"},ss={class:"col-lg-12"},ts={class:"card"},es={class:"card-header"},os={class:"card-title mb-0"},ls={class:"text-muted mb-0"},is={class:"card-body"},as={class:"row mb-4"},ns={class:"col-12"},rs={class:"progress-steps"},cs={class:"step-label"},ds={class:"step-label"},us={class:"step-label"},ms={class:"step-label"},ps={class:"form-section"},vs={class:"section-title"},bs={class:"row mb-3"},gs={for:"inputName",class:"col-sm-2 col-form-label required"},_s={class:"col-sm-10"},fs={class:"input-group"},hs=["placeholder"],xs={class:"form-text"},ys={class:"row mb-3"},ks={for:"inputBarcode",class:"col-sm-2 col-form-label"},ws={class:"col-sm-10"},Vs={class:"input-group"},qs=["placeholder"],Is=["disabled","title"],Bs={key:0,class:"input-group-text"},Cs={key:1,class:"input-group-text text-danger"},Us={key:2,class:"input-group-text text-success"},Ss={class:"form-text"},Ns={class:"row mb-3"},Fs={for:"inputModel",class:"col-sm-2 col-form-label"},js={class:"col-sm-10"},Es={class:"input-group"},Ms=["placeholder"],Ps={class:"form-text"},$s={class:"row mb-3"},Os={for:"inputOENumber",class:"col-sm-2 col-form-label"},Rs={class:"col-sm-10"},Ds={class:"input-group"},Ts=["placeholder"],As={class:"form-text"},Qs={class:"form-section"},zs={class:"section-title"},Gs={class:"row mb-3"},Ls={for:"inputPriceCost",class:"col-sm-2 col-form-label"},Hs={class:"col-sm-10"},Js={class:"input-group"},Ks=["placeholder"],Ws={class:"input-group-text"},Xs={class:"form-text"},Ys={class:"row mb-3"},Zs={for:"inputPrice",class:"col-sm-2 col-form-label required"},st={class:"col-sm-10"},tt={class:"input-group"},et=["placeholder"],ot={class:"input-group-text"},lt={class:"form-text"},it={key:0,class:"row mb-3"},at={class:"col-sm-10"},nt={class:"alert alert-info"},rt={class:"form-section"},ct={class:"section-title"},dt={class:"row mb-3"},ut={for:"inputQuantity",class:"col-sm-2 col-form-label required"},mt={class:"col-sm-10"},pt={class:"input-group"},vt=["placeholder"],bt={class:"input-group-text"},gt={class:"form-text"},_t={class:"form-section"},ft={class:"section-title"},ht={class:"row mb-3"},xt={for:"inputNote",class:"col-sm-2 col-form-label"},yt={class:"col-sm-10"},kt={class:"input-group"},wt=["placeholder"],Vt={class:"form-text"},qt={class:"row mb-3"},It={for:"inputdate",class:"col-sm-2 col-form-label"},Bt={class:"col-sm-10"},Ct={class:"input-group"},Ut={class:"form-text"},St={class:"row mb-3"},Nt={for:"inputImage",class:"col-sm-2 col-form-label"},Ft={class:"col-sm-10"},jt={key:0,class:"upload-placeholder"},Et={class:"text-muted"},Mt={key:1,class:"image-preview"},Pt=["src","alt"],$t=["value"],Ot={class:"form-text"},Rt={class:"row mt-4"},Dt={class:"col-12"},Tt={class:"d-flex justify-content-between"},At=["disabled"],Qt=["disabled"],zt={key:0,class:"bi bi-check-circle me-2"},Gt={key:1,class:"spinner-border spinner-border-sm me-2"},Lt={__name:"Edit",props:{product:Object,productRoles:Array,roles:Object,translations:Object},setup(o){const y=h(!1),k=z(),n=h(1),w=h(null),q=h(null),r=h({checking:!1,isValid:!0,message:""}),V=h(null),B=h(null),c=o,C=j(()=>{var m;return(m=c.product)!=null&&m.image&&c.product.image.trim()!==""?`/public/storage/${c.product.image}`:"/public/dashboard-assets/img/product-placeholder.svg"}),e=G({name:c.product.name,model:c.product.model,notes:c.product.notes,oe_number:c.product.oe_number,price_cost:c.product.price_cost,quantity:c.product.quantity,price:c.product.price,created:c.product.created,barcode:c.product.barcode,selectedRoles:c.productRoles,image:null}),S=j(()=>e.name&&e.price&&e.quantity),M=()=>{n.value<4&&n.value++},P=()=>{n.value>1&&n.value--},N=()=>{n.value===1&&e.name&&(n.value=2)},$=()=>{const m=Date.now().toString(),t=Math.floor(Math.random()*1e3).toString().padStart(3,"0");e.barcode=`BC${m.slice(-6)}${t}`,F(e.barcode),k.success("تم توليد باركود جديد")},U=()=>{e.price_cost&&e.price?(V.value=parseFloat(e.price)-parseFloat(e.price_cost),B.value=V.value/parseFloat(e.price_cost)*100):(V.value=null,B.value=null)},O=()=>{q.value.click()},R=m=>{const t=m.target.files[0];if(t){e.image=t;const a=new FileReader;a.onload=Q=>{w.value=Q.target.result},a.readAsDataURL(t)}},D=()=>{e.image=null,w.value=null,q.value&&(q.value.value="")},T=async m=>{if(!m||m.length<3){r.value={checking:!1,isValid:!0,message:""};return}if(m===c.product.barcode){r.value={checking:!1,isValid:!0,message:""};return}r.value.checking=!0;try{const a=await(await fetch(route("products.checkBarcodeUnique",m))).json();r.value={checking:!1,isValid:a.unique,message:a.message},a.unique||k.warning(a.message)}catch(t){console.error("Barcode validation error:",t),r.value={checking:!1,isValid:!1,message:"خطأ في التحقق من الباركود"}}},F=W.debounce(T,500),A=()=>{if(e.barcode&&!r.value.isValid){k.error("يجب إدخال باركود صحيح ومتاح");return}if(!S.value){k.error("يرجى ملء جميع الحقول المطلوبة");return}y.value=!0,e.post(route("products.update",{product:c.product.id}),{onSuccess:()=>{y.value=!1,k.success("تم تحديث المنتج بنجاح")},onError:()=>{y.value=!1,k.error("حدث خطأ أثناء تحديث المنتج")}})};return L([()=>e.name,()=>e.price,()=>e.quantity],()=>{N()}),U(),(m,t)=>(p(),H(K,{translations:o.translations},{default:J(()=>[s("section",Y,[s("div",Z,[s("div",ss,[s("div",ts,[s("div",es,[s("h5",os,[t[10]||(t[10]=s("i",{class:"bi bi-pencil-square me-2"},null,-1)),b(" "+l(o.translations.edit_product),1)]),s("p",ls,l(o.translations.edit_product_description),1)]),s("div",is,[s("div",as,[s("div",ns,[s("div",rs,[s("div",{class:d(["step",{active:n.value>=1,completed:n.value>1}])},[t[11]||(t[11]=s("div",{class:"step-number"},"1",-1)),s("div",cs,l(o.translations.basic_info),1)],2),s("div",{class:d(["step",{active:n.value>=2,completed:n.value>2}])},[t[12]||(t[12]=s("div",{class:"step-number"},"2",-1)),s("div",ds,l(o.translations.pricing),1)],2),s("div",{class:d(["step",{active:n.value>=3,completed:n.value>3}])},[t[13]||(t[13]=s("div",{class:"step-number"},"3",-1)),s("div",us,l(o.translations.inventory),1)],2),s("div",{class:d(["step",{active:n.value>=4,completed:n.value>4}])},[t[14]||(t[14]=s("div",{class:"step-number"},"4",-1)),s("div",ms,l(o.translations.additional),1)],2)])])]),s("form",{onSubmit:E(A,["prevent"]),class:"needs-validation",novalidate:""},[u(s("div",ps,[s("h6",vs,[t[15]||(t[15]=s("i",{class:"bi bi-info-circle me-2"},null,-1)),b(" "+l(o.translations.basic_info),1)]),s("div",bs,[s("label",gs,l(o.translations.name),1),s("div",_s,[s("div",fs,[t[16]||(t[16]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-box-seam"})],-1)),u(s("input",{id:"inputName",type:"text",class:d(["form-control",{"is-invalid":i(e).errors.name}]),placeholder:o.translations.enter_product_name,"onUpdate:modelValue":t[0]||(t[0]=a=>i(e).name=a),required:"",onInput:N},null,42,hs),[[g,i(e).name]])]),s("div",xs,l(o.translations.product_name_help),1),_(f,{message:i(e).errors.name},null,8,["message"])])]),s("div",ys,[s("label",ks,l(o.translations.barcode),1),s("div",ws,[s("div",Vs,[t[21]||(t[21]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-upc-scan"})],-1)),u(s("input",{id:"inputBarcode",type:"text",class:d(["form-control",{"is-invalid":r.value.checking===!1&&!r.value.isValid,"is-valid":i(e).barcode&&r.value.isValid}]),placeholder:o.translations.enter_barcode_or_auto_generate,"onUpdate:modelValue":t[1]||(t[1]=a=>i(e).barcode=a),onInput:t[2]||(t[2]=a=>i(F)(i(e).barcode))},null,42,qs),[[g,i(e).barcode]]),s("button",{class:"btn btn-outline-secondary",type:"button",onClick:$,disabled:r.value.checking,title:o.translations.auto_generate_barcode},t[17]||(t[17]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,Is),r.value.checking?(p(),v("div",Bs,t[18]||(t[18]=[s("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1)]))):r.value.isValid?i(e).barcode&&r.value.isValid?(p(),v("div",Us,t[20]||(t[20]=[s("i",{class:"bi bi-check-circle"},null,-1)]))):x("",!0):(p(),v("div",Cs,t[19]||(t[19]=[s("i",{class:"bi bi-exclamation-triangle"},null,-1)])))]),r.value.message?(p(),v("div",{key:0,class:d(["form-text",r.value.isValid?"text-success":"text-danger"])},l(r.value.message),3)):x("",!0),s("div",Ss,l(o.translations.barcode_help),1),_(f,{message:i(e).errors.barcode},null,8,["message"])])]),s("div",Ns,[s("label",Fs,l(o.translations.model)+" ("+l(o.translations.optional)+")",1),s("div",js,[s("div",Es,[t[22]||(t[22]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-tag"})],-1)),u(s("input",{id:"inputModel",type:"text",class:d(["form-control",{"is-invalid":i(e).errors.model}]),placeholder:o.translations.enter_model_number,"onUpdate:modelValue":t[3]||(t[3]=a=>i(e).model=a)},null,10,Ms),[[g,i(e).model]])]),s("div",Ps,l(o.translations.model_help),1),_(f,{message:i(e).errors.model},null,8,["message"])])]),s("div",$s,[s("label",Os,l(o.translations.oe_number),1),s("div",Rs,[s("div",Ds,[t[23]||(t[23]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-hash"})],-1)),u(s("input",{id:"inputOENumber",type:"text",class:d(["form-control",{"is-invalid":i(e).errors.oe_number}]),placeholder:o.translations.enter_oe_number,"onUpdate:modelValue":t[4]||(t[4]=a=>i(e).oe_number=a)},null,10,Ts),[[g,i(e).oe_number]])]),s("div",As,l(o.translations.oe_number_help),1),_(f,{message:i(e).errors.oe_number},null,8,["message"])])])],512),[[I,n.value>=1]]),u(s("div",Qs,[s("h6",zs,[t[24]||(t[24]=s("i",{class:"bi bi-currency-dollar me-2"},null,-1)),b(" "+l(o.translations.pricing),1)]),s("div",Gs,[s("label",Ls,l(o.translations.price_cost),1),s("div",Hs,[s("div",Js,[t[25]||(t[25]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cart-plus"})],-1)),u(s("input",{id:"inputPriceCost",type:"number",step:"0.01",min:"0",class:d(["form-control",{"is-invalid":i(e).errors.price_cost}]),placeholder:o.translations.enter_cost_price,"onUpdate:modelValue":t[5]||(t[5]=a=>i(e).price_cost=a),onInput:U},null,42,Ks),[[g,i(e).price_cost]]),s("span",Ws,l(o.translations.dinar),1)]),s("div",Xs,l(o.translations.cost_price_help),1),_(f,{message:i(e).errors.price_cost},null,8,["message"])])]),s("div",Ys,[s("label",Zs,l(o.translations.price),1),s("div",st,[s("div",tt,[t[26]||(t[26]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cash-stack"})],-1)),u(s("input",{id:"inputPrice",type:"number",step:"0.01",min:"0",class:d(["form-control",{"is-invalid":i(e).errors.price}]),placeholder:o.translations.enter_selling_price,"onUpdate:modelValue":t[6]||(t[6]=a=>i(e).price=a),required:"",onInput:U},null,42,et),[[g,i(e).price]]),s("span",ot,l(o.translations.dinar),1)]),s("div",lt,l(o.translations.selling_price_help),1),_(f,{message:i(e).errors.price},null,8,["message"])])]),V.value!==null?(p(),v("div",it,[t[28]||(t[28]=s("div",{class:"col-sm-2"},null,-1)),s("div",at,[s("div",nt,[t[27]||(t[27]=s("i",{class:"bi bi-graph-up me-2"},null,-1)),s("strong",null,l(o.translations.profit_margin)+":",1),b(" "+l(V.value.toFixed(2))+" "+l(o.translations.dinar)+" ("+l(B.value.toFixed(1))+"%) ",1)])])])):x("",!0)],512),[[I,n.value>=2]]),u(s("div",rt,[s("h6",ct,[t[29]||(t[29]=s("i",{class:"bi bi-boxes me-2"},null,-1)),b(" "+l(o.translations.inventory),1)]),s("div",dt,[s("label",ut,l(o.translations.quantity),1),s("div",mt,[s("div",pt,[t[30]||(t[30]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-123"})],-1)),u(s("input",{id:"inputQuantity",type:"number",min:"0",class:d(["form-control",{"is-invalid":i(e).errors.quantity}]),placeholder:o.translations.enter_initial_quantity,"onUpdate:modelValue":t[7]||(t[7]=a=>i(e).quantity=a),required:""},null,10,vt),[[g,i(e).quantity]]),s("span",bt,l(o.translations.units),1)]),s("div",gt,l(o.translations.quantity_help),1),_(f,{message:i(e).errors.quantity},null,8,["message"])])])],512),[[I,n.value>=3]]),u(s("div",_t,[s("h6",ft,[t[31]||(t[31]=s("i",{class:"bi bi-info-square me-2"},null,-1)),b(" "+l(o.translations.additional),1)]),s("div",ht,[s("label",xt,l(o.translations.note),1),s("div",yt,[s("div",kt,[t[32]||(t[32]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-journal-text"})],-1)),u(s("textarea",{id:"inputNote",class:d(["form-control",{"is-invalid":i(e).errors.notes}]),placeholder:o.translations.enter_notes_optional,"onUpdate:modelValue":t[8]||(t[8]=a=>i(e).notes=a),rows:"3"},null,10,wt),[[g,i(e).notes]])]),s("div",Vt,l(o.translations.notes_help),1),_(f,{message:i(e).errors.notes},null,8,["message"])])]),s("div",qt,[s("label",It,l(o.translations.date),1),s("div",Bt,[s("div",Ct,[t[33]||(t[33]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-calendar"})],-1)),u(s("input",{id:"inputdate",type:"date",class:d(["form-control",{"is-invalid":i(e).errors.created}]),"onUpdate:modelValue":t[9]||(t[9]=a=>i(e).created=a)},null,2),[[g,i(e).created]])]),s("div",Ut,l(o.translations.date_help),1),_(f,{message:i(e).errors.created},null,8,["message"])])]),s("div",St,[s("label",Nt,l(o.translations.image),1),s("div",Ft,[s("div",{class:d(["image-upload-area",{"has-image":w.value||C.value}]),onClick:O},[s("input",{ref_key:"fileInput",ref:q,id:"inputImage",type:"file",accept:"image/*",onInput:R,style:{display:"none"}},null,544),!w.value&&!C.value?(p(),v("div",jt,[t[34]||(t[34]=s("i",{class:"bi bi-cloud-upload"},null,-1)),s("p",null,l(o.translations.click_to_upload_image),1),s("small",Et,l(o.translations.supported_formats),1)])):(p(),v("div",Mt,[s("img",{src:w.value||C.value,alt:o.translations.product_image},null,8,Pt),s("button",{type:"button",class:"btn btn-sm btn-danger remove-image",onClick:E(D,["stop"])},t[35]||(t[35]=[s("i",{class:"bi bi-x"},null,-1)]))]))],2),i(e).progress?(p(),v("progress",{key:0,value:i(e).progress.percentage,max:"100",class:"w-100 mt-2"},l(i(e).progress.percentage)+"% ",9,$t)):x("",!0),s("div",Ot,l(o.translations.image_help),1)])])],512),[[I,n.value>=4]]),s("div",Rt,[s("div",Dt,[s("div",Tt,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:P,disabled:n.value===1},[t[36]||(t[36]=s("i",{class:"bi bi-arrow-left me-2"},null,-1)),b(" "+l(o.translations.previous),1)],8,At),s("div",null,[n.value<4?(p(),v("button",{key:0,type:"button",class:"btn btn-primary me-2",onClick:M},[b(l(o.translations.next)+" ",1),t[37]||(t[37]=s("i",{class:"bi bi-arrow-right ms-2"},null,-1))])):x("",!0),s("button",{type:"submit",class:"btn btn-success",disabled:y.value||!S.value},[y.value?x("",!0):(p(),v("i",zt)),y.value?(p(),v("span",Gt)):x("",!0),b(" "+l(o.translations.update),1)],8,Qt)])])])])],32)])])])])])]),_:1},8,["translations"]))}},Yt=X(Lt,[["__scopeId","data-v-14381f02"]]);export{Yt as default};
