import{r as B,k as E,B as _,o as z,a as I,h as J,w as Q,c as N,b as e,d as S,t as v,e as M,l as j,x as O,C as Z,K as tt,W as w,N as et}from"./app-BK41XzZo.js";import{_ as nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const at={key:0,class:"modal-mask"},ot={class:"modal-wrapper"},rt={class:"pos-payment-modal"},st={class:"payment-header"},it={class:"payment-summary"},lt={class:"summary-card"},ut={class:"summary-grid"},dt={class:"summary-item"},mt={class:"summary-value amount"},ct={key:0,class:"summary-item"},ft={class:"summary-value discount"},vt={class:"summary-item total-item"},bt={class:"summary-value final-total"},yt={class:"payment-form"},pt={class:"form-layout"},gt={class:"form-column"},Tt={class:"form-group"},$t=["max"],St={class:"form-group"},ht={class:"form-group"},kt={class:"form-label"},xt={class:"form-group"},_t={class:"form-label"},jt={class:"form-column"},Ot={class:"form-group"},Dt={class:"amount-input-group"},It={key:0,class:"form-group"},wt={class:"change-display"},Ct={class:"change-amount"},Et={class:"payment-actions"},Nt={__name:"ModalConfirmOrderAndPay",props:{show:Boolean,total:Number,translations:Object,defaultCurrency:String},emits:["close","confirm"],setup(t,{emit:s}){const l=t,m=(o,n="")=>{if(o==null||o==="")return"0";const r=parseFloat(o);if(isNaN(r))return"0";const k=r.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).replace(/\.00$/,"");return n?`${k} ${n}`:k};function c(){const o=new Date,n=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),$=String(o.getDate()).padStart(2,"0");return`${n}-${r}-${$}`}const a=B({date:c(),printInvoice:!1,amountDollar:l.total,discount_amount:0,discount_rate:0,notes:"",paymentMethod:"cash"}),f=B(null),u=E(()=>a.value.discount_rate>0?l.total*a.value.discount_rate/100:a.value.discount_amount||0),d=E(()=>Math.max(0,l.total-u.value)),b=E(()=>Math.max(0,a.value.amountDollar-d.value));_(()=>l.total,o=>{a.value.amountDollar=d.value}),_(()=>a.value.amountDollar,o=>{o<0&&(a.value.amountDollar=0)}),_(()=>a.value.discount_rate,o=>{o>0&&(a.value.discount_amount=0),a.value.amountDollar=d.value}),_(()=>a.value.discount_amount,o=>{o>0&&(a.value.discount_rate=0),a.value.amountDollar=d.value}),_(()=>l.show,o=>{o&&tt(()=>{var n,r;(n=f.value)==null||n.focus(),(r=f.value)==null||r.select()})});const p=()=>{a.value={date:c(),printInvoice:!1,amountDollar:d.value,discount_amount:0,discount_rate:0,notes:"",paymentMethod:"cash"}},g=()=>{a.value.amountDollar=d.value},h=o=>{l.show&&(o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),a.value.printInvoice=!0,T("confirm",a.value),p()),o.key==="Enter"&&o.shiftKey&&(o.preventDefault(),a.value.printInvoice=!1,T("confirm",a.value),p()),o.key==="Escape"&&(o.preventDefault(),T("close")))},T=s;return z(()=>{document.addEventListener("keydown",h)}),(o,n)=>(I(),J(Z,{name:"modal"},{default:Q(()=>[t.show?(I(),N("div",at,[e("div",ot,[e("div",rt,[e("div",st,[n[10]||(n[10]=e("h4",{class:"payment-title"},[e("i",{class:"bi bi-credit-card"}),S(" إتمام عملية الدفع ")],-1)),e("button",{onClick:n[0]||(n[0]=r=>o.$emit("close")),class:"btn-close-modal"},n[9]||(n[9]=[e("i",{class:"bi bi-x"},null,-1)]))]),e("div",it,[e("div",lt,[e("div",ut,[e("div",dt,[n[11]||(n[11]=e("div",{class:"summary-label"},"المبلغ الأصلي",-1)),e("div",mt,v(m(t.total,t.defaultCurrency)),1)]),u.value>0?(I(),N("div",ct,[n[12]||(n[12]=e("div",{class:"summary-label"},"الخصم",-1)),e("div",ft,"-"+v(m(u.value,t.defaultCurrency)),1)])):M("",!0),e("div",vt,[n[13]||(n[13]=e("div",{class:"summary-label"},"المبلغ النهائي",-1)),e("div",bt,v(m(d.value,t.defaultCurrency)),1)])])])]),e("div",yt,[e("div",pt,[e("div",gt,[n[16]||(n[16]=e("div",{class:"form-group"},[e("label",{class:"form-label"},"طريقة الدفع"),e("div",{class:"payment-method-cash"},[e("div",{class:"cash-indicator"},[e("i",{class:"bi bi-cash"}),e("span",null,"نقدي")])])],-1)),e("div",Tt,[n[14]||(n[14]=e("label",{class:"form-label"},"خصم مبلغ",-1)),j(e("input",{type:"number",class:"form-control","onUpdate:modelValue":n[1]||(n[1]=r=>a.value.discount_amount=r),min:"0",max:t.total,step:"0.01",placeholder:"0.00"},null,8,$t),[[O,a.value.discount_amount,void 0,{number:!0}]])]),e("div",St,[n[15]||(n[15]=e("label",{class:"form-label"},"خصم نسبة %",-1)),j(e("input",{type:"number",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=r=>a.value.discount_rate=r),min:"0",max:"100",step:"0.1",placeholder:"0"},null,512),[[O,a.value.discount_rate,void 0,{number:!0}]])]),e("div",ht,[e("label",kt,v(t.translations.note),1),j(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[3]||(n[3]=r=>a.value.notes=r),placeholder:"ملاحظات إضافية..."},null,512),[[O,a.value.notes]])]),e("div",xt,[e("label",_t,v(t.translations.date),1),j(e("input",{type:"date",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=r=>a.value.date=r)},null,512),[[O,a.value.date]])])]),e("div",jt,[e("div",Ot,[n[17]||(n[17]=e("label",{class:"form-label"},"المبلغ المدفوع",-1)),e("div",Dt,[j(e("input",{ref_key:"amountInput",ref:f,type:"number",class:"form-control amount-input","onUpdate:modelValue":n[5]||(n[5]=r=>a.value.amountDollar=r),min:"0",step:"0.01",placeholder:"0.00"},null,512),[[O,a.value.amountDollar,void 0,{number:!0}]]),e("button",{onClick:g,class:"btn btn-outline-primary exact-btn"}," المبلغ الصحيح ")])]),b.value>0?(I(),N("div",It,[e("div",wt,[n[18]||(n[18]=e("i",{class:"bi bi-arrow-return-left"},null,-1)),n[19]||(n[19]=e("span",null,"المبلغ المرتجع: ",-1)),e("span",Ct,v(b.value.toFixed(2))+" "+v(t.defaultCurrency),1)])])):M("",!0)])])]),e("div",Et,[e("button",{onClick:n[6]||(n[6]=r=>o.$emit("close")),class:"btn btn-secondary cancel-btn"},[n[20]||(n[20]=e("i",{class:"bi bi-x-circle"},null,-1)),S(" "+v(t.translations.cancel),1)]),e("button",{onClick:n[7]||(n[7]=r=>{a.value.printInvoice=!1,o.$emit("confirm",a.value),p()}),class:"btn btn-success save-btn"},[n[21]||(n[21]=e("i",{class:"bi bi-check-circle"},null,-1)),S(" "+v(t.translations.save_without_invoice),1)]),e("button",{onClick:n[8]||(n[8]=r=>{a.value.printInvoice=!0,o.$emit("confirm",a.value),p()}),class:"btn btn-primary print-btn"},[n[22]||(n[22]=e("i",{class:"bi bi-printer"},null,-1)),S(" "+v(t.translations.save_with_invoice),1)])]),n[23]||(n[23]=e("div",{class:"keyboard-info"},[e("small",{class:"text-muted"},[e("kbd",null,"Enter"),S(" حفظ وطباعة • "),e("kbd",null,"Shift+Enter"),S(" حفظ بدون طباعة • "),e("kbd",null,"Esc"),S(" إلغاء ")])],-1))])])])):M("",!0)]),_:1}))}},Fe=nt(Nt,[["__scopeId","data-v-9a7a2f37"]]);function Mt(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var R=Mt,Ft=typeof w=="object"&&w&&w.Object===Object&&w,At=Ft,Bt=At,Lt=typeof self=="object"&&self&&self.Object===Object&&self,Vt=Bt||Lt||Function("return this")(),K=Vt,Ut=K,Gt=function(){return Ut.Date.now()},Pt=Gt,Wt=/\s/;function Rt(t){for(var s=t.length;s--&&Wt.test(t.charAt(s)););return s}var Kt=Rt,Ht=Kt,Xt=/^\s+/;function Yt(t){return t&&t.slice(0,Ht(t)+1).replace(Xt,"")}var qt=Yt,zt=K,Jt=zt.Symbol,H=Jt,L=H,X=Object.prototype,Qt=X.hasOwnProperty,Zt=X.toString,D=L?L.toStringTag:void 0;function te(t){var s=Qt.call(t,D),l=t[D];try{t[D]=void 0;var m=!0}catch{}var c=Zt.call(t);return m&&(s?t[D]=l:delete t[D]),c}var ee=te,ne=Object.prototype,ae=ne.toString;function oe(t){return ae.call(t)}var re=oe,V=H,se=ee,ie=re,le="[object Null]",ue="[object Undefined]",U=V?V.toStringTag:void 0;function de(t){return t==null?t===void 0?ue:le:U&&U in Object(t)?se(t):ie(t)}var me=de;function ce(t){return t!=null&&typeof t=="object"}var fe=ce,ve=me,be=fe,ye="[object Symbol]";function pe(t){return typeof t=="symbol"||be(t)&&ve(t)==ye}var ge=pe,Te=qt,G=R,$e=ge,P=NaN,Se=/^[-+]0x[0-9a-f]+$/i,he=/^0b[01]+$/i,ke=/^0o[0-7]+$/i,xe=parseInt;function _e(t){if(typeof t=="number")return t;if($e(t))return P;if(G(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=G(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=Te(t);var l=he.test(t);return l||ke.test(t)?xe(t.slice(2),l?2:8):Se.test(t)?P:+t}var je=_e,Oe=R,F=Pt,W=je,De="Expected a function",Ie=Math.max,we=Math.min;function Ce(t,s,l){var m,c,a,f,u,d,b=0,p=!1,g=!1,h=!0;if(typeof t!="function")throw new TypeError(De);s=W(s)||0,Oe(l)&&(p=!!l.leading,g="maxWait"in l,a=g?Ie(W(l.maxWait)||0,s):a,h="trailing"in l?!!l.trailing:h);function T(i){var y=m,x=c;return m=c=void 0,b=i,f=t.apply(x,y),f}function o(i){return b=i,u=setTimeout($,s),p?T(i):f}function n(i){var y=i-d,x=i-b,A=s-y;return g?we(A,a-x):A}function r(i){var y=i-d,x=i-b;return d===void 0||y>=s||y<0||g&&x>=a}function $(){var i=F();if(r(i))return k(i);u=setTimeout($,n(i))}function k(i){return u=void 0,h&&m?T(i):(m=c=void 0,f)}function Y(){u!==void 0&&clearTimeout(u),b=0,m=d=c=u=void 0}function q(){return u===void 0?f:k(F())}function C(){var i=F(),y=r(i);if(m=arguments,c=this,d=i,y){if(u===void 0)return o(d);if(g)return clearTimeout(u),u=setTimeout($,s),T(d)}return u===void 0&&(u=setTimeout($,s)),f}return C.cancel=Y,C.flush=q,C}var Ee=Ce;const Ae=et(Ee);export{Fe as M,Ae as d};
