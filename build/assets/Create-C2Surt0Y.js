import{l as g,T as H,m as B,h as L,p as K,q as R,c as z,w as P,o as m,b as t,t as l,a as f,d as I,e as G,L as $,u as i,i as V,x,f as b,F as J,s as W,g as k,P as M}from"./app-BdCTErYV.js";import{_ as X}from"./AuthenticatedLayout-CbMAqcF_.js";import{_ as A}from"./InputError-1q4KRqEN.js";import{C as D}from"./vue-select-BV-Tc8Va.js";import"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as Y}from"./ModalConfirmOrderAndPay-B1SmSMwF.js";const Z={class:"pagetitle"},tt={class:"breadcrumb"},et={class:"breadcrumb-item"},ot={class:"breadcrumb-item active"},st={class:"section dashboard"},at={class:"row"},lt={class:"col-lg-12"},nt={class:"card"},rt={class:"card-body"},it={class:"card-title"},dt={class:"row mb-3"},ut={for:"customerSelect",class:"col-sm-2 col-form-label"},ct={class:"col-sm-10"},mt={class:"row mb-3"},vt={class:"col-sm-10"},pt={key:0,class:"row mb-3"},ft={for:"productTable",class:"col-sm-2 col-form-label"},bt={class:"col-sm-10"},ht={class:"table"},yt=["onInput","onUpdate:modelValue","max"],_t=["onUpdate:modelValue"],gt=["value"],wt=["onClick"],Ct={class:"row"},qt={class:"col-md-6"},Vt={class:"col-md-6"},xt={class:"text-center"},kt=["disabled"],$t={key:0,class:"bi bi-save"},Ut={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Dt={__name:"Create",props:{products:Array,customers:Array,defaultCustomer:Object,translations:Object},setup(a){let U=g(""),h=g(!1),d=g(""),u=g(!1);const c=a,w=g(c.defaultCustomer.name),y=H({customer_id:c.defaultCustomer.id,items:[],log:[],total_amount:0}),v=B([]),S=B([]),N=L(()=>U.value?c.customers.filter(o=>{const e=U.value.toLowerCase();return o.name.toLowerCase().includes(e)||o.phone.includes(e)}):c.customers),T=o=>{const e=c.products.find(n=>n.id===o.product_id);e&&(o.price=e.price,o.max_quantity=e.max_quantity)},O=o=>{const e=c.products.find(n=>n.id===o.product_id);e&&o.quantity>e.max_quantity&&(o.quantity=e.max_quantity)},C=L(()=>v.reduce((o,e)=>o+e.quantity*e.price,0));K(C,o=>{y.total_amount=o});const _=o=>{const e=new Date().toLocaleString();S.push({message:o,timestamp:e})},j=()=>{v.push({product_id:"",quantity:1,price:0}),_("product_added")},F=o=>{v.splice(o,1),_("product_removed")},Q=async o=>{h.value=!0;const e={total_amount:y.total_amount,total_paid:o.amountDollar,customer_id:y.customer_id,date:o.date,notes:o.notes,items:v.reduce((n,p)=>{let s=n.find(q=>q.product_id===p.product_id);return s?s.quantity+=p.quantity:n.push(p),n},[])};try{const n=await M.post(route("orders.store"),e);n.status===200||n.status===201?_("invoice_saved"):_("invoice_save_failed")}catch(n){console.error("خطأ أثناء حفظ الفاتورة:",n),_("invoice_save_failed")}finally{h.value=!1}},E=async()=>{if(d.value)try{const o=await M.get(`/api/products/${d.value}`);o.data.id&&(d.value="",v.push({product_id:o.data.id,quantity:1,price:o.data.selling_price}),console.log("تمت إضافة المنتج:",o.data))}catch(o){console.error("خطأ أثناء البحث عن الباركود:",o)}};return(o,e)=>{const n=R("Link");return m(),z(X,{translations:a.translations},{default:P(()=>{var p;return[t("div",Z,[t("h1",null,l(a.translations.invoice),1),t("nav",null,[t("ol",tt,[t("li",et,[f(n,{class:"nav-link",href:o.route("dashboard")},{default:P(()=>[I(l(a.translations.Home),1)]),_:1},8,["href"])]),t("li",ot,l(a.translations.invoice),1)])])]),t("section",st,[t("div",at,[t("div",lt,[t("div",nt,[t("div",rt,[t("h5",it,l(a.translations.create_invoice),1),t("form",{onSubmit:e[5]||(e[5]=G(s=>$(u)?u.value=!0:u=!0,["prevent"])),class:"row g-3"},[t("div",dt,[t("label",ut,l(a.translations.client),1),t("div",ct,[f(i(D),{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s),options:N.value,label:"name","track-by":"id",reduce:s=>({id:s.id,name:s.name}),onBlur:e[1]||(e[1]=s=>o.mouseleave(w.value)),clearable:!0,placeholder:a.translations.select_customer},null,8,["modelValue","options","reduce","placeholder"]),f(A,{message:i(y).errors.customer},null,8,["message"])])]),t("div",mt,[e[8]||(e[8]=t("label",{for:"inputBarcode",class:"col-sm-2 col-form-label"},"barcode",-1)),t("div",vt,[V(t("input",{autofocus:"",id:"inputBarcode",type:"text",class:"form-control",placeholder:"barcode",onKeyup:e[2]||(e[2]=s=>E()),"onUpdate:modelValue":e[3]||(e[3]=s=>$(d)?d.value=s:d=s)},null,544),[[x,i(d)]]),f(A,{message:i(y).errors.name},null,8,["message"])])]),w.value?(m(),b("div",pt,[t("label",ft,l(a.translations.products),1),t("div",bt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",null,l(a.translations.product),1),t("th",null,l(a.translations.quantity),1),t("th",null,l(a.translations.price)+" "+l(a.translations.dollar),1),t("th",null,l(a.translations.total)+" "+l(a.translations.dollar),1),t("th",null,l(a.translations.actions),1)])]),t("tbody",null,[(m(!0),b(J,null,W(v,(s,q)=>(m(),b("tr",{key:q},[f(i(D),{modelValue:s.product_id,"onUpdate:modelValue":r=>s.product_id=r,options:a.products,label:"name",reduce:r=>r.id,placeholder:a.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:r=>T(s)},null,8,["modelValue","onUpdate:modelValue","options","reduce","placeholder","onMouseleave"]),t("td",null,[V(t("input",{type:"number",onInput:r=>O(s),"onUpdate:modelValue":r=>s.quantity=r,min:"1",max:s.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,yt),[[x,s.quantity]])]),t("td",null,[V(t("input",{type:"number","onUpdate:modelValue":r=>s.price=r,min:"0",class:"form-control",placeholder:"Price"},null,8,_t),[[x,s.price]])]),t("td",null,[t("input",{type:"number",value:s.quantity*s.price,class:"form-control",disabled:""},null,8,gt)]),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:r=>F(q)},e[9]||(e[9]=[t("i",{class:"bi bi-trash"},null,-1)]),8,wt)])]))),128))])]),(p=a.products)!=null&&p.length?(m(),b("button",{key:0,type:"button",class:"btn btn-primary",onClick:j},l(a.translations.add_product),1)):k("",!0)])])):k("",!0),t("div",Ct,[t("div",qt,[t("strong",null,l(c.translations.total)+" "+l(a.translations.dollar)+":",1)]),t("div",Vt,[V(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=s=>C.value=s),class:"form-control",readonly:""},null,512),[[x,C.value]])])]),t("div",xt,[t("button",{type:"submit",class:"btn btn-primary",disabled:i(h)},[I(l(a.translations.save)+"   ",1),i(h)?k("",!0):(m(),b("i",$t)),i(h)?(m(),b("span",Ut)):k("",!0)],8,kt)])],32)])])])]),f(Y,{show:i(u),total:C.value,onClose:e[6]||(e[6]=s=>$(u)?u.value=!1:u=!1),onConfirm:e[7]||(e[7]=s=>Q(s))},null,8,["show","total"])])]}),_:1},8,["translations"])}}};export{Dt as default};
