import{r as v,C as Q,a as o,c as Y,w as R,b as t,i as Z,d as b,n as S,e as n,l as d,y as w,A as _,F as g,g as C,t as a,f as i,j as q,h as T}from"./app-rrtI315f.js";import{_ as tt}from"./AuthenticatedLayout-CiFcEoWJ.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st={class:"pagetitle dark:text-white"},lt={class:"breadcrumb"},ot={class:"breadcrumb-item"},nt={class:"section"},at={class:"row"},dt={class:"col-lg-12"},rt={class:"card"},it={class:"card-body"},ut={class:"nav nav-tabs",id:"paymentsTabs",role:"tablist"},ct={class:"nav-item",role:"presentation"},mt={class:"nav-item",role:"presentation"},vt={class:"nav-item",role:"presentation"},bt={class:"tab-content mt-4"},pt={key:0,class:"tab-pane fade show active"},yt={class:"row mb-3"},ft={class:"col-md-4"},_t={class:"col-md-3"},ht={class:"col-md-3"},kt={class:"table-responsive"},wt={class:"table table-striped"},gt=["onClick","disabled"],Ct={class:"d-flex justify-content-center mt-3"},St={class:"pagination"},xt=["onClick","innerHTML","disabled"],Tt={key:1,class:"tab-pane fade show active"},Vt={class:"table-responsive"},Bt={class:"table table-striped"},Mt={class:"d-flex justify-content-center mt-3"},Ft={class:"pagination"},Ut=["onClick","innerHTML","disabled"],Ot={key:2,class:"tab-pane fade show active"},$t={class:"row"},jt={class:"col-md-6"},qt={class:"card"},Nt={class:"card-body"},Pt={class:"table-responsive"},At={class:"table table-sm"},Lt=["onClick"],Et=["onClick","disabled"],Dt={class:"col-md-6"},Ht={class:"card"},Jt={class:"card-body"},Kt={class:"d-grid gap-2"},Rt={key:0,class:"modal fade show d-block",tabindex:"-1"},Wt={class:"modal-dialog"},Xt={class:"modal-content"},zt={class:"modal-header"},It={class:"modal-title"},Gt={class:"modal-body"},Qt={class:"mb-3"},Yt={class:"mb-3"},Zt={class:"mb-3"},te={class:"mb-3"},ee={key:0,class:"alert alert-info"},se={class:"modal-footer"},le=["disabled"],oe={key:0,class:"spinner-border spinner-border-sm me-2"},ne={key:1,class:"modal-backdrop fade show"},ae={key:2,class:"modal fade show d-block",tabindex:"-1"},de={class:"modal-dialog"},re={class:"modal-content"},ie={class:"modal-body"},ue={class:"mb-3"},ce=["value"],me={class:"mb-3"},ve={class:"mb-3"},be={class:"mb-3"},pe={class:"modal-footer"},ye=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm me-2"},_e={key:3,class:"modal-backdrop fade show"},he={key:4,class:"modal fade show d-block",tabindex:"-1"},ke={class:"modal-dialog"},we={class:"modal-content"},ge={class:"modal-body"},Ce={class:"mb-3"},Se=["value"],xe={class:"mb-3"},Te={class:"mb-3"},Ve={class:"mb-3"},Be={class:"modal-footer"},Me=["disabled"],Fe={key:0,class:"spinner-border spinner-border-sm me-2"},Ue={key:5,class:"modal-backdrop fade show"},Oe={__name:"Payments",props:{translations:Object,activeTab:String,orders:Object,customerBalances:Array,payments:Object},setup(p){const y=v(p.activeTab||"orders"),u=v(!1),h=v({search:"",status:"",currency:""}),V=v(!1),B=v(null),U=v({balance_dollar:0,balance_dinar:0}),r=v({order_id:null,amount:"",currency:"dollar",payment_method:"cash",notes:""}),M=v(!1),c=v({customer_id:"",amount:"",currency:"dollar",notes:""}),F=v(!1),m=v({customer_id:"",amount:"",currency:"dollar",notes:""}),f=(l,e="dollar")=>{if(!l)return"0.00";const x=e==="dollar"?"$":"د.ع";return`${parseFloat(l).toFixed(2)} ${x}`},W=l=>new Date(l).toLocaleDateString("ar-SA"),X=l=>({created:"secondary",received:"info",executing:"primary",partial_payment:"warning",full_payment:"success",completed:"success",cancelled:"danger"})[l]||"secondary",z=l=>({cash:"نقدي",balance:"من الرصيد",transfer:"تحويل"})[l]||l,I=()=>{T.get(route("decoration.payments"),h.value,{preserveState:!0,preserveScroll:!0})},N=l=>{l&&T.visit(l)},G=async l=>{if(B.value=l,r.value.order_id=l.id,r.value.currency=l.currency,l.customer)try{const x=await(await fetch(route("decoration.payments.balance.get",l.customer.id))).json();U.value=x}catch(e){console.error("Error fetching customer balance:",e)}V.value=!0},O=()=>{V.value=!1,B.value=null,r.value={order_id:null,amount:"",currency:"dollar",payment_method:"cash",notes:""}},P=async()=>{u.value=!0;try{const e=await(await fetch(route("decoration.payments.add"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(r.value)})).json();e.success?(O(),T.reload()):alert(e.message||"حدث خطأ أثناء إضافة الدفعة")}catch(l){console.error("Error adding payment:",l),alert("حدث خطأ أثناء إضافة الدفعة")}finally{u.value=!1}},A=(l=null)=>{l&&(c.value.customer_id=l.id),M.value=!0},$=()=>{M.value=!1,c.value={customer_id:"",amount:"",currency:"dollar",notes:""}},L=async()=>{u.value=!0;try{const e=await(await fetch(route("decoration.payments.balance.add"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(c.value)})).json();e.success?($(),T.reload()):alert(e.message||"حدث خطأ أثناء إضافة الرصيد")}catch(l){console.error("Error adding balance:",l),alert("حدث خطأ أثناء إضافة الرصيد")}finally{u.value=!1}},E=(l=null)=>{l&&(m.value.customer_id=l.id),F.value=!0},j=()=>{F.value=!1,m.value={customer_id:"",amount:"",currency:"dollar",notes:""}},D=async()=>{u.value=!0;try{const e=await(await fetch(route("decoration.payments.balance.withdraw"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(m.value)})).json();e.success?(j(),T.reload()):alert(e.message||"حدث خطأ أثناء سحب الرصيد")}catch(l){console.error("Error withdrawing balance:",l),alert("حدث خطأ أثناء سحب الرصيد")}finally{u.value=!1}};return(l,e)=>{const x=Q("Link");return o(),Y(tt,{translations:p.translations},{default:R(()=>{var H,J;return[t("div",st,[e[22]||(e[22]=t("h1",{class:"dark:text-white"},"إدارة دفعات الديكورات",-1)),t("nav",null,[t("ol",lt,[t("li",ot,[Z(x,{class:"nav-link dark:text-white",href:l.route("decorations.dashboard")},{default:R(()=>e[20]||(e[20]=[b(" الديكورات ")])),_:1},8,["href"])]),e[21]||(e[21]=t("li",{class:"breadcrumb-item active"},"إدارة الدفعات",-1))])])]),t("section",nt,[t("div",at,[t("div",dt,[t("div",rt,[t("div",it,[t("ul",ut,[t("li",ct,[t("button",{class:S(["nav-link",{active:y.value==="orders"}]),onClick:e[0]||(e[0]=s=>y.value="orders"),type:"button"}," طلبات الديكور ",2)]),t("li",mt,[t("button",{class:S(["nav-link",{active:y.value==="payments"}]),onClick:e[1]||(e[1]=s=>y.value="payments"),type:"button"}," سجل الدفعات ",2)]),t("li",vt,[t("button",{class:S(["nav-link",{active:y.value==="balance"}]),onClick:e[2]||(e[2]=s=>y.value="balance"),type:"button"}," إدارة الرصيد ",2)])]),t("div",bt,[y.value==="orders"?(o(),n("div",pt,[t("div",yt,[t("div",ft,[d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=s=>h.value.search=s),placeholder:"البحث في الطلبات..."},null,512),[[w,h.value.search]])]),t("div",_t,[d(t("select",{class:"form-select","onUpdate:modelValue":e[4]||(e[4]=s=>h.value.status=s)},e[23]||(e[23]=[t("option",{value:""},"جميع الحالات",-1),t("option",{value:"created"},"تم الإنشاء",-1),t("option",{value:"received"},"تم الاستلام",-1),t("option",{value:"executing"},"قيد التنفيذ",-1),t("option",{value:"partial_payment"},"دفع جزئي",-1),t("option",{value:"full_payment"},"دفع كامل",-1),t("option",{value:"completed"},"مكتمل",-1),t("option",{value:"cancelled"},"ملغي",-1)]),512),[[_,h.value.status]])]),t("div",ht,[d(t("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=s=>h.value.currency=s)},e[24]||(e[24]=[t("option",{value:""},"جميع العملات",-1),t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,h.value.currency]])]),t("div",{class:"col-md-2"},[t("button",{class:"btn btn-primary w-100",onClick:I},e[25]||(e[25]=[t("i",{class:"bi bi-search"},null,-1),b(" بحث ")]))])]),t("div",kt,[t("table",wt,[e[27]||(e[27]=t("thead",null,[t("tr",null,[t("th",null,"رقم الطلب"),t("th",null,"العميل"),t("th",null,"الديكور"),t("th",null,"المبلغ الإجمالي"),t("th",null,"المدفوع"),t("th",null,"المتبقي"),t("th",null,"الحالة"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(o(!0),n(g,null,C(p.orders.data,s=>(o(),n("tr",{key:s.id},[t("td",null,"#"+a(s.id),1),t("td",null,a(s.customer_name),1),t("td",null,a(s.decoration.name),1),t("td",null,a(f(s.total_price,s.currency)),1),t("td",null,a(f(s.paid_amount,s.currency)),1),t("td",null,a(f(s.total_price-s.paid_amount,s.currency)),1),t("td",null,[t("span",{class:S(["badge","bg-"+X(s.status)])},a(s.status_name),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-success",onClick:k=>G(s),disabled:s.status==="completed"||s.status==="cancelled"},e[26]||(e[26]=[t("i",{class:"bi bi-plus"},null,-1),b(" إضافة دفعة ")]),8,gt)])]))),128))])])]),t("div",Ct,[t("nav",null,[t("ul",St,[(o(!0),n(g,null,C(p.orders.links,s=>(o(),n("li",{key:s.label,class:S(["page-item",{active:s.active,disabled:!s.url}])},[t("button",{class:"page-link",onClick:k=>N(s.url),innerHTML:s.label,disabled:!s.url},null,8,xt)],2))),128))])])])])):i("",!0),y.value==="payments"?(o(),n("div",Tt,[t("div",Vt,[t("table",Bt,[e[28]||(e[28]=t("thead",null,[t("tr",null,[t("th",null,"رقم الدفعة"),t("th",null,"الوصف"),t("th",null,"المبلغ"),t("th",null,"العملة"),t("th",null,"طريقة الدفع"),t("th",null,"التاريخ"),t("th",null,"الملاحظات")])],-1)),t("tbody",null,[(o(!0),n(g,null,C(p.payments.data,s=>{var k,K;return o(),n("tr",{key:s.id},[t("td",null,"#"+a(s.id),1),t("td",null,a(s.description),1),t("td",null,a(f(s.amount,s.currency)),1),t("td",null,a(s.currency==="dollar"?"دولار":"دينار"),1),t("td",null,a(z((k=s.details)==null?void 0:k.payment_method)),1),t("td",null,a(W(s.created)),1),t("td",null,a(((K=s.details)==null?void 0:K.notes)||"-"),1)])}),128))])])]),t("div",Mt,[t("nav",null,[t("ul",Ft,[(o(!0),n(g,null,C(p.payments.links,s=>(o(),n("li",{key:s.label,class:S(["page-item",{active:s.active,disabled:!s.url}])},[t("button",{class:"page-link",onClick:k=>N(s.url),innerHTML:s.label,disabled:!s.url},null,8,Ut)],2))),128))])])])])):i("",!0),y.value==="balance"?(o(),n("div",Ot,[t("div",$t,[t("div",jt,[t("div",qt,[e[32]||(e[32]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"أرصدة العملاء")],-1)),t("div",Nt,[t("div",Pt,[t("table",At,[e[31]||(e[31]=t("thead",null,[t("tr",null,[t("th",null,"العميل"),t("th",null,"الرصيد بالدولار"),t("th",null,"الرصيد بالدينار"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(o(!0),n(g,null,C(p.customerBalances,s=>(o(),n("tr",{key:s.id},[t("td",null,a(s.customer.name),1),t("td",null,a(f(s.balance_dollar,"dollar")),1),t("td",null,a(f(s.balance_dinar,"dinar")),1),t("td",null,[t("button",{class:"btn btn-sm btn-primary me-1",onClick:k=>A(s.customer)},e[29]||(e[29]=[t("i",{class:"bi bi-plus"},null,-1)]),8,Lt),t("button",{class:"btn btn-sm btn-warning",onClick:k=>E(s.customer),disabled:s.balance_dollar<=0&&s.balance_dinar<=0},e[30]||(e[30]=[t("i",{class:"bi bi-dash"},null,-1)]),8,Et)])]))),128))])])])])])]),t("div",Dt,[t("div",Ht,[e[35]||(e[35]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"إجراءات سريعة")],-1)),t("div",Jt,[t("div",Kt,[t("button",{class:"btn btn-success",onClick:e[6]||(e[6]=s=>A())},e[33]||(e[33]=[t("i",{class:"bi bi-plus-circle"},null,-1),b(" إضافة رصيد لعميل ")])),t("button",{class:"btn btn-warning",onClick:e[7]||(e[7]=s=>E())},e[34]||(e[34]=[t("i",{class:"bi bi-dash-circle"},null,-1),b(" سحب رصيد من عميل ")]))])])])])])])):i("",!0)])])])])])]),V.value?(o(),n("div",Rt,[t("div",Wt,[t("div",Xt,[t("div",zt,[t("h5",It,"إضافة دفعة لطلب #"+a((H=B.value)==null?void 0:H.id),1),t("button",{type:"button",class:"btn-close",onClick:O})]),t("div",Gt,[t("form",{onSubmit:q(P,["prevent"])},[t("div",Qt,[e[36]||(e[36]=t("label",{for:"amount",class:"form-label"},"المبلغ",-1)),d(t("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":e[8]||(e[8]=s=>r.value.amount=s),step:"0.01",min:"0.01",required:""},null,512),[[w,r.value.amount]])]),t("div",Yt,[e[38]||(e[38]=t("label",{for:"currency",class:"form-label"},"العملة",-1)),d(t("select",{class:"form-select",id:"currency","onUpdate:modelValue":e[9]||(e[9]=s=>r.value.currency=s),required:""},e[37]||(e[37]=[t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,r.value.currency]])]),t("div",Zt,[e[40]||(e[40]=t("label",{for:"payment_method",class:"form-label"},"طريقة الدفع",-1)),d(t("select",{class:"form-select",id:"payment_method","onUpdate:modelValue":e[10]||(e[10]=s=>r.value.payment_method=s),required:""},e[39]||(e[39]=[t("option",{value:"cash"},"نقدي",-1),t("option",{value:"balance"},"من الرصيد",-1),t("option",{value:"transfer"},"تحويل",-1)]),512),[[_,r.value.payment_method]])]),t("div",te,[e[41]||(e[41]=t("label",{for:"notes",class:"form-label"},"ملاحظات",-1)),d(t("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[11]||(e[11]=s=>r.value.notes=s),rows:"3"},null,512),[[w,r.value.notes]])]),r.value.payment_method==="balance"&&((J=B.value)!=null&&J.customer)?(o(),n("div",ee,[e[42]||(e[42]=t("strong",null,"الرصيد المتاح:",-1)),e[43]||(e[43]=t("br",null,null,-1)),b(" دولار: "+a(f(U.value.balance_dollar,"dollar")),1),e[44]||(e[44]=t("br",null,null,-1)),b(" دينار: "+a(f(U.value.balance_dinar,"dinar")),1)])):i("",!0)],32)]),t("div",se,[t("button",{type:"button",class:"btn btn-secondary",onClick:O},"إلغاء"),t("button",{type:"button",class:"btn btn-success",onClick:P,disabled:u.value},[u.value?(o(),n("span",oe)):i("",!0),e[45]||(e[45]=b(" إضافة الدفعة "))],8,le)])])])])):i("",!0),V.value?(o(),n("div",ne)):i("",!0),M.value?(o(),n("div",ae,[t("div",de,[t("div",re,[t("div",{class:"modal-header"},[e[46]||(e[46]=t("h5",{class:"modal-title"},"إضافة رصيد",-1)),t("button",{type:"button",class:"btn-close",onClick:$})]),t("div",ie,[t("form",{onSubmit:q(L,["prevent"])},[t("div",ue,[e[48]||(e[48]=t("label",{for:"customer_id",class:"form-label"},"العميل",-1)),d(t("select",{class:"form-select",id:"customer_id","onUpdate:modelValue":e[12]||(e[12]=s=>c.value.customer_id=s),required:""},[e[47]||(e[47]=t("option",{value:""},"اختر العميل",-1)),(o(!0),n(g,null,C(p.customerBalances,s=>(o(),n("option",{key:s.customer.id,value:s.customer.id},a(s.customer.name),9,ce))),128))],512),[[_,c.value.customer_id]])]),t("div",me,[e[49]||(e[49]=t("label",{for:"amount",class:"form-label"},"المبلغ",-1)),d(t("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":e[13]||(e[13]=s=>c.value.amount=s),step:"0.01",min:"0.01",required:""},null,512),[[w,c.value.amount]])]),t("div",ve,[e[51]||(e[51]=t("label",{for:"currency",class:"form-label"},"العملة",-1)),d(t("select",{class:"form-select",id:"currency","onUpdate:modelValue":e[14]||(e[14]=s=>c.value.currency=s),required:""},e[50]||(e[50]=[t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,c.value.currency]])]),t("div",be,[e[52]||(e[52]=t("label",{for:"notes",class:"form-label"},"ملاحظات",-1)),d(t("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[15]||(e[15]=s=>c.value.notes=s),rows:"3"},null,512),[[w,c.value.notes]])])],32)]),t("div",pe,[t("button",{type:"button",class:"btn btn-secondary",onClick:$},"إلغاء"),t("button",{type:"button",class:"btn btn-success",onClick:L,disabled:u.value},[u.value?(o(),n("span",fe)):i("",!0),e[53]||(e[53]=b(" إضافة الرصيد "))],8,ye)])])])])):i("",!0),M.value?(o(),n("div",_e)):i("",!0),F.value?(o(),n("div",he,[t("div",ke,[t("div",we,[t("div",{class:"modal-header"},[e[54]||(e[54]=t("h5",{class:"modal-title"},"سحب رصيد",-1)),t("button",{type:"button",class:"btn-close",onClick:j})]),t("div",ge,[t("form",{onSubmit:q(D,["prevent"])},[t("div",Ce,[e[56]||(e[56]=t("label",{for:"customer_id",class:"form-label"},"العميل",-1)),d(t("select",{class:"form-select",id:"customer_id","onUpdate:modelValue":e[16]||(e[16]=s=>m.value.customer_id=s),required:""},[e[55]||(e[55]=t("option",{value:""},"اختر العميل",-1)),(o(!0),n(g,null,C(p.customerBalances,s=>(o(),n("option",{key:s.customer.id,value:s.customer.id},a(s.customer.name),9,Se))),128))],512),[[_,m.value.customer_id]])]),t("div",xe,[e[57]||(e[57]=t("label",{for:"amount",class:"form-label"},"المبلغ",-1)),d(t("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":e[17]||(e[17]=s=>m.value.amount=s),step:"0.01",min:"0.01",required:""},null,512),[[w,m.value.amount]])]),t("div",Te,[e[59]||(e[59]=t("label",{for:"currency",class:"form-label"},"العملة",-1)),d(t("select",{class:"form-select",id:"currency","onUpdate:modelValue":e[18]||(e[18]=s=>m.value.currency=s),required:""},e[58]||(e[58]=[t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,m.value.currency]])]),t("div",Ve,[e[60]||(e[60]=t("label",{for:"notes",class:"form-label"},"ملاحظات",-1)),d(t("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[19]||(e[19]=s=>m.value.notes=s),rows:"3"},null,512),[[w,m.value.notes]])])],32)]),t("div",Be,[t("button",{type:"button",class:"btn btn-secondary",onClick:j},"إلغاء"),t("button",{type:"button",class:"btn btn-warning",onClick:D,disabled:u.value},[u.value?(o(),n("span",Fe)):i("",!0),e[61]||(e[61]=b(" سحب الرصيد "))],8,Me)])])])])):i("",!0),F.value?(o(),n("div",Ue)):i("",!0)]}),_:1},8,["translations"])}}},Pe=et(Oe,[["__scopeId","data-v-e4b42e80"]]);export{Pe as default};
