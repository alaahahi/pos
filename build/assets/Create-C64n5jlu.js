import{s as Ct,r as m,T as wt,x as qt,k as Z,B as tt,K as st,o as xt,R as $t,a as i,h as It,w as Ft,b as s,d,t as a,I as C,l as S,y as A,u as l,S as et,n as B,c as u,F as D,f as T,e as v,i as O,j as Vt,E as ot}from"./app-CHz4vJ2a.js";import{_ as Bt}from"./AuthenticatedLayout-JX5hdPrS.js";import{_ as Pt}from"./InputError-DL9wO4T-.js";import{C as Mt}from"./vue-select-BP_79Tuh.js";import{d as Et,M as St}from"./debounce-CSMloAp9.js";import{S as At}from"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as Dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Tt={class:"pos-header"},Ut={class:"d-flex justify-content-between align-items-center"},Lt={class:"pos-title"},Nt={class:"pos-actions"},Ot={class:"pos-container"},Kt={class:"pos-products-panel"},Qt={class:"pos-search-section"},jt={class:"search-input-group"},Rt=["placeholder"],zt={class:"barcode-section"},Gt=["placeholder"],Ht={class:"pos-filters"},Jt={key:0,class:"pos-categories"},Wt=["onClick"],Xt={class:"pos-products-grid"},Yt=["onClick"],Zt={class:"product-image"},ts=["src","alt"],ss={key:0,class:"product-stock-badge"},es={class:"product-info"},os={class:"product-name"},ns={class:"product-model"},ls={class:"product-price"},is={class:"product-stock"},as={key:1,class:"text-center p-4"},rs={key:2,class:"no-products"},us={class:"pos-cart-panel"},cs={class:"pos-customer-section"},ds={class:"form-label text-center w-100"},bs={class:"pos-cart-section"},ms={class:"cart-header"},ps={class:"text-center w-100"},vs={key:0,class:"cart-count"},fs={class:"cart-items"},ys={class:"cart-item-info"},hs={class:"item-name"},_s={class:"item-model"},gs={class:"cart-item-controls"},ks={class:"quantity-controls"},Cs=["onClick","disabled"],ws=["onUpdate:modelValue","onInput"],qs=["onClick"],xs={class:"price-controls"},$s=["onUpdate:modelValue"],Is={class:"item-total"},Fs=["onClick"],Vs={key:0,class:"empty-cart"},Bs={key:0,class:"pos-summary-section"},Ps={class:"summary-row"},Ms={class:"summary-row"},Es={class:"summary-row total-row"},Ss={class:"total-amount"},As={key:1,class:"pos-actions-section"},Ds=["disabled"],Ts={key:0,class:"bi bi-credit-card"},Us={key:1,class:"spinner-border spinner-border-sm"},Ls={key:0,class:"keyboard-shortcuts"},Ns={class:"modal-header"},Os={class:"modal-body"},Ks={class:"cash-summary mb-4"},Qs={class:"row"},js={class:"col-md-6"},Rs={class:"cash-stat-card"},zs={class:"stat-info"},Gs={class:"stat-value"},Hs={class:"col-md-6"},Js={class:"cash-stat-card"},Ws={class:"stat-info"},Xs={class:"stat-value"},Ys={class:"cash-products"},Zs={key:0,class:"empty-cash"},te={key:1,class:"cash-products-list"},se={class:"product-info"},ee={class:"product-name"},oe={class:"text-muted"},ne={class:"product-actions"},le=["onClick"],ie={class:"modal-footer"},ae=["disabled"],re={__name:"Create",props:{products:Array,customers:Array,defaultCustomer:Object,translations:Object,defaultCurrency:String,categories:Array},setup(c){var W;let y=Ct(),I=m(!1),_=m(""),h=m(""),w=m(!1),K=m(!1),F=m(null),g=m("featured"),U=m(!1),p=m(!1),q=m({totalProducts:0,totalValue:0,products:[]});const Q=m(null),P=m(null),b=c,x=m(b.defaultCustomer),$=wt({customer_id:((W=b.defaultCustomer)==null?void 0:W.id)||null,total_amount:0}),n=qt([]),k=m(b.products.filter(e=>e.is_featured)),L=Z(()=>n.reduce((e,t)=>e+t.quantity*t.price,0)),nt=Z(()=>n.reduce((e,t)=>e+t.quantity,0));tt(L,e=>{$.total_amount=e}),tt(n,()=>{ut()},{deep:!0});const lt=e=>{x.value=e,$.customer_id=e?e.id:null},N=e=>{if(e.quantity<=0){y.warning("المنتج غير متوفر في المخزون",{timeout:3e3,position:"bottom-right",rtl:!0});return}const t=n.find(o=>o.product_id===e.id);t?t.quantity<e.quantity?t.quantity+=1:y.warning("لا توجد كمية كافية في المخزون",{timeout:3e3,position:"bottom-right",rtl:!0}):n.push({product_id:e.id,quantity:1,price:e.price})},it=e=>{n.splice(e,1)},at=e=>{const t=n.findIndex(o=>o.product_id===e);t!==-1&&(n.splice(t,1),y.success("تم حذف المنتج من الكاش",{timeout:2e3,position:"bottom-right",rtl:!0}))},rt=()=>{n.length!==0&&At.fire({title:"تأكيد الحذف",text:"هل أنت متأكد من حذف جميع المنتجات من الكاش؟",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذف الكل",cancelButtonText:"إلغاء"}).then(e=>{e.isConfirmed&&(M(),y.success("تم حذف جميع المنتجات من الكاش",{timeout:2e3,position:"bottom-right",rtl:!0}))})},ut=()=>{q.value={totalProducts:n.reduce((e,t)=>e+t.quantity,0),totalValue:n.reduce((e,t)=>e+t.quantity*t.price,0),products:[...n]}},j=(e,t="IQD")=>parseFloat(e||0).toFixed(2)+" "+t,ct=e=>{const t=n[e],o=b.products.find(r=>r.id===t.product_id);t.quantity<o.quantity?t.quantity+=1:y.warning("لا توجد كمية كافية في المخزون",{timeout:3e3,position:"bottom-right",rtl:!0})},dt=e=>{const t=n[e];t.quantity>1&&(t.quantity-=1)},M=()=>{n.splice(0)},R=()=>{M(),x.value=null,$.customer_id=null,h.value="",_.value="",g.value="featured",F.value=null,k.value=b.products.filter(e=>e.is_featured)},z=()=>{if(console.log("Search query:",h.value),console.log("Available products:",b.products.length),!h.value.trim()){V(g.value);return}const e=h.value.toLowerCase();let t=[];g.value==="featured"?t=b.products.filter(r=>r.is_featured):g.value==="best_selling"?t=b.products.filter(r=>r.is_best_selling):t=[...b.products],console.log("Base products after filter:",t.length);const o=t.filter(r=>{const f=r.name&&r.name.toLowerCase().includes(e),X=r.model&&r.model.toLowerCase().includes(e),Y=r.barcode&&r.barcode.toLowerCase().includes(e);return console.log(`Product: ${r.name}, Name match: ${f}, Model match: ${X}, Barcode match: ${Y}`),f||X||Y});console.log("Search results:",o.length),k.value=o},bt=()=>{k.value.length===1&&(N(k.value[0]),h.value="",V(g.value))},mt=e=>{F.value=e},pt=()=>{F.value=null,V(g.value)},V=e=>{g.value=e,e==="featured"?k.value=b.products.filter(t=>t.is_featured):e==="best_selling"&&(k.value=b.products.filter(t=>t.is_best_selling))},G=e=>{const t=b.products.find(o=>o.id===e);return t?t.name:""},vt=e=>{const t=b.products.find(o=>o.id===e);return t?t.model:""},ft=e=>{e.target.src="/dashboard-assets/img/product-placeholder.svg"},yt=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},ht=()=>{y.info("تم تعليق الطلب",{timeout:3e3,position:"bottom-right",rtl:!0})},_t=()=>{window.print()},H=()=>{w.value=!0},gt=async e=>{I.value=!0;const t={total_amount:$.total_amount,total_paid:e.amountDollar??0,customer_id:$.customer_id,date:e.date,notes:e.notes,discount_amount:e.discount_amount??0,discount_rate:e.discount_rate??0,items:n.map(o=>({product_id:o.product_id,quantity:o.quantity,price:o.price}))};try{const o=await ot.post("/api/createOrder",t);if(o.status===200||o.status===201){let{id:r,order_id:f}=o.data;y.success("تم حفظ الفاتورة بنجاح",{timeout:3e3,position:"bottom-right",rtl:!0}),e.printInvoice&&window.open(`/api/getIndexAccountsSelas?print=2&transactions_id=${r}&order_id=${f}`,"_blank"),M(),h.value="",_.value="",k.value=[...b.products]}}catch{y.error("خطأ أثناء حفظ الفاتورة",{timeout:5e3,position:"bottom-right",rtl:!0})}finally{I.value=!1,w.value=!1}},E=Et(()=>{if(!_.value)return;const e=b.products.find(t=>t.barcode===_.value);e?(N(e),_.value="",st(()=>{var t;(t=P.value)==null||t.focus()})):y.warning("المنتج غير موجود في القائمة الحالية",{timeout:3e3,position:"bottom-right",rtl:!0})},500),kt=async e=>{try{const t=await ot.get(`/api/check-stock/${e.product_id}`);e.quantity>t.data.available_quantity&&(y.warning(`الكمية المتوفرة فقط: ${t.data.available_quantity}`,{timeout:3e3,position:"bottom-right",rtl:!0}),e.quantity=t.data.available_quantity)}catch(t){console.error("خطأ عند التحقق من المخزون:",t)}},J=e=>{var t,o;e.key==="F1"&&(e.preventDefault(),(t=Q.value)==null||t.focus()),e.key==="F2"&&(e.preventDefault(),(o=P.value)==null||o.focus()),e.key==="F9"&&n.length>0&&x.value&&(e.preventDefault(),H()),e.key==="Escape"&&(e.preventDefault(),R()),e.key==="F12"&&(e.preventDefault(),U.value=!U.value)};return xt(()=>{document.addEventListener("keydown",J),st(()=>{var e;(e=P.value)==null||e.focus()})}),$t(()=>{document.removeEventListener("keydown",J)}),(e,t)=>(i(),It(Bt,{translations:c.translations},{default:Ft(()=>[s("div",Tt,[s("div",Ut,[s("h2",Lt,[t[13]||(t[13]=s("i",{class:"bi bi-shop"},null,-1)),d(" "+a(c.translations.invoice),1)]),s("div",Nt,[s("button",{onClick:t[0]||(t[0]=o=>C(p)?p.value=!0:p=!0),class:"btn btn-outline-info"},t[14]||(t[14]=[s("i",{class:"bi bi-cash-coin"},null,-1),d(" إدارة الكاش ")])),s("button",{onClick:R,class:"btn btn-outline-danger"},t[15]||(t[15]=[s("i",{class:"bi bi-trash"},null,-1),d(" مسح الكل ")])),s("button",{onClick:yt,class:"btn btn-outline-primary"},t[16]||(t[16]=[s("i",{class:"bi bi-fullscreen"},null,-1),d(" ملء الشاشة ")]))])])]),s("div",Ot,[s("div",Kt,[s("div",Qt,[s("div",jt,[S(s("input",{ref_key:"searchInput",ref:Q,"onUpdate:modelValue":t[1]||(t[1]=o=>C(h)?h.value=o:h=o),type:"text",class:"form-control pos-search-input",placeholder:c.translations.search_by_name_or_barcode,onInput:z,onKeyup:et(bt,["enter"])},null,40,Rt),[[A,l(h)]]),s("button",{class:"btn btn-primary search-btn",onClick:z},t[17]||(t[17]=[s("i",{class:"bi bi-search"},null,-1)]))]),s("div",zt,[S(s("input",{ref_key:"barcodeInput",ref:P,"onUpdate:modelValue":t[2]||(t[2]=o=>C(_)?_.value=o:_=o),type:"text",class:"form-control barcode-input",placeholder:c.translations.barcode,onKeyup:[t[3]||(t[3]=(...o)=>l(E)&&l(E)(...o)),t[4]||(t[4]=et((...o)=>l(E)&&l(E)(...o),["enter"]))]},null,40,Gt),[[A,l(_)]]),t[18]||(t[18]=s("i",{class:"bi bi-upc-scan barcode-icon"},null,-1))])]),s("div",Ht,[s("button",{onClick:t[5]||(t[5]=o=>V("featured")),class:B(["btn","filter-btn",{active:l(g)==="featured"}])},t[19]||(t[19]=[s("i",{class:"bi bi-star-fill"},null,-1),d(" المميزة ")]),2),s("button",{onClick:t[6]||(t[6]=o=>V("best_selling")),class:B(["btn","filter-btn",{active:l(g)==="best_selling"}])},t[20]||(t[20]=[s("i",{class:"bi bi-trophy-fill"},null,-1),d(" الأكثر مبيعاً ")]),2)]),c.categories&&c.categories.length?(i(),u("div",Jt,[(i(!0),u(D,null,T(c.categories,o=>(i(),u("button",{key:o.id,onClick:r=>mt(o.id),class:B(["btn","category-btn",{active:l(F)===o.id}])},a(o.name),11,Wt))),128)),s("button",{onClick:pt,class:B(["btn","category-btn",{active:l(F)===null}])}," الكل ",2)])):v("",!0),s("div",Xt,[(i(!0),u(D,null,T(k.value,o=>(i(),u("div",{key:o.id,onClick:r=>N(o),class:B(["product-card",{"out-of-stock":o.quantity<=0}])},[s("div",Zt,[s("img",{src:o.image?`/public/storage/${o.image}`:"/dashboard-assets/img/product-placeholder.svg",alt:o.name,onError:ft},null,40,ts),o.quantity<=5?(i(),u("div",ss,a(o.quantity),1)):v("",!0)]),s("div",es,[s("h6",os,a(o.name),1),s("p",ns,a(o.model),1),s("div",ls,a(c.defaultCurrency)+" "+a(o.price),1),s("div",is," المخزون: "+a(o.quantity),1)])],10,Yt))),128))]),l(K)?(i(),u("div",as,t[21]||(t[21]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"جاري التحميل...")],-1)]))):v("",!0),!l(K)&&k.value.length===0?(i(),u("div",rs,t[22]||(t[22]=[s("i",{class:"bi bi-box-seam"},null,-1),s("p",null,"لا توجد منتجات",-1)]))):v("",!0)]),s("div",us,[s("div",cs,[s("label",ds,a(c.translations.client),1),O(l(Mt),{modelValue:x.value,"onUpdate:modelValue":t[7]||(t[7]=o=>x.value=o),options:c.customers,label:"name","track-by":"id",reduce:o=>o,onInput:lt,placeholder:c.translations.select_customer,class:"customer-select"},null,8,["modelValue","options","reduce","placeholder"]),O(Pt,{message:l($).errors.customer_id},null,8,["message"])]),s("div",bs,[s("div",ms,[s("h5",ps,[t[23]||(t[23]=s("i",{class:"bi bi-cart3"},null,-1)),t[24]||(t[24]=d(" عربة التسوق ")),n.length?(i(),u("span",vs,a(n.length),1)):v("",!0)]),n.length?(i(),u("button",{key:0,onClick:M,class:"btn btn-sm btn-outline-danger"},t[25]||(t[25]=[s("i",{class:"bi bi-trash"},null,-1)]))):v("",!0)]),s("div",fs,[(i(!0),u(D,null,T(n,(o,r)=>(i(),u("div",{key:r,class:"cart-item"},[s("div",ys,[s("h6",hs,a(G(o.product_id)),1),s("p",_s,a(vt(o.product_id)),1)]),s("div",gs,[s("div",ks,[s("button",{onClick:f=>dt(r),class:"btn btn-sm btn-outline-secondary",disabled:o.quantity<=1},t[26]||(t[26]=[s("i",{class:"bi bi-dash"},null,-1)]),8,Cs),S(s("input",{"onUpdate:modelValue":f=>o.quantity=f,type:"number",min:"1",class:"form-control quantity-input",onInput:f=>kt(o)},null,40,ws),[[A,o.quantity,void 0,{number:!0}]]),s("button",{onClick:f=>ct(r),class:"btn btn-sm btn-outline-secondary"},t[27]||(t[27]=[s("i",{class:"bi bi-plus"},null,-1)]),8,qs)]),s("div",xs,[S(s("input",{"onUpdate:modelValue":f=>o.price=f,type:"number",min:"0",step:"0.01",class:"form-control price-input"},null,8,$s),[[A,o.price,void 0,{number:!0}]])]),s("div",Is,a(c.defaultCurrency)+" "+a((o.quantity*o.price).toFixed(2)),1),s("button",{onClick:f=>it(r),class:"btn btn-sm btn-danger remove-btn"},t[28]||(t[28]=[s("i",{class:"bi bi-x"},null,-1)]),8,Fs)])]))),128))]),n.length===0?(i(),u("div",Vs,t[29]||(t[29]=[s("i",{class:"bi bi-cart-x"},null,-1),s("p",{class:"text-center"},"عربة التسوق فارغة",-1),s("small",{class:"text-center"},"اضغط على المنتجات لإضافتها",-1)]))):v("",!0)]),n.length>0?(i(),u("div",Bs,[s("div",Ps,[t[30]||(t[30]=s("span",null,"عدد الأصناف:",-1)),s("span",null,a(n.length),1)]),s("div",Ms,[t[31]||(t[31]=s("span",null,"إجمالي الكمية:",-1)),s("span",null,a(nt.value),1)]),s("div",Es,[t[32]||(t[32]=s("span",null,"الإجمالي:",-1)),s("span",Ss,a(c.defaultCurrency)+" "+a(L.value.toFixed(2)),1)])])):v("",!0),n.length>0&&x.value?(i(),u("div",As,[s("button",{onClick:H,class:"btn btn-success btn-lg checkout-btn",disabled:l(I)},[l(I)?v("",!0):(i(),u("i",Ts)),l(I)?(i(),u("span",Us)):v("",!0),d(" "+a(c.translations.continue),1)],8,Ds),s("div",{class:"quick-actions"},[s("button",{onClick:ht,class:"btn btn-outline-warning"},t[33]||(t[33]=[s("i",{class:"bi bi-pause-circle"},null,-1),d(" تعليق ")])),s("button",{onClick:_t,class:"btn btn-outline-info"},t[34]||(t[34]=[s("i",{class:"bi bi-printer"},null,-1),d(" طباعة ")]))])])):v("",!0)])]),O(St,{translations:c.translations,show:l(w),total:L.value,defaultCurrency:c.defaultCurrency,onClose:t[8]||(t[8]=o=>C(w)?w.value=!1:w=!1),onConfirm:gt},null,8,["translations","show","total","defaultCurrency"]),l(U)?(i(),u("div",Ls,t[35]||(t[35]=[s("div",{class:"shortcuts-content"},[s("h6",null,"اختصارات لوحة المفاتيح"),s("div",{class:"shortcut-item"},[s("kbd",null,"F1"),d(" - البحث ")]),s("div",{class:"shortcut-item"},[s("kbd",null,"F2"),d(" - الباركود ")]),s("div",{class:"shortcut-item"},[s("kbd",null,"F9"),d(" - الدفع ")]),s("div",{class:"shortcut-item"},[s("kbd",null,"Esc"),d(" - مسح الكل ")])],-1)]))):v("",!0),l(p)?(i(),u("div",{key:1,class:"modal-overlay",onClick:t[12]||(t[12]=o=>C(p)?p.value=!1:p=!1)},[s("div",{class:"modal-content cash-modal",onClick:t[11]||(t[11]=Vt(()=>{},["stop"]))},[s("div",Ns,[t[37]||(t[37]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-cash-coin"}),d(" إدارة الكاش ")],-1)),s("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=o=>C(p)?p.value=!1:p=!1)},t[36]||(t[36]=[s("i",{class:"bi bi-x"},null,-1)]))]),s("div",Os,[s("div",Ks,[s("div",Qs,[s("div",js,[s("div",Rs,[t[39]||(t[39]=s("div",{class:"stat-icon"},[s("i",{class:"bi bi-box-seam"})],-1)),s("div",zs,[t[38]||(t[38]=s("h6",null,"إجمالي المنتجات",-1)),s("span",Gs,a(l(q).totalProducts),1)])])]),s("div",Hs,[s("div",Js,[t[41]||(t[41]=s("div",{class:"stat-icon"},[s("i",{class:"bi bi-currency-dollar"})],-1)),s("div",Ws,[t[40]||(t[40]=s("h6",null,"إجمالي القيمة",-1)),s("span",Xs,a(j(l(q).totalValue)),1)])])])])]),s("div",Ys,[t[44]||(t[44]=s("h6",{class:"mb-3"},[s("i",{class:"bi bi-list-ul"}),d(" المنتجات في الكاش ")],-1)),l(q).products.length===0?(i(),u("div",Zs,t[42]||(t[42]=[s("i",{class:"bi bi-inbox"},null,-1),s("p",null,"لا توجد منتجات في الكاش",-1)]))):(i(),u("div",te,[(i(!0),u(D,null,T(l(q).products,o=>(i(),u("div",{key:o.product_id,class:"cash-product-item"},[s("div",se,[s("h6",ee,a(G(o.product_id)),1),s("small",oe,"الكمية: "+a(o.quantity)+" × "+a(j(o.price)),1)]),s("div",ne,[s("button",{class:"btn btn-sm btn-outline-danger",onClick:r=>at(o.product_id),title:"حذف المنتج"},t[43]||(t[43]=[s("i",{class:"bi bi-trash"},null,-1)]),8,le)])]))),128))]))])]),s("div",ie,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=o=>C(p)?p.value=!1:p=!1)}," إغلاق "),s("button",{type:"button",class:"btn btn-danger",onClick:rt,disabled:l(q).products.length===0},t[45]||(t[45]=[s("i",{class:"bi bi-trash"},null,-1),d(" مسح الكاش بالكامل ")]),8,ae)])])])):v("",!0)]),_:1},8,["translations"]))}},fe=Dt(re,[["__scopeId","data-v-1e0484ed"]]);export{fe as default};
