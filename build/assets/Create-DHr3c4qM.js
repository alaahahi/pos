import{r as y,T as N,z as k,k as C,B as T,a as r,h as D,w as j,b as t,t as n,j as E,i as f,u as V,c as i,F,f as Q,l as w,x,e as _,d as z}from"./app-clFBPr0i.js";import{A as O}from"./AuthenticatedLayout-DqXWRB_x.js";import{_ as G}from"./InputError-CbNC1Wun.js";import{C as U}from"./vue-select-D2TxhEr1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"section dashboard"},J={class:"row"},K={class:"col-lg-12"},R={class:"card"},W={class:"card-body"},X={class:"card-title"},Y={class:"row mb-3"},Z={for:"customerSelect",class:"col-sm-2 col-form-label"},tt={class:"col-sm-10"},et={key:0,class:"row mb-3"},st={for:"productTable",class:"col-sm-2 col-form-label"},ot={class:"col-sm-10"},at={class:"table"},nt=["onInput","onUpdate:modelValue","max"],lt=["onUpdate:modelValue"],rt=["value"],ct=["onClick"],dt={class:"row"},it={class:"col-md-6"},ut={class:"col-md-6"},mt={class:"text-center"},pt=["disabled"],vt={key:0,class:"bi bi-save"},ht={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},wt={__name:"Create",props:{products:Array,customers:Array,translations:Object},setup(a){const g=y(""),c=y(!1),u=y(null),m=a,p=N({customer_id:"",items:[],log:[],total_amount:0}),v=k([]),A=k([]),L=C(()=>g.value?m.customers.filter(e=>{const s=g.value.toLowerCase();return e.name.toLowerCase().includes(s)||e.phone.includes(s)}):m.customers),M=e=>{const s=m.products.find(d=>d.id===e.product_id);s&&(e.price=s.price,e.max_quantity=s.max_quantity)},$=e=>{const s=m.products.find(d=>d.id===e.product_id);s&&e.quantity>s.max_quantity&&(e.quantity=s.max_quantity)},b=C(()=>v.reduce((e,s)=>e+s.quantity*s.price,0));T(b,e=>{p.total_amount=e});const B=()=>{v.push({product_id:"",quantity:1,price:0}),h("product_added")},I=e=>{v.splice(e,1),h("product_removed")},P=e=>{console.log(e),u.value=e,p.customer_id=e?e.id:null,h(`customer_selected ${e?e.name:""}`)},h=e=>{const s=new Date().toLocaleString();A.push({message:e,timestamp:s})},S=()=>{c.value=!0,p.items=v,p.post(route("orders.store"),{onSuccess:()=>{c.value=!1,h("invoice_saved")},onError:()=>{c.value=!1,h("invoice_save_failed")}})};return(e,s)=>(r(),D(O,{translations:a.translations},{default:j(()=>{var d;return[t("section",H,[t("div",J,[t("div",K,[t("div",R,[t("div",W,[t("h5",X,n(a.translations.create_invoice),1),t("form",{onSubmit:E(S,["prevent"]),class:"row g-3"},[t("div",Y,[t("label",Z,n(a.translations.client),1),t("div",tt,[f(V(U),{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),options:L.value,label:"name","track-by":"id",reduce:o=>({id:o.id,name:o.name}),onMouseleave:s[1]||(s[1]=o=>P(u.value)),clearable:!0,placeholder:a.translations.select_customer},null,8,["modelValue","options","reduce","placeholder"]),f(G,{message:V(p).errors.customer},null,8,["message"])])]),u.value?(r(),i("div",et,[t("label",st,n(a.translations.products),1),t("div",ot,[t("table",at,[t("thead",null,[t("tr",null,[t("th",null,n(a.translations.product),1),t("th",null,n(a.translations.quantity),1),t("th",null,n(a.translations.price),1),t("th",null,n(a.translations.total),1),t("th",null,n(a.translations.actions),1)])]),t("tbody",null,[(r(!0),i(F,null,Q(v,(o,q)=>(r(),i("tr",{key:q},[f(V(U),{modelValue:o.product_id,"onUpdate:modelValue":l=>o.product_id=l,options:a.products,label:"name",reduce:l=>l.id,placeholder:a.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:l=>M(o)},null,8,["modelValue","onUpdate:modelValue","options","reduce","placeholder","onMouseleave"]),t("td",null,[w(t("input",{type:"number",onInput:l=>$(o),"onUpdate:modelValue":l=>o.quantity=l,min:"1",max:o.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,nt),[[x,o.quantity]])]),t("td",null,[w(t("input",{type:"number","onUpdate:modelValue":l=>o.price=l,min:"0",class:"form-control",placeholder:"Price"},null,8,lt),[[x,o.price]])]),t("td",null,[t("input",{type:"number",value:o.quantity*o.price,class:"form-control",disabled:""},null,8,rt)]),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:l=>I(q)},s[3]||(s[3]=[t("i",{class:"bi bi-trash"},null,-1)]),8,ct)])]))),128))])]),(d=a.products)!=null&&d.length?(r(),i("button",{key:0,type:"button",class:"btn btn-primary",onClick:B},n(a.translations.add_product),1)):_("",!0)])])):_("",!0),t("div",dt,[t("div",it,[t("strong",null,n(m.translations.total)+":",1)]),t("div",ut,[w(t("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=o=>b.value=o),class:"form-control",readonly:""},null,512),[[x,b.value]])])]),t("div",mt,[t("button",{type:"submit",class:"btn btn-primary",disabled:c.value},[z(n(a.translations.save)+" Â  ",1),c.value?_("",!0):(r(),i("i",vt)),c.value?(r(),i("span",ht)):_("",!0)],8,pt)])],32)])])])])])]}),_:1},8,["translations"]))}};export{wt as default};
