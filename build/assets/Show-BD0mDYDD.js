import{Q as es,r as g,k as as,a as r,h as q,w as k,b as s,i as F,d as o,u as Q,p as z,t as l,n as L,c,e as v,f as ls,F as ns,J as N,j as D,l as _,x as C,A as P,C as $,K as os,g as O,D as J}from"./app-Umg6DmM7.js";import{A as rs}from"./AuthenticatedLayout-7Fi5SlqU.js";import{S as m}from"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as ds}from"./_plugin-vue_export-helper-DlAUqK2U.js";const is={class:"section dashboard"},us={class:"card mb-4"},cs={class:"card-header d-flex justify-content-between align-items-center"},ms={class:"card-body"},bs={class:"row"},vs={class:"col-md-3"},fs={class:"col-md-3"},ys={class:"col-md-3"},ps={class:"col-md-3"},gs={key:0,class:"row mt-3"},_s={class:"col-md-4"},xs={class:"badge bg-info fs-6"},hs={class:"col-md-4"},ws={class:"badge bg-info fs-6"},ks={class:"col-md-4"},Cs=["disabled"],Ms={class:"row mb-4"},Fs={class:"col-md-3"},Bs={class:"card text-center"},Vs={class:"card-body"},Ss={class:"text-primary"},Us={class:"col-md-3"},As={class:"card text-center"},Ts={class:"card-body"},qs={class:"text-info"},Ds={class:"col-md-3"},js={class:"card text-center"},Is={class:"card-body"},Es={class:"text-success"},Ls={class:"col-md-3"},Ns={class:"card text-center"},Ps={class:"card-body"},$s={class:"text-danger"},Os={class:"card"},Ws={class:"card-body"},Qs={class:"table-responsive"},zs={class:"table table-hover"},Js={class:"text-success"},Ks=["onClick"],Gs={key:0},Hs={class:"modal-container"},Rs={class:"modal-content"},Xs={class:"modal-header"},Ys={class:"modal-title"},Zs={class:"modal-body"},st={class:"mb-3"},tt=["value"],et={class:"mb-3"},at=["max"],lt={class:"mb-3"},nt=["disabled"],ot={key:0},rt={key:0,class:"text-danger"},dt={key:1,class:"text-success"},it={class:"mb-3"},ut={key:0,class:"alert alert-info"},ct={class:"modal-footer"},mt=["disabled"],bt={key:0,class:"spinner-border spinner-border-sm me-2"},vt={class:"modal-container"},ft={class:"modal-content"},yt={class:"modal-body"},pt={class:"mb-3"},gt={class:"mb-3"},_t={class:"mb-3"},xt={class:"modal-footer"},ht=["disabled"],wt={key:0,class:"spinner-border spinner-border-sm me-2"},kt={class:"modal-container"},Ct={class:"modal-content"},Mt={class:"modal-body"},Ft={class:"alert alert-info"},Bt={class:"mb-3"},Vt={class:"mb-3"},St={class:"mb-3"},Ut={class:"modal-footer"},At=["disabled"],Tt={key:0,class:"spinner-border spinner-border-sm me-2"},qt={__name:"Show",props:{customer:Object,invoices:Array,statistics:Object,translations:Object},setup(n){const w=n;es();const j=g(!1),f=g(null),B=g(!1),V=g(null),I=g(!1),E=g(!1),x=g(!1),i=g({amount:"",payment_method:"cash",notes:""}),b=g({amount:"",currency:"dinar",notes:""}),u=g({amount:"",currency:"dinar",notes:""}),S=as(()=>w.customer.balance?i.value.payment_method!=="balance"?!0:(w.customer.balance.balance_dinar||0)>=parseFloat(i.value.amount||0):!1),d=(a,t="dinar")=>{if(!a)return"0";const e=parseFloat(a);return`${e%1===0?e.toString():e.toFixed(2)} ${t==="dollar"?"$":"د.ع"}`},K=a=>a?new Date(a).toLocaleDateString("ar-IQ"):"-",G=a=>({paid:"مدفوعة",due:"غير مدفوعة",pending:"قيد الانتظار",completed:"مكتملة",cancelled:"ملغاة"})[a]||a,H=a=>({paid:"badge bg-success",due:"badge bg-danger",pending:"badge bg-warning",completed:"badge bg-success",cancelled:"badge bg-secondary"})[a]||"badge bg-secondary",R=a=>({cash:"نقدي",balance:"من الرصيد",transfer:"تحويل"})[a]||a,X=async a=>{f.value=a,i.value={amount:a.remaining.toFixed(2),payment_method:"cash",notes:""},j.value=!0,await os(),V.value&&(V.value.focus(),V.value.select())},U=()=>{j.value=!1,f.value=null,i.value={amount:"",payment_method:"cash",notes:""}},W=()=>{if(f.value){if(parseFloat(i.value.amount)<=0){m.fire("خطأ","المبلغ يجب أن يكون أكبر من صفر","error");return}if(parseFloat(i.value.amount)>f.value.remaining){m.fire("خطأ","المبلغ المدفوع أكبر من المبلغ المتبقي","error");return}if(i.value.payment_method==="balance"&&!S.value){m.fire("خطأ","الرصيد غير كافي","error");return}B.value=!0,O.post(route("customers.orders.pay",{customer:w.customer.id,order:f.value.id}),i.value,{onSuccess:()=>{m.fire("نجح","تم دفع الفاتورة بنجاح","success"),U()},onError:a=>{const t=a.message||a.amount||"حدث خطأ أثناء الدفع";m.fire("خطأ",t,"error")},onFinish:()=>{B.value=!1}})}},Y=()=>{b.value={amount:"",currency:"dinar",notes:""},I.value=!0},A=()=>{I.value=!1,b.value={amount:"",currency:"dinar",notes:""}},Z=async()=>{var a,t;if(!b.value.amount||parseFloat(b.value.amount)<=0){m.fire("خطأ","يرجى إدخال مبلغ صحيح","error");return}x.value=!0;try{const e=await J.post("/decoration-payments/balance/add",{customer_id:w.customer.id,amount:b.value.amount,currency:b.value.currency,notes:b.value.notes});e.data.success?(m.fire("نجح","تم إضافة الرصيد بنجاح","success"),A(),O.reload()):m.fire("خطأ",e.data.message||"حدث خطأ أثناء إضافة الرصيد","error")}catch(e){console.error("Error adding balance:",e),m.fire("خطأ",((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"حدث خطأ أثناء إضافة الرصيد","error")}finally{x.value=!1}},ss=()=>{u.value={amount:"",currency:"dinar",notes:""},E.value=!0},T=()=>{E.value=!1,u.value={amount:"",currency:"dinar",notes:""}},ts=async()=>{var t,e,p,y;if(!u.value.amount||parseFloat(u.value.amount)<=0){m.fire("خطأ","يرجى إدخال مبلغ صحيح","error");return}const a=u.value.currency==="dollar"?((t=w.customer.balance)==null?void 0:t.balance_dollar)||0:((e=w.customer.balance)==null?void 0:e.balance_dinar)||0;if(parseFloat(u.value.amount)>a){m.fire("خطأ","الرصيد غير كافي","error");return}x.value=!0;try{const h=await J.post("/decoration-payments/balance/withdraw",{customer_id:w.customer.id,amount:u.value.amount,currency:u.value.currency,notes:u.value.notes});h.data.success?(m.fire("نجح","تم سحب الرصيد بنجاح","success"),T(),O.reload()):m.fire("خطأ",h.data.message||"حدث خطأ أثناء سحب الرصيد","error")}catch(h){console.error("Error withdrawing balance:",h),m.fire("خطأ",((y=(p=h.response)==null?void 0:p.data)==null?void 0:y.message)||"حدث خطأ أثناء سحب الرصيد","error")}finally{x.value=!1}};return(a,t)=>(r(),q(rs,{translations:n.translations},{default:k(()=>[s("section",is,[s("div",us,[s("div",cs,[t[10]||(t[10]=s("h5",{class:"mb-0"},"معلومات العميل",-1)),F(Q(z),{href:a.route("customers.index"),class:"btn btn-secondary btn-sm"},{default:k(()=>t[9]||(t[9]=[s("i",{class:"bi bi-arrow-right"},null,-1),o(" رجوع ")])),_:1},8,["href"])]),s("div",ms,[s("div",bs,[s("div",vs,[t[11]||(t[11]=s("strong",null,"الاسم:",-1)),o(" "+l(n.customer.name),1)]),s("div",fs,[t[12]||(t[12]=s("strong",null,"الهاتف:",-1)),o(" "+l(n.customer.phone||"-"),1)]),s("div",ys,[t[13]||(t[13]=s("strong",null,"البريد الإلكتروني:",-1)),o(" "+l(n.customer.email||"-"),1)]),s("div",ps,[t[14]||(t[14]=s("strong",null,"الحالة:",-1)),s("span",{class:L(n.customer.is_active?"badge bg-success":"badge bg-danger")},l(n.customer.is_active?"نشط":"غير نشط"),3)])]),n.customer.balance?(r(),c("div",gs,[s("div",_s,[t[15]||(t[15]=s("strong",null,"الرصيد بالدولار:",-1)),s("span",xs,l(d(n.customer.balance.balance_dollar||0,"dollar")),1)]),s("div",hs,[t[16]||(t[16]=s("strong",null,"الرصيد بالدينار:",-1)),s("span",ws,l(d(n.customer.balance.balance_dinar||0,"dinar")),1)]),s("div",ks,[s("button",{class:"btn btn-sm btn-success me-2",onClick:Y},t[17]||(t[17]=[s("i",{class:"bi bi-plus-circle"},null,-1),o(" إضافة رصيد ")])),s("button",{class:"btn btn-sm btn-warning",onClick:ss,disabled:(n.customer.balance.balance_dollar||0)<=0&&(n.customer.balance.balance_dinar||0)<=0},t[18]||(t[18]=[s("i",{class:"bi bi-dash-circle"},null,-1),o(" سحب رصيد ")]),8,Cs)])])):v("",!0)])]),s("div",Ms,[s("div",Fs,[s("div",Bs,[s("div",Vs,[t[19]||(t[19]=s("h6",{class:"text-muted"},"إجمالي الفواتير",-1)),s("h4",Ss,l(n.statistics.total_invoices),1)])])]),s("div",Us,[s("div",As,[s("div",Ts,[t[20]||(t[20]=s("h6",{class:"text-muted"},"إجمالي المبلغ",-1)),s("h4",qs,l(d(n.statistics.total_amount)),1)])])]),s("div",Ds,[s("div",js,[s("div",Is,[t[21]||(t[21]=s("h6",{class:"text-muted"},"إجمالي المدفوع",-1)),s("h4",Es,l(d(n.statistics.total_paid)),1)])])]),s("div",Ls,[s("div",Ns,[s("div",Ps,[t[22]||(t[22]=s("h6",{class:"text-muted"},"إجمالي الدين",-1)),s("h4",$s,l(d(n.statistics.total_debt)),1)])])])]),s("div",Os,[t[27]||(t[27]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},"الفواتير المرتبطة")],-1)),s("div",Ws,[s("div",Qs,[s("table",zs,[t[26]||(t[26]=s("thead",null,[s("tr",null,[s("th",null,"رقم الفاتورة"),s("th",null,"التاريخ"),s("th",null,"المبلغ الإجمالي"),s("th",null,"الخصم"),s("th",null,"المبلغ النهائي"),s("th",null,"المدفوع"),s("th",null,"المتبقي"),s("th",null,"الحالة"),s("th",null,"طريقة الدفع"),s("th",null,"الإجراءات")])],-1)),s("tbody",null,[(r(!0),c(ns,null,ls(n.invoices,e=>(r(),c("tr",{key:e.id},[s("td",null,l(e.order_number),1),s("td",null,l(K(e.date)),1),s("td",null,l(d(e.total_amount)),1),s("td",null,l(d(e.discount_amount)),1),s("td",null,[s("strong",null,l(d(e.final_amount)),1)]),s("td",Js,l(d(e.total_paid)),1),s("td",{class:L(["text-danger",{"fw-bold":e.remaining>0}])},l(d(e.remaining)),3),s("td",null,[s("span",{class:L(H(e.status))},l(G(e.status)),3)]),s("td",null,l(R(e.payment_method)),1),s("td",null,[e.remaining>0?(r(),c("button",{key:0,class:"btn btn-sm btn-primary",onClick:p=>X(e)},t[23]||(t[23]=[s("i",{class:"bi bi-cash-coin"},null,-1),o(" دفع ")]),8,Ks)):v("",!0),F(Q(z),{href:a.route("order.print",e.id),class:"btn btn-sm btn-info",target:"_blank"},{default:k(()=>t[24]||(t[24]=[s("i",{class:"bi bi-printer"},null,-1),o(" طباعة ")])),_:2},1032,["href"])])]))),128)),n.invoices.length===0?(r(),c("tr",Gs,t[25]||(t[25]=[s("td",{colspan:"10",class:"text-center text-muted"},"لا توجد فواتير",-1)]))):v("",!0)])])])])])]),(r(),q(N,{to:"body"},[F($,{name:"modal"},{default:k(()=>{var e,p,y,h;return[j.value?(r(),c("div",{key:0,class:"modal-overlay",onClick:D(U,["self"])},[s("div",Hs,[s("div",Rs,[s("div",Xs,[s("h5",Ys,"دفع الفاتورة "+l((e=f.value)==null?void 0:e.order_number),1),s("button",{type:"button",class:"btn-close",onClick:U,"aria-label":"Close"},t[28]||(t[28]=[s("span",{"aria-hidden":"true"},"×",-1)]))]),s("div",Zs,[s("form",{onSubmit:D(W,["prevent"])},[s("div",st,[t[29]||(t[29]=s("label",{class:"form-label"},"المبلغ المتبقي",-1)),s("input",{type:"text",class:"form-control",value:d(((p=f.value)==null?void 0:p.remaining)||0),disabled:""},null,8,tt)]),s("div",et,[t[30]||(t[30]=s("label",{class:"form-label"},[o("المبلغ المدفوع "),s("span",{class:"text-danger"},"*")],-1)),_(s("input",{type:"number",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=M=>i.value.amount=M),step:"0.01",min:"0.01",max:(y=f.value)==null?void 0:y.remaining,required:"",ref_key:"amountInput",ref:V},null,8,at),[[C,i.value.amount]])]),s("div",lt,[t[34]||(t[34]=s("label",{class:"form-label"},[o("طريقة الدفع "),s("span",{class:"text-danger"},"*")],-1)),_(s("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=M=>i.value.payment_method=M),required:""},[t[32]||(t[32]=s("option",{value:"cash"},"نقدي",-1)),s("option",{value:"balance",disabled:!S.value},[t[31]||(t[31]=o(" من الرصيد ")),n.customer.balance?(r(),c("span",ot," (المتاح: "+l(d(n.customer.balance.balance_dinar||0))+") ",1)):v("",!0)],8,nt),t[33]||(t[33]=s("option",{value:"transfer"},"تحويل",-1))],512),[[P,i.value.payment_method]]),i.value.payment_method==="balance"&&!S.value?(r(),c("small",rt," الرصيد غير كافي (المتاح: "+l(d(((h=n.customer.balance)==null?void 0:h.balance_dinar)||0))+") ",1)):v("",!0),i.value.payment_method==="balance"&&S.value?(r(),c("small",dt," ✓ الرصيد كافي للدفع ")):v("",!0)]),s("div",it,[t[35]||(t[35]=s("label",{class:"form-label"},"ملاحظات",-1)),_(s("textarea",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=M=>i.value.notes=M),rows:"3"},null,512),[[C,i.value.notes]])]),f.value?(r(),c("div",ut,[t[36]||(t[36]=s("strong",null,"المبلغ النهائي:",-1)),o(" "+l(d(f.value.final_amount)),1),t[37]||(t[37]=s("br",null,null,-1)),t[38]||(t[38]=s("strong",null,"المدفوع سابقاً:",-1)),o(" "+l(d(f.value.total_paid)),1),t[39]||(t[39]=s("br",null,null,-1)),t[40]||(t[40]=s("strong",null,"المتبقي:",-1)),o(" "+l(d(f.value.remaining)),1)])):v("",!0)],32)]),s("div",ct,[s("button",{type:"button",class:"btn btn-secondary",onClick:U},"إلغاء"),s("button",{type:"button",class:"btn btn-primary",onClick:W,disabled:B.value},[B.value?(r(),c("span",bt)):v("",!0),t[41]||(t[41]=o(" دفع "))],8,mt)])])])])):v("",!0)]}),_:1})])),(r(),q(N,{to:"body"},[F($,{name:"modal"},{default:k(()=>[I.value?(r(),c("div",{key:0,class:"modal-overlay",onClick:D(A,["self"])},[s("div",vt,[s("div",ft,[s("div",{class:"modal-header"},[t[43]||(t[43]=s("h5",{class:"modal-title"},"إضافة رصيد للعميل",-1)),s("button",{type:"button",class:"btn-close",onClick:A},t[42]||(t[42]=[s("span",null,"×",-1)]))]),s("div",yt,[s("div",pt,[t[44]||(t[44]=s("label",{class:"form-label"},[o("المبلغ "),s("span",{class:"text-danger"},"*")],-1)),_(s("input",{type:"number",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>b.value.amount=e),step:"0.01",min:"0.01",required:""},null,512),[[C,b.value.amount]])]),s("div",gt,[t[46]||(t[46]=s("label",{class:"form-label"},[o("العملة "),s("span",{class:"text-danger"},"*")],-1)),_(s("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=e=>b.value.currency=e),required:""},t[45]||(t[45]=[s("option",{value:"dollar"},"دولار",-1),s("option",{value:"dinar"},"دينار",-1)]),512),[[P,b.value.currency]])]),s("div",_t,[t[47]||(t[47]=s("label",{class:"form-label"},"ملاحظات",-1)),_(s("textarea",{class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>b.value.notes=e),rows:"3"},null,512),[[C,b.value.notes]])])]),s("div",xt,[s("button",{type:"button",class:"btn btn-secondary",onClick:A},"إلغاء"),s("button",{type:"button",class:"btn btn-success",onClick:Z,disabled:x.value},[x.value?(r(),c("span",wt)):v("",!0),t[48]||(t[48]=o(" إضافة "))],8,ht)])])])])):v("",!0)]),_:1})])),(r(),q(N,{to:"body"},[F($,{name:"modal"},{default:k(()=>{var e,p;return[E.value?(r(),c("div",{key:0,class:"modal-overlay",onClick:D(T,["self"])},[s("div",kt,[s("div",Ct,[s("div",{class:"modal-header"},[t[50]||(t[50]=s("h5",{class:"modal-title"},"سحب رصيد من العميل",-1)),s("button",{type:"button",class:"btn-close",onClick:T},t[49]||(t[49]=[s("span",null,"×",-1)]))]),s("div",Mt,[s("div",Ft,[t[51]||(t[51]=s("strong",null,"الرصيد المتاح:",-1)),t[52]||(t[52]=s("br",null,null,-1)),o(" دولار: "+l(d(((e=n.customer.balance)==null?void 0:e.balance_dollar)||0,"dollar")),1),t[53]||(t[53]=s("br",null,null,-1)),o(" دينار: "+l(d(((p=n.customer.balance)==null?void 0:p.balance_dinar)||0,"dinar")),1)]),s("div",Bt,[t[54]||(t[54]=s("label",{class:"form-label"},[o("المبلغ "),s("span",{class:"text-danger"},"*")],-1)),_(s("input",{type:"number",class:"form-control","onUpdate:modelValue":t[6]||(t[6]=y=>u.value.amount=y),step:"0.01",min:"0.01",required:""},null,512),[[C,u.value.amount]])]),s("div",Vt,[t[56]||(t[56]=s("label",{class:"form-label"},[o("العملة "),s("span",{class:"text-danger"},"*")],-1)),_(s("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=y=>u.value.currency=y),required:""},t[55]||(t[55]=[s("option",{value:"dollar"},"دولار",-1),s("option",{value:"dinar"},"دينار",-1)]),512),[[P,u.value.currency]])]),s("div",St,[t[57]||(t[57]=s("label",{class:"form-label"},"ملاحظات",-1)),_(s("textarea",{class:"form-control","onUpdate:modelValue":t[8]||(t[8]=y=>u.value.notes=y),rows:"3"},null,512),[[C,u.value.notes]])])]),s("div",Ut,[s("button",{type:"button",class:"btn btn-secondary",onClick:T},"إلغاء"),s("button",{type:"button",class:"btn btn-warning",onClick:ts,disabled:x.value},[x.value?(r(),c("span",Tt)):v("",!0),t[58]||(t[58]=o(" سحب "))],8,At)])])])])):v("",!0)]}),_:1})]))]),_:1},8,["translations"]))}},Lt=ds(qt,[["__scopeId","data-v-c9bcdfb3"]]);export{Lt as default};
