import{r as _,s as L,T as O,k as Q,B as R,a as c,h as z,w as G,b as s,d as b,t as l,n as r,j as F,l as u,G as q,u as i,x as g,i as v,c as m,e as h,f as H,F as J,A as K}from"./app-O9LB-b3q.js";import{A as W}from"./AuthenticatedLayout-clERgUMh.js";import{_ as p}from"./InputError-Dl0jYs61.js";import{l as X}from"./lodash-CzKie_ZB.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"section dashboard"},ss={class:"row"},ts={class:"col-lg-12"},es={class:"card"},os={class:"card-header"},ls={class:"card-title mb-0"},is={class:"text-muted mb-0"},as={class:"card-body"},ns={class:"row mb-4"},rs={class:"col-12"},ds={class:"progress-steps"},cs={class:"step-label"},us={class:"step-label"},ms={class:"step-label"},vs={class:"step-label"},ps={class:"form-section"},bs={class:"section-title"},gs={class:"row mb-3"},fs={for:"inputName",class:"col-sm-2 col-form-label required"},_s={class:"col-sm-10"},hs={class:"input-group"},ys=["placeholder"],xs={class:"form-text"},ws={class:"row mb-3"},ks={for:"inputBarcode",class:"col-sm-2 col-form-label"},Vs={class:"col-sm-10"},qs={class:"input-group"},Cs=["placeholder"],Bs=["disabled","title"],Is={key:0,class:"input-group-text"},Us={key:1,class:"input-group-text text-danger"},Ss={key:2,class:"input-group-text text-success"},Fs={class:"form-text"},Ns={class:"row mb-3"},Ms={for:"inputModel",class:"col-sm-2 col-form-label"},Ps={class:"col-sm-10"},js={class:"input-group"},As=["placeholder"],Es={class:"form-text"},Ds={class:"row mb-3"},Ts={for:"inputOENumber",class:"col-sm-2 col-form-label"},$s={class:"col-sm-10"},Ls={class:"input-group"},Os=["placeholder"],Qs={class:"form-text"},Rs={class:"row mb-3"},zs={class:"col-sm-10"},Gs={class:"input-group"},Hs=["value"],Js={class:"form-section"},Ks={class:"section-title"},Ws={class:"row mb-3"},Xs={for:"inputPriceCost",class:"col-sm-2 col-form-label"},Ys={class:"col-sm-10"},Zs={class:"input-group"},st=["placeholder"],tt={class:"input-group-text"},et={class:"form-text"},ot={class:"row mb-3"},lt={for:"inputPrice",class:"col-sm-2 col-form-label required"},it={class:"col-sm-10"},at={class:"input-group"},nt=["placeholder"],rt={class:"input-group-text"},dt={class:"form-text"},ct={key:0,class:"row mb-3"},ut={class:"col-sm-10"},mt={class:"alert alert-info"},vt={class:"form-section"},pt={class:"section-title"},bt={class:"row mb-3"},gt={for:"inputQuantity",class:"col-sm-2 col-form-label required"},ft={class:"col-sm-10"},_t={class:"input-group"},ht=["placeholder"],yt={class:"input-group-text"},xt={class:"form-text"},wt={class:"form-section"},kt={class:"section-title"},Vt={class:"row mb-3"},qt={for:"inputNote",class:"col-sm-2 col-form-label"},Ct={class:"col-sm-10"},Bt={class:"input-group"},It=["placeholder"],Ut={class:"form-text"},St={class:"row mb-3"},Ft={for:"inputdate",class:"col-sm-2 col-form-label"},Nt={class:"col-sm-10"},Mt={class:"input-group"},Pt={class:"form-text"},jt={class:"row mb-3"},At={for:"inputImage",class:"col-sm-2 col-form-label"},Et={class:"col-sm-10"},Dt={key:0,class:"upload-placeholder"},Tt={class:"text-muted"},$t={key:1,class:"image-preview"},Lt=["src","alt"],Ot=["value"],Qt={class:"form-text"},Rt={class:"row mt-4"},zt={class:"col-12"},Gt={class:"d-flex justify-content-between"},Ht=["disabled"],Jt=["disabled"],Kt={key:0,class:"bi bi-check-circle me-2"},Wt={key:1,class:"spinner-border spinner-border-sm me-2"},Xt={__name:"Create",props:{categories:{type:Array,default:()=>[]},translations:Object},setup(o){const y=_(!1),x=L(),n=_(1),w=_(null),V=_(null),d=_({checking:!1,isValid:!0,message:""}),k=_(null),C=_(null),e=O({name:"",model:"",oe_number:"",price_cost:null,price:null,quantity:null,notes:"",barcode:"",image:null,category_id:null}),B=Q(()=>e.name&&e.price&&e.quantity),N=()=>{n.value<4&&n.value++},M=()=>{n.value>1&&n.value--},I=()=>{n.value===1&&e.name&&(n.value=2)},P=()=>{const f=Date.now().toString(),t=Math.floor(Math.random()*1e3).toString().padStart(3,"0");e.barcode=`BC${f.slice(-6)}${t}`,U(e.barcode),x.success("تم توليد باركود جديد")},j=async f=>{if(!f||f.length<3){d.value={checking:!1,isValid:!0,message:""};return}d.value.checking=!0;try{const a=await(await fetch(route("products.checkBarcodeUnique",f))).json();d.value={checking:!1,isValid:a.unique,message:a.message},a.unique||x.warning(a.message)}catch(t){console.error("Barcode validation error:",t),d.value={checking:!1,isValid:!1,message:"خطأ في التحقق من الباركود"}}},U=X.debounce(j,500),S=()=>{e.price_cost&&e.price?(k.value=parseFloat(e.price)-parseFloat(e.price_cost),C.value=k.value/parseFloat(e.price_cost)*100):(k.value=null,C.value=null)},A=()=>{V.value.click()},E=f=>{const t=f.target.files[0];if(t){e.image=t;const a=new FileReader;a.onload=$=>{w.value=$.target.result},a.readAsDataURL(t)}},D=()=>{e.image=null,w.value=null,V.value&&(V.value.value="")},T=()=>{if(e.barcode&&!d.value.isValid){x.error("يجب إدخال باركود صحيح ومتاح");return}if(!B.value){x.error("يرجى ملء جميع الحقول المطلوبة");return}y.value=!0,e.post(route("products.store"),{onSuccess:()=>{y.value=!1,x.success("تم إنشاء المنتج بنجاح")},onError:()=>{y.value=!1,x.error("حدث خطأ أثناء إنشاء المنتج")}})};return R([()=>e.name,()=>e.price,()=>e.quantity],()=>{I()}),(f,t)=>(c(),z(W,{translations:o.translations},{default:G(()=>[s("section",Z,[s("div",ss,[s("div",ts,[s("div",es,[s("div",os,[s("h5",ls,[t[11]||(t[11]=s("i",{class:"bi bi-plus-circle me-2"},null,-1)),b(" "+l(o.translations.add_new_product),1)]),s("p",is,l(o.translations.add_new_product_description),1)]),s("div",as,[s("div",ns,[s("div",rs,[s("div",ds,[s("div",{class:r(["step",{active:n.value>=1,completed:n.value>1}])},[t[12]||(t[12]=s("div",{class:"step-number"},"1",-1)),s("div",cs,l(o.translations.basic_info),1)],2),s("div",{class:r(["step",{active:n.value>=2,completed:n.value>2}])},[t[13]||(t[13]=s("div",{class:"step-number"},"2",-1)),s("div",us,l(o.translations.pricing),1)],2),s("div",{class:r(["step",{active:n.value>=3,completed:n.value>3}])},[t[14]||(t[14]=s("div",{class:"step-number"},"3",-1)),s("div",ms,l(o.translations.inventory),1)],2),s("div",{class:r(["step",{active:n.value>=4,completed:n.value>4}])},[t[15]||(t[15]=s("div",{class:"step-number"},"4",-1)),s("div",vs,l(o.translations.additional),1)],2)])])]),s("form",{onSubmit:F(T,["prevent"]),class:"needs-validation",novalidate:""},[u(s("div",ps,[s("h6",bs,[t[16]||(t[16]=s("i",{class:"bi bi-info-circle me-2"},null,-1)),b(" "+l(o.translations.basic_info),1)]),s("div",gs,[s("label",fs,l(o.translations.name),1),s("div",_s,[s("div",hs,[t[17]||(t[17]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-box-seam"})],-1)),u(s("input",{id:"inputName",type:"text",class:r(["form-control",{"is-invalid":i(e).errors.name}]),placeholder:o.translations.enter_product_name,"onUpdate:modelValue":t[0]||(t[0]=a=>i(e).name=a),required:"",onInput:I},null,42,ys),[[g,i(e).name]])]),s("div",xs,l(o.translations.product_name_help),1),v(p,{message:i(e).errors.name},null,8,["message"])])]),s("div",ws,[s("label",ks,l(o.translations.barcode),1),s("div",Vs,[s("div",qs,[t[22]||(t[22]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-upc-scan"})],-1)),u(s("input",{id:"inputBarcode",type:"text",class:r(["form-control",{"is-invalid":d.value.checking===!1&&!d.value.isValid,"is-valid":i(e).barcode&&d.value.isValid}]),placeholder:o.translations.enter_barcode_or_auto_generate,"onUpdate:modelValue":t[1]||(t[1]=a=>i(e).barcode=a),onInput:t[2]||(t[2]=a=>i(U)(i(e).barcode))},null,42,Cs),[[g,i(e).barcode]]),s("button",{class:"btn btn-outline-secondary",type:"button",onClick:P,disabled:d.value.checking,title:o.translations.auto_generate_barcode},t[18]||(t[18]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,Bs),d.value.checking?(c(),m("div",Is,t[19]||(t[19]=[s("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1)]))):d.value.isValid?i(e).barcode&&d.value.isValid?(c(),m("div",Ss,t[21]||(t[21]=[s("i",{class:"bi bi-check-circle"},null,-1)]))):h("",!0):(c(),m("div",Us,t[20]||(t[20]=[s("i",{class:"bi bi-exclamation-triangle"},null,-1)])))]),d.value.message?(c(),m("div",{key:0,class:r(["form-text",d.value.isValid?"text-success":"text-danger"])},l(d.value.message),3)):h("",!0),s("div",Fs,l(o.translations.barcode_help),1),v(p,{message:i(e).errors.barcode},null,8,["message"])])]),s("div",Ns,[s("label",Ms,l(o.translations.model)+" ("+l(o.translations.optional)+")",1),s("div",Ps,[s("div",js,[t[23]||(t[23]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-tag"})],-1)),u(s("input",{id:"inputModel",type:"text",class:r(["form-control",{"is-invalid":i(e).errors.model}]),placeholder:o.translations.enter_model_number,"onUpdate:modelValue":t[3]||(t[3]=a=>i(e).model=a)},null,10,As),[[g,i(e).model]])]),s("div",Es,l(o.translations.model_help),1),v(p,{message:i(e).errors.model},null,8,["message"])])]),s("div",Ds,[s("label",Ts,l(o.translations.oe_number),1),s("div",$s,[s("div",Ls,[t[24]||(t[24]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-hash"})],-1)),u(s("input",{id:"inputOENumber",type:"text",class:r(["form-control",{"is-invalid":i(e).errors.oe_number}]),placeholder:o.translations.enter_oe_number,"onUpdate:modelValue":t[4]||(t[4]=a=>i(e).oe_number=a)},null,10,Os),[[g,i(e).oe_number]])]),s("div",Qs,l(o.translations.oe_number_help),1),v(p,{message:i(e).errors.oe_number},null,8,["message"])])]),s("div",Rs,[t[28]||(t[28]=s("label",{for:"inputCategory",class:"col-sm-2 col-form-label"},"التصنيف",-1)),s("div",zs,[s("div",Gs,[t[26]||(t[26]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-tags"})],-1)),u(s("select",{id:"inputCategory",class:r(["form-control",{"is-invalid":i(e).errors.category_id}]),"onUpdate:modelValue":t[5]||(t[5]=a=>i(e).category_id=a)},[t[25]||(t[25]=s("option",{value:""},"اختر تصنيف (اختياري)",-1)),(c(!0),m(J,null,H(o.categories,a=>(c(),m("option",{key:a.id,value:a.id},l(a.name),9,Hs))),128))],2),[[K,i(e).category_id]])]),t[27]||(t[27]=s("div",{class:"form-text"},"اختر تصنيف للمنتج لتسهيل البحث والفلترة",-1)),v(p,{message:i(e).errors.category_id},null,8,["message"])])])],512),[[q,n.value>=1]]),u(s("div",Js,[s("h6",Ks,[t[29]||(t[29]=s("i",{class:"bi bi-currency-dollar me-2"},null,-1)),b(" "+l(o.translations.pricing),1)]),s("div",Ws,[s("label",Xs,l(o.translations.price_cost),1),s("div",Ys,[s("div",Zs,[t[30]||(t[30]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cart-plus"})],-1)),u(s("input",{id:"inputPriceCost",type:"number",step:"0.01",min:"0",class:r(["form-control",{"is-invalid":i(e).errors.price_cost}]),placeholder:o.translations.enter_cost_price,"onUpdate:modelValue":t[6]||(t[6]=a=>i(e).price_cost=a),onInput:S},null,42,st),[[g,i(e).price_cost]]),s("span",tt,l(o.translations.dinar),1)]),s("div",et,l(o.translations.cost_price_help),1),v(p,{message:i(e).errors.price_cost},null,8,["message"])])]),s("div",ot,[s("label",lt,l(o.translations.price),1),s("div",it,[s("div",at,[t[31]||(t[31]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cash-stack"})],-1)),u(s("input",{id:"inputPrice",type:"number",step:"0.01",min:"0",class:r(["form-control",{"is-invalid":i(e).errors.price}]),placeholder:o.translations.enter_selling_price,"onUpdate:modelValue":t[7]||(t[7]=a=>i(e).price=a),required:"",onInput:S},null,42,nt),[[g,i(e).price]]),s("span",rt,l(o.translations.dinar),1)]),s("div",dt,l(o.translations.selling_price_help),1),v(p,{message:i(e).errors.price},null,8,["message"])])]),k.value!==null?(c(),m("div",ct,[t[33]||(t[33]=s("div",{class:"col-sm-2"},null,-1)),s("div",ut,[s("div",mt,[t[32]||(t[32]=s("i",{class:"bi bi-graph-up me-2"},null,-1)),s("strong",null,l(o.translations.profit_margin)+":",1),b(" "+l(k.value.toFixed(2))+" "+l(o.translations.dinar)+" ("+l(C.value.toFixed(1))+"%) ",1)])])])):h("",!0)],512),[[q,n.value>=2]]),u(s("div",vt,[s("h6",pt,[t[34]||(t[34]=s("i",{class:"bi bi-boxes me-2"},null,-1)),b(" "+l(o.translations.inventory),1)]),s("div",bt,[s("label",gt,l(o.translations.quantity),1),s("div",ft,[s("div",_t,[t[35]||(t[35]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-123"})],-1)),u(s("input",{id:"inputQuantity",type:"number",min:"0",class:r(["form-control",{"is-invalid":i(e).errors.quantity}]),placeholder:o.translations.enter_initial_quantity,"onUpdate:modelValue":t[8]||(t[8]=a=>i(e).quantity=a),required:""},null,10,ht),[[g,i(e).quantity]]),s("span",yt,l(o.translations.units),1)]),s("div",xt,l(o.translations.quantity_help),1),v(p,{message:i(e).errors.quantity},null,8,["message"])])])],512),[[q,n.value>=3]]),u(s("div",wt,[s("h6",kt,[t[36]||(t[36]=s("i",{class:"bi bi-info-square me-2"},null,-1)),b(" "+l(o.translations.additional),1)]),s("div",Vt,[s("label",qt,l(o.translations.note),1),s("div",Ct,[s("div",Bt,[t[37]||(t[37]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-journal-text"})],-1)),u(s("textarea",{id:"inputNote",class:r(["form-control",{"is-invalid":i(e).errors.notes}]),placeholder:o.translations.enter_notes_optional,"onUpdate:modelValue":t[9]||(t[9]=a=>i(e).notes=a),rows:"3"},null,10,It),[[g,i(e).notes]])]),s("div",Ut,l(o.translations.notes_help),1),v(p,{message:i(e).errors.notes},null,8,["message"])])]),s("div",St,[s("label",Ft,l(o.translations.date),1),s("div",Nt,[s("div",Mt,[t[38]||(t[38]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-calendar"})],-1)),u(s("input",{id:"inputdate",type:"date",class:r(["form-control",{"is-invalid":i(e).errors.date}]),"onUpdate:modelValue":t[10]||(t[10]=a=>i(e).date=a)},null,2),[[g,i(e).date]])]),s("div",Pt,l(o.translations.date_help),1),v(p,{message:i(e).errors.date},null,8,["message"])])]),s("div",jt,[s("label",At,l(o.translations.image),1),s("div",Et,[s("div",{class:r(["image-upload-area",{"has-image":w.value}]),onClick:A},[s("input",{ref_key:"fileInput",ref:V,id:"inputImage",type:"file",accept:"image/*",onInput:E,style:{display:"none"}},null,544),w.value?(c(),m("div",$t,[s("img",{src:w.value,alt:o.translations.product_image},null,8,Lt),s("button",{type:"button",class:"btn btn-sm btn-danger remove-image",onClick:F(D,["stop"])},t[40]||(t[40]=[s("i",{class:"bi bi-x"},null,-1)]))])):(c(),m("div",Dt,[t[39]||(t[39]=s("i",{class:"bi bi-cloud-upload"},null,-1)),s("p",null,l(o.translations.click_to_upload_image),1),s("small",Tt,l(o.translations.supported_formats),1)]))],2),i(e).progress?(c(),m("progress",{key:0,value:i(e).progress.percentage,max:"100",class:"w-100 mt-2"},l(i(e).progress.percentage)+"% ",9,Ot)):h("",!0),s("div",Qt,l(o.translations.image_help),1)])])],512),[[q,n.value>=4]]),s("div",Rt,[s("div",zt,[s("div",Gt,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:M,disabled:n.value===1},[t[41]||(t[41]=s("i",{class:"bi bi-arrow-left me-2"},null,-1)),b(" "+l(o.translations.previous),1)],8,Ht),s("div",null,[n.value<4?(c(),m("button",{key:0,type:"button",class:"btn btn-primary me-2",onClick:N},[b(l(o.translations.next)+" ",1),t[42]||(t[42]=s("i",{class:"bi bi-arrow-right ms-2"},null,-1))])):h("",!0),s("button",{type:"submit",class:"btn btn-success",disabled:y.value||!B.value},[y.value?h("",!0):(c(),m("i",Kt)),y.value?(c(),m("span",Wt)):h("",!0),b(" "+l(o.translations.save),1)],8,Jt)])])])])],32)])])])])])]),_:1},8,["translations"]))}},oe=Y(Xt,[["__scopeId","data-v-a64daad6"]]);export{oe as default};
