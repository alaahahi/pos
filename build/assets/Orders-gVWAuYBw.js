import{Q as X,r as k,z as N,a as d,h as C,w,b as t,t as s,u as S,p as $,d as r,e as c,i as V,j as T,l as v,x as j,A as O,c as u,f as M,n as _,F as U,g as D}from"./app-BK41XzZo.js";import{A as Y}from"./AuthenticatedLayout-BrjZjJ95.js";import{_ as Z}from"./Pagination-CrVYEERS.js";import{P as tt}from"./PricingEditModal-BPuc9WCM.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";const et={class:"d-flex justify-content-between align-items-center"},at={class:"font-semibold text-xl text-gray-800 leading-tight"},nt={class:"d-flex gap-2"},lt={class:"py-12"},ot={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},it={class:"card mb-4"},dt={class:"card-body"},ut={class:"row"},ct={class:"col-md-4"},rt=["placeholder"],mt={class:"col-md-4"},vt={value:""},_t={value:"created"},bt={value:"received"},yt={value:"executing"},ht={value:"partial_payment"},ft={value:"full_payment"},pt={value:"completed"},gt={value:"cancelled"},xt={class:"col-md-4"},kt={type:"submit",class:"btn btn-primary w-100"},wt={class:"card"},At={class:"card-body"},St={class:"table-responsive"},jt={class:"table table-striped"},Ct={class:"text-muted"},$t={class:"text-muted"},Vt={class:"text-muted"},Ot={class:"pricing-details"},Mt={class:"d-flex justify-content-between mb-1"},Ut={key:0,class:"d-flex justify-content-between mb-1"},Dt={class:"text-success"},Ft={class:"text-success"},Et={key:1,class:"d-flex justify-content-between mb-1"},It={class:"text-danger"},Lt={class:"text-danger"},Pt={class:"d-flex justify-content-between"},Bt={class:"text-primary"},Nt={class:"d-flex justify-content-between mt-1"},Tt={class:"text-success"},zt={key:0},Gt={key:1,class:"text-muted"},Qt={class:"btn-group",role:"group"},qt=["onClick"],Ht=["onClick"],Jt=["href"],Kt={key:0,class:"d-flex justify-content-center mt-4"},Rt={key:1,class:"text-center py-5"},Wt={class:"text-muted mt-3"},Xt={class:"text-muted"},Yt={key:0,class:"modal-mask"},Zt={class:"modal-wrapper"},ts={class:"modal-container"},ss={class:"modal-header"},es={class:"modal-body"},as={key:0,class:"alert alert-danger mb-3",role:"alert"},ns={class:"mb-0"},ls={class:"row"},os={class:"col-md-6"},is={class:"mb-3"},ds={class:"form-label"},us={value:""},cs={value:"created"},rs={value:"received"},ms={value:"executing"},vs={value:"partial_payment"},_s={value:"full_payment"},bs={value:"completed"},ys={value:"cancelled"},hs={key:0,class:"invalid-feedback"},fs={class:"col-md-6"},ps={class:"mb-3"},gs={class:"form-label"},xs={value:""},ks=["value"],ws={key:0,class:"invalid-feedback"},As={key:0,class:"col-md-6"},Ss={class:"mb-3"},js={class:"form-label"},Cs={key:0,class:"invalid-feedback"},$s={class:"col-md-6"},Vs={class:"mb-3"},Os={class:"form-label"},Ms={key:0,class:"invalid-feedback"},Us={class:"col-12"},Ds={class:"mb-3"},Fs={class:"form-label"},Es={key:0,class:"invalid-feedback"},Is={class:"d-flex justify-content-center gap-2"},Ls=["disabled"],Ps={key:0,class:"spinner-border spinner-border-sm me-2"},Bs={__name:"Orders",props:{orders:Object,filters:Object,translations:Object,employees:Array},setup(n){var E,I;const F=X(),m=n,z=l=>F.props.auth_permissions&&F.props.auth_permissions.includes(l),b=k(!1),A=k(!1),y=k(!1),h=k(null),o=k({}),f=N({search:((E=m.filters)==null?void 0:E.search)||"",status:((I=m.filters)==null?void 0:I.status)||""}),i=N({status:"",assigned_employee_id:"",paid_amount:"",scheduled_date:"",notes:""}),G=()=>{D.get(route("decorations.orders"),f,{preserveState:!0,replace:!0})},Q=l=>{h.value=l,i.status=l.status||"",i.assigned_employee_id=l.assigned_employee_id||"",i.paid_amount=l.paid_amount||"",i.scheduled_date=l.scheduled_date?K(l.scheduled_date):"",i.notes=l.notes||"",o.value={},b.value=!0},q=l=>{h.value=l,A.value=!0},p=l=>l==="dollar"?"دولار":"دينار",H=()=>{y.value=!0,o.value={};const l={};i.status&&i.status!==""&&(l.status=i.status),i.assigned_employee_id&&i.assigned_employee_id!==""&&(l.assigned_employee_id=i.assigned_employee_id),i.paid_amount&&i.paid_amount!==""&&(l.paid_amount=i.paid_amount),i.scheduled_date&&i.scheduled_date!==""&&(l.scheduled_date=i.scheduled_date),i.notes&&i.notes!==""&&(l.notes=i.notes),D.patch(route("decoration.orders.status",h.value.id),l,{onSuccess:()=>{y.value=!1,b.value=!1,o.value={}},onError:e=>{y.value=!1,o.value=e,console.error("Update status errors:",e)}})},J=l=>new Date(l).toLocaleDateString("ar-EG"),K=l=>new Date(l).toISOString().slice(0,16),g=l=>{o.value[l]&&delete o.value[l]},R=l=>({status:m.translations.status||"الحالة",assigned_employee_id:m.translations.assign_employee||"تعيين موظف",paid_amount:m.translations.paid_amount||"المبلغ المدفوع",scheduled_date:m.translations.scheduled_date||"التاريخ المجدول",notes:m.translations.notes||"ملاحظات"})[l]||l;return(l,e)=>(d(),C(Y,null,{header:w(()=>[t("div",et,[t("h2",at,s(n.translations.decoration_orders),1),t("div",nt,[z("read decoration")?(d(),C(S($),{key:0,class:"btn btn-success",href:l.route("decorations.orders.simple")},{default:w(()=>e[16]||(e[16]=[t("i",{class:"bi bi-table"},null,-1),r(" عرض بسيط ")])),_:1},8,["href"])):c("",!0),V(S($),{class:"btn btn-secondary",href:l.route("decorations.index")},{default:w(()=>[e[17]||(e[17]=t("i",{class:"bi bi-arrow-left"},null,-1)),r(" "+s(n.translations.cancel),1)]),_:1},8,["href"])])])]),default:w(()=>{var L,P;return[t("div",lt,[t("div",ot,[t("div",it,[t("div",dt,[t("form",{onSubmit:T(G,["prevent"])},[t("div",ut,[t("div",ct,[v(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=a=>f.search=a),placeholder:n.translations.search},null,8,rt),[[j,f.search]])]),t("div",mt,[v(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=a=>f.status=a)},[t("option",vt,s(n.translations.all_status),1),t("option",_t,s(n.translations.created),1),t("option",bt,s(n.translations.received),1),t("option",yt,s(n.translations.executing),1),t("option",ht,s(n.translations.partial_payment),1),t("option",ft,s(n.translations.full_payment),1),t("option",pt,s(n.translations.completed),1),t("option",gt,s(n.translations.cancelled),1)],512),[[O,f.status]])]),t("div",xt,[t("button",kt,[e[18]||(e[18]=t("i",{class:"bi bi-search"},null,-1)),r(" "+s(n.translations.search),1)])])])],32)])]),t("div",wt,[t("div",At,[t("div",St,[t("table",jt,[t("thead",null,[t("tr",null,[t("th",null,s(n.translations.decoration),1),t("th",null,s(n.translations.customer_name),1),t("th",null,s(n.translations.event_date),1),t("th",null,s(n.translations.pricing),1),t("th",null,s(n.translations.status),1),t("th",null,s(n.translations.assigned_employee),1),t("th",null,s(n.translations.action),1)])]),t("tbody",null,[(d(!0),u(U,null,M(n.orders.data,a=>{var x,B;return d(),u("tr",{key:a.id},[t("td",null,[t("div",null,[t("strong",null,s((x=a.decoration)==null?void 0:x.name),1),e[19]||(e[19]=t("br",null,null,-1)),t("small",Ct,s((B=a.decoration)==null?void 0:B.type_name),1)])]),t("td",null,[t("div",null,[r(s(a.customer_name)+" ",1),e[20]||(e[20]=t("br",null,null,-1)),t("small",$t,s(a.customer_phone),1)])]),t("td",null,[r(s(J(a.event_date))+" ",1),e[21]||(e[21]=t("br",null,null,-1)),t("small",Vt,s(a.event_time),1)]),t("td",null,[t("div",Ot,[t("div",Mt,[t("small",null,s(n.translations.base_price)+":",1),t("small",null,s(a.base_price)+" "+s(p(a.currency)),1)]),a.additional_cost>0?(d(),u("div",Ut,[t("small",Dt,s(n.translations.additional_cost)+":",1),t("small",Ft,"+"+s(a.additional_cost)+" "+s(p(a.currency)),1)])):c("",!0),a.discount>0?(d(),u("div",Et,[t("small",It,s(n.translations.discount)+":",1),t("small",Lt,"-"+s(a.discount)+" "+s(p(a.currency)),1)])):c("",!0),e[22]||(e[22]=t("hr",{class:"my-1"},null,-1)),t("div",Pt,[t("strong",null,s(n.translations.total_price)+":",1),t("strong",Bt,s(a.total_price)+" "+s(p(a.currency)),1)]),t("div",Nt,[t("small",null,s(n.translations.paid_amount)+":",1),t("small",Tt,s(a.paid_amount||0)+" "+s(p(a.currency)),1)])])]),t("td",null,[t("span",{class:_(["badge",`bg-${a.status_color}`])},s(a.status_name),3)]),t("td",null,[a.assigned_employee?(d(),u("span",zt,s(a.assigned_employee.name),1)):(d(),u("span",Gt,s(n.translations.not_assigned),1))]),t("td",null,[t("div",Qt,[V(S($),{href:l.route("decoration.orders.show",a.id),class:"btn btn-outline-primary btn-sm"},{default:w(()=>[e[23]||(e[23]=t("i",{class:"bi bi-eye"},null,-1)),r(" "+s(n.translations.view),1)]),_:2},1032,["href"]),t("button",{onClick:W=>Q(a),class:"btn btn-outline-secondary btn-sm"},[e[24]||(e[24]=t("i",{class:"bi bi-pencil"},null,-1)),r(" "+s(n.translations.update_status),1)],8,qt),t("button",{onClick:W=>q(a),class:"btn btn-outline-warning btn-sm"},[e[25]||(e[25]=t("i",{class:"bi bi-calculator"},null,-1)),r(" "+s(n.translations.edit_pricing),1)],8,Ht),t("a",{href:l.route("decoration.orders.print",a.id),target:"_blank",class:"btn btn-outline-info btn-sm"},[e[26]||(e[26]=t("i",{class:"bi bi-printer"},null,-1)),r(" "+s(n.translations.print_invoice),1)],8,Jt)])])])}),128))])])]),n.orders.data.length>0?(d(),u("div",Kt,[V(Z,{links:n.orders.links},null,8,["links"])])):(d(),u("div",Rt,[e[27]||(e[27]=t("i",{class:"bi bi-calendar-x text-muted",style:{"font-size":"4rem"}},null,-1)),t("h4",Wt,s(n.translations.no_orders),1),t("p",Xt,s(n.translations.no_orders_description),1)]))])])])]),b.value?(d(),u("div",Yt,[t("div",Zt,[t("div",ts,[t("div",ss,[t("h3",null,s(n.translations.update_status)+" - "+s((P=(L=h.value)==null?void 0:L.decoration)==null?void 0:P.name),1),t("button",{onClick:e[2]||(e[2]=a=>b.value=!1),class:"btn-close"})]),t("div",es,[Object.keys(o.value).length>0?(d(),u("div",as,[e[28]||(e[28]=t("h6",{class:"alert-heading"},[t("i",{class:"bi bi-exclamation-triangle"}),r(" يرجى تصحيح الأخطاء التالية: ")],-1)),t("ul",ns,[(d(!0),u(U,null,M(o.value,(a,x)=>(d(),u("li",{key:x},[t("strong",null,s(R(x))+":",1),r(" "+s(Array.isArray(a)?a[0]:a),1)]))),128))])])):c("",!0),t("form",{onSubmit:T(H,["prevent"])},[t("div",ls,[t("div",os,[t("div",is,[t("label",ds,s(n.translations.status),1),v(t("select",{class:_(["form-select",{"is-invalid":o.value.status}]),"onUpdate:modelValue":e[3]||(e[3]=a=>i.status=a),onChange:e[4]||(e[4]=a=>g("status"))},[t("option",us,s(n.translations.select_type),1),t("option",cs,s(n.translations.created),1),t("option",rs,s(n.translations.received),1),t("option",ms,s(n.translations.executing),1),t("option",vs,s(n.translations.partial_payment),1),t("option",_s,s(n.translations.full_payment),1),t("option",bs,s(n.translations.completed),1),t("option",ys,s(n.translations.cancelled),1)],34),[[O,i.status]]),o.value.status?(d(),u("div",hs,s(Array.isArray(o.value.status)?o.value.status[0]:o.value.status),1)):c("",!0),e[29]||(e[29]=t("small",{class:"text-muted"},"اترك فارغاً للاحتفاظ بالحالة الحالية",-1))])]),t("div",fs,[t("div",ps,[t("label",gs,s(n.translations.assign_employee),1),v(t("select",{class:_(["form-select",{"is-invalid":o.value.assigned_employee_id}]),"onUpdate:modelValue":e[5]||(e[5]=a=>i.assigned_employee_id=a),onChange:e[6]||(e[6]=a=>g("assigned_employee_id"))},[t("option",xs,s(n.translations.select_employee),1),(d(!0),u(U,null,M(n.employees,a=>(d(),u("option",{key:a.id,value:a.id},s(a.name),9,ks))),128))],34),[[O,i.assigned_employee_id]]),o.value.assigned_employee_id?(d(),u("div",ws,s(Array.isArray(o.value.assigned_employee_id)?o.value.assigned_employee_id[0]:o.value.assigned_employee_id),1)):c("",!0)])]),i.status==="partial_payment"||i.status==="full_payment"?(d(),u("div",As,[t("div",Ss,[t("label",js,s(n.translations.paid_amount),1),v(t("input",{type:"number",step:"0.01",class:_(["form-control",{"is-invalid":o.value.paid_amount}]),"onUpdate:modelValue":e[7]||(e[7]=a=>i.paid_amount=a),onInput:e[8]||(e[8]=a=>g("paid_amount"))},null,34),[[j,i.paid_amount]]),o.value.paid_amount?(d(),u("div",Cs,s(Array.isArray(o.value.paid_amount)?o.value.paid_amount[0]:o.value.paid_amount),1)):c("",!0)])])):c("",!0),t("div",$s,[t("div",Vs,[t("label",Os,s(n.translations.scheduled_date),1),v(t("input",{type:"datetime-local",class:_(["form-control",{"is-invalid":o.value.scheduled_date}]),"onUpdate:modelValue":e[9]||(e[9]=a=>i.scheduled_date=a),onInput:e[10]||(e[10]=a=>g("scheduled_date"))},null,34),[[j,i.scheduled_date]]),o.value.scheduled_date?(d(),u("div",Ms,s(Array.isArray(o.value.scheduled_date)?o.value.scheduled_date[0]:o.value.scheduled_date),1)):c("",!0)])]),t("div",Us,[t("div",Ds,[t("label",Fs,s(n.translations.notes),1),v(t("textarea",{class:_(["form-control",{"is-invalid":o.value.notes}]),"onUpdate:modelValue":e[11]||(e[11]=a=>i.notes=a),rows:"3",onInput:e[12]||(e[12]=a=>g("notes"))},null,34),[[j,i.notes]]),o.value.notes?(d(),u("div",Es,s(Array.isArray(o.value.notes)?o.value.notes[0]:o.value.notes),1)):c("",!0)])])]),t("div",Is,[t("button",{type:"button",class:"btn btn-secondary text-center w-100",onClick:e[13]||(e[13]=a=>b.value=!1)},s(n.translations.cancel),1),t("button",{type:"submit",class:"btn btn-primary w-100 text-center",disabled:y.value},[y.value?(d(),u("span",Ps)):c("",!0),r(" "+s(n.translations.update),1)],8,Ls)])],32)])])])])):c("",!0),A.value?(d(),C(tt,{key:1,order:h.value,translations:n.translations,onClose:e[14]||(e[14]=a=>A.value=!1),onSuccess:e[15]||(e[15]=a=>{A.value=!1,S(D).reload()})},null,8,["order","translations"])):c("",!0)]}),_:1}))}},qs=st(Bs,[["__scopeId","data-v-6169749a"]]);export{qs as default};
