import{r as x,s as z,k as M,T as H,B as G,C as J,a as p,h as K,w as N,b as s,t as l,i as v,d as b,n as d,j as P,l as m,H as I,u as i,x as _,c as g,e as y}from"./app-ApMe2Fdo.js";import{_ as W}from"./AuthenticatedLayout-BXN7cNNC.js";import{_ as f}from"./InputError-QLdLswun.js";import{l as X}from"./lodash-JRBrMW6L.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"pagetitle dark:text-white"},ss={class:"dark:text-white"},ts={class:"breadcrumb"},es={class:"breadcrumb-item"},os={class:"breadcrumb-item"},ls={class:"breadcrumb-item active dark:text-white"},is={class:"section dashboard"},as={class:"row"},ns={class:"col-lg-12"},rs={class:"card"},cs={class:"card-header"},ds={class:"card-title mb-0"},us={class:"text-muted mb-0"},ms={class:"card-body"},ps={class:"row mb-4"},vs={class:"col-12"},bs={class:"progress-steps"},gs={class:"step-label"},hs={class:"step-label"},_s={class:"step-label"},fs={class:"step-label"},xs={class:"form-section"},ys={class:"section-title"},ks={class:"row mb-3"},ws={for:"inputName",class:"col-sm-2 col-form-label required"},Vs={class:"col-sm-10"},qs={class:"input-group"},Cs=["placeholder"],Is={class:"form-text"},Bs={class:"row mb-3"},Us={for:"inputBarcode",class:"col-sm-2 col-form-label"},Ss={class:"col-sm-10"},Ns={class:"input-group"},Fs=["placeholder"],js=["disabled","title"],Es={key:0,class:"input-group-text"},Ms={key:1,class:"input-group-text text-danger"},Ps={key:2,class:"input-group-text text-success"},$s={class:"form-text"},Os={class:"row mb-3"},Rs={for:"inputModel",class:"col-sm-2 col-form-label"},Ds={class:"col-sm-10"},Ts={class:"input-group"},Ls=["placeholder"],As={class:"form-text"},Qs={class:"row mb-3"},zs={for:"inputOENumber",class:"col-sm-2 col-form-label"},Hs={class:"col-sm-10"},Gs={class:"input-group"},Js=["placeholder"],Ks={class:"form-text"},Ws={class:"form-section"},Xs={class:"section-title"},Ys={class:"row mb-3"},Zs={for:"inputPriceCost",class:"col-sm-2 col-form-label"},st={class:"col-sm-10"},tt={class:"input-group"},et=["placeholder"],ot={class:"input-group-text"},lt={class:"form-text"},it={class:"row mb-3"},at={for:"inputPrice",class:"col-sm-2 col-form-label required"},nt={class:"col-sm-10"},rt={class:"input-group"},ct=["placeholder"],dt={class:"input-group-text"},ut={class:"form-text"},mt={key:0,class:"row mb-3"},pt={class:"col-sm-10"},vt={class:"alert alert-info"},bt={class:"form-section"},gt={class:"section-title"},ht={class:"row mb-3"},_t={for:"inputQuantity",class:"col-sm-2 col-form-label required"},ft={class:"col-sm-10"},xt={class:"input-group"},yt=["placeholder"],kt={class:"input-group-text"},wt={class:"form-text"},Vt={class:"form-section"},qt={class:"section-title"},Ct={class:"row mb-3"},It={for:"inputNote",class:"col-sm-2 col-form-label"},Bt={class:"col-sm-10"},Ut={class:"input-group"},St=["placeholder"],Nt={class:"form-text"},Ft={class:"row mb-3"},jt={for:"inputdate",class:"col-sm-2 col-form-label"},Et={class:"col-sm-10"},Mt={class:"input-group"},Pt={class:"form-text"},$t={class:"row mb-3"},Ot={for:"inputImage",class:"col-sm-2 col-form-label"},Rt={class:"col-sm-10"},Dt={key:0,class:"upload-placeholder"},Tt={class:"text-muted"},Lt={key:1,class:"image-preview"},At=["src","alt"],Qt=["value"],zt={class:"form-text"},Ht={class:"row mt-4"},Gt={class:"col-12"},Jt={class:"d-flex justify-content-between"},Kt=["disabled"],Wt=["disabled"],Xt={key:0,class:"bi bi-check-circle me-2"},Yt={key:1,class:"spinner-border spinner-border-sm me-2"},Zt={__name:"Edit",props:{product:Object,productRoles:Array,roles:Object,translations:Object},setup(o){const k=x(!1),w=z(),a=x(1),V=x(null),C=x(null),r=x({checking:!1,isValid:!0,message:""}),q=x(null),B=x(null),c=o,U=M(()=>{var u;return(u=c.product)!=null&&u.image&&c.product.image.trim()!==""?`/public/storage/${c.product.image}`:"/public/dashboard-assets/img/product-placeholder.svg"}),e=H({name:c.product.name,model:c.product.model,notes:c.product.notes,oe_number:c.product.oe_number,price_cost:c.product.price_cost,quantity:c.product.quantity,price:c.product.price,created:c.product.created,barcode:c.product.barcode,selectedRoles:c.productRoles,image:null}),F=M(()=>e.name&&e.price&&e.quantity),$=()=>{a.value<4&&a.value++},O=()=>{a.value>1&&a.value--},j=()=>{a.value===1&&e.name&&(a.value=2)},R=()=>{const u=Date.now().toString(),t=Math.floor(Math.random()*1e3).toString().padStart(3,"0");e.barcode=`BC${u.slice(-6)}${t}`,E(e.barcode),w.success("تم توليد باركود جديد")},S=()=>{e.price_cost&&e.price?(q.value=parseFloat(e.price)-parseFloat(e.price_cost),B.value=q.value/parseFloat(e.price_cost)*100):(q.value=null,B.value=null)},D=()=>{C.value.click()},T=u=>{const t=u.target.files[0];if(t){e.image=t;const h=new FileReader;h.onload=n=>{V.value=n.target.result},h.readAsDataURL(t)}},L=()=>{e.image=null,V.value=null,C.value&&(C.value.value="")},A=async u=>{if(!u||u.length<3){r.value={checking:!1,isValid:!0,message:""};return}if(u===c.product.barcode){r.value={checking:!1,isValid:!0,message:""};return}r.value.checking=!0;try{const h=await(await fetch(route("products.checkBarcodeUnique",u))).json();r.value={checking:!1,isValid:h.unique,message:h.message},h.unique||w.warning(h.message)}catch(t){console.error("Barcode validation error:",t),r.value={checking:!1,isValid:!1,message:"خطأ في التحقق من الباركود"}}},E=X.debounce(A,500),Q=()=>{if(e.barcode&&!r.value.isValid){w.error("يجب إدخال باركود صحيح ومتاح");return}if(!F.value){w.error("يرجى ملء جميع الحقول المطلوبة");return}k.value=!0,e.post(route("products.update",{product:c.product.id}),{onSuccess:()=>{k.value=!1,w.success("تم تحديث المنتج بنجاح")},onError:()=>{k.value=!1,w.error("حدث خطأ أثناء تحديث المنتج")}})};return G([()=>e.name,()=>e.price,()=>e.quantity],()=>{j()}),S(),(u,t)=>{const h=J("Link");return p(),K(W,{translations:o.translations},{default:N(()=>[s("div",Z,[s("h1",ss,l(o.translations.products),1),s("nav",null,[s("ol",ts,[s("li",es,[v(h,{class:"nav-link dark:text-white",href:u.route("dashboard")},{default:N(()=>[b(l(o.translations.home),1)]),_:1},8,["href"])]),s("li",os,[v(h,{class:"nav-link dark:text-white",href:u.route("products.index")},{default:N(()=>[b(l(o.translations.products),1)]),_:1},8,["href"])]),s("li",ls,l(o.translations.edit),1)])])]),s("section",is,[s("div",as,[s("div",ns,[s("div",rs,[s("div",cs,[s("h5",ds,[t[10]||(t[10]=s("i",{class:"bi bi-pencil-square me-2"},null,-1)),b(" "+l(o.translations.edit_product),1)]),s("p",us,l(o.translations.edit_product_description),1)]),s("div",ms,[s("div",ps,[s("div",vs,[s("div",bs,[s("div",{class:d(["step",{active:a.value>=1,completed:a.value>1}])},[t[11]||(t[11]=s("div",{class:"step-number"},"1",-1)),s("div",gs,l(o.translations.basic_info),1)],2),s("div",{class:d(["step",{active:a.value>=2,completed:a.value>2}])},[t[12]||(t[12]=s("div",{class:"step-number"},"2",-1)),s("div",hs,l(o.translations.pricing),1)],2),s("div",{class:d(["step",{active:a.value>=3,completed:a.value>3}])},[t[13]||(t[13]=s("div",{class:"step-number"},"3",-1)),s("div",_s,l(o.translations.inventory),1)],2),s("div",{class:d(["step",{active:a.value>=4,completed:a.value>4}])},[t[14]||(t[14]=s("div",{class:"step-number"},"4",-1)),s("div",fs,l(o.translations.additional),1)],2)])])]),s("form",{onSubmit:P(Q,["prevent"]),class:"needs-validation",novalidate:""},[m(s("div",xs,[s("h6",ys,[t[15]||(t[15]=s("i",{class:"bi bi-info-circle me-2"},null,-1)),b(" "+l(o.translations.basic_info),1)]),s("div",ks,[s("label",ws,l(o.translations.name),1),s("div",Vs,[s("div",qs,[t[16]||(t[16]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-box-seam"})],-1)),m(s("input",{id:"inputName",type:"text",class:d(["form-control",{"is-invalid":i(e).errors.name}]),placeholder:o.translations.enter_product_name,"onUpdate:modelValue":t[0]||(t[0]=n=>i(e).name=n),required:"",onInput:j},null,42,Cs),[[_,i(e).name]])]),s("div",Is,l(o.translations.product_name_help),1),v(f,{message:i(e).errors.name},null,8,["message"])])]),s("div",Bs,[s("label",Us,l(o.translations.barcode),1),s("div",Ss,[s("div",Ns,[t[21]||(t[21]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-upc-scan"})],-1)),m(s("input",{id:"inputBarcode",type:"text",class:d(["form-control",{"is-invalid":r.value.checking===!1&&!r.value.isValid,"is-valid":i(e).barcode&&r.value.isValid}]),placeholder:o.translations.enter_barcode_or_auto_generate,"onUpdate:modelValue":t[1]||(t[1]=n=>i(e).barcode=n),onInput:t[2]||(t[2]=n=>i(E)(i(e).barcode))},null,42,Fs),[[_,i(e).barcode]]),s("button",{class:"btn btn-outline-secondary",type:"button",onClick:R,disabled:r.value.checking,title:o.translations.auto_generate_barcode},t[17]||(t[17]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,js),r.value.checking?(p(),g("div",Es,t[18]||(t[18]=[s("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1)]))):r.value.isValid?i(e).barcode&&r.value.isValid?(p(),g("div",Ps,t[20]||(t[20]=[s("i",{class:"bi bi-check-circle"},null,-1)]))):y("",!0):(p(),g("div",Ms,t[19]||(t[19]=[s("i",{class:"bi bi-exclamation-triangle"},null,-1)])))]),r.value.message?(p(),g("div",{key:0,class:d(["form-text",r.value.isValid?"text-success":"text-danger"])},l(r.value.message),3)):y("",!0),s("div",$s,l(o.translations.barcode_help),1),v(f,{message:i(e).errors.barcode},null,8,["message"])])]),s("div",Os,[s("label",Rs,l(o.translations.model)+" ("+l(o.translations.optional)+")",1),s("div",Ds,[s("div",Ts,[t[22]||(t[22]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-tag"})],-1)),m(s("input",{id:"inputModel",type:"text",class:d(["form-control",{"is-invalid":i(e).errors.model}]),placeholder:o.translations.enter_model_number,"onUpdate:modelValue":t[3]||(t[3]=n=>i(e).model=n)},null,10,Ls),[[_,i(e).model]])]),s("div",As,l(o.translations.model_help),1),v(f,{message:i(e).errors.model},null,8,["message"])])]),s("div",Qs,[s("label",zs,l(o.translations.oe_number),1),s("div",Hs,[s("div",Gs,[t[23]||(t[23]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-hash"})],-1)),m(s("input",{id:"inputOENumber",type:"text",class:d(["form-control",{"is-invalid":i(e).errors.oe_number}]),placeholder:o.translations.enter_oe_number,"onUpdate:modelValue":t[4]||(t[4]=n=>i(e).oe_number=n)},null,10,Js),[[_,i(e).oe_number]])]),s("div",Ks,l(o.translations.oe_number_help),1),v(f,{message:i(e).errors.oe_number},null,8,["message"])])])],512),[[I,a.value>=1]]),m(s("div",Ws,[s("h6",Xs,[t[24]||(t[24]=s("i",{class:"bi bi-currency-dollar me-2"},null,-1)),b(" "+l(o.translations.pricing),1)]),s("div",Ys,[s("label",Zs,l(o.translations.price_cost),1),s("div",st,[s("div",tt,[t[25]||(t[25]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cart-plus"})],-1)),m(s("input",{id:"inputPriceCost",type:"number",step:"0.01",min:"0",class:d(["form-control",{"is-invalid":i(e).errors.price_cost}]),placeholder:o.translations.enter_cost_price,"onUpdate:modelValue":t[5]||(t[5]=n=>i(e).price_cost=n),onInput:S},null,42,et),[[_,i(e).price_cost]]),s("span",ot,l(o.translations.dinar),1)]),s("div",lt,l(o.translations.cost_price_help),1),v(f,{message:i(e).errors.price_cost},null,8,["message"])])]),s("div",it,[s("label",at,l(o.translations.price),1),s("div",nt,[s("div",rt,[t[26]||(t[26]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cash-stack"})],-1)),m(s("input",{id:"inputPrice",type:"number",step:"0.01",min:"0",class:d(["form-control",{"is-invalid":i(e).errors.price}]),placeholder:o.translations.enter_selling_price,"onUpdate:modelValue":t[6]||(t[6]=n=>i(e).price=n),required:"",onInput:S},null,42,ct),[[_,i(e).price]]),s("span",dt,l(o.translations.dinar),1)]),s("div",ut,l(o.translations.selling_price_help),1),v(f,{message:i(e).errors.price},null,8,["message"])])]),q.value!==null?(p(),g("div",mt,[t[28]||(t[28]=s("div",{class:"col-sm-2"},null,-1)),s("div",pt,[s("div",vt,[t[27]||(t[27]=s("i",{class:"bi bi-graph-up me-2"},null,-1)),s("strong",null,l(o.translations.profit_margin)+":",1),b(" "+l(q.value.toFixed(2))+" "+l(o.translations.dinar)+" ("+l(B.value.toFixed(1))+"%) ",1)])])])):y("",!0)],512),[[I,a.value>=2]]),m(s("div",bt,[s("h6",gt,[t[29]||(t[29]=s("i",{class:"bi bi-boxes me-2"},null,-1)),b(" "+l(o.translations.inventory),1)]),s("div",ht,[s("label",_t,l(o.translations.quantity),1),s("div",ft,[s("div",xt,[t[30]||(t[30]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-123"})],-1)),m(s("input",{id:"inputQuantity",type:"number",min:"0",class:d(["form-control",{"is-invalid":i(e).errors.quantity}]),placeholder:o.translations.enter_initial_quantity,"onUpdate:modelValue":t[7]||(t[7]=n=>i(e).quantity=n),required:""},null,10,yt),[[_,i(e).quantity]]),s("span",kt,l(o.translations.units),1)]),s("div",wt,l(o.translations.quantity_help),1),v(f,{message:i(e).errors.quantity},null,8,["message"])])])],512),[[I,a.value>=3]]),m(s("div",Vt,[s("h6",qt,[t[31]||(t[31]=s("i",{class:"bi bi-info-square me-2"},null,-1)),b(" "+l(o.translations.additional),1)]),s("div",Ct,[s("label",It,l(o.translations.note),1),s("div",Bt,[s("div",Ut,[t[32]||(t[32]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-journal-text"})],-1)),m(s("textarea",{id:"inputNote",class:d(["form-control",{"is-invalid":i(e).errors.notes}]),placeholder:o.translations.enter_notes_optional,"onUpdate:modelValue":t[8]||(t[8]=n=>i(e).notes=n),rows:"3"},null,10,St),[[_,i(e).notes]])]),s("div",Nt,l(o.translations.notes_help),1),v(f,{message:i(e).errors.notes},null,8,["message"])])]),s("div",Ft,[s("label",jt,l(o.translations.date),1),s("div",Et,[s("div",Mt,[t[33]||(t[33]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-calendar"})],-1)),m(s("input",{id:"inputdate",type:"date",class:d(["form-control",{"is-invalid":i(e).errors.created}]),"onUpdate:modelValue":t[9]||(t[9]=n=>i(e).created=n)},null,2),[[_,i(e).created]])]),s("div",Pt,l(o.translations.date_help),1),v(f,{message:i(e).errors.created},null,8,["message"])])]),s("div",$t,[s("label",Ot,l(o.translations.image),1),s("div",Rt,[s("div",{class:d(["image-upload-area",{"has-image":V.value||U.value}]),onClick:D},[s("input",{ref_key:"fileInput",ref:C,id:"inputImage",type:"file",accept:"image/*",onInput:T,style:{display:"none"}},null,544),!V.value&&!U.value?(p(),g("div",Dt,[t[34]||(t[34]=s("i",{class:"bi bi-cloud-upload"},null,-1)),s("p",null,l(o.translations.click_to_upload_image),1),s("small",Tt,l(o.translations.supported_formats),1)])):(p(),g("div",Lt,[s("img",{src:V.value||U.value,alt:o.translations.product_image},null,8,At),s("button",{type:"button",class:"btn btn-sm btn-danger remove-image",onClick:P(L,["stop"])},t[35]||(t[35]=[s("i",{class:"bi bi-x"},null,-1)]))]))],2),i(e).progress?(p(),g("progress",{key:0,value:i(e).progress.percentage,max:"100",class:"w-100 mt-2"},l(i(e).progress.percentage)+"% ",9,Qt)):y("",!0),s("div",zt,l(o.translations.image_help),1)])])],512),[[I,a.value>=4]]),s("div",Ht,[s("div",Gt,[s("div",Jt,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:O,disabled:a.value===1},[t[36]||(t[36]=s("i",{class:"bi bi-arrow-left me-2"},null,-1)),b(" "+l(o.translations.previous),1)],8,Kt),s("div",null,[a.value<4?(p(),g("button",{key:0,type:"button",class:"btn btn-primary me-2",onClick:$},[b(l(o.translations.next)+" ",1),t[37]||(t[37]=s("i",{class:"bi bi-arrow-right ms-2"},null,-1))])):y("",!0),s("button",{type:"submit",class:"btn btn-success",disabled:k.value||!F.value},[k.value?y("",!0):(p(),g("i",Xt)),k.value?(p(),g("span",Yt)):y("",!0),b(" "+l(o.translations.update),1)],8,Wt)])])])])],32)])])])])])]),_:1},8,["translations"])}}},ie=Y(Zt,[["__scopeId","data-v-fcb73e7c"]]);export{ie as default};
