import{r as h,k as E,o as L,C as D,a,c as B,w as S,b as t,i as Y,d as _,n as f,e as i,t as o,f as c,F as w,g as M,l as C,A,y as P,h as x}from"./app-Dyo3CGUB.js";import{_ as U}from"./AuthenticatedLayout-DQQOHWHW.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"pagetitle dark:text-white"},K={class:"breadcrumb"},X={class:"breadcrumb-item"},z={class:"section"},I={class:"row"},J={class:"col-lg-12"},G={class:"card"},Q={class:"card-body"},W={class:"nav nav-tabs",id:"monthlyTabs",role:"tablist"},Z={class:"nav-item",role:"presentation"},tt={class:"nav-item",role:"presentation"},st={class:"nav-item",role:"presentation"},et={class:"tab-content mt-4"},ot={key:0,class:"tab-pane fade show active"},lt={class:"row"},nt={class:"col-md-8"},at={class:"card"},it={class:"card-header"},dt={class:"card-title mb-0"},rt={class:"card-body"},ct={class:"row"},ut={class:"col-md-6"},vt={class:"info-item"},bt={class:"value"},mt={class:"info-item"},_t={class:"value"},ht={class:"info-item"},yt={class:"value"},ft={class:"col-md-6"},pt={class:"info-item"},kt={class:"value"},gt={class:"info-item"},wt={class:"value"},Mt={class:"info-item"},Ct={class:"value text-success"},xt={class:"mt-4"},Tt={class:"row"},$t={class:"col-md-6"},jt={class:"info-item"},Nt={class:"value"},St={class:"col-md-6"},At={class:"info-item"},Ft={class:"value"},Ot={key:0,class:"mt-3"},Rt={class:"text-muted"},Vt={class:"col-md-4"},Et={class:"card"},Lt={class:"card-body"},Dt={key:0,class:"d-grid gap-2"},Bt={key:1,class:"alert alert-info"},Yt={key:1,class:"tab-pane fade show active"},Pt={class:"card"},Ut={class:"card-body"},qt={class:"table-responsive"},Ht={class:"table table-striped"},Kt={class:"btn-group",role:"group"},Xt=["onClick"],zt=["onClick"],It={class:"d-flex justify-content-center mt-3"},Jt={class:"pagination"},Gt=["onClick","innerHTML","disabled"],Qt={key:2,class:"tab-pane fade show active"},Wt={class:"card"},Zt={class:"card-body"},ts={class:"row mb-3"},ss={class:"col-md-4"},es=["value"],os={class:"col-md-4"},ls=["value"],ns={class:"col-md-4"},as=["disabled"],is={key:0,class:"mt-4"},ds={class:"card"},rs={class:"card-header"},cs={class:"card-title mb-0"},us={class:"card-body"},vs={class:"row"},bs={class:"col-md-6"},ms={class:"info-item"},_s={class:"value"},hs={class:"info-item"},ys={class:"value"},fs={class:"info-item"},ps={class:"value"},ks={class:"col-md-6"},gs={class:"info-item"},ws={class:"value"},Ms={class:"info-item"},Cs={class:"value"},xs={class:"info-item"},Ts={class:"value text-success"},$s={key:0,class:"modal fade show d-block",tabindex:"-1"},js={class:"modal-dialog"},Ns={class:"modal-content"},Ss={class:"modal-header"},As={class:"modal-body"},Fs={class:"mb-3"},Os={class:"modal-footer"},Rs=["disabled"],Vs={key:0,class:"spinner-border spinner-border-sm me-2"},Es={key:1,class:"modal-backdrop fade show"},Ls={__name:"MonthlyAccounting",props:{translations:Object,activeTab:String,currentMonth:Object,monthlyAccounts:Object,monthlyReport:Object},setup(n){const T=n,r=h(T.activeTab||"current"),y=h(!1),k=h(""),g=h(!1),u=h(""),v=h(""),b=h(T.monthlyReport),F=E(()=>{const l=new Date().getFullYear();return Array.from({length:5},(s,m)=>l-m)}),$=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],d=(l,s="dollar")=>{if(!l)return"0.00";const m=s==="dollar"?"$":"د.ع";return`${parseFloat(l).toFixed(2)} ${m}`},O=async()=>{g.value=!0;try{const s=await(await fetch(route("decoration.monthly.close"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({notes:k.value})})).json();s.success?(y.value=!1,k.value="",x.reload()):alert(s.message||"حدث خطأ أثناء إغلاق الشهر")}catch(l){console.error("Error closing month:",l),alert("حدث خطأ أثناء إغلاق الشهر")}finally{g.value=!1}},j=async l=>{try{const m=await(await fetch(route("decoration.monthly.recalculate",l),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();m.success?(alert("تم إعادة حساب البيانات بنجاح"),x.reload()):alert(m.message||"حدث خطأ أثناء إعادة حساب البيانات")}catch(s){console.error("Error recalculating data:",s),alert("حدث خطأ أثناء إعادة حساب البيانات")}},R=(l,s)=>{u.value=l,v.value=s,r.value="reports",N()},N=async()=>{if(!(!u.value||!v.value))try{const s=await(await fetch(route("decoration.monthly.report",{year:u.value,month:v.value}))).json();s.success?b.value=s.data:alert(s.message||"لا توجد بيانات لهذا الشهر")}catch(l){console.error("Error loading monthly report:",l),alert("حدث خطأ أثناء تحميل التقرير")}},V=l=>{l&&x.visit(l)};return L(()=>{const l=new Date;u.value=l.getFullYear(),v.value=l.getMonth()+1}),(l,s)=>{const m=D("Link");return a(),B(U,{translations:n.translations},{default:S(()=>[t("div",H,[s[12]||(s[12]=t("h1",{class:"dark:text-white"},"المحاسبة الشهرية للديكورات",-1)),t("nav",null,[t("ol",K,[t("li",X,[Y(m,{class:"nav-link dark:text-white",href:l.route("decorations.dashboard")},{default:S(()=>s[10]||(s[10]=[_(" الديكورات ")])),_:1},8,["href"])]),s[11]||(s[11]=t("li",{class:"breadcrumb-item active"},"المحاسبة الشهرية",-1))])])]),t("section",z,[t("div",I,[t("div",J,[t("div",G,[t("div",Q,[t("ul",W,[t("li",Z,[t("button",{class:f(["nav-link",{active:r.value==="current"}]),onClick:s[0]||(s[0]=e=>r.value="current"),type:"button"}," الشهر الحالي ",2)]),t("li",tt,[t("button",{class:f(["nav-link",{active:r.value==="history"}]),onClick:s[1]||(s[1]=e=>r.value="history"),type:"button"}," السجل الشهري ",2)]),t("li",st,[t("button",{class:f(["nav-link",{active:r.value==="reports"}]),onClick:s[2]||(s[2]=e=>r.value="reports"),type:"button"}," التقارير ",2)])]),t("div",et,[r.value==="current"?(a(),i("div",ot,[t("div",lt,[t("div",nt,[t("div",at,[t("div",it,[t("h5",dt,[_(" الشهر الحالي: "+o(n.currentMonth.month_name)+" "+o(n.currentMonth.year)+" ",1),t("span",{class:f(["badge","bg-"+(n.currentMonth.status==="open"?"success":"secondary")])},o(n.currentMonth.status_name),3)])]),t("div",rt,[t("div",ct,[t("div",ut,[t("div",vt,[s[13]||(s[13]=t("label",null,"عدد الطلبات:",-1)),t("span",bt,o(n.currentMonth.total_orders),1)]),t("div",mt,[s[14]||(s[14]=t("label",null,"إجمالي مبلغ الطلبات:",-1)),t("span",_t,o(d(n.currentMonth.total_orders_amount)),1)]),t("div",ht,[s[15]||(s[15]=t("label",null,"إجمالي المدفوعات المستلمة:",-1)),t("span",yt,o(d(n.currentMonth.total_payments_received)),1)])]),t("div",ft,[t("div",pt,[s[16]||(s[16]=t("label",null,"الرصيد بالدولار:",-1)),t("span",kt,o(d(n.currentMonth.total_balance_dollar,"dollar")),1)]),t("div",gt,[s[17]||(s[17]=t("label",null,"الرصيد بالدينار:",-1)),t("span",wt,o(d(n.currentMonth.total_balance_dinar,"dinar")),1)]),t("div",Mt,[s[18]||(s[18]=t("label",null,"صافي الربح:",-1)),t("span",Ct,o(d(n.currentMonth.net_profit_dollar)),1)])])]),t("div",xt,[s[21]||(s[21]=t("h6",null,"الرصيد الافتتاحي:",-1)),t("div",Tt,[t("div",$t,[t("div",jt,[s[19]||(s[19]=t("label",null,"الدولار:",-1)),t("span",Nt,o(d(n.currentMonth.opening_balance_dollar,"dollar")),1)])]),t("div",St,[t("div",At,[s[20]||(s[20]=t("label",null,"الدينار:",-1)),t("span",Ft,o(d(n.currentMonth.opening_balance_dinar,"dinar")),1)])])])]),n.currentMonth.notes?(a(),i("div",Ot,[s[22]||(s[22]=t("h6",null,"ملاحظات:",-1)),t("p",Rt,o(n.currentMonth.notes),1)])):c("",!0)])])]),t("div",Vt,[t("div",Et,[s[26]||(s[26]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"إجراءات الشهر")],-1)),t("div",Lt,[n.currentMonth.status==="open"?(a(),i("div",Dt,[t("button",{class:"btn btn-warning",onClick:s[3]||(s[3]=e=>y.value=!0)},s[23]||(s[23]=[t("i",{class:"bi bi-lock"},null,-1),_(" إغلاق الشهر ")])),t("button",{class:"btn btn-info",onClick:s[4]||(s[4]=e=>j(n.currentMonth.id))},s[24]||(s[24]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),_(" إعادة حساب البيانات ")]))])):(a(),i("div",Bt,s[25]||(s[25]=[t("i",{class:"bi bi-info-circle"},null,-1),_(" الشهر مغلق - لا يمكن إجراء تعديلات ")])))])])])])])):c("",!0),r.value==="history"?(a(),i("div",Yt,[t("div",Pt,[s[30]||(s[30]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"السجل الشهري")],-1)),t("div",Ut,[t("div",qt,[t("table",Ht,[s[29]||(s[29]=t("thead",null,[t("tr",null,[t("th",null,"الشهر"),t("th",null,"السنة"),t("th",null,"الحالة"),t("th",null,"عدد الطلبات"),t("th",null,"إجمالي المبلغ"),t("th",null,"المدفوعات"),t("th",null,"صافي الربح"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(a(!0),i(w,null,M(n.monthlyAccounts.data,e=>(a(),i("tr",{key:e.id},[t("td",null,o(e.month_name),1),t("td",null,o(e.year),1),t("td",null,[t("span",{class:f(["badge","bg-"+(e.status==="open"?"success":"secondary")])},o(e.status_name),3)]),t("td",null,o(e.total_orders),1),t("td",null,o(d(e.total_orders_amount)),1),t("td",null,o(d(e.total_payments_received)),1),t("td",null,o(d(e.net_profit_dollar)),1),t("td",null,[t("div",Kt,[t("button",{class:"btn btn-sm btn-outline-info",onClick:p=>R(e.year,e.month)},s[27]||(s[27]=[t("i",{class:"bi bi-eye"},null,-1)]),8,Xt),e.status==="open"?(a(),i("button",{key:0,class:"btn btn-sm btn-outline-warning",onClick:p=>j(e.id)},s[28]||(s[28]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,zt)):c("",!0)])])]))),128))])])]),t("div",It,[t("nav",null,[t("ul",Jt,[(a(!0),i(w,null,M(n.monthlyAccounts.links,e=>(a(),i("li",{key:e.label,class:f(["page-item",{active:e.active,disabled:!e.url}])},[t("button",{class:"page-link",onClick:p=>V(e.url),innerHTML:e.label,disabled:!e.url},null,8,Gt)],2))),128))])])])])])])):c("",!0),r.value==="reports"?(a(),i("div",Qt,[t("div",Wt,[s[42]||(s[42]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"تقارير شهرية")],-1)),t("div",Zt,[t("div",ts,[t("div",ss,[C(t("select",{"onUpdate:modelValue":s[5]||(s[5]=e=>u.value=e),class:"form-select"},[s[31]||(s[31]=t("option",{value:""},"اختر السنة",-1)),(a(!0),i(w,null,M(F.value,e=>(a(),i("option",{key:e,value:e},o(e),9,es))),128))],512),[[A,u.value]])]),t("div",os,[C(t("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>v.value=e),class:"form-select"},[s[32]||(s[32]=t("option",{value:""},"اختر الشهر",-1)),(a(),i(w,null,M($,(e,p)=>t("option",{key:p,value:p+1},o(e),9,ls)),64))],512),[[A,v.value]])]),t("div",ns,[t("button",{class:"btn btn-primary",onClick:N,disabled:!u.value||!v.value},s[33]||(s[33]=[t("i",{class:"bi bi-search"},null,-1),_(" عرض التقرير ")]),8,as)])]),b.value?(a(),i("div",is,[t("div",ds,[t("div",rs,[t("h5",cs," تقرير "+o($[v.value-1])+" "+o(u.value),1)]),t("div",us,[t("div",vs,[t("div",bs,[s[37]||(s[37]=t("h6",null,"ملخص الشهر:",-1)),t("div",ms,[s[34]||(s[34]=t("label",null,"عدد الطلبات:",-1)),t("span",_s,o(b.value.monthly_account.total_orders),1)]),t("div",hs,[s[35]||(s[35]=t("label",null,"إجمالي المبلغ:",-1)),t("span",ys,o(d(b.value.monthly_account.total_orders_amount)),1)]),t("div",fs,[s[36]||(s[36]=t("label",null,"المدفوعات المستلمة:",-1)),t("span",ps,o(d(b.value.monthly_account.total_payments_received)),1)])]),t("div",ks,[s[41]||(s[41]=t("h6",null,"الرصيد:",-1)),t("div",gs,[s[38]||(s[38]=t("label",null,"الدولار:",-1)),t("span",ws,o(d(b.value.monthly_account.total_balance_dollar,"dollar")),1)]),t("div",Ms,[s[39]||(s[39]=t("label",null,"الدينار:",-1)),t("span",Cs,o(d(b.value.monthly_account.total_balance_dinar,"dinar")),1)]),t("div",xs,[s[40]||(s[40]=t("label",null,"صافي الربح:",-1)),t("span",Ts,o(d(b.value.monthly_account.net_profit_dollar)),1)])])])])])])):c("",!0)])])])):c("",!0)])])])])])]),y.value?(a(),i("div",$s,[t("div",js,[t("div",Ns,[t("div",Ss,[s[43]||(s[43]=t("h5",{class:"modal-title"},"إغلاق الشهر",-1)),t("button",{type:"button",class:"btn-close",onClick:s[7]||(s[7]=e=>y.value=!1)})]),t("div",As,[s[45]||(s[45]=t("div",{class:"alert alert-warning"},[t("i",{class:"bi bi-exclamation-triangle"}),_(" هل أنت متأكد من إغلاق الشهر؟ لا يمكن التراجع عن هذا الإجراء. ")],-1)),t("div",Fs,[s[44]||(s[44]=t("label",{for:"closeNotes",class:"form-label"},"ملاحظات (اختياري)",-1)),C(t("textarea",{id:"closeNotes","onUpdate:modelValue":s[8]||(s[8]=e=>k.value=e),class:"form-control",rows:"3",placeholder:"أضف ملاحظات حول إغلاق الشهر..."},null,512),[[P,k.value]])])]),t("div",Os,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[9]||(s[9]=e=>y.value=!1)},"إلغاء"),t("button",{type:"button",class:"btn btn-warning",onClick:O,disabled:g.value},[g.value?(a(),i("span",Vs)):c("",!0),s[46]||(s[46]=_(" إغلاق الشهر "))],8,Rs)])])])])):c("",!0),y.value?(a(),i("div",Es)):c("",!0)]),_:1},8,["translations"])}}},Ps=q(Ls,[["__scopeId","data-v-40e67a6c"]]);export{Ps as default};
