import{s as Y,T as Z,r as p,z as L,k as tt,o as st,a as r,h as et,w as K,b as t,d as k,j as P,l as u,x as c,c as a,F as $,f as M,t as i,e as f,u as d,A as O,U as ot,v as lt,i as nt,p as rt,D as E}from"./app-CuWfCMHW.js";import{A as at}from"./AuthenticatedLayout-AxOaBXSA.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={dir:"rtl",lang:"ar"},ut={class:"section dashboard"},ct={class:"card"},pt={class:"card-body"},mt={class:"row mb-4"},bt={class:"col-md-6"},vt={class:"input-group"},ft={key:0,class:"dropdown-menu show w-100"},_t=["onClick"],yt={class:"d-flex justify-content-between"},ht={class:"text-muted"},wt={key:1,class:"mt-2"},gt={class:"alert alert-info d-flex justify-content-between align-items-center"},xt={class:"col-md-3"},kt={class:"col-md-3"},qt={class:"row mb-4"},Ct={class:"col-12"},Vt={class:"row mb-3"},St={class:"col-md-8"},Ut={class:"input-group"},It={key:0,class:"dropdown-menu show w-100"},$t=["onClick"],Mt={class:"d-flex justify-content-between align-items-center"},Dt={class:"text-muted"},Pt={class:"col-md-4"},Et={key:0,class:"table-responsive"},Ft={class:"table table-hover"},At={class:"d-flex align-items-center"},jt=["src","alt"],Tt={class:"text-muted"},Bt=["onUpdate:modelValue","onInput"],Nt=["onUpdate:modelValue","onInput"],Lt=["onUpdate:modelValue"],Kt=["onClick"],Ot={class:"table-light"},Qt={class:"text-primary"},zt={key:1,class:"text-center py-5"},Gt={class:"row mb-4"},Ht={class:"col-md-8"},Jt={class:"col-md-4"},Rt={class:"form-check form-switch mb-3"},Wt={key:0,class:"alert alert-warning"},Xt={class:"d-flex justify-content-between"},Yt=["disabled"],Zt={key:0,class:"spinner-border spinner-border-sm me-2"},ts={key:1,class:"bi bi-check-circle me-2"},ss={key:0,class:"modal fade show d-block",tabindex:"-1"},es={class:"modal-dialog"},os={class:"modal-content"},ls={class:"modal-header"},ns={class:"modal-body"},rs={class:"mb-3"},as={class:"mb-3"},is={class:"modal-footer"},ds={key:1,class:"modal fade show d-block",tabindex:"-1"},us={class:"modal-dialog"},cs={class:"modal-content"},ps={class:"modal-header"},ms={class:"modal-body"},bs={class:"mb-3"},vs=["value"],fs={class:"row"},_s={class:"col-md-6"},ys={class:"mb-3"},hs={class:"col-md-6"},ws={class:"mb-3"},gs={class:"mb-3"},xs={class:"modal-footer"},ks={key:2,class:"modal-backdrop fade show"},qs={__name:"Create",props:{suppliers:Array,products:Array,translations:Object},setup(D){const Q=D,m=Y(),l=Z({supplier_id:null,invoice_date:new Date().toISOString().split("T")[0],notes:"",items:[],withdraw_from_cashbox:!1,currency:"IQD"}),_=p(""),q=p(""),C=p(!1),S=p(!1),U=p([]),y=p([]),V=p(null),h=p(!1),w=p(!1),g=p(!1),b=L({name:"",phone:""}),n=L({product_id:"",quantity:1,cost_price:0,sales_price:0}),F=tt(()=>l.items.reduce((o,s)=>o+s.total,0)),z=async()=>{if(_.value.length<2){U.value=[];return}try{const o=await E.get(route("purchase-invoices.search-suppliers"),{params:{q:_.value}});U.value=o.data,C.value=!0}catch(o){console.error("Error searching suppliers:",o)}},G=async()=>{if(q.value.length<2){y.value=[];return}try{const o=await E.get(route("purchase-invoices.search-products"),{params:{q:q.value}});y.value=o.data,S.value=!0}catch(o){console.error("Error searching products:",o)}},A=o=>{V.value=o,l.supplier_id=o.id,_.value=o.name,C.value=!1},H=()=>{V.value=null,l.supplier_id=null,_.value=""},j=o=>{const s=l.items.findIndex(e=>e.product.id===o.id);s!==-1?(l.items[s].quantity+=1,I(s)):l.items.push({product:o,quantity:1,cost_price:o.price_cost||0,sales_price:o.price,total:o.price_cost||0}),q.value="",S.value=!1,m.success("تم إضافة المنتج بنجاح")},T=()=>{y.value.length>0&&j(y.value[0])},B=()=>{const o=Q.products.find(e=>e.id==n.product_id);if(!o)return;const s=l.items.findIndex(e=>e.product.id===o.id);s!==-1?(l.items[s].quantity+=n.quantity,l.items[s].cost_price=n.cost_price,l.items[s].sales_price=n.sales_price,I(s)):l.items.push({product:o,quantity:n.quantity,cost_price:n.cost_price,sales_price:n.sales_price,total:n.quantity*n.cost_price}),n.product_id="",n.quantity=1,n.cost_price=0,n.sales_price=0,w.value=!1,m.success("تم إضافة المنتج بنجاح")},I=o=>{const s=l.items[o];s.total=s.quantity*s.cost_price},J=o=>{l.items.splice(o,1),m.success("تم حذف المنتج")},N=async()=>{try{const o=await E.post(route("suppliers.store"),{name:b.name,phone:b.phone}),s=o.data.supplier||o.data;A(s),b.name="",b.phone="",h.value=!1,m.success("تم إضافة المورد بنجاح")}catch(o){m.error("حدث خطأ أثناء إضافة المورد"),console.error("Error adding supplier:",o)}},R=o=>o.image&&o.image!=="products/default_product.png"?`/public/storage/${o.image}`:"/public/dashboard-assets/img/product-placeholder.svg",W=o=>{o.target.src="/dashboard-assets/img/product-placeholder.svg"},X=()=>{if(l.items.length===0){m.error("يجب إضافة منتج واحد على الأقل");return}g.value=!0;const o={supplier_id:l.supplier_id,invoice_date:l.invoice_date,notes:l.notes,withdraw_from_cashbox:l.withdraw_from_cashbox,currency:l.currency,items:l.items.map(s=>({product_id:s.product.id,quantity:s.quantity,cost_price:s.cost_price,sales_price:s.sales_price}))};l.transform(()=>o).post(route("purchase-invoices.store"),{onSuccess:()=>{g.value=!1,m.success("تم إنشاء فاتورة المشتريات بنجاح")},onError:s=>{g.value=!1,console.error("Form errors:",s),m.error("حدث خطأ في حفظ الفاتورة")}})};return st(()=>{document.addEventListener("click",o=>{o.target.closest(".input-group")||(C.value=!1,S.value=!1)})}),(o,s)=>(r(),et(at,{translations:D.translations},{default:K(()=>[t("div",dt,[t("section",ut,[t("div",ct,[s[41]||(s[41]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-plus-circle me-2"}),k(" إنشاء فاتورة مشتريات جديدة ")])],-1)),t("div",pt,[t("form",{onSubmit:P(X,["prevent"])},[t("div",mt,[t("div",bt,[s[22]||(s[22]=t("label",{class:"form-label"},"المورد",-1)),t("div",vt,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),onInput:z,placeholder:"ابحث عن المورد...",onFocus:s[1]||(s[1]=e=>C.value=!0)},null,544),[[c,_.value]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=e=>h.value=!0)},s[19]||(s[19]=[t("i",{class:"bi bi-plus"},null,-1)]))]),C.value&&U.value.length>0?(r(),a("div",ft,[(r(!0),a($,null,M(U.value,e=>(r(),a("div",{key:e.id,class:"dropdown-item cursor-pointer",onClick:x=>A(e)},[t("div",yt,[t("span",null,i(e.name),1),t("small",ht,i(e.phone),1)])],8,_t))),128))])):f("",!0),V.value?(r(),a("div",wt,[t("div",gt,[t("div",null,[t("strong",null,i(V.value.name),1),s[20]||(s[20]=t("br",null,null,-1)),t("small",null,i(V.value.phone),1)]),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:H},s[21]||(s[21]=[t("i",{class:"bi bi-x"},null,-1)]))])])):f("",!0)]),t("div",xt,[s[23]||(s[23]=t("label",{class:"form-label"},"تاريخ الفاتورة",-1)),u(t("input",{type:"date",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>d(l).invoice_date=e),required:""},null,512),[[c,d(l).invoice_date]])]),t("div",kt,[s[25]||(s[25]=t("label",{class:"form-label"},"العملة",-1)),u(t("select",{class:"form-select","onUpdate:modelValue":s[4]||(s[4]=e=>d(l).currency=e),required:""},s[24]||(s[24]=[t("option",{value:"IQD"},"دينار عراقي",-1),t("option",{value:"$"},"دولار أمريكي",-1)]),512),[[O,d(l).currency]])])]),t("div",qt,[t("div",Ct,[s[36]||(s[36]=t("h6",{class:"mb-3"},[t("i",{class:"bi bi-box-seam me-2"}),k(" المنتجات ")],-1)),t("div",Vt,[t("div",St,[t("div",Ut,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=e=>q.value=e),onInput:G,placeholder:"ابحث عن المنتج بالاسم أو الباركود...",onKeyup:ot(T,["enter"])},null,544),[[c,q.value]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:T},s[26]||(s[26]=[t("i",{class:"bi bi-search"},null,-1)]))]),S.value&&y.value.length>0?(r(),a("div",It,[(r(!0),a($,null,M(y.value,e=>(r(),a("div",{key:e.id,class:"dropdown-item cursor-pointer",onClick:x=>j(e)},[t("div",Mt,[t("div",null,[t("strong",null,i(e.name),1),s[27]||(s[27]=t("br",null,null,-1)),t("small",Dt," الباركود: "+i(e.barcode||"غير محدد")+" | السعر: "+i(e.price)+" | المخزون: "+i(e.quantity),1)]),s[28]||(s[28]=t("i",{class:"bi bi-plus-circle text-primary"},null,-1))])],8,$t))),128))])):f("",!0)]),t("div",Pt,[t("button",{type:"button",class:"btn btn-primary w-100",onClick:s[6]||(s[6]=e=>w.value=!0)},s[29]||(s[29]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),k(" إضافة منتج يدوياً ")]))])]),d(l).items.length>0?(r(),a("div",Et,[t("table",Ft,[s[34]||(s[34]=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"المنتج"),t("th",null,"الكمية"),t("th",null,"سعر التكلفة"),t("th",null,"سعر البيع"),t("th",null,"المجموع"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(r(!0),a($,null,M(d(l).items,(e,x)=>(r(),a("tr",{key:x},[t("td",null,[t("div",At,[t("img",{src:R(e.product),alt:e.product.name,class:"product-thumb me-2",onError:W},null,40,jt),t("div",null,[t("strong",null,i(e.product.name),1),s[30]||(s[30]=t("br",null,null,-1)),t("small",Tt,i(e.product.barcode||"غير محدد"),1)])])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":v=>e.quantity=v,onInput:v=>I(x),min:"1",style:{width:"80px"}},null,40,Bt),[[c,e.quantity,void 0,{number:!0}]])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":v=>e.cost_price=v,onInput:v=>I(x),step:"1",min:"0",style:{width:"100px"}},null,40,Nt),[[c,e.cost_price,void 0,{number:!0}]])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":v=>e.sales_price=v,step:"1",min:"0",style:{width:"100px"}},null,8,Lt),[[c,e.sales_price,void 0,{number:!0}]])]),t("td",null,[t("strong",null,i(Math.round(e.total))+" "+i(d(l).currency),1)]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:v=>J(x)},s[31]||(s[31]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Kt)])]))),128))]),t("tfoot",Ot,[t("tr",null,[s[32]||(s[32]=t("th",{colspan:"4",class:"text-end"},"المجموع الكلي:",-1)),t("th",null,[t("strong",Qt,i(Math.round(F.value))+" "+i(d(l).currency),1)]),s[33]||(s[33]=t("th",null,null,-1))])])])])):(r(),a("div",zt,s[35]||(s[35]=[t("i",{class:"bi bi-box-seam display-1 text-muted"},null,-1),t("h5",{class:"text-muted mt-3"},"لم يتم إضافة أي منتجات",-1),t("p",{class:"text-muted"},"ابحث عن المنتجات أو أضفها يدوياً لبدء إنشاء الفاتورة",-1)])))])]),t("div",Gt,[t("div",Ht,[s[37]||(s[37]=t("label",{class:"form-label"},"ملاحظات",-1)),u(t("textarea",{class:"form-control","onUpdate:modelValue":s[7]||(s[7]=e=>d(l).notes=e),rows:"3",placeholder:"أي ملاحظات إضافية..."},null,512),[[c,d(l).notes]])]),t("div",Jt,[t("div",Rt,[u(t("input",{class:"form-check-input",type:"checkbox",id:"withdrawFromCashbox","onUpdate:modelValue":s[8]||(s[8]=e=>d(l).withdraw_from_cashbox=e)},null,512),[[lt,d(l).withdraw_from_cashbox]]),s[38]||(s[38]=t("label",{class:"form-check-label",for:"withdrawFromCashbox"}," سحب من الصندوق ",-1))]),d(l).withdraw_from_cashbox?(r(),a("div",Wt,[s[39]||(s[39]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),k(" سيتم سحب "+i(Math.round(F.value))+" "+i(d(l).currency)+" من الصندوق الرئيسي ",1)])):f("",!0)])]),t("div",Xt,[nt(d(rt),{href:o.route("purchase-invoices.index"),class:"btn btn-secondary"},{default:K(()=>s[40]||(s[40]=[t("i",{class:"bi bi-arrow-right me-2"},null,-1),k(" إلغاء ")])),_:1},8,["href"]),t("button",{type:"submit",class:"btn btn-primary",disabled:d(l).items.length===0||g.value},[g.value?(r(),a("span",Zt)):(r(),a("i",ts)),k(" "+i(g.value?"جاري الحفظ...":"حفظ الفاتورة"),1)],8,Yt)])],32)])])]),h.value?(r(),a("div",ss,[t("div",es,[t("div",os,[t("div",ls,[s[42]||(s[42]=t("h5",{class:"modal-title"},"إضافة مورد جديد",-1)),t("button",{type:"button",class:"btn-close",onClick:s[9]||(s[9]=e=>h.value=!1)})]),t("div",ns,[t("form",{onSubmit:P(N,["prevent"])},[t("div",rs,[s[43]||(s[43]=t("label",{class:"form-label"},"اسم المورد",-1)),u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[10]||(s[10]=e=>b.name=e),required:""},null,512),[[c,b.name]])]),t("div",as,[s[44]||(s[44]=t("label",{class:"form-label"},"رقم الهاتف",-1)),u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=e=>b.phone=e)},null,512),[[c,b.phone]])])],32)]),t("div",is,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[12]||(s[12]=e=>h.value=!1)}," إلغاء "),t("button",{type:"button",class:"btn btn-primary",onClick:N}," إضافة المورد ")])])])])):f("",!0),w.value?(r(),a("div",ds,[t("div",us,[t("div",cs,[t("div",ps,[s[45]||(s[45]=t("h5",{class:"modal-title"},"إضافة منتج يدوياً",-1)),t("button",{type:"button",class:"btn-close",onClick:s[13]||(s[13]=e=>w.value=!1)})]),t("div",ms,[t("form",{onSubmit:P(B,["prevent"])},[t("div",bs,[s[47]||(s[47]=t("label",{class:"form-label"},"اختر المنتج",-1)),u(t("select",{class:"form-select","onUpdate:modelValue":s[14]||(s[14]=e=>n.product_id=e),required:""},[s[46]||(s[46]=t("option",{value:""},"اختر منتج...",-1)),(r(!0),a($,null,M(D.products,e=>(r(),a("option",{key:e.id,value:e.id},i(e.name)+" - "+i(e.barcode||"غير محدد"),9,vs))),128))],512),[[O,n.product_id]])]),t("div",fs,[t("div",_s,[t("div",ys,[s[48]||(s[48]=t("label",{class:"form-label"},"الكمية",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[15]||(s[15]=e=>n.quantity=e),min:"1",required:""},null,512),[[c,n.quantity,void 0,{number:!0}]])])]),t("div",hs,[t("div",ws,[s[49]||(s[49]=t("label",{class:"form-label"},"سعر التكلفة",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[16]||(s[16]=e=>n.cost_price=e),step:"1",min:"0",required:""},null,512),[[c,n.cost_price,void 0,{number:!0}]])])])]),t("div",gs,[s[50]||(s[50]=t("label",{class:"form-label"},"سعر البيع",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[17]||(s[17]=e=>n.sales_price=e),step:"1",min:"0",required:""},null,512),[[c,n.sales_price,void 0,{number:!0}]])])],32)]),t("div",xs,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[18]||(s[18]=e=>w.value=!1)}," إلغاء "),t("button",{type:"button",class:"btn btn-primary",onClick:B}," إضافة المنتج ")])])])])):f("",!0),h.value||w.value?(r(),a("div",ks)):f("",!0)])]),_:1},8,["translations"]))}},Us=it(qs,[["__scopeId","data-v-5db15d99"]]);export{Us as default};
