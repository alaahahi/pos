import{S as L,U as ot,l as O,T as at,m as M,h as D,p as rt,L as G,q as st,c as it,w as R,o as $,b as e,t as c,a as S,d as F,e as lt,N as P,u as h,i as E,x as N,f as j,F as ct,s as dt,g as U}from"./app-ChIxOWfg.js";import{_ as ut}from"./AuthenticatedLayout-DCZqNzb4.js";import{_ as W}from"./InputError-D9BVLZ1Q.js";import{C as H}from"./vue-select-D81KAgod.js";import"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as mt}from"./ModalConfirmOrderAndPay-BHzOImge.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ft(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var Z=ft,bt=typeof L=="object"&&L&&L.Object===Object&&L,vt=bt,pt=vt,yt=typeof self=="object"&&self&&self.Object===Object&&self,ht=pt||yt||Function("return this")(),tt=ht,_t=tt,gt=function(){return _t.Date.now()},Tt=gt,xt=/\s/;function $t(t){for(var s=t.length;s--&&xt.test(t.charAt(s)););return s}var wt=$t,St=wt,jt=/^\s+/;function kt(t){return t&&t.slice(0,St(t)+1).replace(jt,"")}var Ot=kt,Ct=tt,It=Ct.Symbol,et=It,Q=et,nt=Object.prototype,qt=nt.hasOwnProperty,Vt=nt.toString,C=Q?Q.toStringTag:void 0;function Lt(t){var s=qt.call(t,C),d=t[C];try{t[C]=void 0;var u=!0}catch{}var m=Vt.call(t);return u&&(s?t[C]=d:delete t[C]),m}var Et=Lt,Nt=Object.prototype,Ut=Nt.toString;function Bt(t){return Ut.call(t)}var Pt=Bt,K=et,At=Et,Mt=Pt,Dt="[object Null]",Gt="[object Undefined]",X=K?K.toStringTag:void 0;function Rt(t){return t==null?t===void 0?Gt:Dt:X&&X in Object(t)?At(t):Mt(t)}var Ft=Rt;function Wt(t){return t!=null&&typeof t=="object"}var Ht=Wt,Qt=Ft,Kt=Ht,Xt="[object Symbol]";function zt(t){return typeof t=="symbol"||Kt(t)&&Qt(t)==Xt}var Jt=zt,Yt=Ot,z=Z,Zt=Jt,J=NaN,te=/^[-+]0x[0-9a-f]+$/i,ee=/^0b[01]+$/i,ne=/^0o[0-7]+$/i,oe=parseInt;function ae(t){if(typeof t=="number")return t;if(Zt(t))return J;if(z(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=z(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=Yt(t);var d=ee.test(t);return d||ne.test(t)?oe(t.slice(2),d?2:8):te.test(t)?J:+t}var re=ae,se=Z,A=Tt,Y=re,ie="Expected a function",le=Math.max,ce=Math.min;function de(t,s,d){var u,m,b,p,l,f,g=0,I=!1,T=!1,k=!0;if(typeof t!="function")throw new TypeError(ie);s=Y(s)||0,se(d)&&(I=!!d.leading,T="maxWait"in d,b=T?le(Y(d.maxWait)||0,s):b,k="trailing"in d?!!d.trailing:k);function _(r){var o=u,y=m;return u=m=void 0,g=r,p=t.apply(y,o),p}function x(r){return g=r,l=setTimeout(w,s),I?_(r):p}function B(r){var o=r-f,y=r-g,v=s-o;return T?ce(v,b-y):v}function q(r){var o=r-f,y=r-g;return f===void 0||o>=s||o<0||T&&y>=b}function w(){var r=A();if(q(r))return V(r);l=setTimeout(w,B(r))}function V(r){return l=void 0,k&&u?_(r):(u=m=void 0,p)}function a(){l!==void 0&&clearTimeout(l),g=0,u=f=m=l=void 0}function n(){return l===void 0?p:V(A())}function i(){var r=A(),o=q(r);if(u=arguments,m=this,f=r,o){if(l===void 0)return x(f);if(T)return clearTimeout(l),l=setTimeout(w,s),_(f)}return l===void 0&&(l=setTimeout(w,s)),p}return i.cancel=a,i.flush=n,i}var ue=de;const me=ot(ue),fe={class:"pagetitle dark:text-white"},be={class:"dark:text-white"},ve={class:"breadcrumb"},pe={class:"breadcrumb-item"},ye={class:"breadcrumb-item active dark:text-white"},he={class:"section dashboard"},_e={class:"row"},ge={class:"col-lg-12"},Te={class:"card"},xe={class:"card-body"},$e={class:"card-title"},we={class:"row mb-3"},Se={for:"customerSelect",class:"col-sm-2 col-form-label"},je={class:"col-sm-10"},ke={class:"row mb-3"},Oe={for:"inputBarcode",class:"col-sm-2 col-form-label"},Ce={class:"col-sm-10"},Ie=["placeholder"],qe={key:0,class:"row mb-3"},Ve={for:"productTable",class:"col-sm-2 col-form-label"},Le={class:"col-sm-10"},Ee={class:"table"},Ne=["onInput","onUpdate:modelValue","max"],Ue=["onUpdate:modelValue"],Be=["value"],Pe=["onClick"],Ae={class:"row"},Me={class:"col-md-6"},De={class:"col-md-6"},Ge={class:"text-center"},Re=["disabled"],Fe={key:0,class:"bi bi-save"},We={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ze={__name:"Create",props:{products:Array,customers:Array,defaultCustomer:Object,translations:Object},setup(t){let s=O(""),d=O(!1),u=O(""),m=O(!1);const b=t,p=O(b.defaultCustomer.name),l=at({customer_id:b.defaultCustomer.id,items:[],log:[],total_amount:0}),f=M([]),g=M([]),I=D(()=>s.value?b.customers.filter(a=>{const n=s.value.toLowerCase();return a.name.toLowerCase().includes(n)||a.phone.includes(n)}):b.customers),T=a=>{const n=b.products.find(i=>i.id===a.product_id);n&&(a.price=n.price,a.max_quantity=n.max_quantity)},k=a=>{const n=b.products.find(i=>i.id===a.product_id);n&&a.quantity>n.max_quantity&&(a.quantity=n.max_quantity)},_=D(()=>f.reduce((a,n)=>a+n.quantity*n.price,0));rt(_,a=>{l.total_amount=a});const x=a=>{const n=new Date().toLocaleString();g.push({message:a,timestamp:n})},B=()=>{f.push({product_id:"",quantity:1,price:0}),x("product_added")},q=a=>{f.splice(a,1),x("product_removed")},w=async a=>{d.value=!0;const n={total_amount:l.total_amount,total_paid:a.amountDollar,customer_id:l.customer_id,date:a.date,notes:a.notes,items:f.reduce((i,r)=>{let o=i.find(y=>y.product_id===r.product_id);return o?o.quantity+=r.quantity:i.push(r),i},[])};try{const i=await G.post("/api/createOrder",n);if(i.status===200||i.status===201){let r=i.data.id,o=i.data.order_id;window.open(`/api/getIndexAccountsSelas?print=2&transactions_id=${r}&order_id=${o}`,"_blank"),x("invoice_saved")}else x("invoice_save_failed")}catch(i){console.error("خطأ أثناء حفظ الفاتورة:",i),x("invoice_save_failed")}finally{d.value=!1}},V=me(async()=>{if(u.value)try{const a=await G.get(`/api/products/${u.value}`);if(a.data.id){const n=f.find(i=>i.product_id===a.data.id);n?n.quantity+=1:f.push({product_id:a.data.id,quantity:1,price:a.data.price}),u.value="",console.log("تمت إضافة أو تحديث المنتج:",a.data)}}catch(a){console.error("خطأ أثناء البحث عن الباركود:",a)}},500);return(a,n)=>{const i=st("Link");return $(),it(ut,{translations:t.translations},{default:R(()=>{var r;return[e("div",fe,[e("h1",be,c(t.translations.invoice),1),e("nav",null,[e("ol",ve,[e("li",pe,[S(i,{class:"nav-link dark:text-white",href:a.route("dashboard")},{default:R(()=>[F(c(t.translations.Home),1)]),_:1},8,["href"])]),e("li",ye,c(t.translations.invoice),1)])])]),e("section",he,[e("div",_e,[e("div",ge,[e("div",Te,[e("div",xe,[e("h5",$e,c(t.translations.create_invoice),1),e("form",{onSubmit:n[5]||(n[5]=lt(o=>P(m)?m.value=!0:m=!0,["prevent"])),class:"row g-3"},[e("div",we,[e("label",Se,c(t.translations.client),1),e("div",je,[S(h(H),{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=o=>p.value=o),options:I.value,label:"name","track-by":"id",reduce:o=>({id:o.id,name:o.name}),onBlur:n[1]||(n[1]=o=>a.mouseleave(p.value)),clearable:!0,placeholder:t.translations.select_customer},null,8,["modelValue","options","reduce","placeholder"]),S(W,{message:h(l).errors.customer},null,8,["message"])])]),e("div",ke,[e("label",Oe,c(t.translations.barcode),1),e("div",Ce,[E(e("input",{autofocus:"",id:"inputBarcode",type:"text",class:"form-control",placeholder:t.translations.barcode,onKeyup:n[2]||(n[2]=o=>h(V)()),"onUpdate:modelValue":n[3]||(n[3]=o=>P(u)?u.value=o:u=o)},null,40,Ie),[[N,h(u)]]),S(W,{message:h(l).errors.name},null,8,["message"])])]),p.value?($(),j("div",qe,[e("label",Ve,c(t.translations.products),1),e("div",Le,[e("table",Ee,[e("thead",null,[e("tr",null,[e("th",null,c(t.translations.product),1),e("th",null,c(t.translations.quantity),1),e("th",null,c(t.translations.price)+" "+c(t.translations.dollar),1),e("th",null,c(t.translations.total)+" "+c(t.translations.dollar),1),e("th",null,c(t.translations.actions),1)])]),e("tbody",null,[($(!0),j(ct,null,dt(f,(o,y)=>($(),j("tr",{key:y},[S(h(H),{modelValue:o.product_id,"onUpdate:modelValue":v=>o.product_id=v,options:t.products,label:"name",reduce:v=>v.id,placeholder:t.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:v=>T(o)},null,8,["modelValue","onUpdate:modelValue","options","reduce","placeholder","onMouseleave"]),e("td",null,[E(e("input",{type:"number",onInput:v=>k(o),"onUpdate:modelValue":v=>o.quantity=v,min:"1",max:o.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,Ne),[[N,o.quantity]])]),e("td",null,[E(e("input",{type:"number","onUpdate:modelValue":v=>o.price=v,min:"0",class:"form-control",placeholder:"Price"},null,8,Ue),[[N,o.price]])]),e("td",null,[e("input",{type:"number",value:o.quantity*o.price,class:"form-control",disabled:""},null,8,Be)]),e("td",null,[e("button",{type:"button",class:"btn btn-danger",onClick:v=>q(y)},n[8]||(n[8]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Pe)])]))),128))])]),(r=t.products)!=null&&r.length?($(),j("button",{key:0,type:"button",class:"btn btn-primary",onClick:B},c(t.translations.add_product),1)):U("",!0)])])):U("",!0),e("div",Ae,[e("div",Me,[e("strong",null,c(b.translations.total)+" "+c(t.translations.dollar)+":",1)]),e("div",De,[E(e("input",{type:"number","onUpdate:modelValue":n[4]||(n[4]=o=>_.value=o),class:"form-control",readonly:""},null,512),[[N,_.value]])])]),e("div",Ge,[e("button",{type:"submit",class:"btn btn-primary",disabled:h(d)},[F(c(t.translations.save)+"   ",1),h(d)?U("",!0):($(),j("i",Fe)),h(d)?($(),j("span",We)):U("",!0)],8,Re)])],32)])])])]),S(mt,{translations:t.translations,show:h(m),total:_.value,onClose:n[6]||(n[6]=o=>P(m)?m.value=!1:m=!1),onConfirm:n[7]||(n[7]=o=>w(o))},null,8,["translations","show","total"])])]}),_:1},8,["translations"])}}};export{Ze as default};
