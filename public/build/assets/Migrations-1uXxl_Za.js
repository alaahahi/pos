import{r as h,o as N,a as l,c as n,b as s,d,e as u,t as a,F as p,f as w,n as k,g as f}from"./app-CHz4vJ2a.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"py-12"},M={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},R={class:"card mb-4"},E={class:"card-body"},P={class:"row g-3"},q={class:"col-md-2"},D=["disabled"],K={key:0,class:"bi bi-play-circle"},X={key:1,class:"spinner-border spinner-border-sm me-2"},z={key:2,class:"badge bg-light text-dark ms-2"},B={class:"col-md-2"},I=["disabled"],V={key:0,class:"bi bi-arrow-counterclockwise"},L={key:1,class:"spinner-border spinner-border-sm me-2"},$={class:"col-md-2"},G=["disabled"],H={key:0,class:"bi bi-arrow-repeat"},J={key:1,class:"spinner-border spinner-border-sm me-2"},Q={class:"col-md-3"},U=["disabled"],W={key:0,class:"bi bi-database-add"},Y={key:1,class:"spinner-border spinner-border-sm me-2"},Z={class:"col-md-3"},ss=["disabled"],ts={class:"card mb-4"},es={class:"card-header"},as={class:"card-title mb-0"},ls={class:"card-body"},ns={key:0},os={class:"text-primary"},is={class:"table-responsive"},rs={class:"table table-sm table-hover"},ds={key:0,class:"badge bg-success"},us={key:1,class:"badge bg-warning"},cs={key:0,class:"badge bg-info"},bs={key:1,class:"text-muted"},ms={class:"row mt-3"},vs={class:"col-md-6"},gs={class:"alert alert-warning"},hs={class:"col-md-6"},fs={class:"alert alert-success"},ys={key:1,class:"text-center text-muted py-4"},ks={class:"card"},_s={class:"card-header"},ps={class:"card-title mb-0"},ws={class:"card-body"},xs={class:"table-responsive"},Ss={class:"table table-striped table-hover"},Cs={class:"badge bg-info"},js={class:"badge bg-secondary"},Ts={class:"text-muted"},Os={class:"text-muted"},Ns={key:0,class:"modal-mask"},As={class:"modal-wrapper"},Fs={class:"modal-container modal-lg"},Ms={class:"modal-header"},Rs={class:"modal-body"},Es={key:0,class:"alert alert-info"},Ps={key:1,class:"bg-dark text-light p-3 rounded",style:{"font-family":"monospace","white-space":"pre-wrap","max-height":"400px","overflow-y":"auto"}},qs={class:"modal-footer"},Ds={__name:"Migrations",props:{migrations:Object,tables:Array,translations:Object},setup(e){const y=e,o=h(!1),c=h(!1),g=h(""),b=h(""),m=h(!1),v=h(""),x=async()=>{if(confirm("هل أنت متأكد من تشغيل المايكريشنات المعلقة؟")){o.value=!0;try{const t=await(await fetch("/admin/migrations/run?key=migrate123",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",c.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",c.value=!0}finally{o.value=!1}}},S=async()=>{if(confirm(y.translations.confirm_rollback)){o.value=!0;try{const t=await(await fetch("/admin/migrations/rollback?key=migrate123",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",c.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",c.value=!0}finally{o.value=!1}}},C=async()=>{if(confirm(y.translations.confirm_refresh)){o.value=!0;try{const t=await(await fetch("/admin/migrations/refresh?key=migrate123",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",c.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",c.value=!0}finally{o.value=!1}}},j=async()=>{if(confirm(y.translations.confirm_seeders)){o.value=!0;try{const t=await(await fetch("/admin/migrations/seeders?key=migrate123",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",c.value=!0,t.success&&f.reload()}catch(i){g.value="حدث خطأ في الاتصال",b.value=i.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",c.value=!0}finally{o.value=!1}}},_=()=>{f.reload()},T=i=>i?new Date(i).toLocaleString("ar-SA"):"غير محدد",O=i=>new Intl.NumberFormat("ar-SA").format(i);return N(()=>{setInterval(()=>{o.value||_()},3e4)}),(i,t)=>(l(),n("div",F,[s("div",M,[s("div",R,[t[3]||(t[3]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-gear"}),d(" إجراءات المايكريشنات ")])],-1)),s("div",E,[s("div",P,[s("div",q,[s("button",{onClick:x,disabled:o.value||e.migrations.pending.length===0,class:"btn btn-success w-100"},[o.value?u("",!0):(l(),n("i",K)),o.value?(l(),n("span",X)):u("",!0),d(" "+a(e.translations.run_pending)+" ",1),e.migrations.pending.length>0?(l(),n("span",z,a(e.migrations.pending.length),1)):u("",!0)],8,D)]),s("div",B,[s("button",{onClick:S,disabled:o.value||e.migrations.executed.length===0,class:"btn btn-warning w-100"},[o.value?u("",!0):(l(),n("i",V)),o.value?(l(),n("span",L)):u("",!0),d(" "+a(e.translations.rollback_last),1)],8,I)]),s("div",$,[s("button",{onClick:C,disabled:o.value,class:"btn btn-danger w-100"},[o.value?u("",!0):(l(),n("i",H)),o.value?(l(),n("span",J)):u("",!0),d(" "+a(e.translations.refresh_all),1)],8,G)]),s("div",Q,[s("button",{onClick:j,disabled:o.value,class:"btn btn-info w-100"},[o.value?u("",!0):(l(),n("i",W)),o.value?(l(),n("span",Y)):u("",!0),d(" "+a(e.translations.run_seeders),1)],8,U)]),s("div",Z,[s("button",{onClick:_,disabled:o.value,class:"btn btn-outline-primary w-100"},t[2]||(t[2]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1),d(" تحديث البيانات ")]),8,ss)])])])]),s("div",ts,[s("div",es,[s("h5",as,[t[4]||(t[4]=s("i",{class:"bi bi-list-check"},null,-1)),d(" "+a(e.translations.migration_status),1)])]),s("div",ls,[e.migrations.all&&e.migrations.all.length>0?(l(),n("div",ns,[s("h6",os,[t[5]||(t[5]=s("i",{class:"bi bi-list-ul"},null,-1)),d(" جميع المايكريشنات ("+a(e.migrations.all.length)+") ",1)]),s("div",is,[s("table",rs,[s("thead",null,[s("tr",null,[s("th",null,a(e.translations.migration_name),1),t[6]||(t[6]=s("th",null,"الحالة",-1)),s("th",null,a(e.translations.batch),1)])]),s("tbody",null,[(l(!0),n(p,null,w(e.migrations.all,r=>(l(),n("tr",{key:r.migration,class:k({"table-warning":r.status==="Pending","table-success":r.status==="Ran"})},[s("td",null,[s("code",null,a(r.migration),1)]),s("td",null,[r.status==="Ran"?(l(),n("span",ds,t[7]||(t[7]=[s("i",{class:"bi bi-check-circle"},null,-1),d(" منفذ ")]))):(l(),n("span",us,t[8]||(t[8]=[s("i",{class:"bi bi-clock"},null,-1),d(" معلق ")])))]),s("td",null,[r.batch!=="N/A"?(l(),n("span",cs,a(r.batch),1)):(l(),n("span",bs,"-"))])],2))),128))])])])])):u("",!0),s("div",ms,[s("div",vs,[s("div",gs,[t[9]||(t[9]=s("i",{class:"bi bi-clock"},null,-1)),t[10]||(t[10]=s("strong",null,"المايكريشنات المعلقة:",-1)),d(" "+a(e.migrations.pending?e.migrations.pending.length:0),1)])]),s("div",hs,[s("div",fs,[t[11]||(t[11]=s("i",{class:"bi bi-check-circle"},null,-1)),t[12]||(t[12]=s("strong",null,"المايكريشنات المنفذة:",-1)),d(" "+a(e.migrations.executed?e.migrations.executed.length:0),1)])])]),!e.migrations.all||e.migrations.all.length===0?(l(),n("div",ys,t[13]||(t[13]=[s("i",{class:"bi bi-inbox display-4"},null,-1),s("p",{class:"mt-2"},"لا توجد مايكريشنات",-1)]))):u("",!0)])]),s("div",ks,[s("div",_s,[s("h5",ps,[t[14]||(t[14]=s("i",{class:"bi bi-table"},null,-1)),d(" "+a(e.translations.table_info),1)])]),s("div",ws,[s("div",xs,[s("table",Ss,[s("thead",null,[s("tr",null,[s("th",null,a(e.translations.table_name),1),s("th",null,a(e.translations.table_rows),1),s("th",null,a(e.translations.table_size),1),t[15]||(t[15]=s("th",null,"المحرك",-1)),t[16]||(t[16]=s("th",null,"الترميز",-1)),s("th",null,a(e.translations.last_modified),1)])]),s("tbody",null,[(l(!0),n(p,null,w(e.tables,r=>(l(),n("tr",{key:r.name},[s("td",null,[s("strong",null,a(r.name),1)]),s("td",null,[s("span",Cs,a(O(r.rows)),1)]),s("td",null,a(r.size),1),s("td",null,[s("span",js,a(r.engine),1)]),s("td",null,[s("small",Ts,a(r.collation),1)]),s("td",null,[s("small",Os,a(T(r.updated)),1)])]))),128))])])])])]),c.value?(l(),n("div",Ns,[s("div",As,[s("div",Fs,[s("div",Ms,[t[17]||(t[17]=s("h5",{class:"modal-title"},"نتيجة تنفيذ المايكريشن",-1)),s("button",{onClick:t[0]||(t[0]=r=>c.value=!1),class:"btn-close"})]),s("div",Rs,[s("div",{class:k(["alert",m.value?"alert-success":"alert-danger"])},[s("i",{class:k(["bi",m.value?"bi-check-circle":"bi-exclamation-triangle"])},null,2),d(" "+a(g.value),1)],2),v.value?(l(),n("div",Es,[t[18]||(t[18]=s("i",{class:"bi bi-lightbulb"},null,-1)),t[19]||(t[19]=s("strong",null,"اقتراح:",-1)),d(" "+a(v.value),1)])):u("",!0),b.value?(l(),n("div",Ps,a(b.value),1)):u("",!0)]),s("div",qs,[s("button",{onClick:t[1]||(t[1]=r=>c.value=!1),class:"btn btn-secondary"},"إغلاق")])])])])):u("",!0)])]))}},zs=A(Ds,[["__scopeId","data-v-893d5995"]]);export{zs as default};
