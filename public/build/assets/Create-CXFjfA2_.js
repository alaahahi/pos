import{s as tt,T as st,r as m,x as Q,k as et,o as ot,a as r,c as lt,w as F,b as t,i as M,d as v,t as i,u as d,p as D,j,l as u,y as c,e as a,F as E,g as P,f as y,A as z,S as nt,v as rt,E as T}from"./app-AYyl8aPx.js";import{_ as it}from"./AuthenticatedLayout-CYr2UffW.js";import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={class:"pagetitle dark:text-white"},ut={class:"breadcrumb"},ct={class:"breadcrumb-item"},mt={class:"breadcrumb-item"},pt={class:"section dashboard"},bt={class:"card"},vt={class:"card-body"},ft={class:"row mb-4"},yt={class:"col-md-6"},_t={class:"input-group"},ht={key:0,class:"dropdown-menu show w-100"},wt=["onClick"],gt={class:"d-flex justify-content-between"},xt={class:"text-muted"},kt={key:1,class:"mt-2"},qt={class:"alert alert-info d-flex justify-content-between align-items-center"},Ct={class:"col-md-3"},Vt={class:"col-md-3"},St={class:"row mb-4"},It={class:"col-12"},Ut={class:"row mb-3"},$t={class:"col-md-8"},Ft={class:"input-group"},Et={key:0,class:"dropdown-menu show w-100"},Pt=["onClick"],Mt={class:"d-flex justify-content-between align-items-center"},Dt={class:"text-muted"},jt={class:"col-md-4"},Tt={key:0,class:"table-responsive"},At={class:"table table-hover"},Bt={class:"d-flex align-items-center"},Nt=["src","alt"],Kt={class:"text-muted"},Lt=["onUpdate:modelValue","onInput"],Ot=["onUpdate:modelValue","onInput"],Qt=["onUpdate:modelValue"],zt=["onClick"],Gt={class:"table-light"},Ht={key:1,class:"text-center py-5"},Jt={class:"row mb-4"},Rt={class:"col-md-8"},Wt={class:"col-md-4"},Xt={class:"form-check form-switch mb-3"},Yt={key:0,class:"alert alert-warning"},Zt={class:"d-flex justify-content-between"},ts=["disabled"],ss={key:0,class:"spinner-border spinner-border-sm me-2"},es={key:1,class:"bi bi-check-circle me-2"},os={key:0,class:"modal fade show d-block",tabindex:"-1"},ls={class:"modal-dialog"},ns={class:"modal-content"},rs={class:"modal-header"},is={class:"modal-body"},as={class:"mb-3"},ds={class:"mb-3"},us={class:"modal-footer"},cs={key:1,class:"modal fade show d-block",tabindex:"-1"},ms={class:"modal-dialog"},ps={class:"modal-content"},bs={class:"modal-header"},vs={class:"modal-body"},fs={class:"mb-3"},ys=["value"],_s={class:"row"},hs={class:"col-md-6"},ws={class:"mb-3"},gs={class:"col-md-6"},xs={class:"mb-3"},ks={class:"mb-3"},qs={class:"modal-footer"},Cs={key:2,class:"modal-backdrop fade show"},Vs={__name:"Create",props:{suppliers:Array,products:Array,translations:Object},setup(S){const G=S,f=tt(),l=st({supplier_id:null,invoice_date:new Date().toISOString().split("T")[0],notes:"",items:[],withdraw_from_cashbox:!1,currency:"IQD"}),_=m(""),q=m(""),C=m(!1),I=m(!1),U=m([]),h=m([]),V=m(null),w=m(!1),g=m(!1),x=m(!1),p=Q({name:"",phone:""}),n=Q({product_id:"",quantity:1,cost_price:0,sales_price:0}),A=et(()=>l.items.reduce((o,s)=>o+s.total,0)),H=async()=>{if(_.value.length<2){U.value=[];return}try{const o=await T.get(route("purchase-invoices.search-suppliers"),{params:{q:_.value}});U.value=o.data,C.value=!0}catch(o){console.error("Error searching suppliers:",o)}},J=async()=>{if(q.value.length<2){h.value=[];return}try{const o=await T.get(route("purchase-invoices.search-products"),{params:{q:q.value}});h.value=o.data,I.value=!0}catch(o){console.error("Error searching products:",o)}},B=o=>{V.value=o,l.supplier_id=o.id,_.value=o.name,C.value=!1},R=()=>{V.value=null,l.supplier_id=null,_.value=""},N=o=>{const s=l.items.findIndex(e=>e.product.id===o.id);s!==-1?(l.items[s].quantity+=1,$(s)):l.items.push({product:o,quantity:1,cost_price:o.price_cost||0,sales_price:o.price,total:o.price_cost||0}),q.value="",I.value=!1,f.success("تم إضافة المنتج بنجاح")},K=()=>{h.value.length>0&&N(h.value[0])},L=()=>{const o=G.products.find(e=>e.id==n.product_id);if(!o)return;const s=l.items.findIndex(e=>e.product.id===o.id);s!==-1?(l.items[s].quantity+=n.quantity,l.items[s].cost_price=n.cost_price,l.items[s].sales_price=n.sales_price,$(s)):l.items.push({product:o,quantity:n.quantity,cost_price:n.cost_price,sales_price:n.sales_price,total:n.quantity*n.cost_price}),n.product_id="",n.quantity=1,n.cost_price=0,n.sales_price=0,g.value=!1,f.success("تم إضافة المنتج بنجاح")},$=o=>{const s=l.items[o];s.total=s.quantity*s.cost_price},W=o=>{l.items.splice(o,1),f.success("تم حذف المنتج")},O=async()=>{try{const s=(await T.post(route("customers.store"),{name:p.name,phone:p.phone,is_supplier:!0})).data.customer;B(s),p.name="",p.phone="",w.value=!1,f.success("تم إضافة المورد بنجاح")}catch(o){f.error("حدث خطأ أثناء إضافة المورد"),console.error("Error adding supplier:",o)}},X=o=>o.image&&o.image!=="products/default_product.png"?`/storage/${o.image}`:"/dashboard-assets/img/product-placeholder.svg",Y=o=>{o.target.src="/dashboard-assets/img/product-placeholder.svg"},Z=()=>{if(l.items.length===0){f.error("يجب إضافة منتج واحد على الأقل");return}x.value=!0,l.post(route("purchase-invoices.store"),{onSuccess:()=>{x.value=!1,f.success("تم إنشاء فاتورة المشتريات بنجاح")},onError:o=>{x.value=!1,console.error("Form errors:",o)}})};return ot(()=>{document.addEventListener("click",o=>{o.target.closest(".input-group")||(C.value=!1,I.value=!1)})}),(o,s)=>(r(),lt(it,{translations:S.translations},{default:F(()=>[t("div",dt,[s[21]||(s[21]=t("h1",{class:"dark:text-white"},"إنشاء فاتورة مشتريات",-1)),t("nav",null,[t("ol",ut,[t("li",ct,[M(d(D),{class:"nav-link dark:text-white",href:o.route("dashboard")},{default:F(()=>[v(i(S.translations.home),1)]),_:1},8,["href"])]),t("li",mt,[M(d(D),{class:"nav-link dark:text-white",href:o.route("purchase-invoices.index")},{default:F(()=>s[19]||(s[19]=[v(" فواتير المشتريات ")])),_:1},8,["href"])]),s[20]||(s[20]=t("li",{class:"breadcrumb-item active dark:text-white"},"إنشاء فاتورة",-1))])])]),t("section",pt,[t("div",bt,[s[44]||(s[44]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-plus-circle me-2"}),v(" إنشاء فاتورة مشتريات جديدة ")])],-1)),t("div",vt,[t("form",{onSubmit:j(Z,["prevent"])},[t("div",ft,[t("div",yt,[s[25]||(s[25]=t("label",{class:"form-label"},"المورد",-1)),t("div",_t,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),onInput:H,placeholder:"ابحث عن المورد...",onFocus:s[1]||(s[1]=e=>C.value=!0)},null,544),[[c,_.value]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=e=>w.value=!0)},s[22]||(s[22]=[t("i",{class:"bi bi-plus"},null,-1)]))]),C.value&&U.value.length>0?(r(),a("div",ht,[(r(!0),a(E,null,P(U.value,e=>(r(),a("div",{key:e.id,class:"dropdown-item cursor-pointer",onClick:k=>B(e)},[t("div",gt,[t("span",null,i(e.name),1),t("small",xt,i(e.phone),1)])],8,wt))),128))])):y("",!0),V.value?(r(),a("div",kt,[t("div",qt,[t("div",null,[t("strong",null,i(V.value.name),1),s[23]||(s[23]=t("br",null,null,-1)),t("small",null,i(V.value.phone),1)]),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:R},s[24]||(s[24]=[t("i",{class:"bi bi-x"},null,-1)]))])])):y("",!0)]),t("div",Ct,[s[26]||(s[26]=t("label",{class:"form-label"},"تاريخ الفاتورة",-1)),u(t("input",{type:"date",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>d(l).invoice_date=e),required:""},null,512),[[c,d(l).invoice_date]])]),t("div",Vt,[s[28]||(s[28]=t("label",{class:"form-label"},"العملة",-1)),u(t("select",{class:"form-select","onUpdate:modelValue":s[4]||(s[4]=e=>d(l).currency=e),required:""},s[27]||(s[27]=[t("option",{value:"IQD"},"دينار عراقي",-1),t("option",{value:"$"},"دولار أمريكي",-1)]),512),[[z,d(l).currency]])])]),t("div",St,[t("div",It,[s[39]||(s[39]=t("h6",{class:"mb-3"},[t("i",{class:"bi bi-box-seam me-2"}),v(" المنتجات ")],-1)),t("div",Ut,[t("div",$t,[t("div",Ft,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=e=>q.value=e),onInput:J,placeholder:"ابحث عن المنتج بالاسم أو الباركود...",onKeyup:nt(K,["enter"])},null,544),[[c,q.value]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:K},s[29]||(s[29]=[t("i",{class:"bi bi-search"},null,-1)]))]),I.value&&h.value.length>0?(r(),a("div",Et,[(r(!0),a(E,null,P(h.value,e=>(r(),a("div",{key:e.id,class:"dropdown-item cursor-pointer",onClick:k=>N(e)},[t("div",Mt,[t("div",null,[t("strong",null,i(e.name),1),s[30]||(s[30]=t("br",null,null,-1)),t("small",Dt," الباركود: "+i(e.barcode||"غير محدد")+" | السعر: "+i(e.price)+" | المخزون: "+i(e.quantity),1)]),s[31]||(s[31]=t("i",{class:"bi bi-plus-circle text-primary"},null,-1))])],8,Pt))),128))])):y("",!0)]),t("div",jt,[t("button",{type:"button",class:"btn btn-primary w-100",onClick:s[6]||(s[6]=e=>g.value=!0)},s[32]||(s[32]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),v(" إضافة منتج يدوياً ")]))])]),d(l).items.length>0?(r(),a("div",Tt,[t("table",At,[s[37]||(s[37]=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"المنتج"),t("th",null,"الكمية"),t("th",null,"سعر التكلفة"),t("th",null,"سعر البيع"),t("th",null,"المجموع"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(r(!0),a(E,null,P(d(l).items,(e,k)=>(r(),a("tr",{key:k},[t("td",null,[t("div",Bt,[t("img",{src:X(e.product),alt:e.product.name,class:"product-thumb me-2",onError:Y},null,40,Nt),t("div",null,[t("strong",null,i(e.product.name),1),s[33]||(s[33]=t("br",null,null,-1)),t("small",Kt,i(e.product.barcode||"غير محدد"),1)])])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":b=>e.quantity=b,onInput:b=>$(k),min:"1",style:{width:"80px"}},null,40,Lt),[[c,e.quantity,void 0,{number:!0}]])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":b=>e.cost_price=b,onInput:b=>$(k),step:"0.01",min:"0",style:{width:"100px"}},null,40,Ot),[[c,e.cost_price,void 0,{number:!0}]])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":b=>e.sales_price=b,step:"0.01",min:"0",style:{width:"100px"}},null,8,Qt),[[c,e.sales_price,void 0,{number:!0}]])]),t("td",null,[t("strong",null,i(e.total.toFixed(2))+" "+i(d(l).currency),1)]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:b=>W(k)},s[34]||(s[34]=[t("i",{class:"bi bi-trash"},null,-1)]),8,zt)])]))),128))]),t("tfoot",Gt,[t("tr",null,[s[35]||(s[35]=t("th",{colspan:"4",class:"text-end"},"المجموع الكلي:",-1)),t("th",null,i(A.value.toFixed(2))+" "+i(d(l).currency),1),s[36]||(s[36]=t("th",null,null,-1))])])])])):(r(),a("div",Ht,s[38]||(s[38]=[t("i",{class:"bi bi-box-seam display-1 text-muted"},null,-1),t("h5",{class:"text-muted mt-3"},"لم يتم إضافة أي منتجات",-1),t("p",{class:"text-muted"},"ابحث عن المنتجات أو أضفها يدوياً لبدء إنشاء الفاتورة",-1)])))])]),t("div",Jt,[t("div",Rt,[s[40]||(s[40]=t("label",{class:"form-label"},"ملاحظات",-1)),u(t("textarea",{class:"form-control","onUpdate:modelValue":s[7]||(s[7]=e=>d(l).notes=e),rows:"3",placeholder:"أي ملاحظات إضافية..."},null,512),[[c,d(l).notes]])]),t("div",Wt,[t("div",Xt,[u(t("input",{class:"form-check-input",type:"checkbox",id:"withdrawFromCashbox","onUpdate:modelValue":s[8]||(s[8]=e=>d(l).withdraw_from_cashbox=e)},null,512),[[rt,d(l).withdraw_from_cashbox]]),s[41]||(s[41]=t("label",{class:"form-check-label",for:"withdrawFromCashbox"}," سحب من الصندوق ",-1))]),d(l).withdraw_from_cashbox?(r(),a("div",Yt,[s[42]||(s[42]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),v(" سيتم سحب "+i(A.value.toFixed(2))+" "+i(d(l).currency)+" من الصندوق الرئيسي ",1)])):y("",!0)])]),t("div",Zt,[M(d(D),{href:o.route("purchase-invoices.index"),class:"btn btn-secondary"},{default:F(()=>s[43]||(s[43]=[t("i",{class:"bi bi-arrow-right me-2"},null,-1),v(" إلغاء ")])),_:1},8,["href"]),t("button",{type:"submit",class:"btn btn-primary",disabled:d(l).items.length===0||x.value},[x.value?(r(),a("span",ss)):(r(),a("i",es)),v(" "+i(x.value?"جاري الحفظ...":"حفظ الفاتورة"),1)],8,ts)])],32)])])]),w.value?(r(),a("div",os,[t("div",ls,[t("div",ns,[t("div",rs,[s[45]||(s[45]=t("h5",{class:"modal-title"},"إضافة مورد جديد",-1)),t("button",{type:"button",class:"btn-close",onClick:s[9]||(s[9]=e=>w.value=!1)})]),t("div",is,[t("form",{onSubmit:j(O,["prevent"])},[t("div",as,[s[46]||(s[46]=t("label",{class:"form-label"},"اسم المورد",-1)),u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[10]||(s[10]=e=>p.name=e),required:""},null,512),[[c,p.name]])]),t("div",ds,[s[47]||(s[47]=t("label",{class:"form-label"},"رقم الهاتف",-1)),u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=e=>p.phone=e)},null,512),[[c,p.phone]])])],32)]),t("div",us,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[12]||(s[12]=e=>w.value=!1)}," إلغاء "),t("button",{type:"button",class:"btn btn-primary",onClick:O}," إضافة المورد ")])])])])):y("",!0),g.value?(r(),a("div",cs,[t("div",ms,[t("div",ps,[t("div",bs,[s[48]||(s[48]=t("h5",{class:"modal-title"},"إضافة منتج يدوياً",-1)),t("button",{type:"button",class:"btn-close",onClick:s[13]||(s[13]=e=>g.value=!1)})]),t("div",vs,[t("form",{onSubmit:j(L,["prevent"])},[t("div",fs,[s[50]||(s[50]=t("label",{class:"form-label"},"اختر المنتج",-1)),u(t("select",{class:"form-select","onUpdate:modelValue":s[14]||(s[14]=e=>n.product_id=e),required:""},[s[49]||(s[49]=t("option",{value:""},"اختر منتج...",-1)),(r(!0),a(E,null,P(S.products,e=>(r(),a("option",{key:e.id,value:e.id},i(e.name)+" - "+i(e.barcode||"غير محدد"),9,ys))),128))],512),[[z,n.product_id]])]),t("div",_s,[t("div",hs,[t("div",ws,[s[51]||(s[51]=t("label",{class:"form-label"},"الكمية",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[15]||(s[15]=e=>n.quantity=e),min:"1",required:""},null,512),[[c,n.quantity,void 0,{number:!0}]])])]),t("div",gs,[t("div",xs,[s[52]||(s[52]=t("label",{class:"form-label"},"سعر التكلفة",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[16]||(s[16]=e=>n.cost_price=e),step:"0.01",min:"0",required:""},null,512),[[c,n.cost_price,void 0,{number:!0}]])])])]),t("div",ks,[s[53]||(s[53]=t("label",{class:"form-label"},"سعر البيع",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[17]||(s[17]=e=>n.sales_price=e),step:"0.01",min:"0",required:""},null,512),[[c,n.sales_price,void 0,{number:!0}]])])],32)]),t("div",qs,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[18]||(s[18]=e=>g.value=!1)}," إلغاء "),t("button",{type:"button",class:"btn btn-primary",onClick:L}," إضافة المنتج ")])])])])):y("",!0),w.value||g.value?(r(),a("div",Cs)):y("",!0)]),_:1},8,["translations"]))}},$s=at(Vs,[["__scopeId","data-v-b32a4020"]]);export{$s as default};
