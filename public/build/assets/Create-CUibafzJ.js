import{r as y,T as j,x as q,k as U,B as E,C as F,a as r,c as Q,w as L,b as t,t as n,i as p,d as $,j as H,u as k,e as i,F as O,g as z,l as w,y as x,f as b}from"./app-DRzDNF4B.js";import{_ as G}from"./AuthenticatedLayout-BqMLf6Qf.js";import{_ as J}from"./InputError-SPvZPJUm.js";import{C as M}from"./vue-select-B_P9kXfP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"pagetitle dark:text-white"},R={class:"dark:text-white"},W={class:"breadcrumb"},X={class:"breadcrumb-item"},Y={class:"breadcrumb-item active dark:text-white"},Z={class:"section dashboard"},tt={class:"row"},et={class:"col-lg-12"},st={class:"card"},ot={class:"card-body"},at={class:"card-title"},nt={class:"row mb-3"},lt={for:"customerSelect",class:"col-sm-2 col-form-label"},rt={class:"col-sm-10"},ct={key:0,class:"row mb-3"},it={for:"productTable",class:"col-sm-2 col-form-label"},dt={class:"col-sm-10"},ut={class:"table"},mt=["onInput","onUpdate:modelValue","max"],ht=["onUpdate:modelValue"],vt=["value"],_t=["onClick"],pt={class:"row"},bt={class:"col-md-6"},ft={class:"col-md-6"},yt={class:"text-center"},kt=["disabled"],wt={key:0,class:"bi bi-save"},xt={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Lt={__name:"Create",props:{products:Array,customers:Array,translations:Object},setup(o){const g=y(""),c=y(!1),d=y(null),u=o,m=j({customer_id:"",items:[],log:[],total_amount:0}),h=q([]),B=q([]),I=U(()=>g.value?u.customers.filter(e=>{const s=g.value.toLowerCase();return e.name.toLowerCase().includes(s)||e.phone.includes(s)}):u.customers),P=e=>{const s=u.products.find(_=>_.id===e.product_id);s&&(e.price=s.price,e.max_quantity=s.max_quantity)},S=e=>{const s=u.products.find(_=>_.id===e.product_id);s&&e.quantity>s.max_quantity&&(e.quantity=s.max_quantity)},f=U(()=>h.reduce((e,s)=>e+s.quantity*s.price,0));E(f,e=>{m.total_amount=e});const A=()=>{h.push({product_id:"",quantity:1,price:0}),v("product_added")},N=e=>{h.splice(e,1),v("product_removed")},T=e=>{console.log(e),d.value=e,m.customer_id=e?e.id:null,v(`customer_selected ${e?e.name:""}`)},v=e=>{const s=new Date().toLocaleString();B.push({message:e,timestamp:s})},D=()=>{c.value=!0,m.items=h,m.post(route("orders.store"),{onSuccess:()=>{c.value=!1,v("invoice_saved")},onError:()=>{c.value=!1,v("invoice_save_failed")}})};return(e,s)=>{const _=F("Link");return r(),Q(G,{translations:o.translations},{default:L(()=>{var V;return[t("div",K,[t("h1",R,n(o.translations.invoice),1),t("nav",null,[t("ol",W,[t("li",X,[p(_,{class:"nav-link dark:text-white",href:e.route("dashboard")},{default:L(()=>[$(n(o.translations.Home),1)]),_:1},8,["href"])]),t("li",Y,n(o.translations.invoice),1)])])]),t("section",Z,[t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("h5",at,n(o.translations.create_invoice),1),t("form",{onSubmit:H(D,["prevent"]),class:"row g-3"},[t("div",nt,[t("label",lt,n(o.translations.client),1),t("div",rt,[p(k(M),{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=a=>d.value=a),options:I.value,label:"name","track-by":"id",reduce:a=>({id:a.id,name:a.name}),onMouseleave:s[1]||(s[1]=a=>T(d.value)),clearable:!0,placeholder:o.translations.select_customer},null,8,["modelValue","options","reduce","placeholder"]),p(J,{message:k(m).errors.customer},null,8,["message"])])]),d.value?(r(),i("div",ct,[t("label",it,n(o.translations.products),1),t("div",dt,[t("table",ut,[t("thead",null,[t("tr",null,[t("th",null,n(o.translations.product),1),t("th",null,n(o.translations.quantity),1),t("th",null,n(o.translations.price),1),t("th",null,n(o.translations.total),1),t("th",null,n(o.translations.actions),1)])]),t("tbody",null,[(r(!0),i(O,null,z(h,(a,C)=>(r(),i("tr",{key:C},[p(k(M),{modelValue:a.product_id,"onUpdate:modelValue":l=>a.product_id=l,options:o.products,label:"name",reduce:l=>l.id,placeholder:o.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:l=>P(a)},null,8,["modelValue","onUpdate:modelValue","options","reduce","placeholder","onMouseleave"]),t("td",null,[w(t("input",{type:"number",onInput:l=>S(a),"onUpdate:modelValue":l=>a.quantity=l,min:"1",max:a.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,mt),[[x,a.quantity]])]),t("td",null,[w(t("input",{type:"number","onUpdate:modelValue":l=>a.price=l,min:"0",class:"form-control",placeholder:"Price"},null,8,ht),[[x,a.price]])]),t("td",null,[t("input",{type:"number",value:a.quantity*a.price,class:"form-control",disabled:""},null,8,vt)]),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:l=>N(C)},s[3]||(s[3]=[t("i",{class:"bi bi-trash"},null,-1)]),8,_t)])]))),128))])]),(V=o.products)!=null&&V.length?(r(),i("button",{key:0,type:"button",class:"btn btn-primary",onClick:A},n(o.translations.add_product),1)):b("",!0)])])):b("",!0),t("div",pt,[t("div",bt,[t("strong",null,n(u.translations.total)+":",1)]),t("div",ft,[w(t("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=a=>f.value=a),class:"form-control",readonly:""},null,512),[[x,f.value]])])]),t("div",yt,[t("button",{type:"submit",class:"btn btn-primary",disabled:c.value},[$(n(o.translations.save)+" Â  ",1),c.value?b("",!0):(r(),i("i",wt)),c.value?(r(),i("span",xt)):b("",!0)],8,kt)])],32)])])])])])]}),_:1},8,["translations"])}}};export{Lt as default};
