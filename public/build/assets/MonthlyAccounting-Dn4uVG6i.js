import{r as h,k as R,o as V,a as i,h as q,w as D,b as t,n as f,c as d,d as _,t as e,e as c,F as k,f as w,l as C,A as j,x as L,g as M}from"./app-B4ECXZ10.js";import{A as B}from"./AuthenticatedLayout-BdmISpKo.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"section"},K={class:"row"},U={class:"col-lg-12"},X={class:"card"},H={class:"card-body"},J={class:"nav nav-tabs",id:"monthlyTabs",role:"tablist"},z={class:"nav-item",role:"presentation"},I={class:"nav-item",role:"presentation"},G={class:"nav-item",role:"presentation"},Q={class:"tab-content mt-4"},W={key:0,class:"tab-pane fade show active"},Z={class:"row"},tt={class:"col-md-8"},st={class:"card"},ot={class:"card-header"},et={class:"card-title mb-0"},lt={class:"card-body"},nt={class:"row"},at={class:"col-md-6"},it={class:"info-item"},dt={class:"value"},rt={class:"info-item"},ct={class:"value"},ut={class:"info-item"},vt={class:"value"},mt={class:"info-item"},bt={class:"value text-danger"},_t={class:"info-item"},ht={class:"value text-danger"},yt={class:"col-md-6"},ft={class:"info-item"},pt={class:"value"},gt={class:"info-item"},kt={class:"value"},wt={class:"info-item"},Mt={class:"value text-success"},Ct={class:"mt-4"},xt={class:"row"},Tt={class:"col-md-6"},St={class:"info-item"},$t={class:"value"},jt={class:"col-md-6"},At={class:"info-item"},Ot={class:"value"},Nt={class:"mt-4"},Ft={class:"row"},Et={class:"col-md-6"},Rt={class:"info-item"},Vt={class:"value text-danger"},qt={class:"col-md-6"},Dt={class:"info-item"},Lt={class:"value text-danger"},Bt={key:0,class:"mt-3"},Pt={class:"text-muted"},Yt={class:"col-md-4"},Kt={class:"card"},Ut={class:"card-body"},Xt={key:0,class:"d-grid gap-2"},Ht={key:1,class:"alert alert-info"},Jt={class:"mt-3"},zt=["disabled"],It={key:1,class:"tab-pane fade show active"},Gt={class:"card"},Qt={class:"card-body"},Wt={class:"table-responsive"},Zt={class:"table table-striped"},ts={class:"btn-group",role:"group"},ss=["onClick"],os=["onClick"],es={class:"d-flex justify-content-center mt-3"},ls={class:"pagination"},ns=["onClick","innerHTML","disabled"],as={key:2,class:"tab-pane fade show active"},is={class:"card"},ds={class:"card-body"},rs={class:"row mb-3"},cs={class:"col-md-4"},us=["value"],vs={class:"col-md-4"},ms=["value"],bs={class:"col-md-4"},_s=["disabled"],hs={key:0,class:"mt-4"},ys={class:"card"},fs={class:"card-header"},ps={class:"card-title mb-0"},gs={class:"card-body"},ks={class:"row"},ws={class:"col-md-6"},Ms={class:"info-item"},Cs={class:"value"},xs={class:"info-item"},Ts={class:"value"},Ss={class:"info-item"},$s={class:"value"},js={class:"col-md-6"},As={class:"info-item"},Os={class:"value"},Ns={class:"info-item"},Fs={class:"value"},Es={class:"info-item"},Rs={class:"value text-success"},Vs={key:0,class:"modal fade show d-block",tabindex:"-1"},qs={class:"modal-dialog"},Ds={class:"modal-content"},Ls={class:"modal-header"},Bs={class:"modal-body"},Ps={class:"mb-3"},Ys={class:"modal-footer"},Ks=["disabled"],Us={key:0,class:"spinner-border spinner-border-sm me-2"},Xs={key:1,class:"modal-backdrop fade show"},Hs={__name:"MonthlyAccounting",props:{translations:Object,activeTab:String,currentMonth:Object,monthlyAccounts:Object,monthlyReport:Object},setup(l){const x=l,r=h(x.activeTab||"current"),y=h(!1),p=h(""),g=h(!1),u=h(""),v=h(""),m=h(x.monthlyReport),A=R(()=>{const n=new Date().getFullYear();return Array.from({length:5},(s,o)=>n-o)}),T=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],a=(n,s="dollar")=>{if(n==null)return"0.00";const o=s==="dollar"?"$":"د.ع";return`${parseFloat(n).toFixed(2)} ${o}`},O=async()=>{g.value=!0;try{const s=await(await fetch(route("decoration.monthly.close"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({notes:p.value})})).json();s.success?(y.value=!1,p.value="",M.reload()):alert(s.message||"حدث خطأ أثناء إغلاق الشهر")}catch(n){console.error("Error closing month:",n),alert("حدث خطأ أثناء إغلاق الشهر")}finally{g.value=!1}},S=async n=>{try{const o=await(await fetch(route("decoration.monthly.recalculate",n),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();o.success?(alert("تم إعادة حساب البيانات بنجاح"),M.reload()):alert(o.message||"حدث خطأ أثناء إعادة حساب البيانات")}catch(s){console.error("Error recalculating data:",s),alert("حدث خطأ أثناء إعادة حساب البيانات")}},N=async(n,s)=>{try{const b=await(await fetch(route("decoration.monthly.payoutCommissions"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({year:n,month:s})})).json();b.success?(alert("تم دفع العمولات بنجاح"),M.reload()):alert(b.message||"حدث خطأ أثناء دفع العمولات")}catch(o){console.error("Error paying out commissions:",o),alert("حدث خطأ أثناء دفع العمولات")}},F=(n,s)=>{u.value=n,v.value=s,r.value="reports",$()},$=async()=>{if(!(!u.value||!v.value))try{const s=await(await fetch(route("decoration.monthly.report",{year:u.value,month:v.value}))).json();s.success?m.value=s.data:alert(s.message||"لا توجد بيانات لهذا الشهر")}catch(n){console.error("Error loading monthly report:",n),alert("حدث خطأ أثناء تحميل التقرير")}},E=n=>{n&&M.visit(n)};return V(()=>{const n=new Date;u.value=n.getFullYear(),v.value=n.getMonth()+1}),(n,s)=>(i(),q(B,{translations:l.translations},{default:D(()=>[t("section",Y,[t("div",K,[t("div",U,[t("div",X,[t("div",H,[t("ul",J,[t("li",z,[t("button",{class:f(["nav-link",{active:r.value==="current"}]),onClick:s[0]||(s[0]=o=>r.value="current"),type:"button"}," الشهر الحالي ",2)]),t("li",I,[t("button",{class:f(["nav-link",{active:r.value==="history"}]),onClick:s[1]||(s[1]=o=>r.value="history"),type:"button"}," السجل الشهري ",2)]),t("li",G,[t("button",{class:f(["nav-link",{active:r.value==="reports"}]),onClick:s[2]||(s[2]=o=>r.value="reports"),type:"button"}," التقارير ",2)])]),t("div",Q,[r.value==="current"?(i(),d("div",W,[t("div",Z,[t("div",tt,[t("div",st,[t("div",ot,[t("h5",et,[_(" الشهر الحالي: "+e(l.currentMonth.month_name)+" "+e(l.currentMonth.year)+" ",1),t("span",{class:f(["badge","bg-"+(l.currentMonth.status==="open"?"success":"secondary")])},e(l.currentMonth.status_name),3)])]),t("div",lt,[t("div",nt,[t("div",at,[t("div",it,[s[11]||(s[11]=t("label",null,"عدد الطلبات:",-1)),t("span",dt,e(l.currentMonth.total_orders),1)]),t("div",rt,[s[12]||(s[12]=t("label",null,"إجمالي مبلغ الطلبات:",-1)),t("span",ct,e(a(l.currentMonth.total_orders_amount)),1)]),t("div",ut,[s[13]||(s[13]=t("label",null,"إجمالي المدفوعات المستلمة:",-1)),t("span",vt,e(a(l.currentMonth.total_payments_received)),1)]),t("div",mt,[s[14]||(s[14]=t("label",null,"عمولات الموظفين (دولار):",-1)),t("span",bt,e(a(l.currentMonth.total_commissions_usd,"dollar")),1)]),t("div",_t,[s[15]||(s[15]=t("label",null,"عمولات الموظفين (دينار):",-1)),t("span",ht,e(a(l.currentMonth.total_commissions_iqd,"dinar")),1)])]),t("div",yt,[t("div",ft,[s[16]||(s[16]=t("label",null,"الرصيد بالدولار:",-1)),t("span",pt,e(a(l.currentMonth.total_balance_dollar,"dollar")),1)]),t("div",gt,[s[17]||(s[17]=t("label",null,"الرصيد بالدينار:",-1)),t("span",kt,e(a(l.currentMonth.total_balance_dinar,"dinar")),1)]),t("div",wt,[s[18]||(s[18]=t("label",null,"صافي الربح:",-1)),t("span",Mt,e(a(l.currentMonth.net_profit_dollar)),1)])])]),t("div",Ct,[s[21]||(s[21]=t("h6",null,"الرصيد الافتتاحي:",-1)),t("div",xt,[t("div",Tt,[t("div",St,[s[19]||(s[19]=t("label",null,"الدولار:",-1)),t("span",$t,e(a(l.currentMonth.opening_balance_dollar,"dollar")),1)])]),t("div",jt,[t("div",At,[s[20]||(s[20]=t("label",null,"الدينار:",-1)),t("span",Ot,e(a(l.currentMonth.opening_balance_dinar,"dinar")),1)])])])]),t("div",Nt,[s[24]||(s[24]=t("h6",null,"عمولات الموظفين للشهر:",-1)),t("div",Ft,[t("div",Et,[t("div",Rt,[s[22]||(s[22]=t("label",null,"بالدولار:",-1)),t("span",Vt,e(a(l.currentMonth.total_commissions_usd,"dollar")),1)])]),t("div",qt,[t("div",Dt,[s[23]||(s[23]=t("label",null,"بالدينار:",-1)),t("span",Lt,e(a(l.currentMonth.total_commissions_iqd,"dinar")),1)])])])]),l.currentMonth.notes?(i(),d("div",Bt,[s[25]||(s[25]=t("h6",null,"ملاحظات:",-1)),t("p",Pt,e(l.currentMonth.notes),1)])):c("",!0)])])]),t("div",Yt,[t("div",Kt,[s[32]||(s[32]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"إجراءات الشهر")],-1)),t("div",Ut,[l.currentMonth.status==="open"?(i(),d("div",Xt,[t("button",{class:"btn btn-warning",onClick:s[3]||(s[3]=o=>y.value=!0)},s[26]||(s[26]=[t("i",{class:"bi bi-lock"},null,-1),_(" إغلاق الشهر ")])),t("button",{class:"btn btn-info",onClick:s[4]||(s[4]=o=>S(l.currentMonth.id))},s[27]||(s[27]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),_(" إعادة حساب البيانات ")]))])):(i(),d("div",Ht,s[28]||(s[28]=[t("i",{class:"bi bi-info-circle"},null,-1),_(" الشهر مغلق - لا يمكن إجراء تعديلات ")]))),t("div",Jt,[s[30]||(s[30]=t("h6",null,"دفع عمولات الموظفين",-1)),s[31]||(s[31]=t("p",{class:"text-muted"},"يمكن دفع العمولات المستحقة وتصفيتها للشهر القادم.",-1)),t("button",{class:"btn btn-outline-success w-100",onClick:s[5]||(s[5]=o=>N(l.currentMonth.year,l.currentMonth.month)),disabled:l.currentMonth.status!=="open"},s[29]||(s[29]=[t("i",{class:"bi bi-cash-coin"},null,-1),_(" دفع العمولات للشهر ")]),8,zt)])])])])])])):c("",!0),r.value==="history"?(i(),d("div",It,[t("div",Gt,[s[36]||(s[36]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"السجل الشهري")],-1)),t("div",Qt,[t("div",Wt,[t("table",Zt,[s[35]||(s[35]=t("thead",null,[t("tr",null,[t("th",null,"الشهر"),t("th",null,"السنة"),t("th",null,"الحالة"),t("th",null,"عدد الطلبات"),t("th",null,"إجمالي المبلغ"),t("th",null,"المدفوعات"),t("th",null,"صافي الربح"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(i(!0),d(k,null,w(l.monthlyAccounts.data,o=>(i(),d("tr",{key:o.id},[t("td",null,e(o.month_name),1),t("td",null,e(o.year),1),t("td",null,[t("span",{class:f(["badge","bg-"+(o.status==="open"?"success":"secondary")])},e(o.status_name),3)]),t("td",null,e(o.total_orders),1),t("td",null,e(a(o.total_orders_amount)),1),t("td",null,e(a(o.total_payments_received)),1),t("td",null,e(a(o.net_profit_dollar)),1),t("td",null,[t("div",ts,[t("button",{class:"btn btn-sm btn-outline-info",onClick:b=>F(o.year,o.month)},s[33]||(s[33]=[t("i",{class:"bi bi-eye"},null,-1)]),8,ss),o.status==="open"?(i(),d("button",{key:0,class:"btn btn-sm btn-outline-warning",onClick:b=>S(o.id)},s[34]||(s[34]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,os)):c("",!0)])])]))),128))])])]),t("div",es,[t("nav",null,[t("ul",ls,[(i(!0),d(k,null,w(l.monthlyAccounts.links,o=>(i(),d("li",{key:o.label,class:f(["page-item",{active:o.active,disabled:!o.url}])},[t("button",{class:"page-link",onClick:b=>E(o.url),innerHTML:o.label,disabled:!o.url},null,8,ns)],2))),128))])])])])])])):c("",!0),r.value==="reports"?(i(),d("div",as,[t("div",is,[s[48]||(s[48]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"تقارير شهرية")],-1)),t("div",ds,[t("div",rs,[t("div",cs,[C(t("select",{"onUpdate:modelValue":s[6]||(s[6]=o=>u.value=o),class:"form-select"},[s[37]||(s[37]=t("option",{value:""},"اختر السنة",-1)),(i(!0),d(k,null,w(A.value,o=>(i(),d("option",{key:o,value:o},e(o),9,us))),128))],512),[[j,u.value]])]),t("div",vs,[C(t("select",{"onUpdate:modelValue":s[7]||(s[7]=o=>v.value=o),class:"form-select"},[s[38]||(s[38]=t("option",{value:""},"اختر الشهر",-1)),(i(),d(k,null,w(T,(o,b)=>t("option",{key:b,value:b+1},e(o),9,ms)),64))],512),[[j,v.value]])]),t("div",bs,[t("button",{class:"btn btn-primary",onClick:$,disabled:!u.value||!v.value},s[39]||(s[39]=[t("i",{class:"bi bi-search"},null,-1),_(" عرض التقرير ")]),8,_s)])]),m.value?(i(),d("div",hs,[t("div",ys,[t("div",fs,[t("h5",ps," تقرير "+e(T[v.value-1])+" "+e(u.value),1)]),t("div",gs,[t("div",ks,[t("div",ws,[s[43]||(s[43]=t("h6",null,"ملخص الشهر:",-1)),t("div",Ms,[s[40]||(s[40]=t("label",null,"عدد الطلبات:",-1)),t("span",Cs,e(m.value.monthly_account.total_orders),1)]),t("div",xs,[s[41]||(s[41]=t("label",null,"إجمالي المبلغ:",-1)),t("span",Ts,e(a(m.value.monthly_account.total_orders_amount)),1)]),t("div",Ss,[s[42]||(s[42]=t("label",null,"المدفوعات المستلمة:",-1)),t("span",$s,e(a(m.value.monthly_account.total_payments_received)),1)])]),t("div",js,[s[47]||(s[47]=t("h6",null,"الرصيد:",-1)),t("div",As,[s[44]||(s[44]=t("label",null,"الدولار:",-1)),t("span",Os,e(a(m.value.monthly_account.total_balance_dollar,"dollar")),1)]),t("div",Ns,[s[45]||(s[45]=t("label",null,"الدينار:",-1)),t("span",Fs,e(a(m.value.monthly_account.total_balance_dinar,"dinar")),1)]),t("div",Es,[s[46]||(s[46]=t("label",null,"صافي الربح:",-1)),t("span",Rs,e(a(m.value.monthly_account.net_profit_dollar)),1)])])])])])])):c("",!0)])])])):c("",!0)])])])])])]),y.value?(i(),d("div",Vs,[t("div",qs,[t("div",Ds,[t("div",Ls,[s[49]||(s[49]=t("h5",{class:"modal-title"},"إغلاق الشهر",-1)),t("button",{type:"button",class:"btn-close",onClick:s[8]||(s[8]=o=>y.value=!1)})]),t("div",Bs,[s[51]||(s[51]=t("div",{class:"alert alert-warning"},[t("i",{class:"bi bi-exclamation-triangle"}),_(" هل أنت متأكد من إغلاق الشهر؟ لا يمكن التراجع عن هذا الإجراء. ")],-1)),t("div",Ps,[s[50]||(s[50]=t("label",{for:"closeNotes",class:"form-label"},"ملاحظات (اختياري)",-1)),C(t("textarea",{id:"closeNotes","onUpdate:modelValue":s[9]||(s[9]=o=>p.value=o),class:"form-control",rows:"3",placeholder:"أضف ملاحظات حول إغلاق الشهر..."},null,512),[[L,p.value]])])]),t("div",Ys,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=o=>y.value=!1)},"إلغاء"),t("button",{type:"button",class:"btn btn-warning",onClick:O,disabled:g.value},[g.value?(i(),d("span",Us)):c("",!0),s[52]||(s[52]=_(" إغلاق الشهر "))],8,Ks)])])])])):c("",!0),y.value?(i(),d("div",Xs)):c("",!0)]),_:1},8,["translations"]))}},Gs=P(Hs,[["__scopeId","data-v-d84450ad"]]);export{Gs as default};
