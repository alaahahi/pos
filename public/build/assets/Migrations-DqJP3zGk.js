import{r as h,o as O,a as l,c as M,w,b as s,t as a,d,e as n,f as c,F as x,g as p,n as y,h as f}from"./app-rrtI315f.js";import{_ as A}from"./AuthenticatedLayout-CiFcEoWJ.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"d-flex justify-content-between align-items-center"},B={class:"font-semibold text-xl text-gray-800 leading-tight"},D={class:"py-12"},E={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},P={class:"card mb-4"},q={class:"card-body"},z={class:"row g-3"},I={class:"col-md-3"},K=["disabled"],V={key:0,class:"bi bi-play-circle"},X={key:1,class:"spinner-border spinner-border-sm me-2"},$={key:2,class:"badge bg-light text-dark ms-2"},L={class:"col-md-3"},G=["disabled"],H={key:0,class:"bi bi-arrow-counterclockwise"},J={key:1,class:"spinner-border spinner-border-sm me-2"},Q={class:"col-md-3"},U=["disabled"],W={key:0,class:"bi bi-arrow-repeat"},Y={key:1,class:"spinner-border spinner-border-sm me-2"},Z={class:"col-md-3"},ss=["disabled"],ts={class:"card mb-4"},es={class:"card-header"},as={class:"card-title mb-0"},ls={class:"card-body"},ns={key:0},os={class:"text-primary"},is={class:"table-responsive"},rs={class:"table table-sm table-hover"},ds={key:0,class:"badge bg-success"},cs={key:1,class:"badge bg-warning"},us={key:0,class:"badge bg-info"},bs={key:1,class:"text-muted"},ms={class:"row mt-3"},vs={class:"col-md-6"},gs={class:"alert alert-warning"},hs={class:"col-md-6"},fs={class:"alert alert-success"},ys={key:1,class:"text-center text-muted py-4"},_s={class:"card"},ks={class:"card-header"},ws={class:"card-title mb-0"},xs={class:"card-body"},ps={class:"table-responsive"},Cs={class:"table table-striped table-hover"},Ss={class:"badge bg-info"},js={class:"badge bg-secondary"},Ts={class:"text-muted"},Ns={class:"text-muted"},Os={key:0,class:"modal-mask"},Ms={class:"modal-wrapper"},As={class:"modal-container modal-lg"},Fs={class:"modal-header"},Rs={class:"modal-body"},Bs={key:0,class:"alert alert-info"},Ds={key:1,class:"bg-dark text-light p-3 rounded",style:{"font-family":"monospace","white-space":"pre-wrap","max-height":"400px","overflow-y":"auto"}},Es={class:"modal-footer"},Ps={__name:"Migrations",props:{migrations:Object,tables:Array,translations:Object},setup(e){const _=e,o=h(!1),u=h(!1),g=h(""),b=h(""),m=h(!1),v=h(""),C=async()=>{if(confirm("هل أنت متأكد من تشغيل المايكريشنات المعلقة؟")){o.value=!0;try{const t=await(await fetch("/admin/migrations/run",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(r){g.value="حدث خطأ في الاتصال",b.value=r.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{o.value=!1}}},S=async()=>{if(confirm(_.translations.confirm_rollback)){o.value=!0;try{const t=await(await fetch("/admin/migrations/rollback",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(r){g.value="حدث خطأ في الاتصال",b.value=r.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{o.value=!1}}},j=async()=>{if(confirm(_.translations.confirm_refresh)){o.value=!0;try{const t=await(await fetch("/admin/migrations/refresh",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();g.value=t.message,b.value=t.output?t.output.join(`
`):"",m.value=t.success,v.value=t.suggestion||"",u.value=!0,t.success&&f.reload()}catch(r){g.value="حدث خطأ في الاتصال",b.value=r.message,m.value=!1,v.value="تحقق من اتصال الإنترنت وحاول مرة أخرى",u.value=!0}finally{o.value=!1}}},k=()=>{f.reload()},T=r=>r?new Date(r).toLocaleString("ar-SA"):"غير محدد",N=r=>new Intl.NumberFormat("ar-SA").format(r);return O(()=>{setInterval(()=>{o.value||k()},3e4)}),(r,t)=>(l(),M(A,{translations:e.translations},{header:w(()=>[s("div",R,[s("h2",B,a(e.translations.migration_management),1)])]),default:w(()=>[s("div",D,[s("div",E,[s("div",P,[t[3]||(t[3]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-gear"}),d(" إجراءات المايكريشنات ")])],-1)),s("div",q,[s("div",z,[s("div",I,[s("button",{onClick:C,disabled:o.value||e.migrations.pending.length===0,class:"btn btn-success w-100"},[o.value?c("",!0):(l(),n("i",V)),o.value?(l(),n("span",X)):c("",!0),d(" "+a(e.translations.run_pending)+" ",1),e.migrations.pending.length>0?(l(),n("span",$,a(e.migrations.pending.length),1)):c("",!0)],8,K)]),s("div",L,[s("button",{onClick:S,disabled:o.value||e.migrations.executed.length===0,class:"btn btn-warning w-100"},[o.value?c("",!0):(l(),n("i",H)),o.value?(l(),n("span",J)):c("",!0),d(" "+a(e.translations.rollback_last),1)],8,G)]),s("div",Q,[s("button",{onClick:j,disabled:o.value,class:"btn btn-danger w-100"},[o.value?c("",!0):(l(),n("i",W)),o.value?(l(),n("span",Y)):c("",!0),d(" "+a(e.translations.refresh_all),1)],8,U)]),s("div",Z,[s("button",{onClick:k,disabled:o.value,class:"btn btn-outline-primary w-100"},t[2]||(t[2]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1),d(" تحديث البيانات ")]),8,ss)])])])]),s("div",ts,[s("div",es,[s("h5",as,[t[4]||(t[4]=s("i",{class:"bi bi-list-check"},null,-1)),d(" "+a(e.translations.migration_status),1)])]),s("div",ls,[e.migrations.all&&e.migrations.all.length>0?(l(),n("div",ns,[s("h6",os,[t[5]||(t[5]=s("i",{class:"bi bi-list-ul"},null,-1)),d(" جميع المايكريشنات ("+a(e.migrations.all.length)+") ",1)]),s("div",is,[s("table",rs,[s("thead",null,[s("tr",null,[s("th",null,a(e.translations.migration_name),1),t[6]||(t[6]=s("th",null,"الحالة",-1)),s("th",null,a(e.translations.batch),1)])]),s("tbody",null,[(l(!0),n(x,null,p(e.migrations.all,i=>(l(),n("tr",{key:i.migration,class:y({"table-warning":i.status==="Pending","table-success":i.status==="Ran"})},[s("td",null,[s("code",null,a(i.migration),1)]),s("td",null,[i.status==="Ran"?(l(),n("span",ds,t[7]||(t[7]=[s("i",{class:"bi bi-check-circle"},null,-1),d(" منفذ ")]))):(l(),n("span",cs,t[8]||(t[8]=[s("i",{class:"bi bi-clock"},null,-1),d(" معلق ")])))]),s("td",null,[i.batch!=="N/A"?(l(),n("span",us,a(i.batch),1)):(l(),n("span",bs,"-"))])],2))),128))])])])])):c("",!0),s("div",ms,[s("div",vs,[s("div",gs,[t[9]||(t[9]=s("i",{class:"bi bi-clock"},null,-1)),t[10]||(t[10]=s("strong",null,"المايكريشنات المعلقة:",-1)),d(" "+a(e.migrations.pending?e.migrations.pending.length:0),1)])]),s("div",hs,[s("div",fs,[t[11]||(t[11]=s("i",{class:"bi bi-check-circle"},null,-1)),t[12]||(t[12]=s("strong",null,"المايكريشنات المنفذة:",-1)),d(" "+a(e.migrations.executed?e.migrations.executed.length:0),1)])])]),!e.migrations.all||e.migrations.all.length===0?(l(),n("div",ys,t[13]||(t[13]=[s("i",{class:"bi bi-inbox display-4"},null,-1),s("p",{class:"mt-2"},"لا توجد مايكريشنات",-1)]))):c("",!0)])]),s("div",_s,[s("div",ks,[s("h5",ws,[t[14]||(t[14]=s("i",{class:"bi bi-table"},null,-1)),d(" "+a(e.translations.table_info),1)])]),s("div",xs,[s("div",ps,[s("table",Cs,[s("thead",null,[s("tr",null,[s("th",null,a(e.translations.table_name),1),s("th",null,a(e.translations.table_rows),1),s("th",null,a(e.translations.table_size),1),t[15]||(t[15]=s("th",null,"المحرك",-1)),t[16]||(t[16]=s("th",null,"الترميز",-1)),s("th",null,a(e.translations.last_modified),1)])]),s("tbody",null,[(l(!0),n(x,null,p(e.tables,i=>(l(),n("tr",{key:i.name},[s("td",null,[s("strong",null,a(i.name),1)]),s("td",null,[s("span",Ss,a(N(i.rows)),1)]),s("td",null,a(i.size),1),s("td",null,[s("span",js,a(i.engine),1)]),s("td",null,[s("small",Ts,a(i.collation),1)]),s("td",null,[s("small",Ns,a(T(i.updated)),1)])]))),128))])])])])]),u.value?(l(),n("div",Os,[s("div",Ms,[s("div",As,[s("div",Fs,[t[17]||(t[17]=s("h5",{class:"modal-title"},"نتيجة تنفيذ المايكريشن",-1)),s("button",{onClick:t[0]||(t[0]=i=>u.value=!1),class:"btn-close"})]),s("div",Rs,[s("div",{class:y(["alert",m.value?"alert-success":"alert-danger"])},[s("i",{class:y(["bi",m.value?"bi-check-circle":"bi-exclamation-triangle"])},null,2),d(" "+a(g.value),1)],2),v.value?(l(),n("div",Bs,[t[18]||(t[18]=s("i",{class:"bi bi-lightbulb"},null,-1)),t[19]||(t[19]=s("strong",null,"اقتراح:",-1)),d(" "+a(v.value),1)])):c("",!0),b.value?(l(),n("div",Ds,a(b.value),1)):c("",!0)]),s("div",Es,[s("button",{onClick:t[1]||(t[1]=i=>u.value=!1),class:"btn btn-secondary"},"إغلاق")])])])])):c("",!0)])])]),_:1},8,["translations"]))}},Ks=F(Ps,[["__scopeId","data-v-e3227fa2"]]);export{Ks as default};
