import{r as h,z as w,a as i,c as d,b as e,t as o,d as v,F as b,f as p,e as u,j as C,n as _,l as y,A as M,x as g,g as V,E as j}from"./app-rfKy2ZWt.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"modal-mask"},$={class:"modal-wrapper"},D={class:"modal-container"},B={class:"modal-header"},E={class:"modal-body"},F={key:0,class:"alert alert-danger mb-3",role:"alert"},N={class:"mb-0"},z={class:"mb-4"},T={class:"form-label fw-bold"},I={class:"row g-2"},L=["onClick"],q={key:0,class:"mb-3"},G={class:"form-label"},H={value:""},J=["value"],K={key:0,class:"invalid-feedback"},P={key:1,class:"mb-3"},Q={class:"form-label"},R={key:0,class:"invalid-feedback"},W={class:"mb-3"},X={class:"form-label"},Y=["placeholder"],Z={key:0,class:"invalid-feedback"},ee={class:"d-flex justify-content-center gap-2"},se=["disabled"],ae={key:0,class:"spinner-border spinner-border-sm me-2"},te={__name:"StatusUpdateModal",props:{order:Object,employees:Array,translations:Object},emits:["close","success"],setup(r,{emit:k}){const n=r,x=k,m=h(!1),t=h({}),s=w({status:n.order.status,assigned_employee_id:n.order.assigned_employee_id||"",paid_amount:n.order.paid_amount||0,notes:n.order.notes||""}),S=[{value:"created",label:n.translations.created,icon:"bi bi-plus-circle"},{value:"received",label:n.translations.received,icon:"bi bi-check-circle"},{value:"executing",label:n.translations.executing,icon:"bi bi-play-circle"},{value:"partial_payment",label:n.translations.partial_payment,icon:"bi bi-cash-coin"},{value:"full_payment",label:n.translations.full_payment,icon:"bi bi-credit-card"},{value:"completed",label:n.translations.completed,icon:"bi bi-check2-all"},{value:"cancelled",label:n.translations.cancelled,icon:"bi bi-x-circle"}],A=()=>{m.value=!0,t.value={};const c={};s.status&&s.status!==""&&(c.status=s.status),s.assigned_employee_id&&s.assigned_employee_id!==""&&(c.assigned_employee_id=s.assigned_employee_id),s.notes&&s.notes!==""&&(c.notes=s.notes),s.status==="partial_payment"&&s.paid_amount&&(c.paid_amount=s.paid_amount),V.patch(route("decoration.orders.status",n.order.id),c,{onSuccess:()=>{m.value=!1,j.post("/logs",{module_name:"Decoration Order",action:"Status Modal Submit",affected_record_id:n.order.id,updated_data:c}).catch(()=>{}),t.value={},x("success")},onError:l=>{m.value=!1,t.value=l,console.error("Status update errors:",l)}})};return(c,l)=>(i(),d("div",U,[e("div",$,[e("div",D,[e("div",B,[e("h3",null,o(r.translations.update_status),1),e("button",{onClick:l[0]||(l[0]=a=>c.$emit("close")),class:"btn-close"})]),e("div",E,[Object.keys(t.value).length>0?(i(),d("div",F,[l[5]||(l[5]=e("h6",{class:"alert-heading"},[e("i",{class:"bi bi-exclamation-triangle"}),v(" حدثت أخطاء: ")],-1)),e("ul",N,[(i(!0),d(b,null,p(t.value,(a,f)=>(i(),d("li",{key:f},o(Array.isArray(a)?a[0]:a),1))),128))])])):u("",!0),e("form",{onSubmit:C(A,["prevent"])},[e("div",z,[e("label",T,o(r.translations.change_status_to),1),e("div",I,[(i(),d(b,null,p(S,a=>e("div",{class:"col-6",key:a.value},[e("button",{type:"button",class:_(["btn w-100 status-btn",{"btn-primary":s.status===a.value,"btn-outline-secondary":s.status!==a.value}]),onClick:f=>s.status=a.value},[e("i",{class:_(a.icon)},null,2),v(" "+o(a.label),1)],10,L)])),64))])]),r.order.assigned_employee_id?u("",!0):(i(),d("div",q,[e("label",G,o(r.translations.assign_employee),1),y(e("select",{class:_(["form-select",{"is-invalid":t.value.assigned_employee_id}]),"onUpdate:modelValue":l[1]||(l[1]=a=>s.assigned_employee_id=a)},[e("option",H,o(r.translations.select_employee),1),(i(!0),d(b,null,p(r.employees,a=>(i(),d("option",{key:a.id,value:a.id},o(a.name),9,J))),128))],2),[[M,s.assigned_employee_id]]),t.value.assigned_employee_id?(i(),d("div",K,o(Array.isArray(t.value.assigned_employee_id)?t.value.assigned_employee_id[0]:t.value.assigned_employee_id),1)):u("",!0)])),s.status==="partial_payment"&&s.status!=="full_payment"?(i(),d("div",P,[e("label",Q,o(r.translations.paid_amount),1),y(e("input",{type:"number",step:"0.01",class:_(["form-control",{"is-invalid":t.value.paid_amount}]),"onUpdate:modelValue":l[2]||(l[2]=a=>s.paid_amount=a)},null,2),[[g,s.paid_amount]]),t.value.paid_amount?(i(),d("div",R,o(Array.isArray(t.value.paid_amount)?t.value.paid_amount[0]:t.value.paid_amount),1)):u("",!0)])):u("",!0),e("div",W,[e("label",X,o(r.translations.notes),1),y(e("textarea",{class:_(["form-control",{"is-invalid":t.value.notes}]),rows:"3","onUpdate:modelValue":l[3]||(l[3]=a=>s.notes=a),placeholder:r.translations.add_notes},null,10,Y),[[g,s.notes]]),t.value.notes?(i(),d("div",Z,o(Array.isArray(t.value.notes)?t.value.notes[0]:t.value.notes),1)):u("",!0)]),e("div",ee,[e("button",{type:"button",class:"btn btn-secondary text-center w-100",onClick:l[4]||(l[4]=a=>c.$emit("close"))},o(r.translations.cancel),1),e("button",{type:"submit",class:"btn btn-primary w-100 text-center",disabled:m.value},[m.value?(i(),d("span",ae)):u("",!0),v(" "+o(r.translations.update_status),1)],8,se)])],32)])])])]))}},ne=O(te,[["__scopeId","data-v-33d53edf"]]);export{ne as S};
