import{l as x,T,m as V,h as O,p as j,q as E,c as F,w as $,o as c,b as t,t as n,a as p,d as g,e as H,u as q,f as m,F as Q,s as z,g as y,i as C,x as U,L as G}from"./app-TgNgatPB.js";import{_ as J}from"./AuthenticatedLayout-Dri-m7YE.js";import{_ as K}from"./InputError-q16GEmKj.js";import{C as I}from"./vue-select-6L0hGXJp.js";import{_ as R}from"./ModalConfirmOrderAndPay-8n8ogfee.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"pagetitle dark:text-white"},X={class:"dark:text-white"},Y={class:"breadcrumb"},Z={class:"breadcrumb-item"},tt={class:"breadcrumb-item active dark:text-white"},et={class:"section dashboard"},ot={class:"row"},st={class:"col-lg-12"},at={class:"card"},nt={class:"card-body"},lt={class:"card-title"},rt={class:"row mb-3"},dt={for:"customerSelect",class:"col-sm-2 col-form-label"},it={class:"col-sm-10"},ct={key:0,class:"row mb-3"},ut={for:"productTable",class:"col-sm-2 col-form-label"},mt={class:"col-sm-10"},ht={class:"table"},vt=["onInput","onUpdate:modelValue","max"],_t=["onUpdate:modelValue"],bt=["value"],pt=["onClick"],ft={class:"row"},yt={class:"col-md-6"},wt={class:"col-md-6"},kt={class:"text-center"},xt=["disabled"],Vt={key:0,class:"bi bi-save"},gt={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Lt={__name:"Edit",props:{order:Object,products:Array,customers:Array,translations:Object},setup(a){const h=x(!1),w=x(!1),d=a,v=x(d.customers.find(e=>e.id===d.order.customer_id)||null),i=T({id:d.order.id,customer_id:d.order.customer_id,items:d.order.items||[],total_amount:d.order.total_amount||0}),_=V(i.items);V([]);const b=O(()=>_.reduce((e,o)=>e+o.quantity*o.price,0));j(b,e=>{i.total_amount=e});const M=()=>{_.push({product_id:"",quantity:1,price:0,canadd:"true"})},L=e=>{_.splice(e,1)},P=e=>{const o=d.products.find(l=>l.id===e.product_id);o&&(e.price=o.price)},A=e=>{const o=d.products.find(l=>l.id===e.product_id);o&&e.quantity>o.max_quantity&&(e.quantity=o.max_quantity)},D=e=>{v.value=e,i.customer_id=e?e.id:null},S=()=>{w.value=!0},B=V([]),k=e=>{const o=new Date().toLocaleString();B.push({message:e,timestamp:o})},N=async e=>{h.value=!0;const o={total_amount:i.total_amount,total_paid:e.amountDollar,customer_id:i.customer_id,date:e.date,notes:e.notes,items:_.reduce((l,u)=>{let s=l.find(f=>f.product_id===u.product_id);return s?s.quantity+=u.quantity:l.push(u),l},[])};try{const l=await G.put(route("orders.update",i.id),o);l.status===200||l.status===201?(k("invoice_saved"),window.location.href="/orders"):k("invoice_save_failed")}catch(l){console.error("خطأ أثناء حفظ الفاتورة:",l),k("invoice_save_failed")}finally{h.value=!1}};return(e,o)=>{const l=E("Link");return c(),F(J,{translations:a.translations},{default:$(()=>{var u;return[t("div",W,[t("h1",X,n(a.translations.edit_order),1),t("nav",null,[t("ol",Y,[t("li",Z,[p(l,{class:"nav-link dark:text-white",href:e.route("dashboard")},{default:$(()=>[g(n(a.translations.Home),1)]),_:1},8,["href"])]),t("li",tt,n(a.translations.edit_order),1)])])]),t("section",et,[t("div",ot,[t("div",st,[t("div",at,[t("div",nt,[t("h5",lt,n(a.translations.edit_order),1),t("form",{onSubmit:H(S,["prevent"]),class:"row g-3"},[t("div",rt,[t("label",dt,n(a.translations.client),1),t("div",it,[p(q(I),{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=s=>v.value=s),options:a.customers,label:"name","track-by":"id",reduce:s=>({id:s.id,name:s.name}),clearable:!0,placeholder:a.translations.select_customer,onMouseleave:o[1]||(o[1]=s=>D(v.value))},null,8,["modelValue","options","reduce","placeholder"]),p(K,{message:q(i).errors.customer},null,8,["message"])])]),v.value?(c(),m("div",ct,[t("label",ut,n(a.translations.products),1),t("div",mt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",null,n(a.translations.product),1),t("th",null,n(a.translations.quantity),1),t("th",null,n(a.translations.price),1),t("th",null,n(a.translations.total),1),t("th",null,n(a.translations.actions),1)])]),t("tbody",null,[(c(!0),m(Q,null,z(_,(s,f)=>(c(),m("tr",{key:f},[p(q(I),{modelValue:s.product_id,"onUpdate:modelValue":r=>s.product_id=r,options:a.products,label:"name",disabled:s.canadd!="true",reduce:r=>r.id,placeholder:a.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:r=>P(s)},null,8,["modelValue","onUpdate:modelValue","options","disabled","reduce","placeholder","onMouseleave"]),t("td",null,[C(t("input",{type:"number",onInput:r=>A(s),"onUpdate:modelValue":r=>s.quantity=r,min:"1",max:s.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,vt),[[U,s.quantity]])]),t("td",null,[C(t("input",{type:"number","onUpdate:modelValue":r=>s.price=r,min:"0",class:"form-control",placeholder:"Price"},null,8,_t),[[U,s.price]])]),t("td",null,[t("input",{type:"number",value:s.quantity*s.price,class:"form-control",disabled:""},null,8,bt)]),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:r=>L(f)},o[5]||(o[5]=[t("i",{class:"bi bi-trash"},null,-1)]),8,pt)])]))),128))])]),(u=a.products)!=null&&u.length?(c(),m("button",{key:0,type:"button",class:"btn btn-primary",onClick:M},n(a.translations.add_product),1)):y("",!0)])])):y("",!0),t("div",ft,[t("div",yt,[t("strong",null,n(a.translations.total)+":",1)]),t("div",wt,[C(t("input",{type:"number","onUpdate:modelValue":o[2]||(o[2]=s=>b.value=s),class:"form-control",readonly:""},null,512),[[U,b.value]])])]),g(" "+n(b.value)+" ",1),t("div",kt,[t("button",{type:"submit",class:"btn btn-primary",disabled:h.value},[g(n(a.translations.save)+"   ",1),h.value?y("",!0):(c(),m("i",Vt)),h.value?(c(),m("span",gt)):y("",!0)],8,xt)])],32)])])])])]),p(R,{show:w.value,total:b.value,onClose:o[3]||(o[3]=s=>w.value=!1),onConfirm:o[4]||(o[4]=s=>N(s))},null,8,["show","total"])]}),_:1},8,["translations"])}}};export{Lt as default};
