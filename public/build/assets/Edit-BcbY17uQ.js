import{r as h,s as Q,k as M,T as z,B as G,a as u,h as H,w as J,b as s,d as f,t as l,n as c,j,l as m,G as C,u as i,x as _,i as b,c as p,e as y,f as K,F as W,A as X}from"./app-CAAavkJN.js";import{A as Y}from"./AuthenticatedLayout-BH0auAf-.js";import{_ as g}from"./InputError-BwdD1v-m.js";import{l as Z}from"./lodash-Cl14KtDT.js";import{_ as ss}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ts={class:"section dashboard"},es={class:"row"},os={class:"col-lg-12"},ls={class:"card"},is={class:"card-header"},as={class:"card-title mb-0"},ns={class:"text-muted mb-0"},rs={class:"card-body"},ds={class:"row mb-4"},cs={class:"col-12"},us={class:"progress-steps"},ms={class:"step-label"},ps={class:"step-label"},vs={class:"step-label"},bs={class:"step-label"},gs={class:"form-section"},fs={class:"section-title"},_s={class:"row mb-3"},hs={for:"inputName",class:"col-sm-2 col-form-label required"},ys={class:"col-sm-10"},xs={class:"input-group"},ks=["placeholder"],ws={class:"form-text"},Vs={class:"row mb-3"},qs={for:"inputBarcode",class:"col-sm-2 col-form-label"},Cs={class:"col-sm-10"},Is={class:"input-group"},Bs=["placeholder"],Us=["disabled","title"],Ss={key:0,class:"input-group-text"},Fs={key:1,class:"input-group-text text-danger"},Ns={key:2,class:"input-group-text text-success"},Ms={class:"form-text"},js={class:"row mb-3"},Es={for:"inputModel",class:"col-sm-2 col-form-label"},Ps={class:"col-sm-10"},As={class:"input-group"},Os=["placeholder"],Rs={class:"form-text"},$s={class:"row mb-3"},Ds={for:"inputOENumber",class:"col-sm-2 col-form-label"},Ts={class:"col-sm-10"},Ls={class:"input-group"},Qs=["placeholder"],zs={class:"form-text"},Gs={class:"row mb-3"},Hs={class:"col-sm-10"},Js={class:"input-group"},Ks=["value"],Ws={class:"form-section"},Xs={class:"section-title"},Ys={class:"row mb-3"},Zs={for:"inputPriceCost",class:"col-sm-2 col-form-label"},st={class:"col-sm-10"},tt={class:"input-group"},et=["placeholder"],ot={class:"input-group-text"},lt={class:"form-text"},it={class:"row mb-3"},at={for:"inputPrice",class:"col-sm-2 col-form-label required"},nt={class:"col-sm-10"},rt={class:"input-group"},dt=["placeholder"],ct={class:"input-group-text"},ut={class:"form-text"},mt={key:0,class:"row mb-3"},pt={class:"col-sm-10"},vt={class:"alert alert-info"},bt={class:"form-section"},gt={class:"section-title"},ft={class:"row mb-3"},_t={for:"inputQuantity",class:"col-sm-2 col-form-label required"},ht={class:"col-sm-10"},yt={class:"input-group"},xt=["placeholder"],kt={class:"input-group-text"},wt={class:"form-text"},Vt={class:"form-section"},qt={class:"section-title"},Ct={class:"row mb-3"},It={for:"inputNote",class:"col-sm-2 col-form-label"},Bt={class:"col-sm-10"},Ut={class:"input-group"},St=["placeholder"],Ft={class:"form-text"},Nt={class:"row mb-3"},Mt={for:"inputdate",class:"col-sm-2 col-form-label"},jt={class:"col-sm-10"},Et={class:"input-group"},Pt={class:"form-text"},At={class:"row mb-3"},Ot={for:"inputImage",class:"col-sm-2 col-form-label"},Rt={class:"col-sm-10"},$t={key:0,class:"upload-placeholder"},Dt={class:"text-muted"},Tt={key:1,class:"image-preview"},Lt=["src","alt"],Qt=["value"],zt={class:"form-text"},Gt={class:"row mt-4"},Ht={class:"col-12"},Jt={class:"d-flex justify-content-between"},Kt=["disabled"],Wt=["disabled"],Xt={key:0,class:"bi bi-check-circle me-2"},Yt={key:1,class:"spinner-border spinner-border-sm me-2"},Zt={__name:"Edit",props:{product:Object,productRoles:Array,roles:Object,translations:Object,categories:{type:Array,default:()=>[]}},setup(o){const x=h(!1),k=Q(),n=h(1),w=h(null),q=h(null),r=h({checking:!1,isValid:!0,message:""}),V=h(null),I=h(null),d=o,B=M(()=>{var v;return(v=d.product)!=null&&v.image&&d.product.image.trim()!==""?`/public/storage/${d.product.image}`:"/public/dashboard-assets/img/product-placeholder.svg"}),e=z({name:d.product.name,model:d.product.model,notes:d.product.notes,oe_number:d.product.oe_number,price_cost:d.product.price_cost,quantity:d.product.quantity,price:d.product.price,created:d.product.created,barcode:d.product.barcode,selectedRoles:d.productRoles,image:null,category_id:d.product.category_id||null}),S=M(()=>e.name&&e.price&&e.quantity),E=()=>{n.value<4&&n.value++},P=()=>{n.value>1&&n.value--},F=()=>{n.value===1&&e.name&&(n.value=2)},A=()=>{const v=Date.now().toString(),t=Math.floor(Math.random()*1e3).toString().padStart(3,"0");e.barcode=`BC${v.slice(-6)}${t}`,N(e.barcode),k.success("تم توليد باركود جديد")},U=()=>{e.price_cost&&e.price?(V.value=parseFloat(e.price)-parseFloat(e.price_cost),I.value=V.value/parseFloat(e.price_cost)*100):(V.value=null,I.value=null)},O=()=>{q.value.click()},R=v=>{const t=v.target.files[0];if(t){e.image=t;const a=new FileReader;a.onload=L=>{w.value=L.target.result},a.readAsDataURL(t)}},$=()=>{e.image=null,w.value=null,q.value&&(q.value.value="")},D=async v=>{if(!v||v.length<3){r.value={checking:!1,isValid:!0,message:""};return}if(v===d.product.barcode){r.value={checking:!1,isValid:!0,message:""};return}r.value.checking=!0;try{const a=await(await fetch(route("products.checkBarcodeUnique",v))).json();r.value={checking:!1,isValid:a.unique,message:a.message},a.unique||k.warning(a.message)}catch(t){console.error("Barcode validation error:",t),r.value={checking:!1,isValid:!1,message:"خطأ في التحقق من الباركود"}}},N=Z.debounce(D,500),T=()=>{if(e.barcode&&!r.value.isValid){k.error("يجب إدخال باركود صحيح ومتاح");return}if(!S.value){k.error("يرجى ملء جميع الحقول المطلوبة");return}x.value=!0,e.post(route("products.update",{product:d.product.id}),{onSuccess:()=>{x.value=!1,k.success("تم تحديث المنتج بنجاح")},onError:()=>{x.value=!1,k.error("حدث خطأ أثناء تحديث المنتج")}})};return G([()=>e.name,()=>e.price,()=>e.quantity],()=>{F()}),U(),(v,t)=>(u(),H(Y,{translations:o.translations},{default:J(()=>[s("section",ts,[s("div",es,[s("div",os,[s("div",ls,[s("div",is,[s("h5",as,[t[11]||(t[11]=s("i",{class:"bi bi-pencil-square me-2"},null,-1)),f(" "+l(o.translations.edit_product),1)]),s("p",ns,l(o.translations.edit_product_description),1)]),s("div",rs,[s("div",ds,[s("div",cs,[s("div",us,[s("div",{class:c(["step",{active:n.value>=1,completed:n.value>1}])},[t[12]||(t[12]=s("div",{class:"step-number"},"1",-1)),s("div",ms,l(o.translations.basic_info),1)],2),s("div",{class:c(["step",{active:n.value>=2,completed:n.value>2}])},[t[13]||(t[13]=s("div",{class:"step-number"},"2",-1)),s("div",ps,l(o.translations.pricing),1)],2),s("div",{class:c(["step",{active:n.value>=3,completed:n.value>3}])},[t[14]||(t[14]=s("div",{class:"step-number"},"3",-1)),s("div",vs,l(o.translations.inventory),1)],2),s("div",{class:c(["step",{active:n.value>=4,completed:n.value>4}])},[t[15]||(t[15]=s("div",{class:"step-number"},"4",-1)),s("div",bs,l(o.translations.additional),1)],2)])])]),s("form",{onSubmit:j(T,["prevent"]),class:"needs-validation",novalidate:""},[m(s("div",gs,[s("h6",fs,[t[16]||(t[16]=s("i",{class:"bi bi-info-circle me-2"},null,-1)),f(" "+l(o.translations.basic_info),1)]),s("div",_s,[s("label",hs,l(o.translations.name),1),s("div",ys,[s("div",xs,[t[17]||(t[17]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-box-seam"})],-1)),m(s("input",{id:"inputName",type:"text",class:c(["form-control",{"is-invalid":i(e).errors.name}]),placeholder:o.translations.enter_product_name,"onUpdate:modelValue":t[0]||(t[0]=a=>i(e).name=a),required:"",onInput:F},null,42,ks),[[_,i(e).name]])]),s("div",ws,l(o.translations.product_name_help),1),b(g,{message:i(e).errors.name},null,8,["message"])])]),s("div",Vs,[s("label",qs,l(o.translations.barcode),1),s("div",Cs,[s("div",Is,[t[22]||(t[22]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-upc-scan"})],-1)),m(s("input",{id:"inputBarcode",type:"text",class:c(["form-control",{"is-invalid":r.value.checking===!1&&!r.value.isValid,"is-valid":i(e).barcode&&r.value.isValid}]),placeholder:o.translations.enter_barcode_or_auto_generate,"onUpdate:modelValue":t[1]||(t[1]=a=>i(e).barcode=a),onInput:t[2]||(t[2]=a=>i(N)(i(e).barcode))},null,42,Bs),[[_,i(e).barcode]]),s("button",{class:"btn btn-outline-secondary",type:"button",onClick:A,disabled:r.value.checking,title:o.translations.auto_generate_barcode},t[18]||(t[18]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,Us),r.value.checking?(u(),p("div",Ss,t[19]||(t[19]=[s("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1)]))):r.value.isValid?i(e).barcode&&r.value.isValid?(u(),p("div",Ns,t[21]||(t[21]=[s("i",{class:"bi bi-check-circle"},null,-1)]))):y("",!0):(u(),p("div",Fs,t[20]||(t[20]=[s("i",{class:"bi bi-exclamation-triangle"},null,-1)])))]),r.value.message?(u(),p("div",{key:0,class:c(["form-text",r.value.isValid?"text-success":"text-danger"])},l(r.value.message),3)):y("",!0),s("div",Ms,l(o.translations.barcode_help),1),b(g,{message:i(e).errors.barcode},null,8,["message"])])]),s("div",js,[s("label",Es,l(o.translations.model)+" ("+l(o.translations.optional)+")",1),s("div",Ps,[s("div",As,[t[23]||(t[23]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-tag"})],-1)),m(s("input",{id:"inputModel",type:"text",class:c(["form-control",{"is-invalid":i(e).errors.model}]),placeholder:o.translations.enter_model_number,"onUpdate:modelValue":t[3]||(t[3]=a=>i(e).model=a)},null,10,Os),[[_,i(e).model]])]),s("div",Rs,l(o.translations.model_help),1),b(g,{message:i(e).errors.model},null,8,["message"])])]),s("div",$s,[s("label",Ds,l(o.translations.oe_number),1),s("div",Ts,[s("div",Ls,[t[24]||(t[24]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-hash"})],-1)),m(s("input",{id:"inputOENumber",type:"text",class:c(["form-control",{"is-invalid":i(e).errors.oe_number}]),placeholder:o.translations.enter_oe_number,"onUpdate:modelValue":t[4]||(t[4]=a=>i(e).oe_number=a)},null,10,Qs),[[_,i(e).oe_number]])]),s("div",zs,l(o.translations.oe_number_help),1),b(g,{message:i(e).errors.oe_number},null,8,["message"])])]),s("div",Gs,[t[28]||(t[28]=s("label",{for:"inputCategory",class:"col-sm-2 col-form-label"},"التصنيف",-1)),s("div",Hs,[s("div",Js,[t[26]||(t[26]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-tags"})],-1)),m(s("select",{id:"inputCategory",class:c(["form-control",{"is-invalid":i(e).errors.category_id}]),"onUpdate:modelValue":t[5]||(t[5]=a=>i(e).category_id=a)},[t[25]||(t[25]=s("option",{value:""},"اختر تصنيف (اختياري)",-1)),(u(!0),p(W,null,K(o.categories,a=>(u(),p("option",{key:a.id,value:a.id},l(a.name),9,Ks))),128))],2),[[X,i(e).category_id]])]),t[27]||(t[27]=s("div",{class:"form-text"},"اختر تصنيف للمنتج لتسهيل البحث والفلترة",-1)),b(g,{message:i(e).errors.category_id},null,8,["message"])])])],512),[[C,n.value>=1]]),m(s("div",Ws,[s("h6",Xs,[t[29]||(t[29]=s("i",{class:"bi bi-currency-dollar me-2"},null,-1)),f(" "+l(o.translations.pricing),1)]),s("div",Ys,[s("label",Zs,l(o.translations.price_cost),1),s("div",st,[s("div",tt,[t[30]||(t[30]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cart-plus"})],-1)),m(s("input",{id:"inputPriceCost",type:"number",step:"0.01",min:"0",class:c(["form-control",{"is-invalid":i(e).errors.price_cost}]),placeholder:o.translations.enter_cost_price,"onUpdate:modelValue":t[6]||(t[6]=a=>i(e).price_cost=a),onInput:U},null,42,et),[[_,i(e).price_cost]]),s("span",ot,l(o.translations.dinar),1)]),s("div",lt,l(o.translations.cost_price_help),1),b(g,{message:i(e).errors.price_cost},null,8,["message"])])]),s("div",it,[s("label",at,l(o.translations.price),1),s("div",nt,[s("div",rt,[t[31]||(t[31]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-cash-stack"})],-1)),m(s("input",{id:"inputPrice",type:"number",step:"0.01",min:"0",class:c(["form-control",{"is-invalid":i(e).errors.price}]),placeholder:o.translations.enter_selling_price,"onUpdate:modelValue":t[7]||(t[7]=a=>i(e).price=a),required:"",onInput:U},null,42,dt),[[_,i(e).price]]),s("span",ct,l(o.translations.dinar),1)]),s("div",ut,l(o.translations.selling_price_help),1),b(g,{message:i(e).errors.price},null,8,["message"])])]),V.value!==null?(u(),p("div",mt,[t[33]||(t[33]=s("div",{class:"col-sm-2"},null,-1)),s("div",pt,[s("div",vt,[t[32]||(t[32]=s("i",{class:"bi bi-graph-up me-2"},null,-1)),s("strong",null,l(o.translations.profit_margin)+":",1),f(" "+l(V.value.toFixed(2))+" "+l(o.translations.dinar)+" ("+l(I.value.toFixed(1))+"%) ",1)])])])):y("",!0)],512),[[C,n.value>=2]]),m(s("div",bt,[s("h6",gt,[t[34]||(t[34]=s("i",{class:"bi bi-boxes me-2"},null,-1)),f(" "+l(o.translations.inventory),1)]),s("div",ft,[s("label",_t,l(o.translations.quantity),1),s("div",ht,[s("div",yt,[t[35]||(t[35]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-123"})],-1)),m(s("input",{id:"inputQuantity",type:"number",min:"0",class:c(["form-control",{"is-invalid":i(e).errors.quantity}]),placeholder:o.translations.enter_initial_quantity,"onUpdate:modelValue":t[8]||(t[8]=a=>i(e).quantity=a),required:""},null,10,xt),[[_,i(e).quantity]]),s("span",kt,l(o.translations.units),1)]),s("div",wt,l(o.translations.quantity_help),1),b(g,{message:i(e).errors.quantity},null,8,["message"])])])],512),[[C,n.value>=3]]),m(s("div",Vt,[s("h6",qt,[t[36]||(t[36]=s("i",{class:"bi bi-info-square me-2"},null,-1)),f(" "+l(o.translations.additional),1)]),s("div",Ct,[s("label",It,l(o.translations.note),1),s("div",Bt,[s("div",Ut,[t[37]||(t[37]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-journal-text"})],-1)),m(s("textarea",{id:"inputNote",class:c(["form-control",{"is-invalid":i(e).errors.notes}]),placeholder:o.translations.enter_notes_optional,"onUpdate:modelValue":t[9]||(t[9]=a=>i(e).notes=a),rows:"3"},null,10,St),[[_,i(e).notes]])]),s("div",Ft,l(o.translations.notes_help),1),b(g,{message:i(e).errors.notes},null,8,["message"])])]),s("div",Nt,[s("label",Mt,l(o.translations.date),1),s("div",jt,[s("div",Et,[t[38]||(t[38]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-calendar"})],-1)),m(s("input",{id:"inputdate",type:"date",class:c(["form-control",{"is-invalid":i(e).errors.created}]),"onUpdate:modelValue":t[10]||(t[10]=a=>i(e).created=a)},null,2),[[_,i(e).created]])]),s("div",Pt,l(o.translations.date_help),1),b(g,{message:i(e).errors.created},null,8,["message"])])]),s("div",At,[s("label",Ot,l(o.translations.image),1),s("div",Rt,[s("div",{class:c(["image-upload-area",{"has-image":w.value||B.value}]),onClick:O},[s("input",{ref_key:"fileInput",ref:q,id:"inputImage",type:"file",accept:"image/*",onInput:R,style:{display:"none"}},null,544),!w.value&&!B.value?(u(),p("div",$t,[t[39]||(t[39]=s("i",{class:"bi bi-cloud-upload"},null,-1)),s("p",null,l(o.translations.click_to_upload_image),1),s("small",Dt,l(o.translations.supported_formats),1)])):(u(),p("div",Tt,[s("img",{src:w.value||B.value,alt:o.translations.product_image},null,8,Lt),s("button",{type:"button",class:"btn btn-sm btn-danger remove-image",onClick:j($,["stop"])},t[40]||(t[40]=[s("i",{class:"bi bi-x"},null,-1)]))]))],2),i(e).progress?(u(),p("progress",{key:0,value:i(e).progress.percentage,max:"100",class:"w-100 mt-2"},l(i(e).progress.percentage)+"% ",9,Qt)):y("",!0),s("div",zt,l(o.translations.image_help),1)])])],512),[[C,n.value>=4]]),s("div",Gt,[s("div",Ht,[s("div",Jt,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:P,disabled:n.value===1},[t[41]||(t[41]=s("i",{class:"bi bi-arrow-left me-2"},null,-1)),f(" "+l(o.translations.previous),1)],8,Kt),s("div",null,[n.value<4?(u(),p("button",{key:0,type:"button",class:"btn btn-primary me-2",onClick:E},[f(l(o.translations.next)+" ",1),t[42]||(t[42]=s("i",{class:"bi bi-arrow-right ms-2"},null,-1))])):y("",!0),s("button",{type:"submit",class:"btn btn-success",disabled:x.value||!S.value},[x.value?y("",!0):(u(),p("i",Xt)),x.value?(u(),p("span",Yt)):y("",!0),f(" "+l(o.translations.update),1)],8,Wt)])])])])],32)])])])])])]),_:1},8,["translations"]))}},ie=ss(Zt,[["__scopeId","data-v-107007cc"]]);export{ie as default};
