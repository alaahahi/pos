import{r as v,a as o,h as I,w as G,b as t,n as x,c as n,l as d,x as g,A as _,d as y,F as w,f as C,t as a,e as i,j as q,g as T}from"./app-CMNYfml1.js";import{A as Q}from"./AuthenticatedLayout-B38jxHsH.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"section"},tt={class:"row"},et={class:"col-lg-12"},st={class:"card"},lt={class:"card-body"},ot={class:"nav nav-tabs",id:"paymentsTabs",role:"tablist"},nt={class:"nav-item",role:"presentation"},at={class:"nav-item",role:"presentation"},dt={class:"nav-item",role:"presentation"},rt={class:"tab-content mt-4"},it={key:0,class:"tab-pane fade show active"},ut={class:"row mb-3"},ct={class:"col-md-4"},mt={class:"col-md-3"},vt={class:"col-md-3"},bt={class:"table-responsive"},pt={class:"table table-striped"},yt=["onClick","disabled"],ft={class:"d-flex justify-content-center mt-3"},_t={class:"pagination"},ht=["onClick","innerHTML","disabled"],kt={key:1,class:"tab-pane fade show active"},gt={class:"table-responsive"},wt={class:"table table-striped"},Ct={class:"d-flex justify-content-center mt-3"},St={class:"pagination"},xt=["onClick","innerHTML","disabled"],Tt={key:2,class:"tab-pane fade show active"},Vt={class:"row"},Bt={class:"col-md-6"},Mt={class:"card"},Ut={class:"card-body"},Ft={class:"table-responsive"},Ot={class:"table table-sm"},jt=["onClick"],$t=["onClick","disabled"],qt={class:"col-md-6"},Pt={class:"card"},At={class:"card-body"},Nt={class:"d-grid gap-2"},Et={key:0,class:"modal fade show d-block",tabindex:"-1"},Lt={class:"modal-dialog"},Dt={class:"modal-content"},Ht={class:"modal-header"},Jt={class:"modal-title"},Kt={class:"modal-body"},Rt={class:"mb-3"},Wt={class:"mb-3"},Xt={class:"mb-3"},zt={class:"mb-3"},It={key:0,class:"alert alert-info"},Gt={class:"modal-footer"},Qt=["disabled"],Yt={key:0,class:"spinner-border spinner-border-sm me-2"},Zt={key:1,class:"modal-backdrop fade show"},te={key:2,class:"modal fade show d-block",tabindex:"-1"},ee={class:"modal-dialog"},se={class:"modal-content"},le={class:"modal-body"},oe={class:"mb-3"},ne=["value"],ae={class:"mb-3"},de={class:"mb-3"},re={class:"mb-3"},ie={class:"modal-footer"},ue=["disabled"],ce={key:0,class:"spinner-border spinner-border-sm me-2"},me={key:3,class:"modal-backdrop fade show"},ve={key:4,class:"modal fade show d-block",tabindex:"-1"},be={class:"modal-dialog"},pe={class:"modal-content"},ye={class:"modal-body"},fe={class:"mb-3"},_e=["value"],he={class:"mb-3"},ke={class:"mb-3"},ge={class:"mb-3"},we={class:"modal-footer"},Ce=["disabled"],Se={key:0,class:"spinner-border spinner-border-sm me-2"},xe={key:5,class:"modal-backdrop fade show"},Te={__name:"Payments",props:{translations:Object,activeTab:String,orders:Object,customerBalances:Array,payments:Object},setup(b){const p=v(b.activeTab||"orders"),u=v(!1),h=v({search:"",status:"",currency:""}),V=v(!1),B=v(null),F=v({balance_dollar:0,balance_dinar:0}),r=v({order_id:null,amount:"",currency:"dollar",payment_method:"cash",notes:""}),M=v(!1),c=v({customer_id:"",amount:"",currency:"dollar",notes:""}),U=v(!1),m=v({customer_id:"",amount:"",currency:"dollar",notes:""}),f=(l,e="dollar")=>{if(!l)return"0.00";const S=e==="dollar"?"$":"د.ع";return`${parseFloat(l).toFixed(2)} ${S}`},K=l=>{if(!l)return"-";const e={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Date(l).toLocaleDateString("en-US",e)},R=l=>({created:"secondary",received:"info",executing:"primary",partial_payment:"warning",full_payment:"success",completed:"success",cancelled:"danger"})[l]||"secondary",W=l=>({cash:"نقدي",balance:"من الرصيد",transfer:"تحويل"})[l]||l,X=()=>{T.get(route("decoration.payments"),h.value,{preserveState:!0,preserveScroll:!0})},P=l=>{l&&T.visit(l)},z=async l=>{if(B.value=l,r.value.order_id=l.id,r.value.currency=l.currency,l.customer)try{const S=await(await fetch(route("decoration.payments.balance.get",l.customer.id))).json();F.value=S}catch(e){console.error("Error fetching customer balance:",e)}V.value=!0},O=()=>{V.value=!1,B.value=null,r.value={order_id:null,amount:"",currency:"dollar",payment_method:"cash",notes:""}},A=async()=>{u.value=!0;try{const e=await(await fetch(route("decoration.payments.add"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(r.value)})).json();e.success?(O(),T.reload()):alert(e.message||"حدث خطأ أثناء إضافة الدفعة")}catch(l){console.error("Error adding payment:",l),alert("حدث خطأ أثناء إضافة الدفعة")}finally{u.value=!1}},N=(l=null)=>{l&&(c.value.customer_id=l.id),M.value=!0},j=()=>{M.value=!1,c.value={customer_id:"",amount:"",currency:"dollar",notes:""}},E=async()=>{u.value=!0;try{const e=await(await fetch(route("decoration.payments.balance.add"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(c.value)})).json();e.success?(j(),T.reload()):alert(e.message||"حدث خطأ أثناء إضافة الرصيد")}catch(l){console.error("Error adding balance:",l),alert("حدث خطأ أثناء إضافة الرصيد")}finally{u.value=!1}},L=(l=null)=>{l&&(m.value.customer_id=l.id),U.value=!0},$=()=>{U.value=!1,m.value={customer_id:"",amount:"",currency:"dollar",notes:""}},D=async()=>{u.value=!0;try{const e=await(await fetch(route("decoration.payments.balance.withdraw"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(m.value)})).json();e.success?($(),T.reload()):alert(e.message||"حدث خطأ أثناء سحب الرصيد")}catch(l){console.error("Error withdrawing balance:",l),alert("حدث خطأ أثناء سحب الرصيد")}finally{u.value=!1}};return(l,e)=>(o(),I(Q,{translations:b.translations},{default:G(()=>{var S,H;return[t("section",Z,[t("div",tt,[t("div",et,[t("div",st,[t("div",lt,[t("ul",ot,[t("li",nt,[t("button",{class:x(["nav-link",{active:p.value==="orders"}]),onClick:e[0]||(e[0]=s=>p.value="orders"),type:"button"}," طلبات الديكور ",2)]),t("li",at,[t("button",{class:x(["nav-link",{active:p.value==="payments"}]),onClick:e[1]||(e[1]=s=>p.value="payments"),type:"button"}," سجل الدفعات ",2)]),t("li",dt,[t("button",{class:x(["nav-link",{active:p.value==="balance"}]),onClick:e[2]||(e[2]=s=>p.value="balance"),type:"button"}," إدارة الرصيد ",2)])]),t("div",rt,[p.value==="orders"?(o(),n("div",it,[t("div",ut,[t("div",ct,[d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=s=>h.value.search=s),placeholder:"البحث في الطلبات..."},null,512),[[g,h.value.search]])]),t("div",mt,[d(t("select",{class:"form-select","onUpdate:modelValue":e[4]||(e[4]=s=>h.value.status=s)},e[20]||(e[20]=[t("option",{value:""},"جميع الحالات",-1),t("option",{value:"created"},"تم الإنشاء",-1),t("option",{value:"received"},"تم الاستلام",-1),t("option",{value:"executing"},"قيد التنفيذ",-1),t("option",{value:"partial_payment"},"دفع جزئي",-1),t("option",{value:"full_payment"},"دفع كامل",-1),t("option",{value:"completed"},"مكتمل",-1),t("option",{value:"cancelled"},"ملغي",-1)]),512),[[_,h.value.status]])]),t("div",vt,[d(t("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=s=>h.value.currency=s)},e[21]||(e[21]=[t("option",{value:""},"جميع العملات",-1),t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,h.value.currency]])]),t("div",{class:"col-md-2"},[t("button",{class:"btn btn-primary w-100",onClick:X},e[22]||(e[22]=[t("i",{class:"bi bi-search"},null,-1),y(" بحث ")]))])]),t("div",bt,[t("table",pt,[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",null,"رقم الطلب"),t("th",null,"العميل"),t("th",null,"الديكور"),t("th",null,"المبلغ الإجمالي"),t("th",null,"المدفوع"),t("th",null,"المتبقي"),t("th",null,"الحالة"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(o(!0),n(w,null,C(b.orders.data,s=>(o(),n("tr",{key:s.id},[t("td",null,"#"+a(s.id),1),t("td",null,a(s.customer_name),1),t("td",null,a(s.decoration.name),1),t("td",null,a(f(s.total_price,s.currency)),1),t("td",null,a(f(s.paid_amount,s.currency)),1),t("td",null,a(f(s.total_price-s.paid_amount,s.currency)),1),t("td",null,[t("span",{class:x(["badge","bg-"+R(s.status)])},a(s.status_name),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-success",onClick:k=>z(s),disabled:s.status==="completed"||s.status==="cancelled"},e[23]||(e[23]=[t("i",{class:"bi bi-plus"},null,-1),y(" إضافة دفعة ")]),8,yt)])]))),128))])])]),t("div",ft,[t("nav",null,[t("ul",_t,[(o(!0),n(w,null,C(b.orders.links,s=>(o(),n("li",{key:s.label,class:x(["page-item",{active:s.active,disabled:!s.url}])},[t("button",{class:"page-link",onClick:k=>P(s.url),innerHTML:s.label,disabled:!s.url},null,8,ht)],2))),128))])])])])):i("",!0),p.value==="payments"?(o(),n("div",kt,[t("div",gt,[t("table",wt,[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",null,"رقم الدفعة"),t("th",null,"الوصف"),t("th",null,"المبلغ"),t("th",null,"العملة"),t("th",null,"طريقة الدفع"),t("th",null,"التاريخ"),t("th",null,"الملاحظات")])],-1)),t("tbody",null,[(o(!0),n(w,null,C(b.payments.data,s=>{var k,J;return o(),n("tr",{key:s.id},[t("td",null,"#"+a(s.id),1),t("td",null,a(s.description),1),t("td",null,a(f(s.amount,s.currency)),1),t("td",null,a(s.currency==="dollar"?"دولار":"دينار"),1),t("td",null,a(W((k=s.details)==null?void 0:k.payment_method)),1),t("td",null,a(K(s.created)),1),t("td",null,a(((J=s.details)==null?void 0:J.notes)||"-"),1)])}),128))])])]),t("div",Ct,[t("nav",null,[t("ul",St,[(o(!0),n(w,null,C(b.payments.links,s=>(o(),n("li",{key:s.label,class:x(["page-item",{active:s.active,disabled:!s.url}])},[t("button",{class:"page-link",onClick:k=>P(s.url),innerHTML:s.label,disabled:!s.url},null,8,xt)],2))),128))])])])])):i("",!0),p.value==="balance"?(o(),n("div",Tt,[t("div",Vt,[t("div",Bt,[t("div",Mt,[e[29]||(e[29]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"أرصدة العملاء")],-1)),t("div",Ut,[t("div",Ft,[t("table",Ot,[e[28]||(e[28]=t("thead",null,[t("tr",null,[t("th",null,"العميل"),t("th",null,"الرصيد بالدولار"),t("th",null,"الرصيد بالدينار"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(o(!0),n(w,null,C(b.customerBalances,s=>(o(),n("tr",{key:s.id},[t("td",null,a(s.customer.name),1),t("td",null,a(f(s.balance_dollar,"dollar")),1),t("td",null,a(f(s.balance_dinar,"dinar")),1),t("td",null,[t("button",{class:"btn btn-sm btn-primary me-1",onClick:k=>N(s.customer)},e[26]||(e[26]=[t("i",{class:"bi bi-plus"},null,-1)]),8,jt),t("button",{class:"btn btn-sm btn-warning",onClick:k=>L(s.customer),disabled:s.balance_dollar<=0&&s.balance_dinar<=0},e[27]||(e[27]=[t("i",{class:"bi bi-dash"},null,-1)]),8,$t)])]))),128))])])])])])]),t("div",qt,[t("div",Pt,[e[32]||(e[32]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"إجراءات سريعة")],-1)),t("div",At,[t("div",Nt,[t("button",{class:"btn btn-success",onClick:e[6]||(e[6]=s=>N())},e[30]||(e[30]=[t("i",{class:"bi bi-plus-circle"},null,-1),y(" إضافة رصيد لعميل ")])),t("button",{class:"btn btn-warning",onClick:e[7]||(e[7]=s=>L())},e[31]||(e[31]=[t("i",{class:"bi bi-dash-circle"},null,-1),y(" سحب رصيد من عميل ")]))])])])])])])):i("",!0)])])])])])]),V.value?(o(),n("div",Et,[t("div",Lt,[t("div",Dt,[t("div",Ht,[t("h5",Jt,"إضافة دفعة لطلب #"+a((S=B.value)==null?void 0:S.id),1),t("button",{type:"button",class:"btn-close",onClick:O})]),t("div",Kt,[t("form",{onSubmit:q(A,["prevent"])},[t("div",Rt,[e[33]||(e[33]=t("label",{for:"amount",class:"form-label"},"المبلغ",-1)),d(t("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":e[8]||(e[8]=s=>r.value.amount=s),step:"0.01",min:"0.01",required:""},null,512),[[g,r.value.amount]])]),t("div",Wt,[e[35]||(e[35]=t("label",{for:"currency",class:"form-label"},"العملة",-1)),d(t("select",{class:"form-select",id:"currency","onUpdate:modelValue":e[9]||(e[9]=s=>r.value.currency=s),required:""},e[34]||(e[34]=[t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,r.value.currency]])]),t("div",Xt,[e[37]||(e[37]=t("label",{for:"payment_method",class:"form-label"},"طريقة الدفع",-1)),d(t("select",{class:"form-select",id:"payment_method","onUpdate:modelValue":e[10]||(e[10]=s=>r.value.payment_method=s),required:""},e[36]||(e[36]=[t("option",{value:"cash"},"نقدي",-1),t("option",{value:"balance"},"من الرصيد",-1),t("option",{value:"transfer"},"تحويل",-1)]),512),[[_,r.value.payment_method]])]),t("div",zt,[e[38]||(e[38]=t("label",{for:"notes",class:"form-label"},"ملاحظات",-1)),d(t("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[11]||(e[11]=s=>r.value.notes=s),rows:"3"},null,512),[[g,r.value.notes]])]),r.value.payment_method==="balance"&&((H=B.value)!=null&&H.customer)?(o(),n("div",It,[e[39]||(e[39]=t("strong",null,"الرصيد المتاح:",-1)),e[40]||(e[40]=t("br",null,null,-1)),y(" دولار: "+a(f(F.value.balance_dollar,"dollar")),1),e[41]||(e[41]=t("br",null,null,-1)),y(" دينار: "+a(f(F.value.balance_dinar,"dinar")),1)])):i("",!0)],32)]),t("div",Gt,[t("button",{type:"button",class:"btn btn-secondary",onClick:O},"إلغاء"),t("button",{type:"button",class:"btn btn-success",onClick:A,disabled:u.value},[u.value?(o(),n("span",Yt)):i("",!0),e[42]||(e[42]=y(" إضافة الدفعة "))],8,Qt)])])])])):i("",!0),V.value?(o(),n("div",Zt)):i("",!0),M.value?(o(),n("div",te,[t("div",ee,[t("div",se,[t("div",{class:"modal-header"},[e[43]||(e[43]=t("h5",{class:"modal-title"},"إضافة رصيد",-1)),t("button",{type:"button",class:"btn-close",onClick:j})]),t("div",le,[t("form",{onSubmit:q(E,["prevent"])},[t("div",oe,[e[45]||(e[45]=t("label",{for:"customer_id",class:"form-label"},"العميل",-1)),d(t("select",{class:"form-select",id:"customer_id","onUpdate:modelValue":e[12]||(e[12]=s=>c.value.customer_id=s),required:""},[e[44]||(e[44]=t("option",{value:""},"اختر العميل",-1)),(o(!0),n(w,null,C(b.customerBalances,s=>(o(),n("option",{key:s.customer.id,value:s.customer.id},a(s.customer.name),9,ne))),128))],512),[[_,c.value.customer_id]])]),t("div",ae,[e[46]||(e[46]=t("label",{for:"amount",class:"form-label"},"المبلغ",-1)),d(t("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":e[13]||(e[13]=s=>c.value.amount=s),step:"0.01",min:"0.01",required:""},null,512),[[g,c.value.amount]])]),t("div",de,[e[48]||(e[48]=t("label",{for:"currency",class:"form-label"},"العملة",-1)),d(t("select",{class:"form-select",id:"currency","onUpdate:modelValue":e[14]||(e[14]=s=>c.value.currency=s),required:""},e[47]||(e[47]=[t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,c.value.currency]])]),t("div",re,[e[49]||(e[49]=t("label",{for:"notes",class:"form-label"},"ملاحظات",-1)),d(t("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[15]||(e[15]=s=>c.value.notes=s),rows:"3"},null,512),[[g,c.value.notes]])])],32)]),t("div",ie,[t("button",{type:"button",class:"btn btn-secondary",onClick:j},"إلغاء"),t("button",{type:"button",class:"btn btn-success",onClick:E,disabled:u.value},[u.value?(o(),n("span",ce)):i("",!0),e[50]||(e[50]=y(" إضافة الرصيد "))],8,ue)])])])])):i("",!0),M.value?(o(),n("div",me)):i("",!0),U.value?(o(),n("div",ve,[t("div",be,[t("div",pe,[t("div",{class:"modal-header"},[e[51]||(e[51]=t("h5",{class:"modal-title"},"سحب رصيد",-1)),t("button",{type:"button",class:"btn-close",onClick:$})]),t("div",ye,[t("form",{onSubmit:q(D,["prevent"])},[t("div",fe,[e[53]||(e[53]=t("label",{for:"customer_id",class:"form-label"},"العميل",-1)),d(t("select",{class:"form-select",id:"customer_id","onUpdate:modelValue":e[16]||(e[16]=s=>m.value.customer_id=s),required:""},[e[52]||(e[52]=t("option",{value:""},"اختر العميل",-1)),(o(!0),n(w,null,C(b.customerBalances,s=>(o(),n("option",{key:s.customer.id,value:s.customer.id},a(s.customer.name),9,_e))),128))],512),[[_,m.value.customer_id]])]),t("div",he,[e[54]||(e[54]=t("label",{for:"amount",class:"form-label"},"المبلغ",-1)),d(t("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":e[17]||(e[17]=s=>m.value.amount=s),step:"0.01",min:"0.01",required:""},null,512),[[g,m.value.amount]])]),t("div",ke,[e[56]||(e[56]=t("label",{for:"currency",class:"form-label"},"العملة",-1)),d(t("select",{class:"form-select",id:"currency","onUpdate:modelValue":e[18]||(e[18]=s=>m.value.currency=s),required:""},e[55]||(e[55]=[t("option",{value:"dollar"},"دولار",-1),t("option",{value:"dinar"},"دينار",-1)]),512),[[_,m.value.currency]])]),t("div",ge,[e[57]||(e[57]=t("label",{for:"notes",class:"form-label"},"ملاحظات",-1)),d(t("textarea",{class:"form-control",id:"notes","onUpdate:modelValue":e[19]||(e[19]=s=>m.value.notes=s),rows:"3"},null,512),[[g,m.value.notes]])])],32)]),t("div",we,[t("button",{type:"button",class:"btn btn-secondary",onClick:$},"إلغاء"),t("button",{type:"button",class:"btn btn-warning",onClick:D,disabled:u.value},[u.value?(o(),n("span",Se)):i("",!0),e[58]||(e[58]=y(" سحب الرصيد "))],8,Ce)])])])])):i("",!0),U.value?(o(),n("div",xe)):i("",!0)]}),_:1},8,["translations"]))}},Fe=Y(Te,[["__scopeId","data-v-38b58dc3"]]);export{Fe as default};
