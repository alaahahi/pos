import{Q as $,r as C,a as i,h as g,w as d,b as s,d as u,u as b,p,e as f,c as o,F as x,f as w,t as r,y as B,n as m,i as S,D as A,g as D}from"./app-CPCnYivD.js";import{A as E}from"./AuthenticatedLayout-BWsGDzB7.js";import{S as v}from"./sweetalert2.esm.all-DwEdJQJv.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={dir:"rtl",lang:"ar"},P={class:"section dashboard"},T={class:"card"},j={class:"card-header d-flex justify-content-between align-items-center"},Q={class:"card-body"},q={key:0,class:"table-responsive"},G={class:"table table-hover"},H={key:0,class:"text-muted"},J={key:1,class:"text-muted"},K={key:1,class:"text-muted"},M=["onClick","title"],R={class:"d-flex gap-2"},U=["onClick"],W={key:0},X={colspan:"8",class:"p-0"},Y={key:0,class:"text-center py-3"},Z={key:1},I={class:"mb-3"},ss={class:"badge bg-info ms-2"},ts={class:"table-responsive"},es={class:"table table-sm table-bordered"},ls={key:2,class:"text-center py-3 text-muted"},ns={key:1,class:"text-center py-5"},is={__name:"Index",props:{categories:Array,translations:Object},setup(c){const k=c,z=$(),h=n=>{var t;return((t=z.props.auth_permissions)==null?void 0:t.includes(n))||!1},a=C([]),_=C({}),L=async n=>{const t=a.value.indexOf(n);if(t>-1)a.value.splice(t,1);else{a.value.push(n);const e=k.categories.find(l=>l.id===n);if(!e.products){_.value[n]=!0;try{const l=await A.get(route("categories.products",n));e.products=l.data}catch(l){console.error("Error loading products:",l),v.fire("خطأ!","حدث خطأ أثناء جلب المنتجات","error");const y=a.value.indexOf(n);y>-1&&a.value.splice(y,1)}finally{_.value[n]=!1}}}},N=n=>n===0?"badge bg-danger":n<=5?"badge bg-warning":"badge bg-success",V=n=>{const t=k.categories.find(l=>l.id===n),e=(t==null?void 0:t.products_count)||0;v.fire({title:"تأكيد الحذف",html:`
      <p>هل أنت متأكد من حذف هذا التصنيف؟</p>
      ${e>0?`<p class="text-warning"><strong>تحذير:</strong> يوجد ${e} منتج مرتبط بهذا التصنيف. سيتم إزالة التصنيف من هذه المنتجات.</p>`:""}
    `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء"}).then(l=>{l.isConfirmed&&D.delete(route("categories.destroy",n),{preserveScroll:!0,onSuccess:()=>{v.fire("تم الحذف!","تم حذف التصنيف بنجاح","success")},onError:()=>{v.fire("خطأ!","حدث خطأ أثناء حذف التصنيف","error")}})})};return(n,t)=>(i(),g(E,{translations:c.translations},{default:d(()=>[s("div",O,[s("section",P,[s("div",T,[s("div",j,[t[1]||(t[1]=s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-tags me-2"}),u(" إدارة التصنيفات ")],-1)),h("create category")?(i(),g(b(p),{key:0,class:"btn btn-primary",href:n.route("categories.create")},{default:d(()=>t[0]||(t[0]=[s("i",{class:"bi bi-plus-circle"},null,-1),u(" إضافة تصنيف جديد ")])),_:1},8,["href"])):f("",!0)]),s("div",Q,[c.categories&&c.categories.length>0?(i(),o("div",q,[s("table",G,[t[11]||(t[11]=s("thead",null,[s("tr",null,[s("th",null,"الترتيب"),s("th",null,"الاسم"),s("th",null,"الوصف"),s("th",null,"اللون"),s("th",null,"الأيقونة"),s("th",null,"الحالة"),s("th",null,"عدد المنتجات"),s("th",null,"الإجراءات")])],-1)),s("tbody",null,[(i(!0),o(x,null,w(c.categories,e=>(i(),o(x,{key:e.id},[s("tr",null,[s("td",null,r(e.sort_order),1),s("td",null,[s("strong",null,r(e.name),1)]),s("td",null,[e.description?(i(),o("span",H,r(e.description.length>50?e.description.substring(0,50)+"...":e.description),1)):(i(),o("span",J,"-"))]),s("td",null,[s("span",{class:"badge",style:B({backgroundColor:e.color,color:"#fff",padding:"5px 10px"})},r(e.color),5)]),s("td",null,[e.icon?(i(),o("i",{key:0,class:m(e.icon||"bi bi-tag")},null,2)):(i(),o("span",K,"-"))]),s("td",null,[s("span",{class:m(e.is_active?"badge bg-success":"badge bg-secondary")},r(e.is_active?"نشط":"غير نشط"),3)]),s("td",null,[s("button",{onClick:l=>L(e.id),class:"btn btn-sm btn-outline-info",title:"عرض المنتجات ("+(e.products_count||0)+")"},[t[2]||(t[2]=s("i",{class:"bi bi-box-seam"},null,-1)),u(" "+r(e.products_count||0),1)],8,M)]),s("td",null,[s("div",R,[h("update category")?(i(),g(b(p),{key:0,href:n.route("categories.edit",e.id),class:"btn btn-sm btn-outline-primary",title:"تعديل"},{default:d(()=>t[3]||(t[3]=[s("i",{class:"bi bi-pencil"},null,-1)])),_:2},1032,["href"])):f("",!0),h("delete category")?(i(),o("button",{key:1,onClick:l=>V(e.id),class:"btn btn-sm btn-outline-danger",title:"حذف"},t[4]||(t[4]=[s("i",{class:"bi bi-trash"},null,-1)]),8,U)):f("",!0)])])]),a.value.includes(e.id)?(i(),o("tr",W,[s("td",X,[s("div",{class:"products-container p-3",style:B({backgroundColor:e.color+"10",borderLeft:"4px solid "+e.color})},[_.value[e.id]?(i(),o("div",Y,t[5]||(t[5]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"جاري التحميل...")],-1)]))):e.products&&e.products.length>0?(i(),o("div",Z,[s("h6",I,[s("i",{class:m(e.icon||"bi bi-tag")},null,2),u(" منتجات تصنيف "+r(e.name)+" ",1),s("span",ss,r(e.products.length),1)]),s("div",ts,[s("table",es,[t[7]||(t[7]=s("thead",null,[s("tr",null,[s("th",null,"الاسم"),s("th",null,"الموديل"),s("th",null,"السعر"),s("th",null,"الكمية"),s("th",null,"الحالة"),s("th",null,"الإجراءات")])],-1)),s("tbody",null,[(i(!0),o(x,null,w(e.products,l=>(i(),o("tr",{key:l.id},[s("td",null,r(l.name),1),s("td",null,r(l.model||"-"),1),s("td",null,r(l.price?l.price.toLocaleString():"-")+" IQD",1),s("td",null,[s("span",{class:m(N(l.quantity))},r(l.quantity||0),3)]),s("td",null,[s("span",{class:m(l.is_active?"badge bg-success":"badge bg-secondary")},r(l.is_active?"نشط":"غير نشط"),3)]),s("td",null,[S(b(p),{href:n.route("products.edit",l.id),class:"btn btn-sm btn-outline-primary",title:"تعديل المنتج"},{default:d(()=>t[6]||(t[6]=[s("i",{class:"bi bi-pencil"},null,-1)])),_:2},1032,["href"])])]))),128))])])])])):(i(),o("div",ls,[t[9]||(t[9]=s("i",{class:"bi bi-box-seam",style:{"font-size":"2rem"}},null,-1)),t[10]||(t[10]=s("p",{class:"mt-2"},"لا توجد منتجات مرتبطة بهذا التصنيف",-1)),S(b(p),{href:n.route("products.create"),class:"btn btn-sm btn-primary mt-2"},{default:d(()=>t[8]||(t[8]=[s("i",{class:"bi bi-plus-circle"},null,-1),u(" إضافة منتج جديد ")])),_:1},8,["href"])]))],4)])])):f("",!0)],64))),128))])])])):(i(),o("div",ns,[t[13]||(t[13]=s("i",{class:"bi bi-tags",style:{"font-size":"3rem",color:"#ccc"}},null,-1)),t[14]||(t[14]=s("p",{class:"text-muted mt-3"},"لا توجد تصنيفات",-1)),h("create category")?(i(),g(b(p),{key:0,class:"btn btn-primary",href:n.route("categories.create")},{default:d(()=>t[12]||(t[12]=[s("i",{class:"bi bi-plus-circle"},null,-1),u(" إضافة تصنيف جديد ")])),_:1},8,["href"])):f("",!0)]))])])])])]),_:1},8,["translations"]))}},us=F(is,[["__scopeId","data-v-5d398f7e"]]);export{us as default};
