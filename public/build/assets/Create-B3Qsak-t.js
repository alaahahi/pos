import{s as tt,T as st,r as p,z as Q,k as et,o as ot,a as r,h as lt,w as M,b as t,i as D,d as f,t as a,u as d,p as F,j,l as u,x as c,c as i,F as E,f as P,e as _,A as z,U as nt,v as rt,E as T}from"./app-rfKy2ZWt.js";import{_ as at}from"./AuthenticatedLayout-CJDzBU8V.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={dir:"rtl",lang:"ar"},ut={class:"pagetitle dark:text-white"},ct={class:"breadcrumb"},pt={class:"breadcrumb-item"},mt={class:"breadcrumb-item"},bt={class:"section dashboard"},vt={class:"card"},ft={class:"card-body"},_t={class:"row mb-4"},yt={class:"col-md-6"},ht={class:"input-group"},wt={key:0,class:"dropdown-menu show w-100"},gt=["onClick"],xt={class:"d-flex justify-content-between"},kt={class:"text-muted"},qt={key:1,class:"mt-2"},Ct={class:"alert alert-info d-flex justify-content-between align-items-center"},Vt={class:"col-md-3"},St={class:"col-md-3"},Ut={class:"row mb-4"},It={class:"col-12"},$t={class:"row mb-3"},Mt={class:"col-md-8"},Et={class:"input-group"},Pt={key:0,class:"dropdown-menu show w-100"},Dt=["onClick"],Ft={class:"d-flex justify-content-between align-items-center"},jt={class:"text-muted"},Tt={class:"col-md-4"},At={key:0,class:"table-responsive"},Bt={class:"table table-hover"},Nt={class:"d-flex align-items-center"},Kt=["src","alt"],Lt={class:"text-muted"},Ot=["onUpdate:modelValue","onInput"],Qt=["onUpdate:modelValue","onInput"],zt=["onUpdate:modelValue"],Gt=["onClick"],Ht={class:"table-light"},Jt={class:"text-primary"},Rt={key:1,class:"text-center py-5"},Wt={class:"row mb-4"},Xt={class:"col-md-8"},Yt={class:"col-md-4"},Zt={class:"form-check form-switch mb-3"},ts={key:0,class:"alert alert-warning"},ss={class:"d-flex justify-content-between"},es=["disabled"],os={key:0,class:"spinner-border spinner-border-sm me-2"},ls={key:1,class:"bi bi-check-circle me-2"},ns={key:0,class:"modal fade show d-block",tabindex:"-1"},rs={class:"modal-dialog"},as={class:"modal-content"},is={class:"modal-header"},ds={class:"modal-body"},us={class:"mb-3"},cs={class:"mb-3"},ps={class:"modal-footer"},ms={key:1,class:"modal fade show d-block",tabindex:"-1"},bs={class:"modal-dialog"},vs={class:"modal-content"},fs={class:"modal-header"},_s={class:"modal-body"},ys={class:"mb-3"},hs=["value"],ws={class:"row"},gs={class:"col-md-6"},xs={class:"mb-3"},ks={class:"col-md-6"},qs={class:"mb-3"},Cs={class:"mb-3"},Vs={class:"modal-footer"},Ss={key:2,class:"modal-backdrop fade show"},Us={__name:"Create",props:{suppliers:Array,products:Array,translations:Object},setup(S){const G=S,m=tt(),l=st({supplier_id:null,invoice_date:new Date().toISOString().split("T")[0],notes:"",items:[],withdraw_from_cashbox:!1,currency:"IQD"}),y=p(""),q=p(""),C=p(!1),U=p(!1),I=p([]),h=p([]),V=p(null),w=p(!1),g=p(!1),x=p(!1),b=Q({name:"",phone:""}),n=Q({product_id:"",quantity:1,cost_price:0,sales_price:0}),A=et(()=>l.items.reduce((o,s)=>o+s.total,0)),H=async()=>{if(y.value.length<2){I.value=[];return}try{const o=await T.get(route("purchase-invoices.search-suppliers"),{params:{q:y.value}});I.value=o.data,C.value=!0}catch(o){console.error("Error searching suppliers:",o)}},J=async()=>{if(q.value.length<2){h.value=[];return}try{const o=await T.get(route("purchase-invoices.search-products"),{params:{q:q.value}});h.value=o.data,U.value=!0}catch(o){console.error("Error searching products:",o)}},B=o=>{V.value=o,l.supplier_id=o.id,y.value=o.name,C.value=!1},R=()=>{V.value=null,l.supplier_id=null,y.value=""},N=o=>{const s=l.items.findIndex(e=>e.product.id===o.id);s!==-1?(l.items[s].quantity+=1,$(s)):l.items.push({product:o,quantity:1,cost_price:o.price_cost||0,sales_price:o.price,total:o.price_cost||0}),q.value="",U.value=!1,m.success("تم إضافة المنتج بنجاح")},K=()=>{h.value.length>0&&N(h.value[0])},L=()=>{const o=G.products.find(e=>e.id==n.product_id);if(!o)return;const s=l.items.findIndex(e=>e.product.id===o.id);s!==-1?(l.items[s].quantity+=n.quantity,l.items[s].cost_price=n.cost_price,l.items[s].sales_price=n.sales_price,$(s)):l.items.push({product:o,quantity:n.quantity,cost_price:n.cost_price,sales_price:n.sales_price,total:n.quantity*n.cost_price}),n.product_id="",n.quantity=1,n.cost_price=0,n.sales_price=0,g.value=!1,m.success("تم إضافة المنتج بنجاح")},$=o=>{const s=l.items[o];s.total=s.quantity*s.cost_price},W=o=>{l.items.splice(o,1),m.success("تم حذف المنتج")},O=async()=>{try{const o=await T.post(route("suppliers.store"),{name:b.name,phone:b.phone}),s=o.data.supplier||o.data;B(s),b.name="",b.phone="",w.value=!1,m.success("تم إضافة المورد بنجاح")}catch(o){m.error("حدث خطأ أثناء إضافة المورد"),console.error("Error adding supplier:",o)}},X=o=>o.image&&o.image!=="products/default_product.png"?`/public/storage/${o.image}`:"/public/dashboard-assets/img/product-placeholder.svg",Y=o=>{o.target.src="/dashboard-assets/img/product-placeholder.svg"},Z=()=>{if(l.items.length===0){m.error("يجب إضافة منتج واحد على الأقل");return}x.value=!0;const o={supplier_id:l.supplier_id,invoice_date:l.invoice_date,notes:l.notes,withdraw_from_cashbox:l.withdraw_from_cashbox,currency:l.currency,items:l.items.map(s=>({product_id:s.product.id,quantity:s.quantity,cost_price:s.cost_price,sales_price:s.sales_price}))};l.transform(()=>o).post(route("purchase-invoices.store"),{onSuccess:()=>{x.value=!1,m.success("تم إنشاء فاتورة المشتريات بنجاح")},onError:s=>{x.value=!1,console.error("Form errors:",s),m.error("حدث خطأ في حفظ الفاتورة")}})};return ot(()=>{document.addEventListener("click",o=>{o.target.closest(".input-group")||(C.value=!1,U.value=!1)})}),(o,s)=>(r(),lt(at,{translations:S.translations},{default:M(()=>[t("div",dt,[t("div",ut,[s[21]||(s[21]=t("h1",{class:"dark:text-white"},"إنشاء فاتورة مشتريات",-1)),t("nav",null,[t("ol",ct,[t("li",pt,[D(d(F),{class:"nav-link dark:text-white",href:o.route("dashboard")},{default:M(()=>[f(a(S.translations.home),1)]),_:1},8,["href"])]),t("li",mt,[D(d(F),{class:"nav-link dark:text-white",href:o.route("purchase-invoices.index")},{default:M(()=>s[19]||(s[19]=[f(" فواتير المشتريات ")])),_:1},8,["href"])]),s[20]||(s[20]=t("li",{class:"breadcrumb-item active dark:text-white"},"إنشاء فاتورة",-1))])])]),t("section",bt,[t("div",vt,[s[44]||(s[44]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-plus-circle me-2"}),f(" إنشاء فاتورة مشتريات جديدة ")])],-1)),t("div",ft,[t("form",{onSubmit:j(Z,["prevent"])},[t("div",_t,[t("div",yt,[s[25]||(s[25]=t("label",{class:"form-label"},"المورد",-1)),t("div",ht,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>y.value=e),onInput:H,placeholder:"ابحث عن المورد...",onFocus:s[1]||(s[1]=e=>C.value=!0)},null,544),[[c,y.value]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=e=>w.value=!0)},s[22]||(s[22]=[t("i",{class:"bi bi-plus"},null,-1)]))]),C.value&&I.value.length>0?(r(),i("div",wt,[(r(!0),i(E,null,P(I.value,e=>(r(),i("div",{key:e.id,class:"dropdown-item cursor-pointer",onClick:k=>B(e)},[t("div",xt,[t("span",null,a(e.name),1),t("small",kt,a(e.phone),1)])],8,gt))),128))])):_("",!0),V.value?(r(),i("div",qt,[t("div",Ct,[t("div",null,[t("strong",null,a(V.value.name),1),s[23]||(s[23]=t("br",null,null,-1)),t("small",null,a(V.value.phone),1)]),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:R},s[24]||(s[24]=[t("i",{class:"bi bi-x"},null,-1)]))])])):_("",!0)]),t("div",Vt,[s[26]||(s[26]=t("label",{class:"form-label"},"تاريخ الفاتورة",-1)),u(t("input",{type:"date",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>d(l).invoice_date=e),required:""},null,512),[[c,d(l).invoice_date]])]),t("div",St,[s[28]||(s[28]=t("label",{class:"form-label"},"العملة",-1)),u(t("select",{class:"form-select","onUpdate:modelValue":s[4]||(s[4]=e=>d(l).currency=e),required:""},s[27]||(s[27]=[t("option",{value:"IQD"},"دينار عراقي",-1),t("option",{value:"$"},"دولار أمريكي",-1)]),512),[[z,d(l).currency]])])]),t("div",Ut,[t("div",It,[s[39]||(s[39]=t("h6",{class:"mb-3"},[t("i",{class:"bi bi-box-seam me-2"}),f(" المنتجات ")],-1)),t("div",$t,[t("div",Mt,[t("div",Et,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=e=>q.value=e),onInput:J,placeholder:"ابحث عن المنتج بالاسم أو الباركود...",onKeyup:nt(K,["enter"])},null,544),[[c,q.value]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:K},s[29]||(s[29]=[t("i",{class:"bi bi-search"},null,-1)]))]),U.value&&h.value.length>0?(r(),i("div",Pt,[(r(!0),i(E,null,P(h.value,e=>(r(),i("div",{key:e.id,class:"dropdown-item cursor-pointer",onClick:k=>N(e)},[t("div",Ft,[t("div",null,[t("strong",null,a(e.name),1),s[30]||(s[30]=t("br",null,null,-1)),t("small",jt," الباركود: "+a(e.barcode||"غير محدد")+" | السعر: "+a(e.price)+" | المخزون: "+a(e.quantity),1)]),s[31]||(s[31]=t("i",{class:"bi bi-plus-circle text-primary"},null,-1))])],8,Dt))),128))])):_("",!0)]),t("div",Tt,[t("button",{type:"button",class:"btn btn-primary w-100",onClick:s[6]||(s[6]=e=>g.value=!0)},s[32]||(s[32]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),f(" إضافة منتج يدوياً ")]))])]),d(l).items.length>0?(r(),i("div",At,[t("table",Bt,[s[37]||(s[37]=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"المنتج"),t("th",null,"الكمية"),t("th",null,"سعر التكلفة"),t("th",null,"سعر البيع"),t("th",null,"المجموع"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(r(!0),i(E,null,P(d(l).items,(e,k)=>(r(),i("tr",{key:k},[t("td",null,[t("div",Nt,[t("img",{src:X(e.product),alt:e.product.name,class:"product-thumb me-2",onError:Y},null,40,Kt),t("div",null,[t("strong",null,a(e.product.name),1),s[33]||(s[33]=t("br",null,null,-1)),t("small",Lt,a(e.product.barcode||"غير محدد"),1)])])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":v=>e.quantity=v,onInput:v=>$(k),min:"1",style:{width:"80px"}},null,40,Ot),[[c,e.quantity,void 0,{number:!0}]])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":v=>e.cost_price=v,onInput:v=>$(k),step:"1",min:"0",style:{width:"100px"}},null,40,Qt),[[c,e.cost_price,void 0,{number:!0}]])]),t("td",null,[u(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":v=>e.sales_price=v,step:"1",min:"0",style:{width:"100px"}},null,8,zt),[[c,e.sales_price,void 0,{number:!0}]])]),t("td",null,[t("strong",null,a(Math.round(e.total))+" "+a(d(l).currency),1)]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:v=>W(k)},s[34]||(s[34]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Gt)])]))),128))]),t("tfoot",Ht,[t("tr",null,[s[35]||(s[35]=t("th",{colspan:"4",class:"text-end"},"المجموع الكلي:",-1)),t("th",null,[t("strong",Jt,a(Math.round(A.value))+" "+a(d(l).currency),1)]),s[36]||(s[36]=t("th",null,null,-1))])])])])):(r(),i("div",Rt,s[38]||(s[38]=[t("i",{class:"bi bi-box-seam display-1 text-muted"},null,-1),t("h5",{class:"text-muted mt-3"},"لم يتم إضافة أي منتجات",-1),t("p",{class:"text-muted"},"ابحث عن المنتجات أو أضفها يدوياً لبدء إنشاء الفاتورة",-1)])))])]),t("div",Wt,[t("div",Xt,[s[40]||(s[40]=t("label",{class:"form-label"},"ملاحظات",-1)),u(t("textarea",{class:"form-control","onUpdate:modelValue":s[7]||(s[7]=e=>d(l).notes=e),rows:"3",placeholder:"أي ملاحظات إضافية..."},null,512),[[c,d(l).notes]])]),t("div",Yt,[t("div",Zt,[u(t("input",{class:"form-check-input",type:"checkbox",id:"withdrawFromCashbox","onUpdate:modelValue":s[8]||(s[8]=e=>d(l).withdraw_from_cashbox=e)},null,512),[[rt,d(l).withdraw_from_cashbox]]),s[41]||(s[41]=t("label",{class:"form-check-label",for:"withdrawFromCashbox"}," سحب من الصندوق ",-1))]),d(l).withdraw_from_cashbox?(r(),i("div",ts,[s[42]||(s[42]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),f(" سيتم سحب "+a(Math.round(A.value))+" "+a(d(l).currency)+" من الصندوق الرئيسي ",1)])):_("",!0)])]),t("div",ss,[D(d(F),{href:o.route("purchase-invoices.index"),class:"btn btn-secondary"},{default:M(()=>s[43]||(s[43]=[t("i",{class:"bi bi-arrow-right me-2"},null,-1),f(" إلغاء ")])),_:1},8,["href"]),t("button",{type:"submit",class:"btn btn-primary",disabled:d(l).items.length===0||x.value},[x.value?(r(),i("span",os)):(r(),i("i",ls)),f(" "+a(x.value?"جاري الحفظ...":"حفظ الفاتورة"),1)],8,es)])],32)])])]),w.value?(r(),i("div",ns,[t("div",rs,[t("div",as,[t("div",is,[s[45]||(s[45]=t("h5",{class:"modal-title"},"إضافة مورد جديد",-1)),t("button",{type:"button",class:"btn-close",onClick:s[9]||(s[9]=e=>w.value=!1)})]),t("div",ds,[t("form",{onSubmit:j(O,["prevent"])},[t("div",us,[s[46]||(s[46]=t("label",{class:"form-label"},"اسم المورد",-1)),u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[10]||(s[10]=e=>b.name=e),required:""},null,512),[[c,b.name]])]),t("div",cs,[s[47]||(s[47]=t("label",{class:"form-label"},"رقم الهاتف",-1)),u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=e=>b.phone=e)},null,512),[[c,b.phone]])])],32)]),t("div",ps,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[12]||(s[12]=e=>w.value=!1)}," إلغاء "),t("button",{type:"button",class:"btn btn-primary",onClick:O}," إضافة المورد ")])])])])):_("",!0),g.value?(r(),i("div",ms,[t("div",bs,[t("div",vs,[t("div",fs,[s[48]||(s[48]=t("h5",{class:"modal-title"},"إضافة منتج يدوياً",-1)),t("button",{type:"button",class:"btn-close",onClick:s[13]||(s[13]=e=>g.value=!1)})]),t("div",_s,[t("form",{onSubmit:j(L,["prevent"])},[t("div",ys,[s[50]||(s[50]=t("label",{class:"form-label"},"اختر المنتج",-1)),u(t("select",{class:"form-select","onUpdate:modelValue":s[14]||(s[14]=e=>n.product_id=e),required:""},[s[49]||(s[49]=t("option",{value:""},"اختر منتج...",-1)),(r(!0),i(E,null,P(S.products,e=>(r(),i("option",{key:e.id,value:e.id},a(e.name)+" - "+a(e.barcode||"غير محدد"),9,hs))),128))],512),[[z,n.product_id]])]),t("div",ws,[t("div",gs,[t("div",xs,[s[51]||(s[51]=t("label",{class:"form-label"},"الكمية",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[15]||(s[15]=e=>n.quantity=e),min:"1",required:""},null,512),[[c,n.quantity,void 0,{number:!0}]])])]),t("div",ks,[t("div",qs,[s[52]||(s[52]=t("label",{class:"form-label"},"سعر التكلفة",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[16]||(s[16]=e=>n.cost_price=e),step:"1",min:"0",required:""},null,512),[[c,n.cost_price,void 0,{number:!0}]])])])]),t("div",Cs,[s[53]||(s[53]=t("label",{class:"form-label"},"سعر البيع",-1)),u(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[17]||(s[17]=e=>n.sales_price=e),step:"1",min:"0",required:""},null,512),[[c,n.sales_price,void 0,{number:!0}]])])],32)]),t("div",Vs,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[18]||(s[18]=e=>g.value=!1)}," إلغاء "),t("button",{type:"button",class:"btn btn-primary",onClick:L}," إضافة المنتج ")])])])])):_("",!0),w.value||g.value?(r(),i("div",Ss)):_("",!0)])]),_:1},8,["translations"]))}},Es=it(Us,[["__scopeId","data-v-5c6f1baa"]]);export{Es as default};
