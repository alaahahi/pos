import{r as k,k as K,a as n,h as W,w as $,b as s,t as a,d,l as m,x as C,c as i,e as u,A as j,f,F as y,n as x,i as X,u as F,p as Y,j as B,g as h}from"./app-3XmFid0x.js";import{_ as ss}from"./AuthenticatedLayout-CB5i1jAM.js";import{_ as ts}from"./_plugin-vue_export-helper-DlAUqK2U.js";const es={class:"section dashboard"},ls={class:"row mb-4"},os={class:"col-xl-3 col-md-6"},ns={class:"card info-card"},is={class:"card-body"},as={class:"d-flex align-items-center"},ds={class:"ps-3"},rs={class:"col-xl-3 col-md-6"},cs={class:"card info-card"},us={class:"card-body"},bs={class:"d-flex align-items-center"},ms={class:"ps-3"},vs={class:"col-xl-3 col-md-6"},gs={class:"card info-card"},ps={class:"card-body"},fs={class:"d-flex align-items-center"},ys={class:"ps-3"},_s={class:"col-xl-3 col-md-6"},xs={class:"card info-card"},hs={class:"card-body"},ws={class:"d-flex align-items-center"},ks={class:"ps-3"},Cs={class:"card"},js={class:"card-header"},Us={class:"d-flex justify-content-between align-items-center"},Ss={class:"card-title mb-0"},Ts={class:"card-body"},Ds={class:"row mb-4"},Ms={class:"col-12"},Vs={class:"input-group mb-3"},As={class:"row mb-3 g-3"},Ls={class:"col-md-3"},$s=["value"],Fs={class:"col-md-3"},Bs=["value"],Ns={class:"col-md-3"},Os=["value"],Is={class:"col-md-3"},Hs={key:0,class:"mb-3"},Rs={class:"d-flex align-items-center gap-2 flex-wrap"},qs={key:0,class:"badge bg-primary"},Es={key:1,class:"badge bg-warning"},zs={key:2,class:"badge bg-info"},Ps={key:3,class:"badge bg-success"},Qs={class:"table-responsive"},Zs={class:"table table-hover table-striped align-middle"},Gs={key:0},Js={scope:"row",class:"text-center"},Ks={class:"d-flex align-items-center"},Ws={class:"text-center"},Xs={class:"bg-light px-2 py-1 rounded"},Ys={class:"text-muted"},st={class:"text-center"},tt={class:"btn-group",role:"group"},et=["onClick"],lt={class:"d-flex justify-content-center mt-3"},ot={class:"pagination"},nt=["href","onClick","innerHTML"],it=["innerHTML"],at={class:"modal fade",id:"cleanLogsModal",tabindex:"-1"},dt={class:"modal-dialog"},rt={class:"modal-content"},ct={class:"modal-body"},ut={class:"mb-3"},bt={class:"form-text"},mt={__name:"index",props:{logs:Object,users:Array,modules:Array,actions:Array,statistics:Object,filters:Object,translations:Object},setup(r){var U,S,T,D;const v=r,g=k(30),p=k(""),l=k({module_name:((U=v.filters)==null?void 0:U.module_name)||"",action:((S=v.filters)==null?void 0:S.action)||"",by_user_id:((T=v.filters)==null?void 0:T.by_user_id)||"",date:((D=v.filters)==null?void 0:D.date)||"",search:""}),c=()=>{h.get(route("logs"),l.value,{preserveState:!0,replace:!0})},N=o=>{if(!o)return"-";try{let t=o;typeof o=="object"&&o.date&&(t=o.date),typeof t=="string"&&(t=t.replace(/\.\d+Z?$/,"").trim());const b=new Date(t);return isNaN(b.getTime())?(console.warn("تاريخ غير صالح:",o),"-"):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(b)}catch(t){return console.error("خطأ في تنسيق التاريخ:",t,"القيمة:",o),"-"}},O=o=>["Created","Updated","Deleted"].includes(o.action),I=o=>{confirm("هل أنت متأكد من التراجع عن هذا الإجراء؟")&&h.post(route("logs.undo",o))},H=()=>{confirm(`هل أنت متأكد من حذف السجلات الأقدم من ${g.value} يوم؟`)&&h.post(route("logs.clean"),{days:g.value})},R=()=>{l.value.search=p.value,c()},q=()=>{p.value="",l.value.search="",c()},E=K(()=>l.value.module_name||l.value.action||l.value.by_user_id||l.value.date),_=o=>{l.value[o]="",c()},z=()=>{l.value={module_name:"",action:"",by_user_id:"",date:"",search:l.value.search},c()},P=o=>{const t=v.users.find(b=>b.id==o);return t?t.name:"غير محدد"},Q=o=>({Product:"bg-primary",Order:"bg-success",User:"bg-info",Customer:"bg-warning",Supplier:"bg-secondary",Expense:"bg-danger",Box:"bg-dark"})[o]||"bg-secondary",Z=o=>({Created:"bg-success",Updated:"bg-warning",Deleted:"bg-danger","Status Toggled":"bg-info",Restored:"bg-primary"})[o]||"bg-secondary",G=o=>({Created:"bi bi-plus-circle me-1",Updated:"bi bi-pencil-square me-1",Deleted:"bi bi-trash me-1","Status Toggled":"bi bi-toggle-on me-1",Restored:"bi bi-arrow-counterclockwise me-1"})[o]||"bi bi-circle me-1",J=o=>({Created:"إنشاء",Updated:"تحديث",Deleted:"حذف","Status Toggled":"تغيير الحالة",Restored:"استعادة"})[o]||o;return(o,t)=>(n(),W(ss,{translations:r.translations},{default:$(()=>{var b,w,M,V;return[s("section",es,[s("div",ls,[s("div",os,[s("div",ns,[s("div",is,[t[11]||(t[11]=s("h5",{class:"card-title"},"إجمالي السجلات",-1)),s("div",as,[t[10]||(t[10]=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-journal-text"})],-1)),s("div",ds,[s("h6",null,a(((b=r.statistics)==null?void 0:b.total)||0),1)])])])])]),s("div",rs,[s("div",cs,[s("div",us,[t[13]||(t[13]=s("h5",{class:"card-title"},"اليوم",-1)),s("div",bs,[t[12]||(t[12]=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-calendar-day"})],-1)),s("div",ms,[s("h6",null,a(((w=r.statistics)==null?void 0:w.today)||0),1)])])])])]),s("div",vs,[s("div",gs,[s("div",ps,[t[15]||(t[15]=s("h5",{class:"card-title"},"هذا الأسبوع",-1)),s("div",fs,[t[14]||(t[14]=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-calendar-week"})],-1)),s("div",ys,[s("h6",null,a(((M=r.statistics)==null?void 0:M.this_week)||0),1)])])])])]),s("div",_s,[s("div",xs,[s("div",hs,[t[17]||(t[17]=s("h5",{class:"card-title"},"هذا الشهر",-1)),s("div",ws,[t[16]||(t[16]=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-calendar-month"})],-1)),s("div",ks,[s("h6",null,a(((V=r.statistics)==null?void 0:V.this_month)||0),1)])])])])])]),s("div",Cs,[s("div",js,[s("div",Us,[s("h5",Ss,[t[18]||(t[18]=s("i",{class:"bi bi-journal-text me-2"},null,-1)),d(" "+a(r.translations.logs),1)]),t[19]||(t[19]=s("div",{class:"d-flex gap-2"},[s("button",{type:"button",class:"btn btn-warning btn-sm","data-bs-toggle":"modal","data-bs-target":"#cleanLogsModal"},[s("i",{class:"bi bi-trash me-1"}),d(" تنظيف السجلات القديمة ")])],-1))])]),s("div",Ts,[s("div",Ds,[s("div",Ms,[s("div",Vs,[t[21]||(t[21]=s("span",{class:"input-group-text bg-primary text-white"},[s("i",{class:"bi bi-search"})],-1)),m(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),onInput:R,class:"form-control form-control-lg",placeholder:"بحث في السجلات..."},null,544),[[C,p.value]]),p.value?(n(),i("button",{key:0,onClick:q,class:"btn btn-outline-secondary",type:"button"},t[20]||(t[20]=[s("i",{class:"bi bi-x-lg"},null,-1)]))):u("",!0)])])]),s("div",As,[s("div",Ls,[t[23]||(t[23]=s("label",{class:"form-label fw-bold"},[s("i",{class:"bi bi-box-seam text-primary me-1"}),d(" الوحدة ")],-1)),m(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.module_name=e),onChange:c,class:"form-select"},[t[22]||(t[22]=s("option",{value:""},"جميع الوحدات",-1)),(n(!0),i(y,null,f(r.modules,e=>(n(),i("option",{key:e,value:e},a(e),9,$s))),128))],544),[[j,l.value.module_name]])]),s("div",Fs,[t[25]||(t[25]=s("label",{class:"form-label fw-bold"},[s("i",{class:"bi bi-lightning text-warning me-1"}),d(" العملية ")],-1)),m(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.action=e),onChange:c,class:"form-select"},[t[24]||(t[24]=s("option",{value:""},"جميع العمليات",-1)),(n(!0),i(y,null,f(r.actions,e=>(n(),i("option",{key:e,value:e},a(e),9,Bs))),128))],544),[[j,l.value.action]])]),s("div",Ns,[t[27]||(t[27]=s("label",{class:"form-label fw-bold"},[s("i",{class:"bi bi-person text-info me-1"}),d(" المستخدم ")],-1)),m(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.by_user_id=e),onChange:c,class:"form-select"},[t[26]||(t[26]=s("option",{value:""},"جميع المستخدمين",-1)),(n(!0),i(y,null,f(r.users,e=>(n(),i("option",{key:e.id,value:e.id},a(e.name),9,Os))),128))],544),[[j,l.value.by_user_id]])]),s("div",Is,[t[28]||(t[28]=s("label",{class:"form-label fw-bold"},[s("i",{class:"bi bi-calendar text-success me-1"}),d(" التاريخ ")],-1)),m(s("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=e=>l.value.date=e),onChange:c,class:"form-control"},null,544),[[C,l.value.date]])])]),E.value?(n(),i("div",Hs,[s("div",Rs,[t[30]||(t[30]=s("span",{class:"badge bg-secondary"},"الفلاتر النشطة:",-1)),l.value.module_name?(n(),i("span",qs,[d(a(l.value.module_name)+" ",1),s("i",{onClick:t[5]||(t[5]=e=>_("module_name")),class:"bi bi-x ms-1",style:{cursor:"pointer"}})])):u("",!0),l.value.action?(n(),i("span",Es,[d(a(l.value.action)+" ",1),s("i",{onClick:t[6]||(t[6]=e=>_("action")),class:"bi bi-x ms-1",style:{cursor:"pointer"}})])):u("",!0),l.value.by_user_id?(n(),i("span",zs,[d(a(P(l.value.by_user_id))+" ",1),s("i",{onClick:t[7]||(t[7]=e=>_("by_user_id")),class:"bi bi-x ms-1",style:{cursor:"pointer"}})])):u("",!0),l.value.date?(n(),i("span",Ps,[d(a(l.value.date)+" ",1),s("i",{onClick:t[8]||(t[8]=e=>_("date")),class:"bi bi-x ms-1",style:{cursor:"pointer"}})])):u("",!0),s("button",{onClick:z,class:"btn btn-sm btn-outline-danger"},t[29]||(t[29]=[s("i",{class:"bi bi-x-circle me-1"},null,-1),d(" مسح الكل ")]))])])):u("",!0),s("div",Qs,[s("table",Zs,[t[36]||(t[36]=s("thead",{class:"table-primary"},[s("tr",null,[s("th",{scope:"col",class:"text-center",style:{width:"50px"}},"#"),s("th",{scope:"col"},[s("i",{class:"bi bi-person me-1"}),d(" المستخدم ")]),s("th",{scope:"col"},[s("i",{class:"bi bi-box-seam me-1"}),d(" الوحدة ")]),s("th",{scope:"col"},[s("i",{class:"bi bi-lightning me-1"}),d(" العملية ")]),s("th",{scope:"col",class:"text-center"},[s("i",{class:"bi bi-hash me-1"}),d(" معرف السجل ")]),s("th",{scope:"col"},[s("i",{class:"bi bi-clock me-1"}),d(" التاريخ ")]),s("th",{scope:"col",class:"text-center",style:{width:"120px"}},"الإجراءات")])],-1)),s("tbody",null,[r.logs.data.length===0?(n(),i("tr",Gs,t[31]||(t[31]=[s("td",{colspan:"7",class:"text-center py-5 text-muted"},[s("i",{class:"bi bi-inbox display-4 d-block mb-3"}),s("h5",null,"لا توجد سجلات"),s("p",null,"جرب تغيير الفلاتر أو البحث")],-1)]))):u("",!0),(n(!0),i(y,null,f(r.logs.data,(e,A)=>{var L;return n(),i("tr",{key:e.id},[s("th",Js,a(r.logs.from+A),1),s("td",null,[s("div",Ks,[t[32]||(t[32]=s("div",{class:"avatar-circle me-2"},[s("i",{class:"bi bi-person-fill"})],-1)),s("strong",null,a(((L=e.user)==null?void 0:L.name)||"غير محدد"),1)])]),s("td",null,[s("span",{class:x(["badge","rounded-pill",Q(e.module_name)])},a(e.module_name),3)]),s("td",null,[s("span",{class:x(["badge","rounded-pill",Z(e.action)])},[s("i",{class:x(G(e.action))},null,2),d(" "+a(J(e.action)),1)],2)]),s("td",Ws,[s("code",Xs,a(e.affected_record_id),1)]),s("td",null,[s("small",Ys,[t[33]||(t[33]=s("i",{class:"bi bi-calendar3 me-1"},null,-1)),d(" "+a(N(e.created_at)),1)])]),s("td",st,[s("div",tt,[X(F(Y),{href:o.route("logs.view",e.id),class:"btn btn-sm btn-outline-primary",title:"عرض التفاصيل"},{default:$(()=>t[34]||(t[34]=[s("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["href"]),O(e)?(n(),i("button",{key:0,onClick:vt=>I(e.id),class:"btn btn-sm btn-outline-warning",title:"التراجع"},t[35]||(t[35]=[s("i",{class:"bi bi-arrow-counterclockwise"},null,-1)]),8,et)):u("",!0)])])])}),128))])])]),s("div",lt,[s("nav",null,[s("ul",ot,[(n(!0),i(y,null,f(r.logs.links,e=>(n(),i("li",{key:e.label,class:x(["page-item",{active:e.active,disabled:!e.url}])},[e.url?(n(),i("a",{key:0,href:e.url,class:"page-link",onClick:B(A=>F(h).get(e.url),["prevent"]),innerHTML:e.label},null,8,nt)):(n(),i("span",{key:1,class:"page-link",innerHTML:e.label},null,8,it))],2))),128))])])])])])]),s("div",at,[s("div",dt,[s("div",rt,[t[39]||(t[39]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"تنظيف السجلات القديمة"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("form",{onSubmit:B(H,["prevent"])},[s("div",ct,[s("div",ut,[t[37]||(t[37]=s("label",{class:"form-label"},"حذف السجلات الأقدم من (أيام)",-1)),m(s("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=e=>g.value=e),class:"form-control",min:"1",max:"365",required:""},null,512),[[C,g.value]]),s("div",bt," سيتم حذف جميع السجلات الأقدم من "+a(g.value)+" يوم ",1)])]),t[38]||(t[38]=s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"إلغاء"),s("button",{type:"submit",class:"btn btn-warning"},"تنظيف")],-1))],32)])])])]}),_:1},8,["translations"]))}},yt=ts(mt,[["__scopeId","data-v-e2fcf04e"]]);export{yt as default};
