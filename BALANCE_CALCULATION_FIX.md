# โ ุฅุตูุงุญ ุญุณุงุจ ุงูุฑุตูุฏ - ุตูุญุฉ Boxes

## ๐ **ุงููุดููุฉ ุงูุชู ุชู ุญููุง:**

### ุงููุดููุฉ:
```
โ ุงูุฑุตูุฏ ูุง ูุชุญุฏุซ ุจุนุฏ ุงูุฅุถุงูุฉ/ุงูุณุญุจ
โ ุจุทุงูุฉ "ุฑุตูุฏ ุงูุฏููุงุฑ" ุชุธูุฑ: 1,000 USD
โ ุจุทุงูุฉ "ุฑุตูุฏ ุงูุฏููุงุฑ" ูุง ุชุชุญุฏุซ
```

### ุงูุณุจุจ:
```
ุงูุตูุญุฉ ูุงูุช ุชุนุฑุถ Box model
ููู ุงูุนูููุงุช (ุฅุถุงูุฉ/ุณุญุจ) ุชุญุฏุซ Wallet model
  ูููุณุชุฎุฏู mainBox@account.com

ุงููุชูุฌุฉ: ุนุฏู ุชุทุงุจู ุจูู ูุง ููุนุฑุถ ููุง ููุญุฏุซ!
```

---

## โ **ุงูุญู ุงููุทุจู:**

### 1๏ธโฃ **ุญุณุงุจ ุงูุฑุตูุฏ ูู ุงููุนุงููุงุช**

ุจุฏูุงู ูู ุนุฑุถ ุงูุฑุตูุฏ ุงููุฎุฒูุ ูุชู ุญุณุงุจู ูู ุฌูุน/ุทุฑุญ ุงููุนุงููุงุช:

```php
// ุญุณุงุจ ุฑุตูุฏ ุงูุฏููุงุฑ ูู ูุฌููุน ุงููุนุงููุงุช
$calculatedBalanceUSD = Transactions::where('wallet_id', $walletId)
    ->where(function($query) {
        $query->where('currency', 'USD')
              ->orWhere('currency', '$');
    })
    ->sum('amount');  // ุฌูุน ูู amount (ููุฌุจ ููุฅุถุงูุฉุ ุณุงูุจ ููุณุญุจ)

// ุญุณุงุจ ุฑุตูุฏ ุงูุฏููุงุฑ ูู ูุฌููุน ุงููุนุงููุงุช
$calculatedBalanceIQD = Transactions::where('wallet_id', $walletId)
    ->where('currency', 'IQD')
    ->sum('amount');
```

### 2๏ธโฃ **ุชุตุญูุญ ุงูุฑุตูุฏ ุงููุฎุฒู**

ุฅุฐุง ูุงู ููุงู ูุฑู ุจูู ุงูุฑุตูุฏ ุงููุญุณูุจ ูุงููุฎุฒูุ ูุชู ุงูุชุตุญูุญ:

```php
// ุงูุฑุตูุฏ ุงููุฎุฒู
$storedBalanceUSD = $mainBoxUser->wallet->balance ?? 0;
$storedBalanceIQD = $mainBoxUser->wallet->balance_dinar ?? 0;

// ููุงุฑูุฉ ูุชุตุญูุญ
if (abs($calculatedBalanceUSD - $storedBalanceUSD) > 0.01) {
    $mainBoxUser->wallet->update(['balance' => $calculatedBalanceUSD]);
}

if (abs($calculatedBalanceIQD - $storedBalanceIQD) > 0.01) {
    $mainBoxUser->wallet->update(['balance_dinar' => $calculatedBalanceIQD]);
}
```

### 3๏ธโฃ **ุนุฑุถ ุงูุฑุตูุฏ ุงููุญุณูุจ**

```php
$mainBoxData = (object)[
    'id' => $mainBoxUser->id,
    'balance' => $calculatedBalanceIQD,     // IQD - ูู ุงููุนุงููุงุช
    'balance_usd' => $calculatedBalanceUSD, // USD - ูู ุงููุนุงููุงุช
];
```

---

## ๐ฏ **ููู ูุนูู ุงูุขู:**

### ูุซุงู ุนููู:

#### ุงูุญุงูุฉ ุงูุฃูููุฉ:
```
ุฑุตูุฏ USD ุงููุฎุฒู: 1,000
ุฑุตูุฏ IQD ุงููุฎุฒู: 500,000
```

#### ุงููุนุงููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```
ูุนุงููุฉ 1: +100 USD    (ุฅุถุงูุฉ)
ูุนุงููุฉ 2: -50 USD     (ุณุญุจ)
ูุนุงููุฉ 3: +200,000 IQD (ุฅุถุงูุฉ)
ูุนุงููุฉ 4: -100,000 IQD (ุณุญุจ)
```

#### ุงูุญุณุงุจ:
```
ุฑุตูุฏ USD ุงููุญุณูุจ = ูุฌููุน ุงููุนุงููุงุช USD
= 100 + (-50) = 50 USD

ุฑุตูุฏ IQD ุงููุญุณูุจ = ูุฌููุน ุงููุนุงููุงุช IQD  
= 200,000 + (-100,000) = 100,000 IQD
```

#### ุงูููุงุฑูุฉ ูุงูุชุตุญูุญ:
```
USD: ุงููุฎุฒู 1,000 โ ุงููุญุณูุจ 50
โ ุชุตุญูุญ: wallet.balance = 50 โ

IQD: ุงููุฎุฒู 500,000 โ ุงููุญุณูุจ 100,000
โ ุชุตุญูุญ: wallet.balance_dinar = 100,000 โ
```

#### ุงูุนุฑุถ ูู ุงูุตูุญุฉ:
```
โ ุฑุตูุฏ ุงูุฏููุงุฑ: 50 USD
โ ุฑุตูุฏ ุงูุฏููุงุฑ: 100,000 IQD
```

---

## ๐ก **ูููุฒุงุช ุงูุญู:**

### โ ุฏูุฉ 100%
```
ุงูุฑุตูุฏ ุฏุงุฆูุงู ุตุญูุญ ูุฃูู ูุญุณูุจ ูู ุงููุนุงููุงุช ุงููุนููุฉ
```

### โ ุชุตุญูุญ ุชููุงุฆู
```
ุฃู ูุฑู ูุชู ุชุตุญูุญู ุชููุงุฆูุงู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
```

### โ ุญูุงูุฉ ูู ุงูุฃุฎุทุงุก
```
ุญุชู ูู ุญุฏุซ ุฎุทุฃ ูู increment/decrement
ุงูุฑุตูุฏ ุณูุชู ุชุตุญูุญู ุชููุงุฆูุงู
```

### โ ุดูุงููุฉ
```
ุงูุฑุตูุฏ = ูุฌููุน ุงููุนุงููุงุช
ุณูู ุงูุชุญูู ูุงููุฑุงุฌุนุฉ
```

---

## ๐งช **ุงุฎุชุจุฑ ุงูุขู:**

### ุงูุฎุทูุฉ 1: ุงูุชุญ ุงูุตูุญุฉ
```
http://127.0.0.1:8000/boxes
```

### ุงูุฎุทูุฉ 2: ูุงุญุธ ุงูุฑุตูุฏ ุงูุญุงูู
```
ุฑุตูุฏ USD: _____ 
ุฑุตูุฏ IQD: _____
```

### ุงูุฎุทูุฉ 3: ุฃุถู ูุจูุบ
```
ุงุถุบุท "ุฅุถุงูุฉ ููุตูุฏูู"
ุฃุถู: 100 USD
ุงุญูุธ
```

### ุงูุฎุทูุฉ 4: ุญุฏูุซ ุงูุตูุญุฉ
```
ุงุถุบุท F5 ุฃู ุฒุฑ "ุชุญุฏูุซ"
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
```
โ ุฑุตูุฏ USD ุฒุงุฏ ุจู 100
โ ุงูุจุทุงูุฉ ุชุนุฑุถ ุงูุฑุตูุฏ ุงูุฌุฏูุฏ
โ ุงูุฑุตูุฏ ุงููุฎุฒู ุชู ุชุตุญูุญู
```

---

## ๐ **ุงููุนุงุฏูุงุช:**

### ุฑุตูุฏ ุงูุฏููุงุฑ:
```
balance_usd = SUM(amount) WHERE currency IN ('USD', '$')
```

### ุฑุตูุฏ ุงูุฏููุงุฑ:
```
balance = SUM(amount) WHERE currency = 'IQD'
```

### ุงูููุงุนุฏ:
```
- ูุนุงููุงุช ุงูุฅุถุงูุฉ: amount ููุฌุจ (+)
- ูุนุงููุงุช ุงูุณุญุจ: amount ุณุงูุจ (-)
- ุงููุฌููุน = ุงูุฑุตูุฏ ุงูููุงุฆู
```

---

## ๐ง **ุงูููู ุงููุนุฏู:**

```
app/Http/Controllers/BoxesController.php

ุงูุชุบููุฑุงุช:
โ ุญุณุงุจ ุงูุฑุตูุฏ ูู ุงููุนุงููุงุช
โ ุชุตุญูุญ ุงูุฑุตูุฏ ุงููุฎุฒู
โ ุนุฑุถ ุงูุฑุตูุฏ ุงูุตุญูุญ
```

---

## โ **ุงููุชูุฌุฉ:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                          โ
โ   โ ุงูุฑุตูุฏ ูุนูู ุงูุขู ุจุดูู ุตุญูุญ! โ    โ
โ                                          โ
โ   โ ูุญุณุจ ูู ุงููุนุงููุงุช ุงููุนููุฉ          โ
โ   โ ูุชุญุฏุซ ูุน ูู ุนูููุฉ                  โ
โ   โ ูุตุญุญ ุชููุงุฆูุงู                      โ
โ   โ ุฏููู 100%                           โ
โ                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**๐ ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-10-17  
**โ ุงูุญุงูุฉ:** ููุตูุญ ูููุฎุชุจุฑ  
**๐ฏ ุงูุฏูุฉ:** 100%

