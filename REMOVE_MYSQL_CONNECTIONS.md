# โ ุฅุฒุงูุฉ ุฌููุน ุงูุงุชุตุงูุงุช ุงููุจุงุดุฑุฉ ุจู MySQL

## ๐ ุงูุชุบููุฑุงุช

ุชู ุฅุฒุงูุฉ ุฌููุน ุงูุงุชุตุงูุงุช ุงููุจุงุดุฑุฉ ุจู MySQL ูู ูุธุงู ุงููุฒุงููุฉ. ุงูุขู **ุฌููุน ุงููุฒุงููุงุช ุชุชู ุนุจุฑ API ููุท**.

---

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

### 1. `app/Services/DatabaseSyncService.php`

#### โ `syncPendingChanges()`
- **ูุจู**: ูุงู ูุชุญูู ูู MySQL ุฅุฐุง ูุงู `SYNC_VIA_API=false`
- **ุจุนุฏ**: **ุฅุฌุจุงุฑ** ุงุณุชุฎุฏุงู API ููุท - ูุฑูุถ ุงููุฒุงููุฉ ุฅุฐุง ูุงู `SYNC_VIA_API=false`

#### โ `processChange()`
- **ูุจู**: ูุงู ูุชุญูู ูู MySQL ุฅุฐุง ูุงู `SYNC_VIA_API=false`
- **ุจุนุฏ**: **ุฅุฌุจุงุฑ** ุงุณุชุฎุฏุงู API ููุท

#### โ `syncInsert()`
- **ูุจู**: ูุงู ูุณุชุฎุฏู MySQL ูุจุงุดุฑุฉ ุฅุฐุง ูุงู `SYNC_VIA_API=false`
- **ุจุนุฏ**: **ุฅุฌุจุงุฑ** ุงุณุชุฎุฏุงู API ููุท - ุชู ุฅุฒุงูุฉ ุฌููุน ููุฏ MySQL

#### โ `syncUpdate()`
- **ูุจู**: ูุงู ูุณุชุฎุฏู MySQL ูุจุงุดุฑุฉ ุฅุฐุง ูุงู `SYNC_VIA_API=false`
- **ุจุนุฏ**: **ุฅุฌุจุงุฑ** ุงุณุชุฎุฏุงู API ููุท - ุชู ุฅุฒุงูุฉ ุฌููุน ููุฏ MySQL

#### โ `syncDelete()`
- **ูุจู**: ูุงู ูุณุชุฎุฏู MySQL ูุจุงุดุฑุฉ ุฅุฐุง ูุงู `SYNC_VIA_API=false`
- **ุจุนุฏ**: **ุฅุฌุจุงุฑ** ุงุณุชุฎุฏุงู API ููุท - ุชู ุฅุฒุงูุฉ ุฌููุน ููุฏ MySQL

---

### 2. `app/Services/SyncIdMappingService.php`

#### โ `checkIdConflict()`
- **ูุจู**: ูุงู ูุชุญูู ูู MySQL ูุจุงุดุฑุฉ
- **ุจุนุฏ**: ุฅุฐุง ูุงู `SYNC_VIA_API=true`ุ ูุนูุฏ `false` (API ูุชุนุงูู ูุน ID conflicts ุชููุงุฆูุงู)

#### โ `resolveConflict()`
- **ูุจู**: ูุงู ูุจุญุซ ูู MySQL ูุฅูุฌุงุฏ ID ูุชุงุญ
- **ุจุนุฏ**: ุฅุฐุง ูุงู `SYNC_VIA_API=true`ุ ูุนูุฏ `preferredId` (API ูุชุนุงูู ูุน ID conflicts ุชููุงุฆูุงู)

---

### 3. `app/Jobs/SyncPendingChangesJob.php`

#### โ `handle()`
- **ูุจู**: ูุงู ูุชุญูู ูู MySQL ูุจุงุดุฑุฉ ุญุชู ูุน `SYNC_VIA_API=true`
- **ุจุนุฏ**: ูุชุญูู ูู API ุฅุฐุง ูุงู `SYNC_VIA_API=true`ุ ููุฑูุถ ุงููุฒุงููุฉ ุฅุฐุง ูุงู `SYNC_VIA_API=false`

---

## โ ุงููุชูุฌุฉ

### ุงูุขู:
- โ **ุฌููุน ุงููุฒุงููุงุช ุชุชู ุนุจุฑ API ููุท**
- โ **ูุง ููุฌุฏ ุงุชุตุงู ูุจุงุดุฑ ุจู MySQL** ูู ูุธุงู ุงููุฒุงููุฉ
- โ **ุฅุฐุง ูุงู `SYNC_VIA_API=false`ุ ุงููุธุงู ูุฑูุถ ุงููุฒุงููุฉ** (ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ)

### ููุงุญุธุงุช:
- โ๏ธ `isMySQLAvailable()` ู `autoRetryFailedOnMySQLAvailable()` ูุง ุชูุณุชุฎุฏู ุจุนุฏ ุงูุขู (ููู ุชู ุงูุงุญุชูุงุธ ุจูุง ููุชูุงูู)
- โ๏ธ `checkIdConflict()` ู `resolveConflict()` ุชุนูุฏ ููู ุงูุชุฑุงุถูุฉ ูุน API (API ูุชุนุงูู ูุน ID conflicts ุชููุงุฆูุงู)

---

## ๐ ุงูุฃูุงู

- โ **ูุง ุงุชุตุงู ูุจุงุดุฑ ุจู MySQL** = ุฃูุงู ุฃุนูู
- โ **ุฌููุน ุงููุฒุงููุงุช ุนุจุฑ API** = ุชุญูู ุฃูุถู
- โ **API Token ูุทููุจ** = ูุตุงุฏูุฉ ุขููุฉ

---

**ุชุงุฑูุฎ**: 2025-12-23

